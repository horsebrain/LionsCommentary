%!PS-Adobe-2.0
%%Creator: dvipsk 5.490s Copyright 1986, 1992 Radical Eye Software
%%Title: lionc.dvi
%%Pages: 115 1
%%BoundingBox: 0 0 612 792
%%EndComments
%DVIPSCommandLine: dvips lionc.dvi
%%BeginProcSet: tex.pro
%!
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N /X{S N}
B /TR{translate}N /isls false N /vsize 11 72 mul N /@rigin{isls{[0 -1 1 0 0 0]
concat}if 72 Resolution div 72 VResolution div neg scale isls{Resolution hsize
-72 div mul 0 TR}if Resolution VResolution vsize -72 div 1 add mul TR matrix
currentmatrix dup dup 4 get round 4 exch put dup dup 5 get round 5 exch put
setmatrix}N /@landscape{/isls true N}B /@manualfeed{statusdict /manualfeed
true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N
/IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn begin /FontType 3 N /FontMatrix
fntrx N /FontBBox FBB N string /base X array /BitMaps X /BuildChar{
CharBuilder}N /Encoding IE N end dup{/foo setfont}2 array copy cvx N load 0 nn
put /ctr 0 N[}B /df{/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0
0 sf neg 0 0]N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data
dup length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{128
ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub get 127
sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data dup type
/stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N /rc 0 N /gp 0 N
/cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup /base get 2 index get
S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0 ch-xoff ch-yoff ch-height
sub ch-xoff ch-width add ch-yoff setcachedevice ch-width ch-height true[1 0 0
-1 -.1 ch-xoff sub ch-yoff .1 add]{ch-image}imagemask restore}B /D{/cc X dup
type /stringtype ne{]}if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1
ne{dup dup length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}
B /I{cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul add
.99 lt{/FV}{/RV}ifelse load def pop}N /eop{SI restore showpage userdict
/eop-hook known{eop-hook}if}N /@start{userdict /start-hook known{start-hook}
if /VResolution X /Resolution X 1000 div /DVImag X /IE 256 array N 0 1 255{IE
S 1 string dup 0 3 index put cvn put}for 65781.76 div /vsize X 65781.76 div
/hsize X}N /p{show}N /RMat[1 0 0 -1 0 0]N /BDot 260 string N /rulex 0 N /ruley
0 N /v{/ruley X /rulex X V}B /V{}B /RV statusdict begin /product where{pop
product dup length 7 ge{0 7 getinterval dup(Display)eq exch 0 4 getinterval
(NeXT)eq or}{pop false}ifelse}{false}ifelse end{{gsave TR -.1 -.1 TR 1 1 scale
rulex ruley false RMat{BDot}imagemask grestore}}{{gsave TR -.1 -.1 TR rulex
ruley scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /FV{gsave
transform round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail{dup
/delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}B /d{-3 M}
B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{4 M}B /w{0
rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{p 1 w}B /r{p 2 w}
B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p a}B /bos{/SS save N}B
/eos{SS restore}B end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 300 300 @start /Fa 4 114
df<0000020000000E0000003E000001FE000007FE00003FFE0001FFFE000FFFFE00FFFFFE00FF
FFFE000FFFFE0001FFFE00003FFE000007FE000001FE0000003E0000000E000000020019127E88
2A>27 D<800000E00000F80000FF0000FFC000FFF800FFFF00FFFFE0FFFFFEFFFFFEFFFFE0FFFF
00FFF800FFC000FF0000F80000E0000080000017126F882A>45 D<700000000000FE0000000000
FFC0000000007FF8000000001FFF0000000003FFE0000000007FFC000000000FFF8000000001FF
F0000000003FFE0000000007FFC000000000FFF8000000001FFF0000000003FFE0000000007FF8
000000000FFC0000000001FC0000000000382E12828F2A>80 D<04000000060000000F0000000F
8000000FC000001FF000001FF800001FFC00003FFE00003FFF00003FFFC0007FFFE0007FFFF800
7FFFFC00FFFFFF00FE000180800000001A11708F2A>113 D E /Fb 27 117
df<004001C007C0FFC0F9C001C001C001C001C001C001C001C001C001C001C001C001C001C001
C001C001C001C001C001C001C001C001C001C001C001C001C07FFF7FFF10217CA019>49
D<03F8000FFE00181F802007C04003C04001E0F801E0FC01F0FC00F0FC00F07800F03001F00001
E00001E00003E00003C0000780000700000E00001C0000380000700000E0000080000100000200
100400100800101000302000207FFFE0FFFFE0FFFFE014217EA019>I<01F8000FFE001C0F8030
03C03803C07C03E07C01E07C01E03C03E01803E00003C0000380000780000E00001C0003F80000
0E000007800003C00003E00001E00001F00001F03001F07801F0FC01F0FC01F0FC01E0F803E040
03C02007801C0F000FFE0003F80014227EA019>I<000300000300000700000F00000F00001700
00370000270000470000C7000087000107000307000207000407000C0700080700100700300700
200700400700C00700FFFFFCFFFFFC00070000070000070000070000070000070000070000FFF8
00FFF816217FA019>I<FFFFF800FFFFFE0007800F80078003C0078001E0078000F00780007807
8000780780003C0780003C0780001E0780001E0780001E0780001F0780001F0780001F0780001F
0780001F0780001F0780001F0780001F0780001F0780001E0780001E0780003E0780003C078000
3C07800078078000F0078001E0078003C007800F80FFFFFF00FFFFF80020227EA126>68
D<FFFFFFE0FFFFFFE0078003E0078000E007800060078000200780003007800030078000100780
2010078020100780201007802000078060000780E00007FFE00007FFE0000780E0000780600007
802000078020000780200407802004078000040780000807800008078000080780001807800018
0780003807800078078001F0FFFFFFF0FFFFFFF01E227EA122>I<FFFC3FFFFFFC3FFF078001E0
078001E0078001E0078001E0078001E0078001E0078001E0078001E0078001E0078001E0078001
E0078001E0078001E007FFFFE007FFFFE0078001E0078001E0078001E0078001E0078001E00780
01E0078001E0078001E0078001E0078001E0078001E0078001E0078001E0078001E0078001E0FF
FC3FFFFFFC3FFF20227EA125>72 D<FF8007FFFFC007FF07C000F805E0002004F0002004F00020
04780020047C0020043C0020041E0020041E0020040F002004078020040780200403C0200401E0
200401E0200400F0200400F8200400782004003C2004003C2004001E2004000F2004000F200400
07A0040003E0040003E0040001E0040001E0040000E01F000060FFE00060FFE0002020227EA125
>78 D<7FFFFFFC7FFFFFFC7803C03C6003C00C4003C0044003C004C003C006C003C0068003C002
8003C0028003C0028003C0020003C0000003C0000003C0000003C0000003C0000003C0000003C0
000003C0000003C0000003C0000003C0000003C0000003C0000003C0000003C0000003C0000003
C0000003C0000003C0000003C00001FFFF8001FFFF801F227EA124>84 D<1FF000381C007C0600
7C07007C0380380380000380000380007F8007C3801E03803C0380780380780380F00384F00384
F00384F00784780B843C11C80FE0F016157E9419>97 D<0000700007F00007F00000F000007000
007000007000007000007000007000007000007000007000007001F8700706700E01701C00F038
0070780070700070F00070F00070F00070F00070F00070F00070F000707000707800703800701C
00F00C017807067F01F87F18237EA21C>100 D<01FC000707000C03801C01C03801C07800E070
00E0F000E0FFFFE0F00000F00000F00000F00000F000007000007800203800201C00400E008007
030000FC0013157F9416>I<003E0000E30001C780038F80030F80070700070000070000070000
070000070000070000070000070000FFF800FFF800070000070000070000070000070000070000
0700000700000700000700000700000700000700000700000700000700000700007FF8007FF800
112380A20F>I<00007801F08C071D1C0E0E1C1C07001C07003C07803C07803C07803C07801C07
001C07000E0E000F1C0019F0001000001000001800001C00001FFF000FFFE00FFFF03800F86000
1840001CC0000CC0000CC0000C6000186000183800700E01C001FE0016217F9519>I<0E000000
FE000000FE0000001E0000000E0000000E0000000E0000000E0000000E0000000E0000000E0000
000E0000000E0000000E0000000E1F80000E60E0000E8070000F0038000F0038000E0038000E00
38000E0038000E0038000E0038000E0038000E0038000E0038000E0038000E0038000E0038000E
0038000E0038000E003800FFE3FF80FFE3FF8019237FA21C>I<1C003E003E003E001C00000000
000000000000000000000000000E00FE00FE001E000E000E000E000E000E000E000E000E000E00
0E000E000E000E000E000E00FFC0FFC00A227FA10E>I<00E001F001F001F000E0000000000000
0000000000000000000000F007F007F000F0007000700070007000700070007000700070007000
7000700070007000700070007000700070007000707070F870F8E0F8C071801F000C2C82A10F>
I<0E0000FE0000FE00001E00000E00000E00000E00000E00000E00000E00000E00000E00000E00
000E00000E03FC0E03FC0E01E00E01800E02000E04000E08000E10000E38000EF8000F1C000E1E
000E0E000E07000E07800E03C00E01C00E01E00E01F0FFE3FEFFE3FE17237FA21A>I<0E00FE00
FE001E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E
000E000E000E000E000E000E000E000E000E000E000E00FFE0FFE00B237FA20E>I<0E1FC07F00
FE60E18380FE807201C01F003C00E00F003C00E00E003800E00E003800E00E003800E00E003800
E00E003800E00E003800E00E003800E00E003800E00E003800E00E003800E00E003800E00E0038
00E00E003800E00E003800E0FFE3FF8FFEFFE3FF8FFE27157F942A>I<0E1F8000FE60E000FE80
70001F0038000F0038000E0038000E0038000E0038000E0038000E0038000E0038000E0038000E
0038000E0038000E0038000E0038000E0038000E0038000E003800FFE3FF80FFE3FF8019157F94
1C>I<00FC000703800E01C01C00E0380070780078700038F0003CF0003CF0003CF0003CF0003C
F0003CF0003C7000387800783800701C00E00E01C007038000FC0016157F9419>I<0E1F80FE60
E0FE80700F00380E001C0E001E0E001E0E000F0E000F0E000F0E000F0E000F0E000F0E000F0E00
1E0E001E0E001C0F00380E80700E60E00E1F800E00000E00000E00000E00000E00000E00000E00
000E0000FFE000FFE000181F7F941C>I<01F8200704600E02601C01603801E07800E07800E0F0
00E0F000E0F000E0F000E0F000E0F000E0F000E07000E07800E03801E01C01E00C02E0070CE001
F0E00000E00000E00000E00000E00000E00000E00000E00000E0000FFE000FFE171F7E941A>I<
0E1E00FE6300FE87801E87800F03000F00000E00000E00000E00000E00000E00000E00000E0000
0E00000E00000E00000E00000E00000E0000FFF000FFF00011157F9414>I<0FC4303C600CC00C
C004C004E004F0007F803FF00FF800FC001E800E8006C006C006C004E00CD81887E00F157E9414
>I<020002000200020002000600060006000E001E003FF8FFF80E000E000E000E000E000E000E
000E000E000E000E040E040E040E040E040E040708030801F00E1F7F9E13>I
E /Fc 10 118 df<FFFFFFFF00FFFFFFFF0007E0003F0003E000070003E000038003E000018003
E000018003E000008003E000008003E000008003E000008003E000004003E002004003E0020040
03E002000003E002000003E002000003E006000003E00E000003FFFE000003FFFE000003E00E00
0003E006000003E002000003E002000003E002000003E002000003E002000003E000000003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0
00000007F0000000FFFFE00000FFFFE0000022297EA827>70 D<00FE010003FF83000F81E3001E
0037003C001F0038000F007800070070000700F0000300F0000300F0000300F0000100F8000100
F8000100FC0000007C0000007F0000003FE000001FFF00000FFFE00007FFF80003FFFC00007FFE
000007FF0000007F0000001F8000000F80000007C0000007C0800003C0800003C0800003C08000
03C0C00003C0C0000380C0000380E0000780F0000700F8000E00EE001C00C3C07800C1FFF00080
3FC0001A2B7DA921>83 D<007F8001C0700780080F003C1E007C3C007C3C00387C0010780000F8
0000F80000F80000F80000F80000F80000F80000F800007800007C00003C00043C00041E00080F
001007802001C0C0007F00161A7E991B>99 D<007E0003C3800700E00E00F01C00703C00783C00
3878003C78003CF8003CF8003CFFFFFCF80000F80000F80000F80000F800007800007C00003C00
043C00041E00080E001007002001C0C0007F00161A7E991B>101 D<07000F801F801F800F8007
0000000000000000000000000000000000000007807F807F800F80078007800780078007800780
07800780078007800780078007800780078007800780078007800780FFF8FFF80D297FA811>
105 D<0783F800FF8C1C00FF900E000FA0070007A0078007C0078007C007800780078007800780
078007800780078007800780078007800780078007800780078007800780078007800780078007
800780078007800780078007800780078007800780FFFCFFFCFFFCFFFC1E1A7F9921>110
D<007F000001C1C000070070000E0038001C001C003C001E003C001E0078000F0078000F00F800
0F80F8000F80F8000F80F8000F80F8000F80F8000F80F8000F80F8000F8078000F0078000F003C
001E003C001E001E003C000E0038000700700001C1C000007F0000191A7E991E>I<0787C0FF98
E0FF91F00FA1F007C1F007C0E007C0000780000780000780000780000780000780000780000780
0007800007800007800007800007800007800007800007800007C000FFFE00FFFE00141A7F9917
>114 D<0080000080000080000080000180000180000180000380000380000780000F80001FFF
80FFFF800780000780000780000780000780000780000780000780000780000780000780000780
0007800007804007804007804007804007804007804007804003C08001C08000E100003E001225
7FA417>116 D<07800780FF80FF80FF80FF800F800F8007800780078007800780078007800780
078007800780078007800780078007800780078007800780078007800780078007800780078007
80078007800780078007800F8007800F800380178001C027C000E047FC003F87FC1E1A7F9921>
I E /Fd 2 54 df<0C001C00EC000C000C000C000C000C000C000C000C000C000C000C000C000C
000C000C00FFC00A137D9211>49 D<60607FC07F8044004000400040004F0070C040E000600070
0070E070E070E06040E021C01F000C137E9211>53 D E /Fe 51 122 df<00FC1F8001FC3F8003
FC7F800700E0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C000FFE1FC00
FFE1FC000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C000191D809C18>11
D<0001C001F1C003F1C007F0000700000E00000E00000E00000E00000E00000E00000E0000FFF1
C0FFF1C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01
C00E01C00E01C00E01C00E01C0121E809D16>I<E0E0E0E0E0E06060404040404040C0C00B087F
9C15>34 D<E0E0E060404040C003087C9C0C>39 D<00E001C0038007000E000E001C001C003800
380038007000700070007000E000E000E000E000E000E000E000E000E000E000E000E000700070
00700070003800380038001C001C000E000E000700038001C000E00B2A7E9E10>I<E000700038
001C000E000E000700070003800380038001C001C001C001C000E000E000E000E000E000E000E0
00E000E000E000E000E001C001C001C001C0038003800380070007000E000E001C0038007000E0
000B2A7E9E10>I<E0E0E060404040C003087C820C>44 D<FFE0FFE00B0280890E>I<E0E0E00303
7C820C>I<00010003000600060006000C000C000C0018001800180030003000300060006000C0
00C000C0018001800180030003000300060006000C000C000C0018001800180030003000300060
0060006000C000C00010297E9E15>I<010007003F00FF00C70007000700070007000700070007
0007000700070007000700070007000700070007000700070007000700FFF8FFF80D1C7C9B15>
49 D<07C01FF03878701C601EE00EC00F400F400700070007000F000E001E001C003C007800F0
01E001C0038007000E001C0038007000FFFFFFFF101C7E9B15>I<7FFE7FFE7000700070007000
70007000700073E07FF07FF87E3C7C1E781E780F000F000F000F000F000F000F401EC01E603C38
781FF00FC0101C7E9A15>53 D<E0E0E0000000000000000000000000E0E0E003127C910C>58
D<001C0000003E0000003E0000002E0000006700000067000000E7800000C7800000C3800001C3
C0000183C0000181C0000381E0000381E0000700F0000700F0000600F0000E0078000FFFF8000F
FFF8001C003C001C003C0018003C0038001E0038001E0070001F0070000F0070000F00E0000780
191D7F9C1C>65 D<003FC000FFF003C0F00780300F00001E00003C00003C000078000078000078
0000F00000F00000F00000F00000F00000F00000F00000F00000F000007800007800007800003C
00003C00001E00000F000807801803C07800FFF0003F80151F7D9D1B>67
D<FFFC00FFFF00F00F80F003E0F001F0F000F0F00078F00038F0003CF0003CF0001CF0001EF000
1EF0001EF0001EF0001EF0001EF0001EF0001EF0003CF0003CF0003CF00078F000F0F000F0F003
E0F00FC0FFFF00FFFC00171D7C9C1E>I<FFFF80FFFF80F00000F00000F00000F00000F00000F0
0000F00000F00000F00000F00000F00000FFFF00FFFF00F00000F00000F00000F00000F00000F0
0000F00000F00000F00000F00000F00000F00000F00000F00000111D7C9C18>70
D<F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0041D7C9C0C>73
D<F0003CF00078F000F0F001E0F003C0F00780F00F00F01E00F03C00F07800F0F000F0E000F1F0
00F3F000F77800FE7C00FC3C00FC1E00F81F00F00F00F00F80F00780F003C0F003E0F001E0F000
F0F000F0F00078F0007C161D7C9C1D>75 D<F000F000F000F000F000F000F000F000F000F000F0
00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000FFFEFFFE0F1D
7C9C16>I<003F000001FFE00003FFF00007C0F8000F807C001E001E003E001F003C000F007800
07807800078078000780F00003C0F00003C0F00003C0F00003C0F00003C0F00003C0F00003C0F0
0003C0F80007C078000780780007807C000F803C000F003E001F001F003E000F807C0007C0F800
03FFF00001FFE000003F00001A1F7E9D1F>79 D<FFFC00FFFF00F00F80F003C0F001E0F000F0F0
00F0F000F0F000F0F000F0F000F0F001E0F003E0F00FC0FFFF80FFFE00F00000F00000F00000F0
0000F00000F00000F00000F00000F00000F00000F00000F00000F00000141D7C9C1B>I<03F800
0FFE001C0F00380700700300600000E00000E00000E00000E00000F000007800007F00003FE000
1FFC0007FE0001FF00001F800007800003C00003C00001C00001C00001C00001C0C00180E00380
F007007C0E001FFC0007F000121F7E9D17>83 D<FFFFFF80FFFFFF80001E0000001E0000001E00
00001E0000001E0000001E0000001E0000001E0000001E0000001E0000001E0000001E0000001E
0000001E0000001E0000001E0000001E0000001E0000001E0000001E0000001E0000001E000000
1E0000001E0000001E0000001E0000001E0000191D7F9C1C>I<F00070F00070F00070F00070F0
0070F00070F00070F00070F00070F00070F00070F00070F00070F00070F00070F00070F00070F0
0070F00070F00070F00070F00070F000707800E07800E03C01C01E03800F078007FE0001F80014
1E7C9C1D>I<6060404040404040C0C0E0E0E0E0E0E00B08789C15>92 D<0FC03FF07FF8703840
1C001C001C00FC0FFC3FFC781CE01CE01CE01CF07C7FFC7FDC3F1C0E127E9114>97
D<E000E000E000E000E000E000E000E000E000E000E000E3E0EFF0FFF8F87CF01CE01EE00EE00E
E00EE00EE00EE00EE01CF01CF87CFFF8EFF0E3C00F1D7D9C15>I<07E00FF81FFC3C1C70047000
E000E000E000E000E000E000700070043C1C1FFC0FF807E00E127E9112>I<000E000E000E000E
000E000E000E000E000E000E000E0F8E1FEE3FFE7C3E700E700EE00EE00EE00EE00EE00EE00EF0
0E701E7C3E3FFE1FEE0F8E0F1D7E9C15>I<07C01FE03FF078787018601CFFFCFFFCFFFCE000E0
00E000700070043C1C3FFC1FF807E00E127E9112>I<00FC01FC03FC07000E000E000E000E000E
000E000E00FFE0FFE00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E00
0E000E1D809C0D>I<03C3C00FFFC01FFFC01C3800381C00381C00381C00381C00381C001C3800
1FF8001FF0003BC0003800003800001FFC001FFF003FFF80700780E001C0E001C0E001C0F003C0
7C0F803FFF001FFE0007F800121B7F9115>I<E000E000E000E000E000E000E000E000E000E000
E000E3E0EFF0FFF8F83CF01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01C0E
1D7D9C15>I<F0F0F0F000000000000000707070707070707070707070707070707070041D7E9C
0A>I<E000E000E000E000E000E000E000E000E000E000E000E03CE078E0F0E1E0E3C0E780EF00
FF00FF80FB80F9C0F1E0E0E0E0F0E078E038E03CE01E0F1D7D9C14>107
D<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0031D7D9C0A>I<E3F0
3F00EFF8FF80FFFDFFC0F81F81E0F00F00E0E00E00E0E00E00E0E00E00E0E00E00E0E00E00E0E0
0E00E0E00E00E0E00E00E0E00E00E0E00E00E0E00E00E0E00E00E0E00E00E01B127D9122>I<E3
E0EFF0FFF8F83CF01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01C0E127D91
15>I<03F0000FFC001FFE003C0F00780780700380E001C0E001C0E001C0E001C0E001C0F003C0
7003807807803C0F001FFE000FFC0003F00012127F9115>I<E3E0EFF0FFF8F87CF01CE01EE00E
E00EE00EE00EE00EE00EE01CF03CF87CFFF8EFF0E3C0E000E000E000E000E000E000E000E0000F
1A7D9115>I<078E1FEE3FFE7C3E781E700EE00EE00EE00EE00EE00EE00EF00E701E7C3E3FFE1F
EE0F8E000E000E000E000E000E000E000E000E0F1A7E9115>I<E380E780EF80FC00F800F000F0
00E000E000E000E000E000E000E000E000E000E000E00009127D910E>I<1FC03FF07FF0F030E0
00E000F0007F003FC01FE000F0003800388038F078FFF07FE01FC00D127F9110>I<1C001C001C
001C001C001C00FFE0FFE01C001C001C001C001C001C001C001C001C001C001C001C001C201FF0
0FF007C00C187F970F>I<E01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01C
E07CFFFC7FDC3F1C0E127D9115>I<E007E0077006700E700E381C381C381C1C381C381C380E70
0E7006600660076003C003C010127F9113>I<E03E0380E03E0380E03603807037030070770700
707307007073070038638E0038E38E0038E38E0018E18C001CC1CC001DC1DC001DC1DC000D80D8
000D80D8000F80F8000780700019127F911C>I<7003807807003C0E001C1C000E1C0007380003
F00001E00001C00001E00003F0000738000E18000E1C001C0E00380700700380F003C012128091
13>I<E007E007700E700E780E381C381C1C181C380C380E300E70067007600360034001C001C0
01800180030003000700FE00FC00F800101A7F9113>I E /Ff 89 127 df<60F0F0F0F0F0F0F0
F0F0F0F0F0F0F0F0600000000060F0F0600419779816>33 D<E038F078F078F078F078F078F078
F078E038E03860300D0B7C9816>I<0387000387000387000387000387000387007FFFC0FFFFE0
FFFFE0070E00070E00070E000E1C000E1C000E1C000E1C00FFFFE0FFFFE07FFFC01C38001C3800
1C38001C38001C38001C380013197F9816>I<00C00001C00001C00001C00007F0001FFC003FFE
007DCF0071C780E1C380E1C780E1C780F1C30079C0003FC0001FF00007FC0001FE0001CF0001C7
0061C380F1C380F1C380E1C38071C70079DF003FFE001FF80007E00001C00001C00000C0001120
7E9C16>I<03800007E0000FE0001E70001C70001C70001C70001C77E01CE7E01DE7E00FC7000F
8E000F0E001E0E003F1C007F1C00739C00E3F800E1F800E0F1C0E0F1C071F9C07FFFC03F9F801E
070013197F9816>38 D<30787C3C1C1C1C1C3878F0E040070D789816>I<00E001E0038007000E
001C001C0038003800700070007000E000E000E000E000E000E000E000E000E000700070007000
380038001C001C000E000700038001E000E00B217A9C16>I<C000E000700038001C000E000E00
0700070003800380038001C001C001C001C001C001C001C001C001C0038003800380070007000E
000E001C0038007000E000C0000B217B9C16>I<01C00001C00001C00001C00071C700F9CF807F
FF001FFC0007F00007F0001FFC007FFF00F9CF8071C70001C00001C00001C00001C00011127E95
16>I<01C00001C00001C00001C00001C00001C00001C00001C000FFFF80FFFF80FFFF8001C000
01C00001C00001C00001C00001C00001C00001C00011137E9516>I<387C7E7E3E0E1E1C78F060
070B798416>I<FFFF80FFFF80FFFF8011037E8D16>I<70F8F8F8700505788416>I<0001800003
80000380000700000700000E00000E00001C00001C0000380000380000700000700000E00000E0
0001C00001C0000380000380000700000700000E00000E00001C00001C00003800003800007000
00700000E00000E00000C0000011207E9C16>I<03E0000FF8001FFC001E3C00380E00780F0070
0700700700E00380E00380E00380E00380E00380E00380E00380E00380F0078070070070070078
0F003C1E001E3C001FFC000FF80003E00011197E9816>I<01800380038007800F807F80FF8073
80038003800380038003800380038003800380038003800380038003807FF87FFC7FF80E197C98
16>I<07E0001FF8003FFC00783E00E00700F00780F00380600380000380000380000700000700
000E00001C0000380000700000E00001C0000380000F00001E03803803807FFF80FFFF807FFF80
11197E9816>I<07E0001FF8003FFC00781E00780700300700000700000700000E00003E0007FC
0007F00007FC00001E00000700000300000380000380600380F00380E00700781E003FFC001FF8
0007E00011197E9816>I<007C0000FC0000DC0001DC00039C00039C00071C000F1C000E1C001E
1C003C1C00381C00781C00F01C00FFFFE0FFFFE0FFFFE0001C00001C00001C00001C00001C0001
FFC001FFC001FFC013197F9816>I<3FFE003FFE003FFE00380000380000380000380000380000
3800003800003BF0003FFC003FFE003C0F00300700000380000380600380F00380F00380E00700
781E003FFC001FF80007E00011197E9816>I<00F80003FC0007FE000F07001C0F00380F007806
00700000700000E3F800EFFC00FFFE00F80F00F00700F00380E00380E003807003807003807007
803807003C1E001FFC000FF80003E00011197E9816>I<E00000FFFF80FFFF80FFFF80E00F00E0
1E00001C0000380000780000700000E00000E00001C00001C00001C00003800003800003800003
8000070000070000070000070000070000070000070000111A7E9916>I<07F0001FFC003FFE00
7C1F00F00780E00380E00380E003807007007C1F001FFC0007F0001FFC003C1E00700700F00780
E00380E00380E00380F007807007007C1F003FFE001FFC0007F00011197E9816>I<03E0000FF8
001FFC003C1E00700E00700700E00700E00780E00380E00380E00780700780780F803FFF801FFB
800FE380000700000700300700780E00781C007078003FF0001FE0000F800011197E9816>I<70
F8F8F870000000000000000070F8F8F8700512789116>I<387C7C7C3800000000000000003878
7C7C3C1C1C3870E0400618799116>I<000180000780001F80003E0000F80001F00007C0000F80
003E0000FC0000F00000FC00003E00000F800007C00001F00000F800003E00001F800007800001
8011157E9616>I<7FFF00FFFF80FFFF80000000000000000000000000000000FFFF80FFFF807F
FF00110B7E9116>I<C00000F00000FC00003E00000F800007C00001F00000F800003E00001F80
000780001F80003E0000F80001F00007C0000F80003E0000FC0000F00000C0000011157E9616>
I<0FE03FF87FFCF01EF00EF00E601E003C007800F001C003800380038003800380030000000000
0000000003000780078003000F197D9816>I<00E00001F00001F00001B00001B00003B80003B8
0003B800031800071C00071C00071C00071C00071C000E0E000E0E000FFE000FFE001FFF001C07
001C07001C07007F1FC0FF1FE07F1FC013197F9816>65 D<7FF800FFFE007FFF001C0F001C0780
1C03801C03801C03801C07801C07001FFF001FFE001FFE001C1F001C03801C03C01C01C01C01C0
1C01C01C01C01C03C01C07807FFF80FFFF007FFC0012197F9816>I<01F18007FB800FFF801F0F
803C0780380380700380700380F00000E00000E00000E00000E00000E00000E00000E00000F000
007003807003803803803C07001F0F000FFE0007FC0001F00011197E9816>I<7FF800FFFE007F
FF001C0F001C07801C03C01C01C01C01C01C01E01C00E01C00E01C00E01C00E01C00E01C00E01C
00E01C00E01C01C01C01C01C03C01C07801C0F807FFF00FFFE007FF8001319809816>I<7FFFC0
FFFFC07FFFC01C01C01C01C01C01C01C01C01C00001C00001C1C001C1C001FFC001FFC001FFC00
1C1C001C1C001C00001C00E01C00E01C00E01C00E01C00E07FFFE0FFFFE07FFFE013197F9816>
I<FFFFE0FFFFE0FFFFE01C00E01C00E01C00E01C00E01C00001C00001C1C001C1C001FFC001FFC
001FFC001C1C001C1C001C00001C00001C00001C00001C00001C0000FF8000FFC000FF80001319
7F9816>I<03E30007FF000FFF001E1F003C0F00380700700700700700F00000E00000E00000E0
0000E00000E03F80E07FC0E03F80F00700700700700700380F003C0F001E1F000FFF0007F70003
E70012197E9816>I<7F1FC0FFBFE07F1FC01C07001C07001C07001C07001C07001C07001C0700
1FFF001FFF001FFF001C07001C07001C07001C07001C07001C07001C07001C07001C07007F1FC0
FFBFE07F1FC013197F9816>I<FFFEFFFEFFFE0380038003800380038003800380038003800380
038003800380038003800380038003800380FFFEFFFEFFFE0F197D9816>I<7F0FE0FF8FF07F0F
E01C07801C0F001C0E001C1C001C3C001C78001CF0001CE0001DF0001FF0001FF8001F38001E1C
001C1C001C0E001C0E001C07001C07001C03807F07E0FF8FF07F07E01419809816>75
D<FFC000FFC000FFC0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00
001C00001C00001C00001C00001C00401C00E01C00E01C00E01C00E0FFFFE0FFFFE0FFFFE01319
7F9816>I<FC07E0FE0FE0FE0FE03A0B803B1B803B1B803B1B803B1B803B1B803BBB8039B38039
B38039B38039B38039F38038E38038E380380380380380380380380380380380FE0FE0FE0FE0FE
0FE013197F9816>I<7E1FC0FF3FE07F1FC01D07001D87001D87001D87001DC7001DC7001CC700
1CC7001CE7001CE7001CE7001C67001C67001C77001C77001C37001C37001C37001C17007F1F00
FF9F007F0F0013197F9816>I<1FFC003FFE007FFF00780F00F00780E00380E00380E00380E003
80E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380F00780F00780780F
007FFF003FFE001FFC0011197E9816>I<7FF800FFFE007FFF001C0F801C03801C03C01C01C01C
01C01C01C01C03C01C03801C0F801FFF001FFE001FF8001C00001C00001C00001C00001C00001C
00001C00007F0000FF80007F000012197F9816>I<1FFC003FFE007FFF00780F00F00780E00380
E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E0E380
E1E380F0F780787F007FFF003FFE001FFC00001C00001E00000E00000F00000700000700111F7E
9816>I<7FE000FFF8007FFC001C1E001C0F001C07001C07001C07001C07001C0F001C1E001FFC
001FF8001FFC001C1C001C0E001C0E001C0E001C0E001C0E201C0E701C0E707F07E0FF87E07F03
C014197F9816>I<07E3001FFF003FFF00781F00F00700E00700E00700E00000F000007800003F
80001FF00007FC0000FE00000F00000700000380000380600380E00380E00700F80F00FFFE00FF
FC00C7F00011197E9816>I<7FFFE0FFFFE0FFFFE0E0E0E0E0E0E0E0E0E0E0E0E000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
07FC000FFE0007FC0013197F9816>I<7F07F0FF8FF87F07F01C01C01C01C01C01C01C01C01C01
C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C00E03800E03
8007070007FF0003FE0000F8001519809816>I<FE0FE0FF1FE0FE0FE03803801C07001C07001C
07001C07000E0E000E0E000E0E000E0E00060C00071C00071C00071C00071C0003180003B80003
B80003B80001B00001F00001F00000E00013197F9816>I<FC07E0FE0FE0FC07E07001C07001C0
7001C030018038038038038038038038E38039F38039F38039B38019B30019B30019B30019B300
19B30019B3001913001B1B000F1E000F1E000E0E0013197F9816>I<7F1F807F3F807F1F800E1E
000E1C00073C0007380003B80003F00001F00001E00000E00001E00001F00003F00003B80007B8
00071C00071C000E0E000E0E001C07007F1FC0FF1FE07F1FC013197F9816>I<FE0FE0FF1FE0FE
0FE01C07001C07000E0E000E0E00071C00071C00071C0003B80003B80001F00001F00000E00000
E00000E00000E00000E00000E00000E00000E00003F80007FC0003F80013197F9816>I<FFF0FF
F0FFF0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000FFF0FFF0FFF00C20789C16>91 D<C00000E00000E00000
7000007000003800003800001C00001C00000E00000E000007000007000003800003800001C000
01C00000E00000E000007000007000003800003800001C00001C00000E00000E00000700000700
00038000038000018011207E9C16>I<FFF0FFF0FFF00070007000700070007000700070007000
7000700070007000700070007000700070007000700070007000700070007000700070FFF0FFF0
FFF00C207F9C16>I<03000F803FE0FDF8F07840100D067C9816>I<FFFF80FFFF80FFFF8011037E
7E16>I<081C3C7870E0E0E0E0F0F87830060D789B16>I<1FE0003FF0007FF800783C00300E0000
0E00000E0003FE001FFE003E0E00700E00E00E00E00E00E00E00783E007FFFE03FE7E00F83E013
127E9116>I<7E0000FE00007E00000E00000E00000E00000E00000E3E000EFF000FFF800F83C0
0F00E00E00E00E00700E00700E00700E00700E00700E00700E00E00F01E00F83C00FFF800EFF00
063C001419809816>I<03F80FFC1FFE3C1E780C7000E000E000E000E000E000F000700778073E
0E1FFC0FF803F010127D9116>I<003F00007F00003F0000070000070000070000070003C7000F
F7001FFF003C1F00780F00700700E00700E00700E00700E00700E00700E00700700F00700F003C
1F001FFFE00FE7F007C7E014197F9816>I<03E00FF81FFC3C1E780E7007E007FFFFFFFFFFFFE0
00E000700778073C0F1FFE0FFC03F010127D9116>I<001F00007F8000FF8001E78001C30001C0
0001C0007FFF00FFFF00FFFF0001C00001C00001C00001C00001C00001C00001C00001C00001C0
0001C00001C00001C0003FFE007FFF003FFE0011197F9816>I<03E3C007F7E00FFFE01C1CC038
0E00380E00380E00380E00380E001C1C000FF8001FF0001BE0003800001800001FFC001FFF003F
FF807803C0E000E0E000E0E000E0E000E07001C07C07C03FFF800FFE0003F800131C7F9116>I<
7E0000FE00007E00000E00000E00000E00000E00000E3C000EFE000FFF000F87800F03800E0380
0E03800E03800E03800E03800E03800E03800E03800E03800E03807FC7F0FFE7F87FC7F0151980
9816>I<018003C003C0018000000000000000007FC07FC07FC001C001C001C001C001C001C001
C001C001C001C001C001C07FFFFFFF7FFF101A7D9916>I<003000780078003000000000000000
001FF81FF81FF80038003800380038003800380038003800380038003800380038003800380038
0038003800386070F0F0FFE07FC03F800D237E9916>I<7E0000FE00007E00000E00000E00000E
00000E00000E7FE00E7FE00E7FE00E0F000E1E000E3C000E78000EF0000FF0000FF8000FBC000F
1E000E0E000E07000E07807F87F0FFCFF07F87F01419809816>I<FFC000FFC000FFC00001C000
01C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C000
01C00001C00001C00001C00001C000FFFF80FFFF80FFFF8011197E9816>I<F9C380FFEFC0FFFF
E03C78E03C78E03870E03870E03870E03870E03870E03870E03870E03870E03870E03870E0FE7C
F8FE7CF8FE3C781512809116>I<7E3C00FEFE007FFF000F87800F03800E03800E03800E03800E
03800E03800E03800E03800E03800E03800E03807FC7F0FFE7F87FC7F01512809116>I<03E000
0FF8001FFC003C1E00780F00700700E00380E00380E00380E00380E00380F00780700700780F00
3C1E001FFC000FF80003E00011127E9116>I<7E3E00FEFF007FFF800F83C00F00E00E00E00E00
700E00700E00700E00700E00700E00700E00E00F01E00F83C00FFF800EFF000E3C000E00000E00
000E00000E00000E00000E00007FC000FFE0007FC000141B809116>I<FF0FC0FF3FE0FF7FE007
F04007C000078000078000070000070000070000070000070000070000070000070000FFFC00FF
FC00FFFC0013127F9116>114 D<0FEC3FFC7FFCF03CE01CE01C70007F801FF007F8003C600EE0
0EF00EF81EFFFCFFF8C7E00F127D9116>I<0300000700000700000700000700007FFF00FFFF00
FFFF00070000070000070000070000070000070000070000070100070380070380070380078700
03FE0001FC0000F80011177F9616>I<7E1F80FE3F807E1F800E03800E03800E03800E03800E03
800E03800E03800E03800E03800E03800E03800E0F800FFFF007FBF803E3F01512809116>I<7F
1FC0FF1FE07F1FC01C07001E0F000E0E000E0E000E0E00071C00071C00071C00071C0003B80003
B80003B80001F00001F00000E00013127F9116>I<FF1FE0FFBFE0FF1FE0380380380380380380
38038038E38019F30019F30019B3001DB7001DB7001DB7001DB7000F1E000F1E000F1E0013127F
9116>I<7F1FC07F3FC07F1FC00F1C00073C0003B80003F00001F00000E00001E00001F00003B8
00073C00071C000E0E007F1FC0FF3FE07F1FC013127F9116>I<7F1FC0FF9FE07F1FC01C07000E
07000E0E000E0E00070E00071C00071C00039C00039C0003980001B80001B80000F00000F00000
F00000E00000E00000E00001C00079C0007BC0007F80003F00003C0000131B7F9116>I<3FFFC0
7FFFC07FFFC0700780700F00701E00003C0000780001F00003E0000780000F00001E01C03C01C0
7801C0FFFFC0FFFFC0FFFFC012127F9116>I<001F80007F8000FF8001E00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00003C0007F8000FF0000FF00007F800003C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C00001E00000FF80007F80001F801120
7E9C16>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E00320
779C16>I<7C0000FF0000FF800003C00001C00001C00001C00001C00001C00001C00001C00001
C00001C00001E00000FF00007F80007F8000FF0001E00001C00001C00001C00001C00001C00001
C00001C00001C00001C00003C000FF8000FF00007C000011207E9C16>I<1C303F78FFF8F7E061
C00D057C9816>I E /Fg 74 124 df<000FF83F00007FFDFFC001F81FE3E003E03F87E007C03F
87E00F803F07E00F803F03C00F801F00000F801F00000F801F00000F801F00000F801F00000F80
1F0000FFFFFFFC00FFFFFFFC000F801F00000F801F00000F801F00000F801F00000F801F00000F
801F00000F801F00000F801F00000F801F00000F801F00000F801F00000F801F00000F801F0000
0F801F00000F801F00000F801F00000F801F00000F801F00007FF0FFF0007FF0FFF00023237FA2
21>11 D<000FF000007FFC0001F80E0003E01F0007C03F000F803F000F803F000F801E000F800C
000F8000000F8000000F8000000F800000FFFFFF00FFFFFF000F801F000F801F000F801F000F80
1F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F
801F000F801F000F801F000F801F000F801F007FF0FFE07FF0FFE01B237FA21F>I<000FFF0000
7FFF0001F83F0003E03F0007C03F000F803F000F801F000F801F000F801F000F801F000F801F00
0F801F000F801F00FFFFFF00FFFFFF000F801F000F801F000F801F000F801F000F801F000F801F
000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F80
1F000F801F000F801F007FF0FFE07FF0FFE01B237FA21F>I<3803807C07C0FE0FE0FF0FF0FF0F
F07F07F03B03B00300300300300700700600600600600C00C01C01C01801807007002002001411
7EA21D>34 D<387CFEFFFF7F3B03030706060C1C18702008117CA210>39
D<00180030006000C001C00380070007000E001E001C003C003C003C007800780078007800F800
F000F000F000F000F000F000F000F000F000F000F000F80078007800780078003C003C003C001C
001E000E0007000700038001C000C00060003000180D317BA416>I<C0006000300018001C000E
0007000700038003C001C001E001E001E000F000F000F000F000F8007800780078007800780078
0078007800780078007800F800F000F000F000F001E001E001E001C003C00380070007000E001C
00180030006000C0000D317DA416>I<387CFEFFFF7F3B03030706060C1C18702008117C8610>
44 D<FFFCFFFCFFFCFFFC0E047F8C13>I<387CFEFEFE7C3807077C8610>I<0000180000380000
380000700000700000E00000E00000E00001C00001C00003800003800003800007000007000007
00000E00000E00001C00001C00001C0000380000380000700000700000700000E00000E00001C0
0001C00001C0000380000380000700000700000700000E00000E00000E00001C00001C00003800
00380000380000700000700000E00000E00000C0000015317DA41C>I<00FE0007FFC00F83E01F
01F03E00F83E00F87C007C7C007C7C007CFC007CFC007EFC007EFC007EFC007EFC007EFC007EFC
007EFC007EFC007EFC007EFC007EFC007EFC007E7C007C7C007C7C007C3E00F83E00F81F01F00F
83E007FFC000FE0017207E9F1C>I<00180000780001F800FFF800FFF80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F8007FFFE07FFFE013207C9F1C>
I<03FC000FFF003C1FC07007E07C07F0FE03F0FE03F8FE03F8FE01F87C01F83803F80003F80003
F00003F00007E00007C0000F80001F00003E0000380000700000E01801C0180380180700180E00
380FFFF01FFFF03FFFF07FFFF0FFFFF0FFFFF015207D9F1C>I<00FE0007FFC00F07E01E03F03F
03F03F81F83F81F83F81F81F03F81F03F00003F00003E00007C0001F8001FE0001FF000007C000
01F00001F80000FC0000FC3C00FE7E00FEFF00FEFF00FEFF00FEFF00FC7E01FC7801F81E07F00F
FFC001FE0017207E9F1C>I<0000E00001E00003E00003E00007E0000FE0001FE0001FE00037E0
0077E000E7E001C7E00187E00307E00707E00E07E00C07E01807E03807E07007E0E007E0FFFFFE
FFFFFE0007E00007E00007E00007E00007E00007E00007E000FFFE00FFFE17207E9F1C>I<1000
201E01E01FFFC01FFF801FFF001FFE001FF8001BC00018000018000018000018000019FC001FFF
001E0FC01807E01803E00003F00003F00003F80003F83803F87C03F8FE03F8FE03F8FC03F0FC03
F07007E03007C01C1F800FFF0003F80015207D9F1C>I<001F8000FFE003F07007C0F00F01F81F
01F83E01F83E01F87E00F07C00007C0000FC0800FC7FC0FCFFE0FD80F0FF00F8FE007CFE007CFC
007EFC007EFC007EFC007E7C007E7C007E7C007E3C007C3E007C1E00F80F00F00783E003FFC000
FF0017207E9F1C>I<6000007800007FFFFE7FFFFE7FFFFC7FFFF87FFFF87FFFF0E00060E000C0
C00180C00300C00300000600000C00001C0000180000380000780000780000F00000F00000F000
01F00001F00001F00003F00003F00003F00003F00003F00003F00003F00001E00017227DA11C>
I<00FE0003FFC00703E00E00F01C00F01C00783C00783E00783F00783F80783FE0F01FF9E01FFF
C00FFF8007FFC003FFE007FFF01E7FF83C1FFC7807FC7801FEF000FEF0003EF0001EF0001EF000
1CF8001C7800383C00381F01F00FFFC001FF0017207E9F1C>I<01FE0007FF800F83E01E01F03E
00F07C00F87C0078FC007CFC007CFC007CFC007EFC007EFC007EFC007E7C00FE7C00FE3E01FE1E
037E0FFE7E07FC7E00207E00007C00007C1E007C3F00F83F00F83F00F03F01E01E03C01C0F800F
FE0003F80017207E9F1C>I<387CFEFEFE7C380000000000000000387CFEFEFE7C3807167C9510>
I<000070000000007000000000F800000000F800000000F800000001FC00000001FC00000003FE
00000003FE00000003FE00000006FF000000067F0000000E7F8000000C3F8000000C3F80000018
3FC00000181FC00000381FE00000300FE00000300FE00000600FF000006007F00000E007F80000
FFFFF80000FFFFF800018001FC00018001FC00038001FE00030000FE00030000FE000600007F00
0600007F00FFE00FFFF8FFE00FFFF825227EA12A>65 D<FFFFFF8000FFFFFFE00007F001F80007
F000FC0007F0007E0007F0007E0007F0007F0007F0007F0007F0007F0007F0007F0007F0007F00
07F0007E0007F000FE0007F000FC0007F003F80007FFFFF00007FFFFF00007F001FC0007F0007E
0007F0003F0007F0003F8007F0001F8007F0001FC007F0001FC007F0001FC007F0001FC007F000
1FC007F0001FC007F0003F8007F0003F8007F0007F0007F001FE00FFFFFFF800FFFFFFC0002222
7EA128>I<0003FE0080001FFF818000FF01E38001F8003F8003E0001F8007C0000F800F800007
801F800007803F000003803F000003807F000001807E000001807E00000180FE00000000FE0000
0000FE00000000FE00000000FE00000000FE00000000FE00000000FE000000007E000000007E00
0001807F000001803F000001803F000003801F800003000F8000030007C000060003F0000C0001
F800380000FF00F000001FFFC0000003FE000021227DA128>I<FFFFFF8000FFFFFFF00007F003
FC0007F0007E0007F0003F0007F0001F8007F0000FC007F00007E007F00007E007F00007F007F0
0003F007F00003F007F00003F007F00003F807F00003F807F00003F807F00003F807F00003F807
F00003F807F00003F807F00003F807F00003F807F00003F007F00003F007F00003F007F00007E0
07F00007E007F0000FC007F0001F8007F0003F0007F0007E0007F003FC00FFFFFFF000FFFFFF80
0025227EA12B>I<FFFFFFFCFFFFFFFC07F000FC07F0003C07F0001C07F0000C07F0000E07F000
0E07F0000607F0180607F0180607F0180607F0180007F0380007F0780007FFF80007FFF80007F0
780007F0380007F0180007F0180007F0180307F0180307F0000307F0000607F0000607F0000607
F0000E07F0000E07F0001E07F0003E07F001FCFFFFFFFCFFFFFFFC20227EA125>I<FFFFFFF8FF
FFFFF807F001F807F0007807F0003807F0001807F0001C07F0001C07F0000C07F0000C07F0180C
07F0180C07F0180007F0180007F0380007F0780007FFF80007FFF80007F0780007F0380007F018
0007F0180007F0180007F0180007F0000007F0000007F0000007F0000007F0000007F0000007F0
000007F00000FFFFE000FFFFE0001E227EA123>I<0003FE0040001FFFC0C0007F00F1C001F800
3FC003F0000FC007C00007C00FC00003C01F800003C03F000001C03F000001C07F000000C07E00
0000C07E000000C0FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE
00000000FE000FFFFC7E000FFFFC7F00001FC07F00001FC03F00001FC03F00001FC01F80001FC0
0FC0001FC007E0001FC003F0001FC001FC003FC0007F80E7C0001FFFC3C00003FF00C026227DA1
2C>I<FFFF83FFFEFFFF83FFFE07F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007
F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC0
07FFFFFFC007FFFFFFC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001F
C007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F000
1FC007F0001FC0FFFF83FFFEFFFF83FFFE27227EA12C>I<FFFFE0FFFFE003F80003F80003F800
03F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F800
03F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F80003F800
03F800FFFFE0FFFFE013227FA115>I<03FFFF03FFFF0007F00007F00007F00007F00007F00007
F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007
F00007F00007F00007F01807F07E07F0FF07F0FF07F0FF07F0FF07E07E0FE07C1FC01FFF0007F8
0018227FA11D>I<FFFF803FFCFFFF803FFC07F000038007F000070007F0000E0007F000180007
F000300007F000E00007F001C00007F003800007F007000007F00E000007F018000007F0380000
07F0FC000007F1FE000007F3FE000007F77F000007FE7F800007F83F800007F01FC00007F01FE0
0007F00FE00007F007F00007F007F80007F003F80007F001FC0007F001FE0007F000FF0007F000
7F0007F0007F8007F0003FC0FFFF83FFFCFFFF83FFFC26227EA12C>I<FFFFE000FFFFE00007F0
000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007
F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00018
07F0001807F0001807F0001807F0003807F0003807F0007007F0007007F000F007F001F007F007
F0FFFFFFF0FFFFFFF01D227EA122>I<FFF000000FFFFFF800001FFF07F800001FE006FC000037
E006FC000037E006FC000037E0067E000067E0067E000067E0063F0000C7E0063F0000C7E0061F
800187E0061F800187E0060FC00307E0060FC00307E0060FC00307E00607E00607E00607E00607
E00603F00C07E00603F00C07E00601F81807E00601F81807E00601F81807E00600FC3007E00600
FC3007E006007E6007E006007E6007E006003FC007E006003FC007E006001F8007E006001F8007
E006001F8007E006000F0007E0FFF00F00FFFFFFF00600FFFF30227EA135>I<FFF8001FFEFFFC
001FFE07FC0000C007FE0000C006FF0000C0067F8000C0063FC000C0061FE000C0060FE000C006
0FF000C00607F800C00603FC00C00601FE00C00600FE00C00600FF00C006007F80C006003FC0C0
06001FE0C006000FF0C0060007F0C0060007F8C0060003FCC0060001FEC0060000FFC00600007F
C00600007FC00600003FC00600001FC00600000FC006000007C006000003C006000003C0FFF000
01C0FFF00000C027227EA12C>I<0007FC0000003FFF800000FC07E00003F001F80007E000FC00
0FC0007E001F80003F001F80003F003F00001F803F00001F807F00001FC07E00000FC07E00000F
C0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE0000
0FE0FE00000FE07E00000FC07F00001FC07F00001FC03F00001F803F80003F801F80003F000FC0
007E0007E000FC0003F001F80000FC07E000003FFF80000007FC000023227DA12A>I<FFFFFF00
FFFFFFE007F007F007F001FC07F000FC07F0007E07F0007E07F0007F07F0007F07F0007F07F000
7F07F0007F07F0007E07F0007E07F000FC07F001FC07F007F007FFFFE007FFFF0007F0000007F0
000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007
F0000007F00000FFFF8000FFFF800020227EA126>I<FFFFFE0000FFFFFFC00007F007F00007F0
01F80007F000FC0007F0007E0007F0007F0007F0007F0007F0007F0007F0007F0007F0007F0007
F0007F0007F0007E0007F000FC0007F001F80007F007F00007FFFFC00007FFFF800007F00FE000
07F007F00007F003F80007F001FC0007F001FC0007F001FC0007F001FC0007F001FC0007F001FC
0007F001FC0007F001FC0007F001FC0607F000FE0607F000FF0CFFFF803FF8FFFF800FF027227E
A12A>82 D<01FC0407FF8C1F03FC3C007C7C003C78001C78001CF8000CF8000CFC000CFC0000FF
0000FFE0007FFF007FFFC03FFFF01FFFF80FFFFC03FFFE003FFE0003FF00007F00003F00003FC0
001FC0001FC0001FE0001EE0001EF0003CFC003CFF00F8C7FFE080FF8018227DA11F>I<7FFFFF
FF807FFFFFFF807E03F80F807803F807807003F803806003F80180E003F801C0E003F801C0C003
F800C0C003F800C0C003F800C0C003F800C00003F800000003F800000003F800000003F8000000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F800000003F800
0003FFFFF80003FFFFF80022227EA127>I<FFFF803FFCFFFF803FFC07F000018007F000018007
F000018007F000018007F000018007F000018007F000018007F000018007F000018007F0000180
07F000018007F000018007F000018007F000018007F000018007F000018007F000018007F00001
8007F000018007F000018007F000018007F000018007F000018007F000018003F000030003F800
030001F800060000FC000E00007E001C00003F80F800000FFFE0000001FF000026227EA12B>I<
FFFF800FFEFFFF800FFE07F00000C007F80000C003F800018003F800018001FC00030001FC0003
0001FE00070000FE00060000FF000600007F000C00007F800C00003F801800003F801800003FC0
3800001FC03000001FE03000000FE06000000FF060000007F0C0000007F0C0000007F9C0000003
F980000003FD80000001FF00000001FF00000000FE00000000FE00000000FE000000007C000000
007C00000000380000000038000027227FA12A>I<FFFF0FFFF01FFEFFFF0FFFF01FFE0FF000FF
0000E007F0007F0000C007F0007F0000C003F8007F80018003F8003F80018003FC003F80038001
FC003FC0030001FC003FC0030000FE007FE0060000FE006FE0060000FF006FE00600007F00C7F0
0C00007F00C7F00C00007F80C7F81C00003F8183F81800003F8183F81800001FC383FC3000001F
C301FC3000001FE301FC3000000FE600FE6000000FE600FE6000000FF600FFE0000007FC007FC0
000007FC007FC0000003FC007F80000003F8003F80000003F8003F80000001F0001F00000001F0
001F00000000F0001E00000000E0000E00000000E0000E000037227FA13A>I<7FFFC1FFF07FFF
C1FFF003FC000C0001FE00180000FE00380000FF007000007F806000003F80C000003FC1C00000
1FE38000000FE30000000FF700000007FE00000003FC00000003FC00000001FE00000000FE0000
0000FF00000000FF80000001FFC0000001BFC00000031FE00000070FF000000E0FF000000C07F8
00001803FC00003803FC00003001FE00006000FF0000E000FF0001C0007F800180003FC0FFFC03
FFFEFFFC03FFFE27227FA12A>I<FF80FF80FF80E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000FF80FF80FF8009317BA410
>91 D<0400400E00E0180180380380300300600600600600E00E00C00C00C00C00DC0DC0FE0FE0
FF0FF0FF0FF07F07F03E03E01C01C014117AA21D>I<FF80FF80FF800380038003800380038003
800380038003800380038003800380038003800380038003800380038003800380038003800380
038003800380038003800380038003800380038003800380038003800380038003800380FF80FF
80FF8009317FA410>I<040E1838306060E0C0C0DCFEFFFF7F3E1C08117DA210>96
D<07FC001FFF803F07C03F03E03F01E03F01F01E01F00001F00001F0003FF003FDF01FC1F03F01
F07E01F0FC01F0FC01F0FC01F0FC01F07E02F07E0CF81FF87F07E03F18167E951B>I<FF000000
FF0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000
001F0000001F0000001F0FE0001F3FF8001FF07C001F801E001F001F001F000F801F000F801F00
0FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000F801F001F801F
801F001FC03E001EE07C001C3FF800180FC0001A237EA21F>I<00FF8007FFE00F83F01F03F03E
03F07E03F07C01E07C0000FC0000FC0000FC0000FC0000FC0000FC00007C00007E00007E00003E
00301F00600FC0E007FF8000FE0014167E9519>I<0001FE000001FE0000003E0000003E000000
3E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0001FC3E0007
FFBE000F81FE001F007E003E003E007E003E007C003E00FC003E00FC003E00FC003E00FC003E00
FC003E00FC003E00FC003E00FC003E007C003E007C003E003E007E001E00FE000F83BE0007FF3F
C001FC3FC01A237EA21F>I<00FE0007FF800F87C01E01E03E01F07C00F07C00F8FC00F8FC00F8
FFFFF8FFFFF8FC0000FC0000FC00007C00007C00007E00003E00181F00300FC07003FFC000FF00
15167E951A>I<003F8000FFC001E3E003C7E007C7E00F87E00F83C00F80000F80000F80000F80
000F80000F8000FFFC00FFFC000F80000F80000F80000F80000F80000F80000F80000F80000F80
000F80000F80000F80000F80000F80000F80000F80000F80000F80007FF8007FF80013237FA211
>I<03FC1E0FFF7F1F0F8F3E07CF3C03C07C03E07C03E07C03E07C03E07C03E03C03C03E07C01F
0F801FFF0013FC003000003000003800003FFF801FFFF00FFFF81FFFFC3800FC70003EF0001EF0
001EF0001EF0001E78003C7C007C3F01F80FFFE001FF0018217E951C>I<FF000000FF0000001F
0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F000000
1F0000001F07E0001F1FF8001F307C001F403C001F803E001F803E001F003E001F003E001F003E
001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F00
3E001F003E00FFE1FFC0FFE1FFC01A237EA21F>I<1C003F007F007F007F003F001C0000000000
00000000000000000000FF00FF001F001F001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F00FFE0FFE00B247EA310>I<FF000000FF0000001F0000001F0000001F
0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F00FF80
1F00FF801F0038001F0060001F01C0001F0380001F0700001F0E00001F1C00001F7E00001FFF00
001FCF00001F0F80001F07C0001F03E0001F01E0001F01F0001F00F8001F007C001F003C00FFE0
FFC0FFE0FFC01A237EA21E>107 D<FF00FF001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F00FFE0FFE00B237EA210>I<FF07F007F000FF1FFC1FFC001F303E303E001F403E403E001F
801F801F001F801F801F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F001F001F001F00FFE0FFE0FFE0FFE0FFE0FFE02B167E9530>I<FF07E0
00FF1FF8001F307C001F403C001F803E001F803E001F003E001F003E001F003E001F003E001F00
3E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E00FF
E1FFC0FFE1FFC01A167E951F>I<00FE0007FFC00F83E01E00F03E00F87C007C7C007C7C007CFC
007EFC007EFC007EFC007EFC007EFC007EFC007E7C007C7C007C3E00F81F01F00F83E007FFC000
FE0017167E951C>I<FF0FE000FF3FF8001FF07C001F803E001F001F001F001F801F001F801F00
0FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F001F801F001F801F
803F001FC03E001FE0FC001F3FF8001F0FC0001F0000001F0000001F0000001F0000001F000000
1F0000001F0000001F000000FFE00000FFE000001A207E951F>I<00FE030007FF87000FC1C700
1F006F003F003F007E003F007E001F007C001F00FC001F00FC001F00FC001F00FC001F00FC001F
00FC001F00FC001F007E001F007E001F003E003F001F007F000FC1DF0007FF9F0001FC1F000000
1F0000001F0000001F0000001F0000001F0000001F0000001F0000001F000000FFE00000FFE01B
207E951E>I<FE1F00FE3FC01E67E01EC7E01E87E01E87E01F83C01F00001F00001F00001F0000
1F00001F00001F00001F00001F00001F00001F00001F00001F0000FFF000FFF00013167E9517>
I<0FF3003FFF00781F00600700E00300E00300F00300FC00007FE0007FF8003FFE000FFF0001FF
00000F80C00780C00380E00380E00380F00700FC0E00EFFC00C7F00011167E9516>I<01800001
80000180000180000380000380000780000780000F80003F8000FFFF00FFFF000F80000F80000F
80000F80000F80000F80000F80000F80000F80000F80000F80000F81800F81800F81800F81800F
81800F830007C30003FE0000F80011207F9F16>I<FF01FE00FF01FE001F003E001F003E001F00
3E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F
003E001F003E001F003E001F007E001F00FE000F81BE0007FF3FC001FC3FC01A167E951F>I<FF
E01FE0FFE01FE00F8006000F8006000FC00E0007C00C0007E01C0003E0180003E0180001F03000
01F0300000F8600000F86000007CC000007CC000007FC000003F8000003F8000001F0000001F00
00000E0000000E00001B167F951E>I<FFE7FF07F8FFE7FF07F81F007800C00F807801800F807C
01800F807C018007C07E030007C0DE030007E0DE070003E0DF060003E18F060001F18F0C0001F3
8F8C0001FB079C0000FB07D80000FE03D800007E03F000007E03F000007C01F000003C01E00000
3800E000001800C00025167F9528>I<FFE07FC0FFE07FC00F801C0007C0380003E0700003F060
0001F8C00000F98000007F8000003F0000001F0000001F8000003FC0000037C0000063E00000C1
F00001C0F8000380FC0007007E000E003E00FF80FFE0FF80FFE01B167F951E>I<FFE01FE0FFE0
1FE00F8006000F8006000FC00E0007C00C0007E01C0003E0180003E0180001F0300001F0300000
F8600000F86000007CC000007CC000007FC000003F8000003F8000001F0000001F0000000E0000
000E0000000C0000000C00000018000078180000FC380000FC300000FC60000069C000007F8000
001F0000001B207F951E>I<FFFFFFE0FFFFFFE01B02808E1C>123 D E /Fh
8 108 df<60F0F06004047C830C>58 D<0000038000000F0000003C000000F0000003C000000F
0000003C000000F0000003C000000F0000003C000000F0000000F00000003C0000000F00000003
C0000000F00000003C0000000F00000003C0000000F00000003C0000000F000000038019187D95
20>60 D<E0000000780000001E0000000780000001E0000000780000001E0000000780000001E0
000000780000001E00000007800000078000001E00000078000001E00000078000001E00000078
000001E00000078000001E00000078000000E000000019187D9520>62 D<01FFFF00003C01C000
3800E0003800F0003800700038007000700070007000F0007000F0007001E000E003C000E00780
00E01F0000FFFC0001C00F0001C0078001C003C001C003C0038003C0038003C0038003C0038003
C0070007800700070007000E0007001C000E007800FFFFC0001C1C7E9B1F>66
D<01FFC3FF80003C0078000038007000003800700000380070000038007000007000E000007000
E000007000E000007000E00000E001C00000E001C00000E001C00000FFFFC00001C003800001C0
03800001C003800001C0038000038007000003800700000380070000038007000007000E000007
000E000007000E000007000E00000F001E0000FFE1FFC000211C7E9B23>72
D<00FFFFE000F001C001C003800180070001000E0001001E0002001C0002003800020070000000
E0000001C0000003800000070000000F0000001E0000001C0000003800000070020000E0040001
C0040003800400070008000F0008000E0018001C003000380070007001E000FFFFE0001B1C7E9B
1C>90 D<3F00070007000E000E000E000E001C001C001C001C0039E03A303C1838187018701C70
1C701CE038E038E038E030E070E060E0C061C023001E000E1D7E9C12>98
D<0FC00001C00001C0000380000380000380000380000700000700000700000700000E07000E18
800E21C00E23C01C47801C83001D00001E00003F800039C00038E00038E00070E10070E10070E1
0070E200E06200603C00121D7E9C16>107 D E /Fi 74 124 df<003FE3F801F03F1C03C03E3E
07C07C3E0F807C3E0F807C1C0F807C000F807C000F807C000F807C000F807C00FFFFFFC0FFFFFF
C00F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F80
7C000F807C000F807C000F807C000F807C007FE1FFC07FE1FFC01F1D809C1C>11
D<003FC00001F0300003C0380007C07C000F807C000F807C000F8038000F8000000F8000000F80
00000F800000FFFFFC00FFFFFC000F807C000F807C000F807C000F807C000F807C000F807C000F
807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C007FE1FF807FE1FF80
191D809C1B>I<003FFC0001F07C0003C07C0007C07C000F807C000F807C000F807C000F807C00
0F807C000F807C000F807C00FFFFFC00FFFFFC000F807C000F807C000F807C000F807C000F807C
000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C007FF3
FF807FF3FF80191D809C1B>I<78FCFCFCFCFCFC7878787878787878303030300000000078FCFC
FCFC78061D7C9C0F>33 D<781E00FC3F00FC3F00FE3F80FE3F807A1E8002008002008004010004
0100080200080200300C00401000110E7E9C19>I<0001C070000001C070000001C07000000380
E000000380E000000380E000000380E000000701C000000701C000000701C000000701C000000E
038000FFFFFFFF80FFFFFFFF807FFFFFFF80001C07000000380E000000380E000000380E000000
380E000000380E000000701C00007FFFFFFF80FFFFFFFF80FFFFFFFF8000E038000001C0700000
01C070000001C070000001C07000000380E000000380E000000380E000000380E000000701C000
000701C000000701C0000021257D9C28>I<0020004001800380030006000E001C001C003C0038
003800780078007800F800F000F000F000F000F000F000F000F000F000F8007800780078003800
38003C001C001C000E000600030003800180004000200B297C9E13>40 D<800040003000380018
000C000E000700070007800380038003C003C003C003E001E001E001E001E001E001E001E001E0
01E003E003C003C003C0038003800780070007000E000C00180038003000400080000B297D9E13
>I<78FCFCFEFE7A0202040408083040070E7D850D>44 D<FFE0FFE0FFE0FFE00B047F8A10>I<78
FCFCFCFC7806067D850D>I<000180000380000380000700000700000700000E00000E00001C00
001C00001C0000380000380000380000700000700000E00000E00000E00001C00001C00001C000
0380000380000380000700000700000E00000E00000E00001C00001C00001C0000380000380000
700000700000700000E00000E00000C0000011297D9E18>I<03F8000F1E001C07003C07803803
807803C07803C07803C0F803E0F803E0F803E0F803E0F803E0F803E0F803E0F803E0F803E0F803
E0F803E0F803E07803C07803C03803803C07801C07000F1E0003F800131B7E9A18>I<00600001
E0000FE000FFE000F3E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E0007FFF807FFF8011
1B7D9A18>I<07F8001FFE00383F80780FC0FC07C0FC07E0FC03E0FC03E07803E00007E00007C0
0007C0000F80001F00001E0000380000700000E0000180600300600600600800E01FFFC03FFFC0
7FFFC0FFFFC0FFFFC0131B7E9A18>I<03F8001FFE003C1F003C0F807C07C07E07C07C07C03807
C0000F80000F80001E00003C0003F800001E00000F800007C00007C00007E03007E07807E0FC07
E0FC07E0FC07C0780F80781F001FFE0007F800131B7E9A18>I<000180000380000780000F8000
1F80003F80006F8000CF80008F80018F80030F80060F800C0F80180F80300F80600F80C00F80FF
FFF8FFFFF8000F80000F80000F80000F80000F80000F8001FFF801FFF8151B7F9A18>I<180180
1FFF001FFE001FFC001FF8001FC00018000018000018000018000019F8001E0E00180F80100780
0007C00007E00007E00007E07807E0F807E0F807E0F807C0F007C0600F80381F001FFE0007F000
131B7E9A18>I<007E0003FF000781800F03C01E07C03C07C03C0380780000780000F80000F8F8
00FB0E00FA0780FC0380FC03C0F803E0F803E0F803E0F803E07803E07803E07803C03C03C03C07
801E0F0007FE0003F800131B7E9A18>I<6000007FFFE07FFFE07FFFC07FFF807FFF80E00300C0
0600C00C00C0180000300000300000600000E00000E00001E00001C00003C00003C00003C00003
C00007C00007C00007C00007C00007C00007C000038000131C7D9B18>I<03F8000FFE001E0F80
3807803803C07803C07803C07E03C07F83807FC7003FFE001FFC000FFE0007FF801DFF80387FC0
781FE0F007E0F003E0F001E0F001E0F001E07801C07803803E07801FFE0003F800131B7E9A18>
I<03F8000FFE001E0F003C07807807807803C0F803C0F803C0F803E0F803E0F803E0F803E07807
E03807E03C0BE00E1BE003E3E00003E00003C00003C03807C07C07807C0700780F00383C001FF8
000FE000131B7E9A18>I<78FCFCFCFC7800000000000078FCFCFCFC7806127D910D>I<78FCFCFC
FC7800000000000070F8FCFCFC7C0404080808102040061A7D910D>I<00038000000380000007
C0000007C0000007C000000FE000000FE000001FF000001BF000001BF0000031F8000031F80000
61FC000060FC0000E0FE0000C07E0000C07E0001803F0001FFFF0003FFFF8003001F8003001F80
06000FC006000FC00E000FE00C0007E0FFC07FFEFFC07FFE1F1C7E9B24>65
D<FFFFF800FFFFFF000FC01F800FC00FC00FC007C00FC007E00FC007E00FC007E00FC007E00FC0
07E00FC007C00FC00F800FC03F000FFFFE000FC00F800FC007C00FC007E00FC003E00FC003F00F
C003F00FC003F00FC003F00FC003F00FC007E00FC007E00FC01FC0FFFFFF00FFFFFC001C1C7E9B
22>I<001FE02000FFF8E003F80FE007C003E00F8001E01F0000E03E0000E03E0000607E000060
7C000060FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0000007C0000
607E0000603E0000603E0000C01F0000C00F80018007C0030003F80E0000FFFC00001FE0001B1C
7D9B22>I<FFFFF800FFFFFF000FC01FC00FC007E00FC001F00FC001F80FC000F80FC000FC0FC0
007C0FC0007C0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0F
C0007C0FC0007C0FC0007C0FC000F80FC000F80FC001F00FC007E00FC01FC0FFFFFF00FFFFF800
1F1C7E9B25>I<FFFFFF00FFFFFF000FC01F000FC007000FC003000FC003800FC003800FC18180
0FC181800FC181800FC180000FC380000FFF80000FFF80000FC380000FC180000FC180000FC180
600FC180600FC000E00FC000C00FC000C00FC001C00FC001C00FC003C00FC00F80FFFFFF80FFFF
FF801B1C7E9B1F>I<FFFFFF00FFFFFF000FC01F000FC007000FC003000FC003800FC003800FC0
01800FC181800FC181800FC180000FC180000FC380000FFF80000FFF80000FC380000FC180000F
C180000FC180000FC180000FC000000FC000000FC000000FC000000FC000000FC00000FFFF0000
FFFF0000191C7E9B1E>I<000FF008007FFE3801FC07F807E001F80F8000781F0000783F000038
3E0000387E0000187C000018FC000000FC000000FC000000FC000000FC000000FC000000FC007F
FFFC007FFF7C0001F87E0001F83E0001F83F0001F81F0001F80F8001F807E001F801FC07F8007F
FE78000FF818201C7D9B26>I<FFFC3FFFFFFC3FFF0FC003F00FC003F00FC003F00FC003F00FC0
03F00FC003F00FC003F00FC003F00FC003F00FC003F00FFFFFF00FFFFFF00FC003F00FC003F00F
C003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F0
FFFC3FFFFFFC3FFF201C7E9B25>I<FFFFFFFF07E007E007E007E007E007E007E007E007E007E0
07E007E007E007E007E007E007E007E007E007E007E007E007E007E0FFFFFFFF101C7F9B12>I<
FFFC07FFFFFC07FF0FC000E00FC001C00FC003800FC006000FC00C000FC038000FC070000FC0E0
000FC1C0000FC3C0000FC7E0000FCFE0000FFBF0000FF3F8000FE1F8000FC0FC000FC0FE000FC0
7E000FC03F000FC01F800FC01FC00FC00FC00FC007E00FC007F0FFFC3FFFFFFC3FFF201C7E9B25
>75 D<FFFF00FFFF000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC000
0FC0000FC0000FC0000FC0000FC0000FC0030FC0030FC0030FC0070FC0070FC0060FC00E0FC01E
0FC07EFFFFFEFFFFFE181C7E9B1D>I<FFC00003FFFFE00007FF0FE00007F00DF0000DF00DF000
0DF00DF0000DF00CF80019F00CF80019F00C7C0031F00C7C0031F00C3E0061F00C3E0061F00C1F
00C1F00C1F00C1F00C1F00C1F00C0F8181F00C0F8181F00C07C301F00C07C301F00C03E601F00C
03E601F00C01FC01F00C01FC01F00C01FC01F00C00F801F00C00F801F0FFC0701FFFFFC0701FFF
281C7E9B2D>I<FFE003FFFFE003FF0FF000300FF800300DFC00300CFE00300C7E00300C3F0030
0C1F80300C1FC0300C0FE0300C07F0300C03F0300C01F8300C01FC300C00FE300C007F300C003F
300C001FB00C001FF00C000FF00C0007F00C0003F00C0001F00C0000F00C0000F0FFC00070FFC0
0030201C7E9B25>I<003FE00001F07C0003C01E000F800F801F0007C01E0003C03E0003E07E00
03F07C0001F07C0001F0FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC
0001F87C0001F07E0003F07E0003F03E0003E03F0007E01F0007C00F800F8003C01E0001F07C00
003FE0001D1C7D9B24>I<FFFFF800FFFFFE000FC03F800FC00F800FC007C00FC007E00FC007E0
0FC007E00FC007E00FC007E00FC007C00FC007C00FC00F800FC03F000FFFFC000FC000000FC000
000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000FFFC
0000FFFC00001B1C7E9B21>I<FFFFF00000FFFFFE00000FC03F00000FC00F80000FC007C0000F
C007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007C0000FC00F80000FC03E0000
0FFFF000000FC07C00000FC03E00000FC03F00000FC01F80000FC01F80000FC01F80000FC01F80
000FC01F80000FC01F80000FC01F81800FC01F81800FC00FC180FFFC07C300FFFC01FE00211C7E
9B24>82 D<07F8201FFEE03C07E07801E07000E0F000E0F00060F00060F80000FE0000FFE0007F
FE003FFF003FFF800FFFC007FFE0007FE00003F00001F00000F0C000F0C000F0C000E0E000E0F0
01C0FC03C0EFFF0083FC00141C7D9B1B>I<7FFFFFE07FFFFFE0781F81E0701F80E0601F8060E0
1F8070C01F8030C01F8030C01F8030C01F8030001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F800007FFFE0007FFFE001C1C7E9B21>I<FFFC03FFFFFC03FF0FC000300FC000300FC000
300FC000300FC000300FC000300FC000300FC000300FC000300FC000300FC000300FC000300FC0
00300FC000300FC000300FC000300FC000300FC000300FC0003007C0003007C0006003E000E001
F001C000FC0780007FFE00000FF800201C7E9B25>I<FFFC01FF80FFFC01FF800FC000180007E0
00300007E000300007F000700003F000600003F800E00001F800C00001FC00C00000FC01800000
FC018000007E030000007E030000007F070000003F060000003F8E0000001F8C0000001FCC0000
000FD80000000FD800000007F000000007F000000007F000000003E000000003E000000001C000
000001C00000211C7F9B24>I<FFFC7FFE0FFCFFFC7FFE0FFC0FC007E000C00FC007F000C00FE0
03F001C007E003F0018007E007F8018003F007F8030003F007F8030003F80CFC070001F80CFC06
0001F81CFE060001FC187E0E0000FC187E0C0000FC387F0C00007E303F1800007E303F1800007F
601FB800003F601FB000003FE01FF000003FC00FF000001FC00FE000001FC00FE000000F8007C0
00000F8007C000000F0003C0000007000380000007000380002E1C7F9B31>I<7FFE1FFE007FFE
1FFE0007F001800003F803800001FC07000000FC06000000FE0C0000007F1C0000003F38000000
3FB00000001FE00000000FE00000000FE000000007F000000003F800000007F80000000FFC0000
000CFE000000187E000000387F000000703F800000601F800000C01FC00001C00FE000018007F0
00030007F000FFF03FFF80FFF03FFF80211C7F9B24>I<04010018060020080020080040100040
1000802000802000BC2F00FE3F80FE3F807E1F807E1F803C0F00110E7B9C19>92
D<0FF8001C1E003E0F803E07803E07C01C07C00007C0007FC007E7C01F07C03C07C07C07C0F807
C0F807C0F807C0780BC03E13F80FE1F815127F9117>97 D<FF0000FF00001F00001F00001F0000
1F00001F00001F00001F00001F00001F00001F3F801FE1E01F80701F00781F003C1F003C1F003E
1F003E1F003E1F003E1F003E1F003E1F003C1F003C1F00781F80701EC1E01C3F00171D7F9C1B>
I<03FC000E0E001C1F003C1F00781F00780E00F80000F80000F80000F80000F80000F800007800
007801803C01801C03000E0E0003F80011127E9115>I<000FF0000FF00001F00001F00001F000
01F00001F00001F00001F00001F00001F001F9F00F07F01C03F03C01F07801F07801F0F801F0F8
01F0F801F0F801F0F801F0F801F07801F07801F03C01F01C03F00F0FFE03F9FE171D7E9C1B>I<
01FC000F07001C03803C01C07801C07801E0F801E0F801E0FFFFE0F80000F80000F80000780000
7C00603C00601E00C00F038001FC0013127F9116>I<007F0001E38003C7C00787C00F87C00F83
800F80000F80000F80000F80000F8000FFF800FFF8000F80000F80000F80000F80000F80000F80
000F80000F80000F80000F80000F80000F80000F80000F80007FF8007FF800121D809C0F>I<03
F8F00E0F381E0F381C07303C07803C07803C07803C07801C07001E0F000E0E001BF80010000018
00001800001FFF001FFFC00FFFE01FFFF07801F8F00078F00078F000787000707800F01E03C007
FF00151B7F9118>I<FF0000FF00001F00001F00001F00001F00001F00001F00001F00001F0000
1F00001F0FC01F31E01F40F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F8
1F00F81F00F81F00F81F00F8FFE7FFFFE7FF181D7F9C1B>I<1E003F003F003F003F001E000000
00000000000000000000FF00FF001F001F001F001F001F001F001F001F001F001F001F001F001F
001F00FFE0FFE00B1E7F9D0E>I<007800FC00FC00FC00FC007800000000000000000000000003
FC03FC007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C
707CF87CF878F8F070E01F800E26839D0F>I<FF0000FF00001F00001F00001F00001F00001F00
001F00001F00001F00001F00001F0FF81F0FF81F03801F07001F0C001F18001F70001FF8001FFC
001FBC001F3E001F1F001F0F001F0F801F07C01F03E0FFC7FCFFC7FC161D7F9C19>I<FF00FF00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F00FFE0FFE00B1D7F9C0E>I<FF0FC07E00FF31E18F001F40F207801F80
FC07C01F80FC07C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F
00F807C01F00F807C01F00F807C01F00F807C01F00F807C0FFE7FF3FF8FFE7FF3FF825127F9128
>I<FF0FC0FF31E01F40F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F
00F81F00F81F00F81F00F8FFE7FFFFE7FF18127F911B>I<01FC000F07801C01C03C01E07800F0
7800F0F800F8F800F8F800F8F800F8F800F8F800F87800F07800F03C01E01E03C00F078001FC00
15127F9118>I<FF3F80FFE1E01F80F01F00781F007C1F003C1F003E1F003E1F003E1F003E1F00
3E1F003E1F003C1F007C1F00781F80F01FC1E01F3F001F00001F00001F00001F00001F00001F00
00FFE000FFE000171A7F911B>I<03F0600F0CE01E07E03C03E07C03E07803E0F803E0F803E0F8
03E0F803E0F803E0F803E07803E07C03E03C03E01C07E00E0FE003F3E00003E00003E00003E000
03E00003E00003E0001FFC001FFC161A7E9119>I<FE3E00FE47001E8F801E8F801E8F801F0700
1F00001F00001F00001F00001F00001F00001F00001F00001F00001F0000FFF000FFF00011127F
9114>I<1FD830786018E018E018F000FF807FE07FF01FF807FC007CC01CC01CE01CE018F830CF
C00E127E9113>I<0300030003000300070007000F000F003FFCFFFC1F001F001F001F001F001F
001F001F001F001F0C1F0C1F0C1F0C0F08079803F00E1A7F9913>I<FF07F8FF07F81F00F81F00
F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F01F80F01F80786
FF01F8FF18127F911B>I<FFC1FCFFC1FC1F00601F80E00F80C00FC0C007C18007C18003E30003
E30001F60001F60001FE0000FC0000FC0000780000780000300016127F9119>I<FF8FF8FEFF8F
F8FE1F03E0301F03E0301F83E0700F83F0600F86F06007C6F0C007CEF8C007EC79C003EC7D8003
F83D8001F83F0001F83F0001F01F0000F01E0000E00E0000E00E001F127F9122>I<FFC7FCFFC7
FC1F81800F838007C70003EE0001FC0001F80000F800007C0000FE0001DF00039F00070F800607
C00C03E0FF07FCFF07FC16127F9119>I<FFC1FCFFC1FC1F00601F80E00F80C00FC0C007C18007
C18003E30003E30001F70001F60000FE0000FC0000FC0000780000780000300000300000700070
6000F86000F8C000F980007300003E0000161A7F9119>I<3FFF803C1F00303F00303E00607C00
60FC0060F80001F00003F00007E00007C1800F81801F81801F03803E03007E07007C0F00FFFF00
11127F9115>I<FFFFFE1701808B18>I E /Fj 55 122 df<0001FF81FE00001FFFEFFF80007F80
FF87C000FC00FE0FE001F801FE0FE003F801FC0FE007F001FC0FE007F001FC07C007F001FC0000
07F001FC000007F001FC000007F001FC000007F001FC000007F001FC000007F001FC0000FFFFFF
FFF800FFFFFFFFF800FFFFFFFFF80007F001FC000007F001FC000007F001FC000007F001FC0000
07F001FC000007F001FC000007F001FC000007F001FC000007F001FC000007F001FC000007F001
FC000007F001FC000007F001FC000007F001FC000007F001FC000007F001FC000007F001FC0000
07F001FC000007F001FC000007F001FC000007F001FC00007FFF1FFFE0007FFF1FFFE0007FFF1F
FFE0002B2A7FA928>11 D<1C0038007F00FE007F00FE00FF81FF00FFC1FF80FFC1FF807FC0FF80
7FC0FF801CC0398000C0018000C00180018003000180030001800300030006000300060006000C
000C00180018003000300060002000400019157EA924>34 D<FFFF80FFFF80FFFF80FFFF80FFFF
80FFFF8011067F9017>45 D<1C003E007F00FF80FF80FF807F003E001C0009097B8813>I<0000
0300000007800000078000000F8000000F0000000F0000001F0000001E0000003E0000003C0000
003C0000007C0000007800000078000000F8000000F0000001F0000001E0000001E0000003E000
0003C0000003C0000007C00000078000000F8000000F0000000F0000001F0000001E0000003E00
00003C0000003C0000007C0000007800000078000000F8000000F0000001F0000001E0000001E0
000003E0000003C0000003C0000007C00000078000000F8000000F0000000F0000001F0000001E
0000001E0000003E0000003C0000007C0000007800000078000000F8000000F0000000F0000000
60000000193C7CAC22>I<003F800001FFF00007E0FC000FC07E001F803F001F803F003F001F80
3F001F807F001FC07F001FC07F001FC07F001FC0FF001FE0FF001FE0FF001FE0FF001FE0FF001F
E0FF001FE0FF001FE0FF001FE0FF001FE0FF001FE0FF001FE0FF001FE0FF001FE0FF001FE0FF00
1FE07F001FC07F001FC07F001FC07F001FC03F001F803F001F801F803F001F803F000FC07E0007
E0FC0001FFF000003F80001B277DA622>I<000E00001E00007E0007FE00FFFE00FFFE00F8FE00
00FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE00
00FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE00
00FE0000FE0000FE007FFFFE7FFFFE7FFFFE17277BA622>I<00FF800003FFF0000FFFFC001F03
FE003800FF007C007F80FE003FC0FF003FC0FF003FE0FF001FE0FF001FE07E001FE03C003FE000
003FE000003FC000003FC000007F8000007F000000FE000000FC000001F8000003F0000003E000
00078000000F0000001E0000003C00E0007000E000E000E001C001C0038001C0070001C00FFFFF
C01FFFFFC03FFFFFC07FFFFFC0FFFFFF80FFFFFF80FFFFFF801B277DA622>I<007F800003FFF0
0007FFFC000F81FE001F00FF003F80FF003F807F803F807F803F807F801F807F800F007F800000
FF000000FF000000FE000001FC000001F8000007F00000FFC00000FFF0000001FC0000007E0000
007F0000007F8000003FC000003FC000003FE000003FE03C003FE07E003FE0FF003FE0FF003FE0
FF003FC0FF007FC07E007F807C007F003F01FE001FFFFC0007FFF00000FF80001B277DA622>I<
00000E0000001E0000003E0000007E000000FE000000FE000001FE000003FE0000077E00000E7E
00000E7E00001C7E0000387E0000707E0000E07E0000E07E0001C07E0003807E0007007E000E00
7E000E007E001C007E0038007E0070007E00E0007E00FFFFFFF8FFFFFFF8FFFFFFF80000FE0000
00FE000000FE000000FE000000FE000000FE000000FE000000FE00007FFFF8007FFFF8007FFFF8
1D277EA622>I<0C0003000F803F000FFFFE000FFFFC000FFFF8000FFFF0000FFFE0000FFFC000
0FFE00000E0000000E0000000E0000000E0000000E0000000E0000000E7FC0000FFFF8000F80FC
000E003E000C003F0000001F8000001FC000001FC000001FE000001FE018001FE07C001FE0FE00
1FE0FE001FE0FE001FE0FE001FC0FC001FC078003F8078003F803C007F001F01FE000FFFF80003
FFF00000FF80001B277DA622>I<0007F000003FFC0000FFFE0001FC0F0003F01F8007E03F800F
C03F801FC03F801F803F803F801F003F8000007F0000007F0000007F000000FF000000FF0FC000
FF3FF800FF707C00FFC03E00FFC03F00FF801F80FF801FC0FF001FC0FF001FE0FF001FE0FF001F
E07F001FE07F001FE07F001FE07F001FE03F001FE03F001FC01F801FC01F803F800FC03F0007E0
7E0003FFFC0000FFF000003FC0001B277DA622>I<380000003E0000003FFFFFF03FFFFFF03FFF
FFF07FFFFFE07FFFFFC07FFFFF807FFFFF0070000E0070000E0070001C00E0003800E0007000E0
00E0000000E0000001C000000380000007800000078000000F0000000F0000001F0000001F0000
003F0000003E0000003E0000007E0000007E0000007E0000007E000000FE000000FE000000FE00
0000FE000000FE000000FE000000FE000000FE0000007C0000003800001C297CA822>I<003FC0
0001FFF00003FFFC0007C07E000F003F001E001F001E000F803E000F803E000F803F000F803F00
0F803FC00F003FF01F001FFC1E001FFE3C000FFFF80007FFE00003FFF80001FFFC0001FFFE0007
FFFF000F0FFF801E03FFC03C01FFC07C007FE078001FE0F80007E0F80007E0F80003E0F80003E0
F80003E0F80003C07C0003C07C0007803F000F001FC03E000FFFFC0003FFF800007FC0001B277D
A622>I<007F800001FFF00007FFF8000FE0FC001F807E003F803F007F003F007F001F80FF001F
80FF001FC0FF001FC0FF001FC0FF001FE0FF001FE0FF001FE0FF001FE07F001FE07F003FE03F00
3FE01F807FE00F807FE007C1DFE003FF9FE0007E1FE000001FE000001FC000001FC000001FC000
003F801F003F803F803F003F803F003F807E003F807C001F01F8001E03F0000FFFE00007FF8000
01FE00001B277DA622>I<000003800000000007C00000000007C0000000000FE0000000000FE0
000000000FE0000000001FF0000000001FF0000000003FF8000000003FF8000000003FF8000000
0073FC0000000073FC00000000F3FE00000000E1FE00000000E1FE00000001C0FF00000001C0FF
00000003C0FF80000003807F80000007807FC0000007003FC0000007003FC000000E003FE00000
0E001FE000001E001FF000001C000FF000001FFFFFF000003FFFFFF800003FFFFFF80000780007
FC0000700003FC0000700003FC0000E00001FE0000E00001FE0001E00001FF0001C00000FF0001
C00000FF00FFFE001FFFFEFFFE001FFFFEFFFE001FFFFE2F297EA834>65
D<FFFFFFF80000FFFFFFFF8000FFFFFFFFC00003F8001FF00003F8000FF80003F80007FC0003F8
0003FC0003F80003FC0003F80003FE0003F80001FE0003F80001FE0003F80001FE0003F80003FE
0003F80003FC0003F80003FC0003F80007F80003F8000FF00003F8001FE00003F800FFC00003FF
FFFE000003FFFFFFE00003F80007F00003F80003FC0003F80001FE0003F80001FE0003F80000FF
0003F80000FF0003F80000FF8003F80000FF8003F80000FF8003F80000FF8003F80000FF8003F8
0000FF8003F80000FF0003F80001FF0003F80003FE0003F80007FC0003F8001FF800FFFFFFFFF0
00FFFFFFFFC000FFFFFFFE000029297DA831>I<00003FF001800003FFFE0380000FFFFF878000
3FF007DF8000FF8001FF8001FE00007F8003FC00003F8007F000001F800FF000000F801FE00000
07801FE0000007803FC0000007803FC0000003807FC0000003807F80000003807F8000000000FF
8000000000FF8000000000FF8000000000FF8000000000FF8000000000FF8000000000FF800000
0000FF8000000000FF80000000007F80000000007F80000000007FC0000003803FC0000003803F
C0000003801FE0000003801FE0000007000FF00000070007F000000E0003FC00001E0001FE0000
3C0000FF8000F800003FF007E000000FFFFFC0000003FFFF000000003FF8000029297CA832>I<
FFFFFFF80000FFFFFFFF8000FFFFFFFFE00003FC001FF80003FC0007FC0003FC0001FE0003FC00
00FF0003FC00007F8003FC00003FC003FC00001FC003FC00001FE003FC00001FE003FC00000FF0
03FC00000FF003FC00000FF003FC00000FF003FC00000FF803FC00000FF803FC00000FF803FC00
000FF803FC00000FF803FC00000FF803FC00000FF803FC00000FF803FC00000FF803FC00000FF8
03FC00000FF003FC00000FF003FC00000FF003FC00001FE003FC00001FE003FC00001FC003FC00
003FC003FC00007F8003FC00007F0003FC0001FE0003FC0003FC0003FC001FF800FFFFFFFFE000
FFFFFFFF8000FFFFFFFC00002D297DA835>I<FFFFFFFFE0FFFFFFFFE0FFFFFFFFE003FC001FE0
03FC0007F003FC0001F003FC0001F003FC0000F003FC00007003FC00007003FC00007003FC01C0
7803FC01C03803FC01C03803FC01C03803FC03C00003FC03C00003FC0FC00003FFFFC00003FFFF
C00003FFFFC00003FC0FC00003FC03C00003FC03C00003FC01C00E03FC01C00E03FC01C00E03FC
01C01C03FC00001C03FC00001C03FC00001C03FC00003C03FC00003803FC00007803FC0000F803
FC0001F803FC0003F803FC001FF8FFFFFFFFF0FFFFFFFFF0FFFFFFFFF027297DA82D>I<FFFFFF
FFC0FFFFFFFFC0FFFFFFFFC003FC003FC003FC000FE003FC0003E003FC0001E003FC0001E003FC
0000E003FC0000E003FC0000E003FC0000F003FC03807003FC03807003FC03807003FC03800003
FC07800003FC07800003FC1F800003FFFF800003FFFF800003FFFF800003FC1F800003FC078000
03FC07800003FC03800003FC03800003FC03800003FC03800003FC00000003FC00000003FC0000
0003FC00000003FC00000003FC00000003FC00000003FC00000003FC000000FFFFFC0000FFFFFC
0000FFFFFC000024297DA82B>I<00007FE003000003FFFC0700001FFFFF0F00003FF00FFF0000
FF8001FF0001FE0000FF0003F800003F0007F000003F000FF000001F001FE000000F001FE00000
0F003FC000000F003FC0000007007FC0000007007F80000007007F8000000000FF8000000000FF
8000000000FF8000000000FF8000000000FF8000000000FF8000000000FF8000000000FF800000
0000FF8001FFFFF87F8001FFFFF87F8001FFFFF87FC00000FF003FC00000FF003FC00000FF001F
E00000FF001FE00000FF000FF00000FF0007F00000FF0003F80000FF0001FE0000FF0000FF8001
FF00003FF007BF00001FFFFF1F000003FFFE0F0000007FF003002D297CA836>I<FFFFF01FFFFE
FFFFF01FFFFEFFFFF01FFFFE03FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00
007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F80
03FC00007F8003FC00007F8003FC00007F8003FC00007F8003FFFFFFFF8003FFFFFFFF8003FFFF
FFFF8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F80
03FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F8003FC00
007F8003FC00007F8003FC00007F8003FC00007F8003FC00007F80FFFFF01FFFFEFFFFF01FFFFE
FFFFF01FFFFE2F297DA836>I<FFFFFCFFFFFCFFFFFC01FE0001FE0001FE0001FE0001FE0001FE
0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE
0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE0001FE
0001FE0001FE0001FE00FFFFFCFFFFFCFFFFFC16297EA81A>I<FFFFF001FFFCFFFFF001FFFCFF
FFF001FFFC03FC00001E0003FC00003C0003FC0000780003FC0000F00003FC0001E00003FC0003
C00003FC0007000003FC001E000003FC003C000003FC0078000003FC00F0000003FC01E0000003
FC0380000003FC07C0000003FC1FC0000003FC3FE0000003FC7FF0000003FCFFF8000003FDE7F8
000003FF83FC000003FF01FE000003FE01FF000003FC00FF000003FC007F800003FC003FC00003
FC003FC00003FC001FE00003FC000FF00003FC000FF80003FC0007F80003FC0003FC0003FC0001
FE0003FC0001FF0003FC0000FF0003FC00007F80FFFFF00FFFFEFFFFF00FFFFEFFFFF00FFFFE2F
297DA836>75 D<FFFE0000001FFFC0FFFE0000001FFFC0FFFF0000003FFFC003FF0000003FF000
03FF0000003FF00003BF80000077F00003BF80000077F000039FC00000E7F000039FC00000E7F0
00038FE00001C7F000038FE00001C7F0000387F0000387F0000387F0000387F0000387F0000387
F0000383F8000707F0000383F8000707F0000381FC000E07F0000381FC000E07F0000380FE001C
07F0000380FE001C07F0000380FF003807F00003807F003807F00003807F003807F00003803F80
7007F00003803F807007F00003801FC0E007F00003801FC0E007F00003800FE1C007F00003800F
E1C007F00003800FE1C007F000038007F38007F000038007F38007F000038003FF0007F0000380
03FF0007F000038001FE0007F000038001FE0007F000038000FC0007F000038000FC0007F000FF
FE00FC01FFFFC0FFFE007801FFFFC0FFFE007801FFFFC03A297DA841>77
D<0000FFE000000007FFFC0000003FC07F8000007F001FC00001FC0007F00003F80003F80007F0
0001FC000FF00001FE001FE00000FF001FE00000FF003FC000007F803FC000007F807FC000007F
C07F8000003FC07F8000003FC07F8000003FC0FF8000003FE0FF8000003FE0FF8000003FE0FF80
00003FE0FF8000003FE0FF8000003FE0FF8000003FE0FF8000003FE0FF8000003FE0FF8000003F
E07F8000003FC07FC000007FC07FC000007FC03FC000007F803FC000007F801FE00000FF001FE0
0000FF000FF00001FE0007F00001FC0003F80003F80001FC0007F00000FF001FE000003FC07F80
00000FFFFE00000000FFE000002B297CA834>79 D<FFFFFFF800FFFFFFFF00FFFFFFFFC003FC00
3FE003FC000FF003FC0007F803FC0007FC03FC0003FC03FC0003FE03FC0003FE03FC0003FE03FC
0003FE03FC0003FE03FC0003FE03FC0003FE03FC0003FC03FC0007FC03FC0007F803FC000FF003
FC003FE003FFFFFF8003FFFFFE0003FC00000003FC00000003FC00000003FC00000003FC000000
03FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC0000
0003FC00000003FC00000003FC000000FFFFF00000FFFFF00000FFFFF0000027297DA82F>I<FF
FFFFE00000FFFFFFFE0000FFFFFFFF800003FC007FE00003FC000FF00003FC0007F80003FC0007
FC0003FC0003FC0003FC0003FE0003FC0003FE0003FC0003FE0003FC0003FE0003FC0003FE0003
FC0003FE0003FC0003FC0003FC0007F80003FC0007F80003FC001FE00003FC007FC00003FFFFFE
000003FFFFF0000003FC00FC000003FC007F000003FC003F800003FC003F800003FC001FC00003
FC001FE00003FC001FE00003FC001FE00003FC001FE00003FC001FE00003FC001FF00003FC001F
F00003FC001FF00003FC001FF00703FC001FF80703FC000FF80703FC0007F80EFFFFF003FE1CFF
FFF001FFF8FFFFF0003FF030297DA834>82 D<007F806003FFF0E007FFF9E00F807FE01F001FE0
3E0007E07C0003E07C0001E0FC0001E0FC0001E0FC0000E0FE0000E0FE0000E0FF000000FFC000
007FFE00007FFFE0003FFFFC001FFFFE000FFFFF8007FFFFC003FFFFE000FFFFE00007FFF00000
7FF000000FF8000007F8000003F8600001F8E00001F8E00001F8E00001F8F00001F0F00001F0F8
0003F0FC0003E0FF0007C0FFE01F80F3FFFF00E0FFFE00C01FF0001D297CA826>I<7FFFFFFFFF
C07FFFFFFFFFC07FFFFFFFFFC07F803FC03FC07E003FC007C078003FC003C078003FC003C07000
3FC001C0F0003FC001E0F0003FC001E0E0003FC000E0E0003FC000E0E0003FC000E0E0003FC000
E0E0003FC000E000003FC0000000003FC0000000003FC0000000003FC0000000003FC000000000
3FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC000
0000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC000000000
3FC0000000003FC0000000003FC0000000003FC00000007FFFFFE000007FFFFFE000007FFFFFE0
002B287EA730>I<010002000300060006000C000C0018001800300030006000300060006000C0
006000C0006000C000C0018000C0018000CE019C00FF81FF00FF81FF00FFC1FF80FFC1FF807FC0
FF803F807F003F807F000E001C00191578A924>92 D<01FF800007FFF0000F81F8001FC07E001F
C07E001FC03F000F803F8007003F8000003F8000003F8000003F80000FFF8000FFFF8007FC3F80
0FE03F803F803F803F003F807F003F80FE003F80FE003F80FE003F80FE003F807E007F807F00DF
803F839FFC0FFF0FFC01FC03FC1E1B7E9A21>97 D<FFE0000000FFE0000000FFE00000000FE000
00000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE0
0000000FE00000000FE00000000FE00000000FE1FE00000FE7FF80000FFE07E0000FF801F0000F
F000F8000FE000FC000FE000FE000FE0007F000FE0007F000FE0007F000FE0007F800FE0007F80
0FE0007F800FE0007F800FE0007F800FE0007F800FE0007F800FE0007F000FE0007F000FE0007F
000FE000FE000FE000FC000FF001F8000FF803F0000F9E07E0000F07FF80000E01FC0000212A7E
A926>I<001FF80000FFFE0003F01F0007E03F800FC03F801F803F803F801F007F800E007F0000
007F000000FF000000FF000000FF000000FF000000FF000000FF000000FF0000007F0000007F00
00007F8000003F8001C01F8001C00FC0038007E0070003F01E0000FFFC00001FE0001A1B7E9A1F
>I<00003FF80000003FF80000003FF800000003F800000003F800000003F800000003F8000000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
1FE3F80000FFFBF80003F03FF80007E00FF8000FC007F8001F8003F8003F8003F8007F0003F800
7F0003F8007F0003F800FF0003F800FF0003F800FF0003F800FF0003F800FF0003F800FF0003F8
00FF0003F8007F0003F8007F0003F8007F0003F8003F8003F8001F8003F8000F8007F80007C00F
F80003F03BFF8000FFF3FF80003FC3FF80212A7EA926>I<003FE00001FFF80003F07E0007C01F
000F801F801F800F803F800FC07F000FC07F0007C07F0007E0FF0007E0FF0007E0FFFFFFE0FFFF
FFE0FF000000FF000000FF0000007F0000007F0000007F0000003F8000E01F8000E00FC001C007
E0038003F81F0000FFFE00001FF0001B1B7E9A20>I<0007F0003FFC00FE3E01F87F03F87F03F0
7F07F07F07F03E07F00007F00007F00007F00007F00007F00007F000FFFFC0FFFFC0FFFFC007F0
0007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F0
0007F00007F00007F00007F00007F00007F00007F0007FFF807FFF807FFF80182A7EA915>I<00
FF81F003FFE7F80FC1FE7C1F80FC7C1F007C383F007E107F007F007F007F007F007F007F007F00
7F007F007F007F003F007E001F007C001F80FC000FC1F8001FFFE00018FF800038000000380000
003C0000003E0000003FFFF8001FFFFF001FFFFF800FFFFFC007FFFFE01FFFFFF03E0007F07C00
01F8F80000F8F80000F8F80000F8F80000F87C0001F03C0001E01F0007C00FC01F8003FFFE0000
7FF0001E287E9A22>I<FFE0000000FFE0000000FFE00000000FE00000000FE00000000FE00000
000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE000
00000FE00000000FE07F00000FE1FFC0000FE787E0000FEE03F0000FF803F0000FF803F8000FF0
03F8000FF003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000F
E003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F800
0FE003F8000FE003F800FFFE3FFF80FFFE3FFF80FFFE3FFF80212A7DA926>I<07000FC01FE03F
E03FE03FE01FE00FC007000000000000000000000000000000FFE0FFE0FFE00FE00FE00FE00FE0
0FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFEFF
FE0F2B7DAA14>I<FFE00000FFE00000FFE000000FE000000FE000000FE000000FE000000FE000
000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE01FFC0FE01FFC0FE0
1FFC0FE007800FE00F000FE01E000FE03C000FE078000FE0E0000FE3C0000FE7C0000FEFE0000F
FFE0000FFFF0000FF3F8000FE3F8000FC1FC000FC0FE000FC07F000FC07F000FC03F800FC01FC0
0FC00FC00FC00FE0FFFC3FFEFFFC3FFEFFFC3FFE1F2A7EA924>107 D<FFE0FFE0FFE00FE00FE0
0FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00F
E00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFEFFFE0F2A7DA9
14>I<FFC07F800FF000FFC1FFE03FFC00FFC383F0707E000FC603F8C07F000FCC01F9803F000F
D801FF003F800FF001FE003F800FF001FE003F800FE001FC003F800FE001FC003F800FE001FC00
3F800FE001FC003F800FE001FC003F800FE001FC003F800FE001FC003F800FE001FC003F800FE0
01FC003F800FE001FC003F800FE001FC003F800FE001FC003F800FE001FC003F800FE001FC003F
800FE001FC003F800FE001FC003F80FFFE1FFFC3FFF8FFFE1FFFC3FFF8FFFE1FFFC3FFF8351B7D
9A3C>I<FFC07F0000FFC1FFC000FFC787E0000FCE03F0000FD803F0000FD803F8000FF003F800
0FF003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8
000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003
F8000FE003F800FFFE3FFF80FFFE3FFF80FFFE3FFF80211B7D9A26>I<003FE00001FFFC0003F0
7E000FC01F801F800FC03F800FE03F0007E07F0007F07F0007F07F0007F0FF0007F8FF0007F8FF
0007F8FF0007F8FF0007F8FF0007F8FF0007F8FF0007F87F0007F07F0007F03F800FE03F800FE0
1F800FC00FC01F8007F07F0001FFFC00003FE0001D1B7E9A22>I<FFE1FE0000FFE7FF8000FFFE
07E0000FF803F0000FF001F8000FE000FC000FE000FE000FE000FF000FE0007F000FE0007F000F
E0007F800FE0007F800FE0007F800FE0007F800FE0007F800FE0007F800FE0007F800FE0007F00
0FE000FF000FE000FF000FE000FE000FE001FC000FF001F8000FF803F0000FFE0FE0000FE7FF80
000FE1FC00000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE000
00000FE00000000FE0000000FFFE000000FFFE000000FFFE00000021277E9A26>I<FFC1F0FFC7
FCFFCE3E0FD87F0FD87F0FF07F0FF03E0FF01C0FE0000FE0000FE0000FE0000FE0000FE0000FE0
000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE000FFFF00FFFF00FFFF00181B
7E9A1C>114 D<03FE300FFFF01E03F03800F0700070F00070F00070F80070FC0000FFE0007FFE
007FFF803FFFE01FFFF007FFF800FFF80003FC0000FC60007CE0003CF0003CF00038F80038FC00
70FF01E0F7FFC0C1FF00161B7E9A1B>I<00700000700000700000700000F00000F00000F00001
F00003F00003F00007F0001FFFF0FFFFF0FFFFF007F00007F00007F00007F00007F00007F00007
F00007F00007F00007F00007F00007F00007F00007F03807F03807F03807F03807F03807F03803
F03803F87001F86000FFC0001F8015267FA51B>I<FFE03FF800FFE03FF800FFE03FF8000FE003
F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE0
03F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000FE003F8000F
E003F8000FE003F8000FE007F80007E007F80007E00FF80003F03BFF8001FFF3FF80003FC3FF80
211B7D9A26>I<FFFE03FF80FFFE03FF80FFFE03FF8007F000700007F000700007F800F00003F8
00E00003FC01E00001FC01C00001FC01C00000FE03800000FE038000007F070000007F07000000
7F8F0000003F8E0000003FDE0000001FDC0000001FDC0000000FF80000000FF80000000FF80000
0007F000000007F000000003E000000003E000000001C00000211B7F9A24>I<FFFE7FFC0FFEFF
FE7FFC0FFEFFFE7FFC0FFE0FE007E000E007F003F001C007F003F001C007F807F803C003F807F8
038003F807F8038001FC0EFC070001FC0EFC070001FE1EFC0F0000FE1C7E0E0000FE1C7E0E0000
FF383F1E00007F383F1C00007F783F3C00003FF01FB800003FF01FB800003FF01FF800001FE00F
F000001FE00FF000000FC007E000000FC007E000000FC007E00000078003C00000078003C0002F
1B7F9A32>I<FFFC0FFF00FFFC0FFF00FFFC0FFF0007F003C00003F807800001FC07800000FE0F
000000FF1E0000007F3C0000003FF80000001FF00000000FF00000000FF000000007F000000007
F80000000FFC0000001FFE0000001EFE0000003C7F000000783F800000F01FC00001E01FE00001
C00FE00003C007F000FFF01FFF80FFF01FFF80FFF01FFF80211B7F9A24>I<FFFE03FF80FFFE03
FF80FFFE03FF8007F000700007F000700007F800F00003F800E00003FC01E00001FC01C00001FC
01C00000FE03800000FE038000007F070000007F070000007F8F0000003F8E0000003FDE000000
1FDC0000001FDC0000000FF80000000FF80000000FF800000007F000000007F000000003E00000
0003E000000001C000000001C000000003800000000380000038078000007C07000000FE0F0000
00FE0E000000FE1E000000FE3C0000007C780000003FE00000000FC000000021277F9A24>I
E /Fk 65 123 df<0001FC000703000C03001C07001C0300180000380000380000380000380000
700007FFFC00701C00701C00701C00E03800E03800E03800E03800E07001C07001C07001C07001
C0E201C0E201C0E20380E4038064038038038000030000070000060000C60000E40000CC000070
00001825819C17>12 D<18303C783C783C78040804080810081010202040408081000D0C799C15
>34 D<183878380808101020404080050C7D830D>44 D<FFC0FFC0FFC00A037D890F>I<3078F0
6005047C830D>I<00000200000600000600000C00000C00001800003000003000006000006000
00C00000C0000180000180000300000600000600000C00000C0000180000180000300000300000
600000C00000C0000180000180000300000300000600000C00000C000018000018000030000030
0000600000600000C0000080000017297F9E15>I<003C0000C600018300030300060300060380
0E03800C03801C03801C0300380700380700380700380700700E00700E00700E00700E00E01C00
E01C00E01C00E03800E03800E03000C06000E0600060C0007180001E0000111D7B9B15>I<0002
0006000C001C007C039C0038003800380038007000700070007000E000E000E000E001C001C001
C001C003800380038003800780FFF00F1C7C9B15>I<003C0000C3000101800201800201C00441
C00441C00841C00841C00841C01083801083801107000E0600000C0000180000300000C0000100
000600000800001001001002002002004006007E0C00C7F80083F80080E000121D7C9B15>I<00
3E0000C1800101800200C00400C00440C00841C00841C00841C0088380070380000700000E0001
F800003800000C00000C00000E00000E00000E00000E00700E00E01C00801C0080380080300040
600021C0001F0000121D7C9B15>I<0001800001C0000380000380000380000300000700000700
000600000E00000C00001C0000180000180000300000300000600000400000C600018E00010E00
020E00061C000C1C00181C003F1C0040F800803F00003800003800007000007000007000007000
00E00000600012247E9B15>I<00C06000FFC001FF8001FE000100000100000200000200000200
00020000047800058C00060600040600080600000700000700000600000E00000E00700E00700C
00E01C0080180080380040300040600021C0001F0000131D7C9B15>I<000F0000308000C08001
83800383800300000600000E00000C00001C00001CF0003B18003C0C00380C00780C00700E0070
0E00700E00601C00E01C00E01C00E01C00E03800E03800E0700060600060C0002180001E000011
1D7B9B15>I<09C04017E0801FE0803C6100302700601A00400600400400800C00800800001800
00100000300000600000600000600000C00000C00001C000018000038000038000030000070000
0700000700000E00000E00000C0000121D799B15>I<001E000061000081800180800300C00300
C006018006018006018007030007860003CC0003F00001F000037800063C00081E00180E00300E
00600600600600600600C00C00C00C00C0180060100060200030C0000F0000121D7C9B15>I<00
3C0000C6000183000303000603000E03000C03801C03801C03001C030038070038070038070038
0F00380E00181E00181E000C6C00079C00001C00001800003800003000006000E0C000E0C00081
80008600007C0000111D7B9B15>I<0FFFFFE01FFFFFF000000000000000000000000000000000
00000000000000000000000000000000FFFFFF807FFFFF001C0C7C8F20>61
D<0000180000001800000038000000380000007800000078000000B8000001B800000138000002
380000023C0000041C0000041C0000081C0000181C0000101C0000201C0000201C00007FFC0000
401C0000801C0001801C0001001C0002001C0002001C0004000E000C000E001C001E00FF00FFC0
1A1D7E9C1F>65 D<01FFFE00003C0780003803C0003801C0003801C0003801C0007001C0007003
C0007003C00070078000E0070000E00E0000E03C0000FFF80001C01C0001C00E0001C00F0001C0
0F0003800F0003800F0003800F0003800F0007001E0007001C0007003C00070078000E01E000FF
FF80001A1C7D9B1D>I<0003F020001E0C60003002E000E003C001C001C0038001C0070000C00E
0000801E0000801C0000803C0000803C000000780000007800000078000000F0000000F0000000
F0000000F0000000F0000400F0000400F0000400F0000800700008007000100038002000180040
000C0180000706000001F800001B1E7A9C1E>I<01FFFE00003C0780003801C0003801C0003800
E0003800E0007000F00070007000700070007000F000E000F000E000F000E000F000E000F001C0
01E001C001E001C001E001C001C0038003C003800380038007800380070007000E0007001C0007
003800070070000E01C000FFFF00001C1C7D9B1F>I<01FFFFE0003C00E0003800600038004000
380040003800400070004000700040007020400070200000E0400000E0400000E0C00000FFC000
01C0800001C0800001C0800001C080000381010003800100038002000380020007000400070004
0007000C00070018000E007800FFFFF0001B1C7D9B1C>I<01FFFFC0003C01C0003800C0003800
8000380080003800800070008000700080007020800070200000E0400000E0400000E0C00000FF
C00001C0800001C0800001C0800001C08000038100000380000003800000038000000700000007
00000007000000070000000F000000FFF000001A1C7D9B1B>I<0003F020001E0C60003002E000
E003C001C001C0038001C0070000C00E0000801E0000801C0000803C0000803C00000078000000
7800000078000000F0000000F0000000F001FFC0F0001E00F0001C00F0001C00F0001C00F0001C
00700038007000380038003800180078000C0090000707100001F800001B1E7A9C20>I<01FFCF
FE003C01E0003801C0003801C0003801C0003801C00070038000700380007003800070038000E0
070000E0070000E0070000FFFF0001C00E0001C00E0001C00E0001C00E0003801C0003801C0003
801C0003801C00070038000700380007003800070038000F007800FFE7FF001F1C7D9B1F>I<01
FFC0003C0000380000380000380000380000700000700000700000700000E00000E00000E00000
E00001C00001C00001C00001C0000380000380000380000380000700000700000700000700000F
0000FFE000121C7E9B10>I<01FFC0FF003C003C00380030003800400038008000380100007002
0000700400007010000070200000E0400000E0C00000E1C00000E5C00001C8E00001D0E00001E0
E00001C07000038070000380700003803800038038000700380007001C0007001C0007001C000F
001E00FFE0FF80201C7D9B20>75 D<01FFE0003C00003800003800003800003800007000007000
00700000700000E00000E00000E00000E00001C00001C00001C00001C000038008038008038008
0380100700100700300700600700E00E03C0FFFFC0151C7D9B1A>I<01FE0007F8003E00078000
2E000F00002E001700002E001700002E002700004E002E00004E004E00004E004E00004E008E00
008E011C00008E011C00008E021C00008E021C0001070438000107043800010708380001071038
000207107000020720700002072070000207407000040740E000040780E000040700E0000C0700
E0001C0601E000FF861FFC00251C7D9B25>I<01FC03FE001C0070003C0060002E0040002E0040
002E0040004700800047008000470080004380800083810000838100008181000081C1000101C2
000101C2000100E2000100E2000200E40002007400020074000200740004003800040038000400
38000C0018001C001000FF8010001F1C7D9B1F>I<0007F000001C1C0000700E0000E0070001C0
038003800380070003800E0003C01E0003C01C0003C03C0003C03C0003C0780003C0780003C078
0003C0F0000780F0000780F0000780F0000F00F0000F00F0000E00F0001E00F0003C0070003800
700070007800E0003801C0001C0380000E0E000003F800001A1E7A9C20>I<01FFFC00003C0700
00380380003801C0003801C0003801C0007003C0007003C0007003C00070038000E0078000E007
0000E00E0000E0380001FFE00001C0000001C0000001C000000380000003800000038000000380
0000070000000700000007000000070000000F000000FFE000001A1C7D9B1C>I<01FFF800003C
0E000038070000380380003803800038038000700780007007800070078000700F0000E00E0000
E01C0000E0700000FFC00001C0C00001C0600001C0700001C07000038070000380700003807000
038070000700F0000700F0400700F0400700F0800F007880FFE0790000001E001A1D7D9B1E>82
D<000F8400304C00403C00801801001803001803001806001006001006000007000007000003E0
0003FC0001FF00007F800007C00001C00001C00000C00000C02000C02000C06001806001806003
00600200F00400CC180083E000161E7D9C17>I<1FFFFFC01C0701C0300E00C0200E0080600E00
80400E0080401C0080801C0080801C0080001C0000003800000038000000380000003800000070
000000700000007000000070000000E0000000E0000000E0000000E0000001C0000001C0000001
C0000001C0000003C000007FFE00001A1C799B1E>I<7FF0FF800F001C000E0018000E0010000E
0010000E0010001C0020001C0020001C0020001C00200038004000380040003800400038004000
70008000700080007000800070008000E0010000E0010000E0010000E0020000E0020000E00400
00E00400006008000030300000104000000F800000191D779B1F>I<FF803FC01C000F001C0004
001C0008001C0008001C0010001C0010001C0020001C0040001C0040001E0080000E0080000E01
00000E0200000E0200000E0400000E0400000E0800000E1800000E1000000E2000000720000007
40000007C0000007800000070000000700000006000000060000001A1D779B1F>I<FF83FF0FF0
3C007001C038007001803800F001003800F0020038017002003801700400380270040038027008
001C047008001C047010001C087010001C087020001C107020001C107040001C207040001C2070
80001C407180001C407100001C807200001D807200001D007400001E007400001E007800001C00
7800001C00700000180070000018006000001000600000241D779B29>I<01FF81FE001E00F000
1C0060001E0080000E0180000E0100000F02000007040000070800000790000003A0000003C000
0001C0000001C0000001E0000002E0000004E0000008F000001070000020700000603800004038
0000803C0001001C0002001C0006001E001E001E00FF80FFC01F1C7E9B1F>I<FFC00FE00E0007
800E0006000F000400070008000700180007801000038020000380400003C0800001C1800001C1
000001E2000000E4000000EC000000F80000007000000070000000E0000000E0000000E0000000
E0000001C0000001C0000001C0000001C00000038000003FF800001B1C789B1F>I<060C081010
2020402040408040808100B160F9F0F9F070E00E0C759C15>92 D<03CC063C0C3C181C38383038
70387038E070E070E070E070E0E2C0E2C0E261E462643C380F127B9115>97
D<3F00070007000E000E000E000E001C001C001C001C0039C03E60383038307038703870387038
E070E070E070E060E0E0C0C0C1C0618063003C000D1D7B9C13>I<01F007080C08181C38383000
70007000E000E000E000E000E000E008E010602030C01F000E127B9113>I<001F800003800003
80000700000700000700000700000E00000E00000E00000E0003DC00063C000C3C00181C003838
00303800703800703800E07000E07000E07000E07000E0E200C0E200C0E20061E4006264003C38
00111D7B9C15>I<01E007100C1018083810701070607F80E000E000E000E000E000E008601060
2030C01F000D127B9113>I<0003C0000670000C70001C60001C00001C00003800003800003800
00380000380003FF8000700000700000700000700000700000E00000E00000E00000E00000E000
01C00001C00001C00001C00001C000038000038000038000030000030000070000C60000E60000
CC00007800001425819C0D>I<00F3018F030F06070E0E0C0E1C0E1C0E381C381C381C381C3838
30383038187818F00F700070007000E000E0C0C0E1C0C3007E00101A7D9113>I<0FC00001C000
01C0000380000380000380000380000700000700000700000700000E78000E8C000F0E000E0E00
1C0E001C0E001C0E001C0E00381C00381C00381C00383800703880703880707080707100E03200
601C00111D7D9C15>I<01800380010000000000000000000000000000001C002600470047008E
008E000E001C001C001C0038003800710071007100720072003C00091C7C9B0D>I<0FC00001C0
0001C0000380000380000380000380000700000700000700000700000E0F000E11000E23800E43
801C83001C80001D00001E00003F800039C00038E00038E00070E20070E20070E20070E400E064
00603800111D7D9C13>107 D<1F800380038007000700070007000E000E000E000E001C001C00
1C001C0038003800380038007000700070007000E400E400E400E40068003800091D7C9C0B>I<
3C1E0780266318C04683A0E04703C0E08E0380E08E0380E00E0380E00E0380E01C0701C01C0701
C01C0701C01C070380380E0388380E0388380E0708380E0710701C0320300C01C01D127C9122>
I<3C3C002646004687004707008E07008E07000E07000E07001C0E001C0E001C0E001C1C00381C
40381C40383840383880701900300E0012127C9117>I<01E007180C0C180C380C300E700E700E
E01CE01CE01CE018E038E030E06060C031801E000F127B9115>I<07870004D98008E0C008E0C0
11C0E011C0E001C0E001C0E00381C00381C00381C00381800703800703000707000706000E8C00
0E70000E00000E00001C00001C00001C00001C00003C0000FF8000131A7F9115>I<3C3C26C246
8747078E068E000E000E001C001C001C001C0038003800380038007000300010127C9112>114
D<01F006080C080C1C18181C001F001FC00FF007F0007800386030E030C030806060C01F000E12
7D9111>I<00C001C001C001C00380038003800380FFE00700070007000E000E000E000E001C00
1C001C001C00384038403840388019000E000B1A7D990E>I<1E0300270700470700470700870E
00870E000E0E000E0E001C1C001C1C001C1C001C1C003838803838801838801839001C5900078E
0011127C9116>I<1E06270E470E4706870287020E020E021C041C041C041C0818083808181018
200C4007800F127C9113>I<1E01832703874703874703838707018707010E07010E07011C0E02
1C0E021C0E021C0E04180C04181C04181C081C1C100C263007C3C018127C911C>I<070E001991
0010E38020E38041C30041C00001C00001C000038000038000038000038000070200670200E704
00CB04008B080070F00011127D9113>I<1E03270747074707870E870E0E0E0E0E1C1C1C1C1C1C
1C1C38383838183818381C7007F00070007000E0E0C0E1C0818047003C00101A7C9114>I<0382
07C20FEC08381008001000200040008001000200040008081008383067F043E081C00F127D9111
>I E /Fl 10 104 df<FFFFFF80FFFFFF8019027D8A20>0 D<01800180018001804182F18F399C
0FF003C003C00FF0399CF18F4182018001800180018010127E9215>3 D<0003FE0000000FFF80
00003C01E00000F000780001C0001C00030000060006000003000C0000018018000000C0180000
00C030000000603000000060600000003060000000306000000030C000000018C000000018C000
000018C000000018C000000018C000000018C000000018C000000018C000000018600000003060
0000003060000000303000000060300000006018000000C018000000C00C000001800600000300
030000060001C0001C0000F0007800003C01E000000FFF80000003FE000025277E9D2A>13
D<03C00FF01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFF7FFE7FFE3FFC1FF80FF003C010107E9115>
15 D<000001800000078000001E00000078000001E00000078000001E00000078000001E00000
078000001E00000078000000E0000000780000001E0000000780000001E0000000780000001E00
00000780000001E0000000780000001E0000000780000001800000000000000000000000000000
00000000000000000000000000007FFFFF00FFFFFF8019227D9920>20 D<C0000000F00000003C
0000000F00000003C0000000F00000003C0000000F00000003C0000000F00000003C0000000F00
0000038000000F0000003C000000F0000003C000000F0000003C000000F0000003C000000F0000
003C00000070000000C00000000000000000000000000000000000000000000000000000000000
00007FFFFF00FFFFFF8019227D9920>I<02000000000400000000040000000008000000001000
0000002000000000FFFFFFFFF0FFFFFFFFF0200000000010000000000800000000040000000004
000000000200000000250E7D902A>32 D<00000004000000000200000000020000000001000000
0000800000000040FFFFFFFFF8FFFFFFFFF8000000004000000000800000000100000000020000
000002000000000400250E7E902A>I<003C00E001C00180038003800380038003800380038003
8003800380038003800380030007001C00F0001C00070003000380038003800380038003800380
038003800380038003800380018001C000E0003C0E297D9E15>102 D<F0001C00070003000380
038003800380038003800380038003800380038003800380018001C000E0003C00E001C0018003
80038003800380038003800380038003800380038003800380030007001C00F0000E297D9E15>
I E /Fm 27 122 df<387878380808101020204080050C7D830C>44 D<0007F010001C0C300070
026000C001E0038000E0070000E00E0000600E0000601C0000403C000040380000407800000078
00000078000000F0000000F0000000F0000000F0000000F0000000F0000080F000010070000100
7000010038000200380004001C0004000C001800060020000380C000007F00001C1E7C9C1E>67
D<0FFF8000F80000F00000F00000F00000F00000F00001E00001E00001E00001E00001E00001E0
0003C00003C00003C00003C00003C00003C0000780000780000780000780000780000780000F00
000F8000FFF800111C7F9B0F>73 D<0FFFC000F80000F00000F00000F00000F00000F00001E000
01E00001E00001E00001E00001E00003C00003C00003C00003C00003C00003C004078004078004
0780040780080780080780180F00380F00F0FFFFF0161C7E9B1A>76 D<0FF807FE00F800F000FC
006000BC004000BE0040009E0040009E0040010F0080010F008001078080010780800103C08001
03C0800201E1000201E1000200F1000200F1000200F9000200790004007E0004003E0004003E00
04001E0004001E0004000E000C000C001E000400FF8004001F1C7E9B1F>78
D<0007F00000381C0000E00E0001C0030003800380070001C00E0001C01E0001E01C0000E03C00
00E0380000E0780000F0780000F0780000F0F00001E0F00001E0F00001E0F00001E0F00003C0F0
0003C0F00003C0700007807000070078000F0038001E003C001C001C0038000E00E00003838000
00FE00001C1E7C9C20>I<003F0400C0CC0180380300380600180E00180E00180E00181E00101E
00001F00000F80000FF80007FF0003FF8001FFC0003FE00003E00001E00000E00000E04000E040
00E04000E04000C06001C0E00180F00300CC0E0083F800161E7E9C17>83
D<FFF87FE00F800F000F0006000F0004000F0004000F0004000F0004001E0008001E0008001E00
08001E0008001E0008001E0008003C0010003C0010003C0010003C0010003C0010003C00100078
00200078002000780020003800400038004000380080001C0100000C020000070C000001F00000
1B1D7A9B1F>85 D<07FF87FE00FE01F0007C01C0003C0180003E0100001E0200001E0400001F08
00000F1800000F90000007A0000007C0000003C0000003E0000003E0000003F0000004F0000008
F0000010F8000030780000207C0000403C0000803E0001001E0003001F0006000F001F001F80FF
C0FFF01F1C7F9B1F>88 D<07F0001C18001E0C001C0E00180E00000E00000E0001FE000F0E001C
1C00301C00701C00E01C40E01C40E03C40E05C80709D803F0E0012127D9115>97
D<01F8071C0C1E181C38183000700070007000E000E000E000600060047008301018200FC00F12
7D9112>99 D<0003F00000F00000E00000E00000E00000E00000E00000E00001C00001C00001C0
00F1C0030DC00C03C01C0380380380300380700380700380700380E00700E00700E00700600700
600700700F00301E00186F00078FC0141D7D9C17>I<01F8070C0C061C073803300370037FFF70
00E000E000E00060006002300430081C3007C010127E9112>I<000038003CCC00C69C01830803
8380070380070380070380070380070700030600038C0004F0000400000C00000C00000FFE0007
FF800FFFC01801C02000C06000E0C000C0C000C0600180200300180E0007F000161C809215>
103 D<00C001C001C0018000000000000000000000000000001F80078003800700070007000700
070007000E000E000E000E000E000E001C001E00FF800A1D7F9C0C>105
D<07E001E001C001C001C001C001C001C003800380038003800380038007000700070007000700
07000E000E000E000E000E000E001C001E00FF800B1D7F9C0C>108 D<1F8FC0FC000790610600
03E07607000780780700078078070007007007000700700700070070070007007007000E00E00E
000E00E00E000E00E00E000E00E00E000E00E00E000E00E00E001C01C01C001E01E01E00FF8FF8
FF8021127F9124>I<1F8F8007B0C003C0E00780E00780E00700E00700E00700E00700E00E01C0
0E01C00E01C00E01C00E01C00E01C01C03801E03C0FF9FF014127F9117>I<00FC000307000E01
801C01C03800C03000C07000E07000E07000E0E001C0E001C0E001C0600180600380700700380E
001C180007E00013127E9115>I<0FC78003D86001E03003C03803803803801803801C03801C03
801C0700380700380700380700700700700700E00F01C00EC3000E3C000E00000E00000E00001C
00001C00001C00001C0000FF8000161A809117>I<1F9C07EE03CF078E078C0700070007000700
0E000E000E000E000E000E001C001E00FFC010127F9110>114 D<03F20C0E1806100430043804
3E001FE00FF007F8003C401C400C400C6018E010D0608FC00F127F9110>I<0200020002000600
06000C001C003C00FFE01C001C0038003800380038003800380070007040704070407040708070
8031001E000B1A7C9910>I<FC1F803C07801C0380380700380700380700380700380700380700
700E00700E00700E00700E00701E00701E00703C00305E001F9F8011127C9117>I<FF0FE03C03
801C03001C02001C06001C04001E08000E08000E10000E10000E200007200007400007C0000780
0007000003000002000013127C9116>I<1FE3FC07C1E003818001C10001C20000E40000EC0000
7800007000003800007800009C00011E00020E000407000C07003C0780FE1FF016127F9116>
120 D<0FF0FE03C03801C03001C02001C06001C04001E08000E08000E10000E10000E200007200
007400007C00007800007000003000002000002000004000004000708000F10000F10000E60000
780000171A809116>I E /Fn 92 124 df<007E1F0001C1B1800303E3C00703C3C00E03C1800E
01C0000E01C0000E01C0000E01C0000E01C0000E01C000FFFFFC000E01C0000E01C0000E01C000
0E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0007F87FC001A1D809C18>11 D<007E0001C1800301800703C00E03
C00E01800E00000E00000E00000E00000E0000FFFFC00E01C00E01C00E01C00E01C00E01C00E01
C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C07F87F8151D809C17
>I<007FC001C1C00303C00703C00E01C00E01C00E01C00E01C00E01C00E01C00E01C0FFFFC00E
01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C07FCFF8151D809C17>I<003F07E00001C09C18000380F018000701F03C000E
01E03C000E00E018000E00E000000E00E000000E00E000000E00E000000E00E00000FFFFFFFC00
0E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C
000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E0
1C007FC7FCFF80211D809C23>I<003F07FC0001C0DC1C000381F03C000701F03C000E01E01C00
0E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C00FFFFFFFC000E00E01C
000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E0
1C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C007FC7
FCFF80211D809C23>I<60F0F0F0F0F0F0F060606060606060606060606060000000000060F0F0
60041E7C9D0C>33 D<6060F0F0F8F86868080808080808101010102020404080800D0C7F9C15>
I<0003018000030180000301800006030000060300000603000006030000060300000C0600000C
0600000C0600000C060000180C007FFFFFF8FFFFFFFC0030180000301800003018000030180000
603000006030000060300000603000FFFFFFFC7FFFFFF800C060000180C0000180C0000180C000
0180C000030180000301800003018000030180000603000006030000060300001E257E9C23>I<
0080008007E01898308460824081C087C08FC08FC086E080F0807E803FC01FF00FF803FC00BE00
8E00876087F083F083E0838082408240842088189007E00080008010217E9E15>I<0F0000C018
8000C030600380703807006027FB00E0100600E0100C00E0100C00E0101800E0101800E0103000
E0106000602060007020C00030418000188180000F0303C00006062000060C10000C1C08001818
080018380400303804006038040060380400C0380400C03804018038040300180803001C080600
0C100C000620040003C01E217E9E23>I<00E00000019000000308000003080000070800000708
000007080000070800000710000007100000072000000740000003C03FE003800F000380060003
80040005C0040009C0080010E0100030E010006070200060702000E0384000E03C4000E01C8000
E00F0020E0070020700780403009C0401830E18007C03E001B1F7E9D20>I<60F0F86808080810
10204080050C7C9C0C>I<004000800100020006000C000C001800180030003000700060006000
6000E000E000E000E000E000E000E000E000E000E000E000E00060006000600070003000300018
0018000C000C00060002000100008000400A2A7D9E10>I<800040002000100018000C000C0006
00060003000300038001800180018001C001C001C001C001C001C001C001C001C001C001C001C0
018001800180038003000300060006000C000C00180010002000400080000A2A7E9E10>I<0180
0180018001804182F18F399C0FF003C003C00FF0399CF18F4182018001800180018010127E9E15
>I<00060000000600000006000000060000000600000006000000060000000600000006000000
060000000600000006000000060000FFFFFFE0FFFFFFE000060000000600000006000000060000
0006000000060000000600000006000000060000000600000006000000060000000600001B1C7E
9720>I<60F0F0701010101020204080040C7C830C>I<FFE0FFE00B0280890E>I<60F0F0600404
7C830C>I<00010003000600060006000C000C000C0018001800180030003000300060006000C0
00C000C0018001800180030003000300060006000C000C000C0018001800180030003000300060
0060006000C000C00010297E9E15>I<03C00C301818300C300C700E60066006E007E007E007E0
07E007E007E007E007E007E007E007E007E00760066006700E300C300C18180C3007E0101D7E9B
15>I<030007003F00C70007000700070007000700070007000700070007000700070007000700
070007000700070007000700070007000F80FFF80D1C7C9B15>I<07C01830201C400C400EF00F
F80FF807F8077007000F000E000E001C001C00380070006000C00180030006010C01180110023F
FE7FFEFFFE101C7E9B15>I<07E01830201C201C781E780E781E381E001C001C00180030006007
E00030001C001C000E000F000F700FF80FF80FF80FF00E401C201C183007E0101D7E9B15>I<00
0C00000C00001C00003C00003C00005C0000DC00009C00011C00031C00021C00041C000C1C0008
1C00101C00301C00201C00401C00C01C00FFFFC0001C00001C00001C00001C00001C00001C0000
1C0001FFC0121C7F9B15>I<300C3FF83FF03FC020002000200020002000200023E02430281830
1C200E000E000F000F000F600FF00FF00FF00F800E401E401C2038187007C0101D7E9B15>I<00
F0030C06040C0E181E301E300C700070006000E3E0E430E818F00CF00EE006E007E007E007E007
E007600760077006300E300C18180C3003E0101D7E9B15>I<4000007FFF807FFF007FFF004002
0080040080040080080000100000100000200000600000400000C00000C00001C0000180000180
00038000038000038000038000078000078000078000078000078000078000030000111D7E9B15
>I<03E00C301008200C20066006600660067006780C3E083FB01FE007F007F818FC307E601E60
0FC007C003C003C003C00360026004300C1C1007E0101D7E9B15>I<03C00C301818300C700C60
0EE006E006E007E007E007E007E0076007700F300F18170C2707C700060006000E300C780C7818
7010203030C00F80101D7E9B15>I<60F0F0600000000000000000000060F0F06004127C910C>I<
60F0F0600000000000000000000060F0F0701010101020204080041A7C910C>I<7FFFFFC0FFFF
FFE00000000000000000000000000000000000000000000000000000000000000000FFFFFFE07F
FFFFC01B0C7E8F20>61 D<0FE03038401CE00EF00EF00EF00E000C001C0030006000C000800180
0100010001000100010001000000000000000000000003000780078003000F1D7E9C14>63
D<003F800000C0600003001800040004000800020010000100201F00802070808040E0404040C0
384041C038408180382083803820838038208380382083803820838038208180382041C0382040
C0384040E0784020709880201F0F00100000000800000004000000030001E000C01F80003FF000
1B1D7E9C20>I<000600000006000000060000000F0000000F0000000F00000017800000178000
001780000023C0000023C0000023C0000041E0000041E0000041E0000080F0000080F0000180F8
000100780001FFF80003007C0002003C0002003C0006003E0004001E0004001E000C001F001E00
1F00FF80FFF01C1D7F9C1F>I<FFFFC00F00F00F00380F003C0F001C0F001E0F001E0F001E0F00
1E0F001C0F003C0F00780F01F00FFFE00F00780F003C0F001E0F000E0F000F0F000F0F000F0F00
0F0F000F0F001E0F001E0F003C0F0078FFFFE0181C7E9B1D>I<001F808000E061800180198007
0007800E0003801C0003801C00018038000180780000807800008070000080F0000000F0000000
F0000000F0000000F0000000F0000000F0000000F0000000700000807800008078000080380000
801C0001001C0001000E000200070004000180080000E03000001FC000191E7E9C1E>I<FFFFC0
000F00F0000F003C000F000E000F0007000F0007000F0003800F0003C00F0001C00F0001C00F00
01E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001C00F0001C00F
0003C00F0003800F0007800F0007000F000E000F001C000F007000FFFFC0001B1C7E9B20>I<FF
FFFC0F003C0F000C0F00040F00040F00060F00020F00020F02020F02000F02000F02000F06000F
FE000F06000F02000F02000F02000F02010F00010F00020F00020F00020F00060F00060F000C0F
003CFFFFFC181C7E9B1C>I<FFFFF80F00780F00180F00080F00080F000C0F00040F00040F0204
0F02000F02000F02000F06000FFE000F06000F02000F02000F02000F02000F00000F00000F0000
0F00000F00000F00000F00000F8000FFF800161C7E9B1B>I<001F808000E06180018019800700
07800E0003801C0003801C00018038000180780000807800008070000080F0000000F0000000F0
000000F0000000F0000000F0000000F000FFF0F0000F8070000780780007807800078038000780
1C0007801C0007800E00078007000B800180118000E06080001F80001C1E7E9C21>I<FFF3FFC0
0F003C000F003C000F003C000F003C000F003C000F003C000F003C000F003C000F003C000F003C
000F003C000F003C000FFFFC000F003C000F003C000F003C000F003C000F003C000F003C000F00
3C000F003C000F003C000F003C000F003C000F003C000F003C00FFF3FFC01A1C7E9B1F>I<FFF0
0F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F00FFF00C1C7F9B0F>I<1FFF00F800780078007800780078007800
780078007800780078007800780078007800780078007800787078F878F878F878F0F040E021C0
1F00101D7F9B15>I<FFF03FE00F000F000F000C000F0008000F0010000F0020000F0040000F00
80000F0100000F0200000F0400000F0E00000F1F00000F2F00000F2780000F4780000F83C0000F
01E0000F01E0000F00F0000F00F8000F0078000F003C000F003C000F001E000F001F000F001F80
FFF07FF01C1C7E9B20>I<FFF8000F80000F00000F00000F00000F00000F00000F00000F00000F
00000F00000F00000F00000F00000F00000F00000F00000F00000F00080F00080F00080F00180F
00180F00100F00300F00700F01F0FFFFF0151C7E9B1A>I<FF8000FF800F8000F8000F8000F800
0BC00178000BC00178000BC001780009E002780009E002780008F004780008F004780008F00478
00087808780008780878000878087800083C107800083C107800083C107800081E207800081E20
7800081E207800080F407800080F40780008078078000807807800080780780008030078001C03
007800FF8307FF80211C7E9B26>I<FF007FC00F800E000F8004000BC0040009E0040009E00400
08F0040008F8040008780400083C0400083C0400081E0400080F0400080F0400080784000807C4
000803C4000801E4000801E4000800F40008007C0008007C0008003C0008003C0008001C000800
0C001C000C00FF8004001A1C7E9B1F>I<003F800000E0E0000380380007001C000E000E001C00
07003C00078038000380780003C0780003C0700001C0F00001E0F00001E0F00001E0F00001E0F0
0001E0F00001E0F00001E0F00001E0700001C0780003C0780003C0380003803C0007801C000700
0E000E0007001C000380380000E0E000003F80001B1E7E9C20>I<FFFF800F00E00F00780F003C
0F001C0F001E0F001E0F001E0F001E0F001E0F001C0F003C0F00780F00E00FFF800F00000F0000
0F00000F00000F00000F00000F00000F00000F00000F00000F00000F0000FFF000171C7E9B1C>
I<003F800000E0E0000380380007001C000E000E001C0007003C00078038000380780003C07800
03C0700001C0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E070
0001C0780003C0780003C0380003803C0E07801C1107000E208E000720DC0003A0F80000F0E020
003FE0200000602000007060000078E000003FC000003FC000001F8000000F001B257E9C20>I<
FFFF00000F01E0000F0078000F003C000F001C000F001E000F001E000F001E000F001E000F001C
000F003C000F0078000F01E0000FFF00000F03C0000F00E0000F00F0000F0078000F0078000F00
78000F0078000F0078000F0078000F0078100F0078100F0038100F003C20FFF01C20000007C01C
1D7E9B1F>I<07E0801C1980300580700380600180E00180E00080E00080E00080F00000F80000
7C00007FC0003FF8001FFE0007FF0000FF80000F800007C00003C00001C08001C08001C08001C0
C00180C00180E00300D00200CC0C0083F800121E7E9C17>I<7FFFFFC0700F01C0600F00C0400F
0040400F0040C00F0020800F0020800F0020800F0020000F0000000F0000000F0000000F000000
0F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
000F0000000F0000000F0000001F800003FFFC001B1C7F9B1E>I<FFF07FC00F000E000F000400
0F0004000F0004000F0004000F0004000F0004000F0004000F0004000F0004000F0004000F0004
000F0004000F0004000F0004000F0004000F0004000F0004000F0004000F0004000F0004000700
080007800800038010000180100000C020000070C000001F00001A1D7E9B1F>I<FFE00FF01F00
03C00F0001800F0001000F800300078002000780020003C0040003C0040003C0040001E0080001
E0080001F0080000F0100000F0100000F830000078200000782000003C4000003C4000003C4000
001E8000001E8000001F8000000F0000000F00000006000000060000000600001C1D7F9B1F>I<
FFE0FFE0FF1F001F003C1E001E00180F001F00100F001F00100F001F001007801F002007802780
20078027802003C027804003C043C04003C043C04003E043C04001E081E08001E081E08001E081
E08000F100F10000F100F10000F100F100007900FA00007A007A00007A007A00003E007C00003C
003C00003C003C00003C003C00001800180000180018000018001800281D7F9B2B>I<7FF0FFC0
0FC03E000780180003C0180003E0100001E0200001F0600000F0400000788000007D8000003D00
00001E0000001F0000000F0000000F8000000F80000013C0000023E0000021E0000041F00000C0
F8000080780001007C0003003C0002001E0006001F001F003F80FFC0FFF01C1C7F9B1F>I<FFF0
07FC0F8001E00780008007C0018003C0010003E0020001F0020000F0040000F804000078080000
7C1800003C1000001E2000001F2000000F4000000FC00000078000000780000007800000078000
00078000000780000007800000078000000780000007800000078000007FF8001E1C809B1F>I<
7FFFF07C01F07001E06003C06003C0400780400F80400F00401E00001E00003C00007C00007800
00F00000F00001E00003E00003C0100780100780100F00101F00301E00203C00203C00607800E0
F803E0FFFFE0141C7E9B19>I<FEFEC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0FEFE07297C9E0C>I<08081010202040404040808080808080B0
B0F8F8787830300D0C7A9C15>I<FEFE0606060606060606060606060606060606060606060606
0606060606060606060606060606FEFE0729809E0C>I<0810204040808080B0F87830050C7D9C
0C>96 D<1FC000307000783800781C00301C00001C00001C0001FC000F1C00381C00701C00601C
00E01C40E01C40E01C40603C40304E801F870012127E9115>I<FC00001C00001C00001C00001C
00001C00001C00001C00001C00001C00001C00001C7C001D86001E03001C01801C01C01C00C01C
00E01C00E01C00E01C00E01C00E01C00E01C00C01C01C01C01801E030019060010F800131D7F9C
17>I<07E00C301878307870306000E000E000E000E000E000E00060007004300418080C3007C0
0E127E9112>I<003F000007000007000007000007000007000007000007000007000007000007
0003E7000C1700180F00300700700700600700E00700E00700E00700E00700E00700E007006007
00700700300700180F000C370007C7E0131D7E9C17>I<03E00C301818300C700E6006E006FFFE
E000E000E000E00060007002300218040C1803E00F127F9112>I<00F8018C071E061E0E0C0E00
0E000E000E000E000E00FFE00E000E000E000E000E000E000E000E000E000E000E000E000E000E
000E000E007FE00F1D809C0D>I<00038003C4C00C38C01C3880181800381C00381C00381C0038
1C001818001C38000C300013C0001000003000001800001FF8001FFF001FFF803003806001C0C0
00C0C000C0C000C06001803003001C0E0007F800121C7F9215>I<FC00001C00001C00001C0000
1C00001C00001C00001C00001C00001C00001C00001C7C001C87001D03001E03801C03801C0380
1C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF0141D7F
9C17>I<18003C003C0018000000000000000000000000000000FC001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C00FF80091D7F9C0C>I<00C001E001E000C000
000000000000000000000000000FE000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E060E0F0C0F1C061803E000B25839C0D>I<FC00001C0000
1C00001C00001C00001C00001C00001C00001C00001C00001C00001C3FC01C0F001C0C001C0800
1C10001C20001C40001CE0001DE0001E70001C78001C38001C3C001C1C001C0E001C0F001C0F80
FF9FE0131D7F9C16>I<FC001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C00FF80091D7F9C0C>I<FC7E07
E0001C838838001D019018001E01E01C001C01C01C001C01C01C001C01C01C001C01C01C001C01
C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C
01C01C00FF8FF8FF8021127F9124>I<FC7C001C87001D03001E03801C03801C03801C03801C03
801C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF014127F9117>I<03
F0000E1C00180600300300700380600180E001C0E001C0E001C0E001C0E001C0E001C060018070
03803003001806000E1C0003F00012127F9115>I<FC7C001D86001E03001C01801C01C01C00C0
1C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01C01C01801E03001D06001CF8001C0000
1C00001C00001C00001C00001C00001C0000FF8000131A7F9117>I<03C1000C3300180B00300F
00700700700700E00700E00700E00700E00700E00700E00700600700700700300F00180F000C37
0007C700000700000700000700000700000700000700000700003FE0131A7E9116>I<FCE01D30
1E781E781C301C001C001C001C001C001C001C001C001C001C001C001C00FFC00D127F9110>I<
1F9030704030C010C010E010F8007F803FE00FF000F880388018C018C018E010D0608FC00D127F
9110>I<04000400040004000C000C001C003C00FFE01C001C001C001C001C001C001C001C001C
001C101C101C101C101C100C100E2003C00C1A7F9910>I<FC1F801C03801C03801C03801C0380
1C03801C03801C03801C03801C03801C03801C03801C03801C03801C07800C07800E1B8003E3F0
14127F9117>I<FF07E03C03801C01001C01000E02000E02000704000704000704000388000388
0003D80001D00001D00000E00000E00000E00000400013127F9116>I<FF3FCFE03C0F03801C07
01801C0701001C0B01000E0B82000E0B82000E1182000711C4000711C4000720C40003A0E80003
A0E80003C0680001C0700001C0700001803000008020001B127F911E>I<7F8FF00F03800F0300
07020003840001C80001D80000F00000700000780000F800009C00010E00020E00060700040380
1E07C0FF0FF81512809116>I<FF07E03C03801C01001C01000E02000E02000704000704000704
0003880003880003D80001D00001D00000E00000E00000E000004000004000008000008000F080
00F10000F300006600003C0000131A7F9116>I<7FFC70386038407040F040E041C003C0038007
000F040E041C043C0C380870087038FFF80E127F9112>I<FFFFF01401808B15>I
E /Fo 28 122 df<78FCFCFCFC7806067A8512>46 D<00003FE0010001FFF8030007F01E03001F
800307003E000087007800004F00F000002F01E000001F03C000000F078000000F0F800000070F
000000071F000000031E000000033E000000033C000000017C000000017C000000017C00000001
7800000000F800000000F800000000F800000000F800000000F800000000F800000000F8000000
00F800000000F800000000F800000000F80000000078000000007C000000007C000000017C0000
00013C000000013E000000011E000000011F000000020F000000020F80000006078000000403C0
00000801E000000800F00000100078000020003E0000C0001F8003800007F00F000001FFFC0000
003FE00028337CB130>67 D<FFFFFFE00000FFFFFFFC000007E0007F000003E0000F800003E000
03C00003E00001E00003E00000F00003E00000780003E000003C0003E000001E0003E000001E00
03E000000F0003E000000F0003E000000F8003E00000078003E0000007C003E0000007C003E000
0003C003E0000003C003E0000003E003E0000003E003E0000003E003E0000003E003E0000003E0
03E0000003E003E0000003E003E0000003E003E0000003E003E0000003E003E0000003E003E000
0003C003E0000003C003E0000007C003E0000007C003E00000078003E00000078003E000000F80
03E000000F0003E000001F0003E000001E0003E000003C0003E00000780003E00000F80003E000
01F00003E00003E00003E0000F800007E0003F0000FFFFFFFC0000FFFFFFE000002B317CB033>
I<003FFFC0003FFFC00000FE0000007C0000007C0000007C0000007C0000007C0000007C000000
7C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000
007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C00
00007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0078007C
00FC007C00FC007C00FC007C00F8007800B000F8004000F0004001E0002001C00018038000060F
000001F800001A327CB022>74 D<FFFFC00000FFFFC0000007F000000003E000000003E0000000
03E000000003E000000003E000000003E000000003E000000003E000000003E000000003E00000
0003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0
00000003E000000003E000000003E000004003E000004003E000004003E000004003E000008003
E000008003E000008003E000008003E000018003E000018003E000038003E000038003E0000780
03E0000F0003E0003F0007E000FF00FFFFFFFF00FFFFFFFF0022317CB029>76
D<FFE00007FFC0FFF00007FFC003F000007C0002F80000380002FC00001000027C00001000023E
00001000023E00001000021F00001000021F80001000020F800010000207C00010000207E00010
000203E00010000203F00010000201F00010000200F80010000200FC00100002007C0010000200
7E00100002003E00100002001F00100002001F80100002000F80100002000FC01000020007C010
00020003E01000020003F01000020001F01000020000F81000020000F810000200007C10000200
007E10000200003E10000200001F10000200001F10000200000F90000200000FD00002000007D0
0002000003F00002000003F00002000001F00002000001F00002000000F0000200000070000700
000070000F8000003000FFF800003000FFF8000010002A317CB032>78 D<007F802001FFE02007
C078600F001C601E0006E03C0003E0380001E0780000E0700000E070000060F0000060F0000060
F0000020F0000020F0000020F8000020F80000007C0000007E0000003F0000003FC000001FF800
000FFF800007FFF80003FFFC0000FFFF00000FFF800000FFC000001FE0000007E0000003F00000
01F0000000F0000000F8000000F88000007880000078800000788000007880000078C0000078C0
000070E00000F0E00000E0F00000E0F80001C0EC000380C7000700C1F01E00807FFC00800FF000
1D337CB125>83 D<7FFFFFFFFFE07FFFFFFFFFE07E000F8007E078000F8001E070000F8000E060
000F80006040000F80002040000F800020C0000F800030C0000F80003080000F80001080000F80
001080000F80001080000F80001080000F80001080000F80001000000F80000000000F80000000
000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F80
000000000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000
000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F80
000000000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000
000F80000000000F80000000001FC00000000FFFFF8000000FFFFF80002C317EB030>I<FFFF80
07FFC0FFFF8007FFC007F000007C0003E00000380003E00000100003E00000100003E000001000
03E00000100003E00000100003E00000100003E00000100003E00000100003E00000100003E000
00100003E00000100003E00000100003E00000100003E00000100003E00000100003E000001000
03E00000100003E00000100003E00000100003E00000100003E00000100003E00000100003E000
00100003E00000100003E00000100003E00000100003E00000100003E00000100003E000001000
03E00000100003E00000100003E00000100003E00000100001E00000200001F00000200001F000
00200000F00000400000F000004000007800008000003C00018000003C00010000001E00060000
0007800C00000003E07800000000FFF0000000003F8000002A327CB032>I<FFFE003FFF8001FF
C0FFFE003FFF8001FFC00FE00003F800007E0007C00001F000003C0007C00001F00000180003E0
0000F80000100003E00000F80000100003E00000F80000100001F00000FC0000200001F00000FC
0000200001F00000FC0000200000F800013E0000400000F800013E0000400000F800013E000040
0000FC00033F0000C000007C00021F00008000007C00021F00008000007E00021F80008000003E
00040F80010000003E00040F80010000003E00040F80010000001F000807C0020000001F000807
C0020000001F000807C0020000000F801003E0040000000F801003E0040000000F801003E00400
00000FC02001F00C00000007C02001F00800000007C02001F00800000007E02001F80800000003
E04000F81000000003E04000F81000000003E04000F81000000001F080007C2000000001F08000
7C2000000001F080007C2000000000F900003E4000000000F900003E4000000000F900003E4000
0000007E00001F80000000007E00001F80000000007E00001F80000000007E00001F8000000000
3C00000F00000000003C00000F00000000003C00000F0000000000180000060000000000180000
0600000000001800000600000042327FB044>87 D<00FE00000303C0000C00E000100070001000
38003C003C003E001C003E001E003E001E0008001E0000001E0000001E0000001E00000FFE0000
FC1E0003E01E000F801E001F001E003E001E003C001E007C001E00F8001E04F8001E04F8001E04
F8003E04F8003E0478003E047C005E043E008F080F0307F003FC03E01E1F7D9E21>97
D<003F8000E0600380180700040F00041E001E1C003E3C003E7C003E7C0008780000F80000F800
00F80000F80000F80000F80000F80000F80000F800007800007C00007C00003C00011E00011E00
020F000207000403801800E060003F80181F7D9E1D>99 D<003F800000E0E0000380380007003C
000E001E001E001E001C000F003C000F007C000F0078000F8078000780F8000780F8000780FFFF
FF80F8000000F8000000F8000000F8000000F8000000F8000000780000007C0000003C0000003C
0000801E0000800E0001000F0002000780020001C00C0000F03000001FC000191F7E9E1D>101
D<0007E0001C1000383800707C00E07C01E07C01C03803C00003C00003C00003C00003C00003C0
0003C00003C00003C00003C00003C00003C000FFFFC0FFFFC003C00003C00003C00003C00003C0
0003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0
0003C00003C00003C00003C00003C00003C00003C00003C00007E0007FFF007FFF0016327FB114
>I<0780000000FF80000000FF800000000F800000000780000000078000000007800000000780
000000078000000007800000000780000000078000000007800000000780000000078000000007
800000000780000000078000000007800000000780FE00000783078000078C03C000079001E000
07A001E00007A000F00007C000F00007C000F000078000F000078000F000078000F000078000F0
00078000F000078000F000078000F000078000F000078000F000078000F000078000F000078000
F000078000F000078000F000078000F000078000F000078000F000078000F000078000F0000780
00F0000FC001F800FFFC1FFF80FFFC1FFF8021327EB125>104 D<07000F801F801F800F800700
000000000000000000000000000000000000000000000780FF80FF800F80078007800780078007
800780078007800780078007800780078007800780078007800780078007800780078007800780
0FC0FFF8FFF80D307EAF12>I<0780FF80FF800F80078007800780078007800780078007800780
078007800780078007800780078007800780078007800780078007800780078007800780078007
80078007800780078007800780078007800780078007800780078007800FC0FFFCFFFC0E327EB1
12>108 D<0780FE001FC000FF83078060F000FF8C03C18078000F9001E2003C0007A001E4003C
0007A000F4001E0007C000F8001E0007C000F8001E00078000F0001E00078000F0001E00078000
F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00
078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0
001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E0007
8000F0001E000FC001F8003F00FFFC1FFF83FFF0FFFC1FFF83FFF0341F7E9E38>I<0780FE0000
FF83078000FF8C03C0000F9001E00007A001E00007A000F00007C000F00007C000F000078000F0
00078000F000078000F000078000F000078000F000078000F000078000F000078000F000078000
F000078000F000078000F000078000F000078000F000078000F000078000F000078000F0000780
00F000078000F000078000F000078000F0000FC001F800FFFC1FFF80FFFC1FFF80211F7E9E25>
I<001FC00000F0780001C01C00070007000F0007801E0003C01C0001C03C0001E03C0001E07800
00F0780000F0780000F0F80000F8F80000F8F80000F8F80000F8F80000F8F80000F8F80000F8F8
0000F8780000F07C0001F03C0001E03C0001E01E0003C01E0003C00F00078007800F0001C01C00
00F07800001FC0001D1F7E9E21>I<0781FC00FF860700FF8803C00F9001E007A000F007C00078
078000780780003C0780003C0780003E0780001E0780001F0780001F0780001F0780001F078000
1F0780001F0780001F0780001F0780001F0780003E0780003E0780003C0780007C0780007807C0
00F007A000F007A001E00798038007860F000781F8000780000007800000078000000780000007
8000000780000007800000078000000780000007800000078000000FC00000FFFC0000FFFC0000
202D7E9E25>I<0783E0FF8C18FF907C0F907C07A07C07C03807C00007C00007C0000780000780
000780000780000780000780000780000780000780000780000780000780000780000780000780
000780000780000780000780000FC000FFFE00FFFE00161F7E9E19>114
D<01FC100E03301800F0300070600030E00030E00010E00010E00010F00010F800007E00003FF0
001FFF000FFFC003FFE0003FF00001F80000F880003C80003C80001CC0001CC0001CE0001CE000
18F00038F00030CC0060C301C080FE00161F7E9E1A>I<00400000400000400000400000400000
C00000C00000C00001C00001C00003C00007C0000FC0001FFFE0FFFFE003C00003C00003C00003
C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003
C01003C01003C01003C01003C01003C01003C01003C01001C02001E02000E0400078C0001F0014
2C7FAB19>I<078000F000FF801FF000FF801FF0000F8001F000078000F000078000F000078000
F000078000F000078000F000078000F000078000F000078000F000078000F000078000F0000780
00F000078000F000078000F000078000F000078000F000078000F000078000F000078000F00007
8000F000078001F000078001F000078001F000038002F00003C004F00001C008F800007030FF80
001FC0FF80211F7E9E25>I<FFF801FF80FFF801FF800FC0007C00078000380007C000300003C0
00200003C000200001E000400001E000400001F000400000F000800000F0008000007801000000
78010000007C010000003C020000003C020000001E040000001E040000001F040000000F080000
000F080000000790000000079000000007D000000003E000000003E000000001C000000001C000
000001C000000000800000211F7F9E23>I<FFF07FF80FFCFFF07FF80FFC0FC007C003F00F8003
C001C0078003C00080078003C0008003C003E0010003C003E0010003C007E0010001E004F00200
01E004F0020001E00870020000F00878040000F00878040000F0103804000078103C0800007810
3C08000078201C0800003C201E1000003C201E1000003C400E1000001E400F2000001E400F2000
001E80072000000F8007C000000F8007C000000F0003C000000700038000000700038000000600
0180000002000100002E1F7F9E30>I<FFF801FF80FFF801FF800FC0007C00078000380007C000
300003C000200003C000200001E000400001E000400001F000400000F000800000F00080000078
0100000078010000007C010000003C020000003C020000001E040000001E040000001F04000000
0F080000000F080000000790000000079000000007D000000003E000000003E000000001C00000
0001C000000001C000000000800000000080000000010000000001000000000100000000020000
00000200000000040000007004000000F80C000000F808000000F8100000007030000000304000
00001F80000000212D7F9E23>121 D E /Fp 17 90 df<0000000003E000000000000000000007
F000000000000000000007F00000000000000000000FF80000000000000000000FF80000000000
000000000FF80000000000000000001FFC0000000000000000001FFC0000000000000000003FFE
0000000000000000003FFE0000000000000000007FFF0000000000000000007FFF000000000000
0000007FFF000000000000000000FFFF800000000000000000FFFF800000000000000001FFFFC0
0000000000000001FFFFC00000000000000001FFFFC00000000000000003FFFFE0000000000000
0003EFFFE00000000000000007EFFFF00000000000000007CFFFF00000000000000007C7FFF000
0000000000000FC7FFF8000000000000000F83FFF8000000000000001F83FFFC00000000000000
1F03FFFC000000000000001F01FFFC000000000000003F01FFFE000000000000003E00FFFE0000
00000000007E00FFFF000000000000007C007FFF00000000000000FC007FFF80000000000000F8
007FFF80000000000000F8003FFF80000000000001F8003FFFC0000000000001F0001FFFC00000
00000003F0001FFFE0000000000003E0001FFFE0000000000003E0000FFFE0000000000007E000
0FFFF0000000000007C00007FFF000000000000FC00007FFF800000000000F800007FFF8000000
00000F800003FFF800000000001F800003FFFC00000000001F000001FFFC00000000003FFFFFFF
FFFE00000000003FFFFFFFFFFE00000000007FFFFFFFFFFF00000000007FFFFFFFFFFF00000000
007FFFFFFFFFFF0000000000FC0000007FFF8000000000F80000003FFF8000000001F80000003F
FFC000000001F00000003FFFC000000001F00000001FFFC000000003F00000001FFFE000000003
E00000000FFFE000000007E00000000FFFF000000007C00000000FFFF000000007C000000007FF
F00000000FC000000007FFF80000000F8000000003FFF80000001F8000000003FFFC0000001F00
00000003FFFC0000007FC000000001FFFC0000FFFFFFC00007FFFFFFFF80FFFFFFC00007FFFFFF
FF80FFFFFFC00007FFFFFFFF80FFFFFFC00007FFFFFFFF80FFFFFFC00007FFFFFFFF8051487CC7
5A>65 D<000000003FFE00000E0000000FFFFFC0001E0000007FFFFFF8003E000003FFFFFFFE00
FE00000FFFFFFFFF81FE00003FFFF800FFC3FE0000FFFF80000FF7FE0001FFFC000003FFFE0007
FFF0000001FFFE000FFFC00000007FFE001FFF800000003FFE003FFF000000001FFE007FFE0000
00000FFE00FFFC0000000007FE01FFF80000000007FE03FFF00000000003FE03FFF00000000001
FE07FFE00000000001FE07FFE00000000000FE0FFFC00000000000FE0FFFC000000000007E1FFF
C000000000007E1FFF8000000000007E3FFF8000000000007E3FFF8000000000003E3FFF800000
0000003E7FFF8000000000003E7FFF0000000000003E7FFF000000000000007FFF000000000000
00FFFF00000000000000FFFF00000000000000FFFF00000000000000FFFF00000000000000FFFF
00000000000000FFFF00000000000000FFFF00000000000000FFFF00000000000000FFFF000000
00000000FFFF00000000000000FFFF00000000000000FFFF00000000000000FFFF000000000000
007FFF000000000000007FFF000000000000007FFF000000000000007FFF8000000000003E3FFF
8000000000003E3FFF8000000000003E3FFF8000000000003E1FFF8000000000003E1FFFC00000
0000003E0FFFC000000000007C0FFFC000000000007C07FFE000000000007C07FFE00000000000
F803FFF00000000000F803FFF00000000001F801FFF80000000001F000FFFC0000000003E0007F
FE0000000007E0003FFF000000000FC0001FFF800000001F80000FFFC00000003F000007FFF000
0000FE000001FFFC000001FC000000FFFF80000FF80000003FFFF8007FF00000000FFFFFFFFFC0
00000003FFFFFFFF00000000007FFFFFFC00000000000FFFFFE00000000000003FFE0000004749
79C756>67 D<FFFFFFFFFFFFC0000000FFFFFFFFFFFFFE000000FFFFFFFFFFFFFFC00000FFFFFF
FFFFFFFFF00000FFFFFFFFFFFFFFFC0000001FFF800007FFFF0000001FFF8000007FFF8000001F
FF8000000FFFE000001FFF80000007FFF000001FFF80000001FFF800001FFF80000000FFFC0000
1FFF800000007FFE00001FFF800000003FFF00001FFF800000001FFF00001FFF800000000FFF80
001FFF800000000FFFC0001FFF8000000007FFC0001FFF8000000007FFE0001FFF8000000003FF
E0001FFF8000000003FFF0001FFF8000000003FFF0001FFF8000000003FFF8001FFF8000000001
FFF8001FFF8000000001FFF8001FFF8000000001FFFC001FFF8000000001FFFC001FFF80000000
01FFFC001FFF8000000001FFFC001FFF8000000001FFFC001FFF8000000001FFFE001FFF800000
0000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF8000
000000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF80
00000000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF8000000000FFFE001FFF
8000000001FFFE001FFF8000000001FFFC001FFF8000000001FFFC001FFF8000000001FFFC001F
FF8000000001FFFC001FFF8000000001FFF8001FFF8000000001FFF8001FFF8000000001FFF800
1FFF8000000003FFF0001FFF8000000003FFF0001FFF8000000003FFF0001FFF8000000007FFE0
001FFF8000000007FFE0001FFF800000000FFFC0001FFF800000000FFF80001FFF800000001FFF
80001FFF800000003FFF00001FFF800000003FFE00001FFF800000007FFC00001FFF80000001FF
F800001FFF80000003FFF000001FFF8000000FFFE000001FFF8000007FFFC000001FFF800003FF
FF0000FFFFFFFFFFFFFFFE0000FFFFFFFFFFFFFFF80000FFFFFFFFFFFFFFC00000FFFFFFFFFFFF
FE000000FFFFFFFFFFFFC00000004F477CC65B>I<FFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFE00
FFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFF00001FFFC00001FFFF00001FFF
C000001FFF00001FFFC0000007FF00001FFFC0000003FF00001FFFC0000000FF00001FFFC00000
007F00001FFFC00000007F00001FFFC00000003F00001FFFC00000003F80001FFFC00000001F80
001FFFC00000001F80001FFFC00000001F80001FFFC00000000F80001FFFC00000000F80001FFF
C0007C000F80001FFFC0007C000F80001FFFC0007C0007C0001FFFC0007C0007C0001FFFC0007C
0007C0001FFFC0007C0007C0001FFFC000FC000000001FFFC000FC000000001FFFC000FC000000
001FFFC001FC000000001FFFC003FC000000001FFFC01FFC000000001FFFFFFFFC000000001FFF
FFFFFC000000001FFFFFFFFC000000001FFFFFFFFC000000001FFFFFFFFC000000001FFFC01FFC
000000001FFFC003FC000000001FFFC001FC000000001FFFC000FC000000001FFFC000FC000000
001FFFC000FC000000001FFFC0007C00007C001FFFC0007C00007C001FFFC0007C00007C001FFF
C0007C0000F8001FFFC0007C0000F8001FFFC0007C0000F8001FFFC000000000F8001FFFC00000
0001F8001FFFC000000001F0001FFFC000000001F0001FFFC000000001F0001FFFC000000003F0
001FFFC000000003F0001FFFC000000007F0001FFFC000000007E0001FFFC00000000FE0001FFF
C00000001FE0001FFFC00000003FE0001FFFC00000007FE0001FFFC0000000FFE0001FFFC00000
03FFC0001FFFC000000FFFC0001FFFC00000FFFFC0FFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFC0
FFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFF8046467CC54E>I<000000003F
FE00000E000000000FFFFFC0001E000000007FFFFFF8003E00000003FFFFFFFE00FE0000000FFF
FFFFFF81FE0000003FFFF800FFC3FE000000FFFF80000FF7FE000001FFFC000003FFFE000007FF
F0000001FFFE00000FFFC00000007FFE00001FFF800000003FFE00003FFF000000001FFE00007F
FE000000000FFE0000FFFC0000000007FE0001FFF80000000007FE0003FFF00000000003FE0003
FFF00000000001FE0007FFE00000000001FE0007FFE00000000000FE000FFFC00000000000FE00
0FFFC000000000007E001FFFC000000000007E001FFF8000000000007E003FFF8000000000007E
003FFF8000000000003E003FFF8000000000003E007FFF8000000000003E007FFF000000000000
3E007FFF00000000000000007FFF0000000000000000FFFF0000000000000000FFFF0000000000
000000FFFF0000000000000000FFFF0000000000000000FFFF0000000000000000FFFF00000000
00000000FFFF0000000000000000FFFF0000000000000000FFFF0000000000000000FFFF000000
0000000000FFFF0000000000000000FFFF0000000000000000FFFF0000007FFFFFFFFE7FFF0000
007FFFFFFFFE7FFF0000007FFFFFFFFE7FFF8000007FFFFFFFFE7FFF8000007FFFFFFFFE3FFF80
00000000FFFE003FFF8000000000FFFE003FFF8000000000FFFE001FFF8000000000FFFE001FFF
C000000000FFFE000FFFC000000000FFFE000FFFC000000000FFFE0007FFE000000000FFFE0007
FFE000000000FFFE0003FFF000000000FFFE0003FFF800000000FFFE0001FFF800000000FFFE00
00FFFC00000000FFFE00007FFE00000000FFFE00003FFF00000000FFFE00001FFF80000000FFFE
00000FFFE0000001FFFE000007FFF0000003FFFE000001FFFC000007FFFE000000FFFF80001FFF
FE0000003FFFFC00FFC7FE0000000FFFFFFFFF83FE00000003FFFFFFFE00FE000000007FFFFFF8
003E000000000FFFFFE0000E00000000003FFE000000004F4979C75D>71
D<FFFFFFFFF801FFFFFFFFF0FFFFFFFFF801FFFFFFFFF0FFFFFFFFF801FFFFFFFFF0FFFFFFFFF8
01FFFFFFFFF0FFFFFFFFF801FFFFFFFFF0001FFFC00000003FFF8000001FFFC00000003FFF8000
001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000
003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF800000
1FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC0000000
3FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001F
FFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003F
FF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFF
C00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF
8000001FFFFFFFFFFFFFFF8000001FFFFFFFFFFFFFFF8000001FFFFFFFFFFFFFFF8000001FFFFF
FFFFFFFFFF8000001FFFFFFFFFFFFFFF8000001FFFC00000003FFF8000001FFFC00000003FFF80
00001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC000
00003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000
001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000
003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF800000
1FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC0000000
3FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001F
FFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003FFF8000001FFFC00000003F
FF8000001FFFC00000003FFF8000001FFFC00000003FFF8000FFFFFFFFF801FFFFFFFFF0FFFFFF
FFF801FFFFFFFFF0FFFFFFFFF801FFFFFFFFF0FFFFFFFFF801FFFFFFFFF0FFFFFFFFF801FFFFFF
FFF054477CC65D>I<FFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFFFFFFFE000FFFE000
000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE0
00000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFF
E000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000F
FFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE00000
0FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000
000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE0
00000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000000FFF
E000000FFFE000000FFFE000000FFFE000000FFFE000000FFFE000FFFFFFFFFEFFFFFFFFFEFFFF
FFFFFEFFFFFFFFFEFFFFFFFFFE27477DC62D>I<FFFFFFE0000000000003FFFFFFFFFFFFF00000
00000007FFFFFFFFFFFFF0000000000007FFFFFFFFFFFFF800000000000FFFFFFFFFFFFFF80000
0000000FFFFFFF001FFFF800000000000FFFF800001FFFFC00000000001EFFF800001FFFFC0000
0000001EFFF800001FBFFE00000000003CFFF800001FBFFE00000000003CFFF800001F9FFF0000
00000078FFF800001F9FFF000000000078FFF800001F8FFF8000000000F0FFF800001F8FFF8000
000000F0FFF800001F87FFC000000001E0FFF800001F87FFC000000001E0FFF800001F87FFC000
000001E0FFF800001F83FFE000000003C0FFF800001F83FFE000000003C0FFF800001F81FFF000
00000780FFF800001F81FFF00000000780FFF800001F80FFF80000000F00FFF800001F80FFF800
00000F00FFF800001F807FFC0000001E00FFF800001F807FFC0000001E00FFF800001F807FFC00
00001E00FFF800001F803FFE0000003C00FFF800001F803FFE0000003C00FFF800001F801FFF00
00007800FFF800001F801FFF0000007800FFF800001F800FFF800000F000FFF800001F800FFF80
0000F000FFF800001F8007FFC00001E000FFF800001F8007FFC00001E000FFF800001F8003FFE0
0003C000FFF800001F8003FFE00003C000FFF800001F8003FFE00003C000FFF800001F8001FFF0
00078000FFF800001F8001FFF000078000FFF800001F8000FFF8000F0000FFF800001F8000FFF8
000F0000FFF800001F80007FFC001E0000FFF800001F80007FFC001E0000FFF800001F80003FFE
003C0000FFF800001F80003FFE003C0000FFF800001F80001FFF00780000FFF800001F80001FFF
00780000FFF800001F80001FFF00780000FFF800001F80000FFF80F00000FFF800001F80000FFF
80F00000FFF800001F800007FFC1E00000FFF800001F800007FFC1E00000FFF800001F800003FF
E3C00000FFF800001F800003FFE3C00000FFF800001F800001FFF7800000FFF800001F800001FF
F7800000FFF800001F800001FFF7800000FFF800001F800000FFFF000000FFF800001F800000FF
FF000000FFF800001F8000007FFE000000FFF800001F8000007FFE000000FFF800001F8000003F
FC000000FFF800001F8000003FFC000000FFF800001F8000001FF8000000FFF800001F8000001F
F8000000FFF800007FE000000FF0000000FFF800FFFFFFF0000FF00007FFFFFFFFFFFFFFF0000F
F00007FFFFFFFFFFFFFFF00007E00007FFFFFFFFFFFFFFF00007E00007FFFFFFFFFFFFFFF00003
C00007FFFFFFFF68477CC671>77 D<FFFFFFC0000000FFFFFFF0FFFFFFE0000000FFFFFFF0FFFF
FFF0000000FFFFFFF0FFFFFFF8000000FFFFFFF0FFFFFFFC000000FFFFFFF0001FFFFC00000000
7FE000001FFFFE000000001F8000001FFFFF000000001F8000001FFFFF800000001F8000001FFF
FFC00000001F8000001FBFFFE00000001F8000001F9FFFE00000001F8000001F9FFFF00000001F
8000001F8FFFF80000001F8000001F87FFFC0000001F8000001F83FFFE0000001F8000001F81FF
FF0000001F8000001F80FFFF0000001F8000001F80FFFF8000001F8000001F807FFFC000001F80
00001F803FFFE000001F8000001F801FFFF000001F8000001F800FFFF800001F8000001F8007FF
F800001F8000001F8007FFFC00001F8000001F8003FFFE00001F8000001F8001FFFF00001F8000
001F8000FFFF80001F8000001F80007FFFC0001F8000001F80003FFFC0001F8000001F80003FFF
E0001F8000001F80001FFFF0001F8000001F80000FFFF8001F8000001F800007FFFC001F800000
1F800003FFFE001F8000001F800001FFFF001F8000001F800001FFFF001F8000001F800000FFFF
801F8000001F8000007FFFC01F8000001F8000003FFFE01F8000001F8000001FFFF01F8000001F
8000000FFFF81F8000001F8000000FFFF81F8000001F80000007FFFC1F8000001F80000003FFFE
1F8000001F80000001FFFF1F8000001F80000000FFFF9F8000001F800000007FFFDF8000001F80
0000007FFFDF8000001F800000003FFFFF8000001F800000001FFFFF8000001F800000000FFFFF
8000001F8000000007FFFF8000001F8000000003FFFF8000001F8000000003FFFF8000001F8000
000001FFFF8000001F8000000000FFFF8000001F80000000007FFF8000001F80000000003FFF80
00001F80000000001FFF8000001F80000000001FFF8000001F80000000000FFF8000001F800000
000007FF8000001F800000000003FF8000001F800000000001FF8000007FE00000000000FF8000
FFFFFFF000000000FF8000FFFFFFF0000000007F8000FFFFFFF0000000003F8000FFFFFFF00000
00001F8000FFFFFFF0000000000F000054477CC65D>I<00000003FFF0000000000000007FFFFF
80000000000003FFFFFFF000000000000FFFFFFFFC00000000003FFF807FFF0000000000FFF800
07FFC000000003FFE00001FFF000000007FFC00000FFF80000000FFF0000003FFC0000001FFE00
00001FFE0000003FFC0000000FFF0000007FFC0000000FFF800000FFF800000007FFC00001FFF0
00000003FFE00003FFF000000003FFF00003FFE000000001FFF00007FFE000000001FFF80007FF
C000000000FFF8000FFFC000000000FFFC000FFFC000000000FFFC001FFF80000000007FFE001F
FF80000000007FFE003FFF80000000007FFF003FFF80000000007FFF003FFF80000000007FFF00
7FFF00000000003FFF807FFF00000000003FFF807FFF00000000003FFF807FFF00000000003FFF
807FFF00000000003FFF80FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF00000000003F
FFC0FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF0000000000
3FFFC0FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF00000000
003FFFC0FFFF00000000003FFFC0FFFF00000000003FFFC0FFFF00000000003FFFC07FFF000000
00003FFF807FFF00000000003FFF807FFF80000000007FFF807FFF80000000007FFF803FFF8000
0000007FFF003FFF80000000007FFF003FFF80000000007FFF001FFFC000000000FFFE001FFFC0
00000000FFFE001FFFC000000000FFFE000FFFE000000001FFFC000FFFE000000001FFFC0007FF
E000000001FFF80003FFF000000003FFF00003FFF800000007FFF00001FFF800000007FFE00000
FFFC0000000FFFC000007FFE0000001FFF8000007FFF0000003FFF8000003FFF8000007FFF0000
000FFFC00000FFFC00000007FFF00003FFF800000003FFFC000FFFF000000000FFFF807FFFC000
0000007FFFFFFFFF80000000000FFFFFFFFC000000000003FFFFFFF00000000000007FFFFF8000
000000000003FFF0000000004A4979C759>I<FFFFFFFFFFFF800000FFFFFFFFFFFFFC0000FFFF
FFFFFFFFFF0000FFFFFFFFFFFFFFC000FFFFFFFFFFFFFFF000001FFF80000FFFFC00001FFF8000
01FFFE00001FFF8000007FFF00001FFF8000003FFF80001FFF8000001FFFC0001FFF8000000FFF
C0001FFF8000000FFFE0001FFF8000000FFFE0001FFF80000007FFF0001FFF80000007FFF0001F
FF80000007FFF0001FFF80000007FFF8001FFF80000007FFF8001FFF80000007FFF8001FFF8000
0007FFF8001FFF80000007FFF8001FFF80000007FFF8001FFF80000007FFF8001FFF80000007FF
F8001FFF80000007FFF0001FFF80000007FFF0001FFF80000007FFF0001FFF8000000FFFE0001F
FF8000000FFFE0001FFF8000000FFFC0001FFF8000001FFF80001FFF8000003FFF80001FFF8000
007FFF00001FFF800001FFFE00001FFF80000FFFF800001FFFFFFFFFFFF000001FFFFFFFFFFFC0
00001FFFFFFFFFFE0000001FFFFFFFFFF00000001FFFC00000000000001FFFC00000000000001F
FFC00000000000001FFFC00000000000001FFFC00000000000001FFFC00000000000001FFFC000
00000000001FFFC00000000000001FFFC00000000000001FFFC00000000000001FFFC000000000
00001FFFC00000000000001FFFC00000000000001FFFC00000000000001FFFC00000000000001F
FFC00000000000001FFFC00000000000001FFFC00000000000001FFFC00000000000001FFFC000
00000000001FFFC00000000000001FFFC00000000000001FFFC00000000000001FFFC000000000
00001FFFC00000000000001FFFC00000000000001FFFC00000000000FFFFFFFFF800000000FFFF
FFFFF800000000FFFFFFFFF800000000FFFFFFFFF800000000FFFFFFFFF80000000045477CC651
>I<FFFFFFFFFFFC0000000000FFFFFFFFFFFFF000000000FFFFFFFFFFFFFE00000000FFFFFFFF
FFFFFF80000000FFFFFFFFFFFFFFE0000000001FFF80001FFFF8000000001FFF800001FFFC0000
00001FFF8000007FFF000000001FFF8000003FFF800000001FFF8000001FFF800000001FFF8000
000FFFC00000001FFF8000000FFFE00000001FFF8000000FFFE00000001FFF80000007FFF00000
001FFF80000007FFF00000001FFF80000007FFF80000001FFF80000007FFF80000001FFF800000
07FFF80000001FFF80000007FFF80000001FFF80000007FFF80000001FFF80000007FFF8000000
1FFF80000007FFF80000001FFF80000007FFF80000001FFF80000007FFF00000001FFF80000007
FFF00000001FFF8000000FFFE00000001FFF8000000FFFE00000001FFF8000000FFFC00000001F
FF8000001FFF800000001FFF8000003FFF000000001FFF800000FFFE000000001FFF800003FFF8
000000001FFF80001FFFF0000000001FFFFFFFFFFFC0000000001FFFFFFFFFFE00000000001FFF
FFFFFFF800000000001FFFFFFFFFFE00000000001FFF80007FFF80000000001FFF80001FFFC000
0000001FFF800007FFE0000000001FFF800003FFF0000000001FFF800001FFF8000000001FFF80
0001FFFC000000001FFF800000FFFE000000001FFF800000FFFE000000001FFF8000007FFE0000
00001FFF8000007FFF000000001FFF8000007FFF000000001FFF8000007FFF000000001FFF8000
007FFF000000001FFF8000007FFF000000001FFF8000007FFF000000001FFF8000007FFF000000
001FFF8000007FFF800000001FFF8000007FFF800000001FFF8000007FFF800000001FFF800000
7FFF800000001FFF8000007FFF800000001FFF8000007FFF8000E0001FFF8000007FFF8001F000
1FFF8000007FFFC001F0001FFF8000007FFFC001F0001FFF8000003FFFC001F0001FFF8000003F
FFC003F0001FFF8000001FFFE003E0001FFF8000000FFFE007E0FFFFFFFFF00007FFF007C0FFFF
FFFFF00003FFFC1F80FFFFFFFFF00001FFFFFF00FFFFFFFFF000007FFFFE00FFFFFFFFF000001F
FFFC000000000000000000FFF00054487CC659>82 D<00007FF00007000007FFFF000F00001FFF
FFC01F00007FFFFFF03F0000FFFFFFFC7F0003FFC00FFEFF0007FE0000FFFF0007FC00003FFF00
0FF000001FFF001FF0000007FF001FE0000003FF003FE0000001FF003FC0000001FF007FC00000
00FF007FC00000007F007FC00000007F00FFC00000003F00FFC00000003F00FFC00000003F00FF
E00000003F00FFE00000001F00FFF00000001F00FFF80000001F00FFFC0000001F00FFFF000000
00007FFFC0000000007FFFFE000000007FFFFFE00000003FFFFFFF0000003FFFFFFFF000001FFF
FFFFFC00001FFFFFFFFF00000FFFFFFFFFC00007FFFFFFFFE00007FFFFFFFFF00003FFFFFFFFF8
0000FFFFFFFFFC00007FFFFFFFFE00003FFFFFFFFE00000FFFFFFFFF000001FFFFFFFF0000003F
FFFFFF80000001FFFFFF800000000FFFFFC000000000FFFFC0000000001FFFC0000000000FFFE0
0000000007FFE00000000003FFE07800000001FFE0F800000000FFE0F800000000FFE0F8000000
007FE0F8000000007FE0F8000000007FE0FC000000007FE0FC000000007FC0FC000000007FC0FE
000000007FC0FE000000007F80FF00000000FF80FF80000000FF80FFC0000000FF00FFE0000001
FE00FFF8000003FE00FFFE000007FC00FFFF80000FF800FFFFFC007FF000FE3FFFFFFFE000FC0F
FFFFFF8000F803FFFFFF0000F0007FFFF80000E00003FFC00000334979C742>I<3FFFFFFFFFFF
FFFFFF003FFFFFFFFFFFFFFFFF003FFFFFFFFFFFFFFFFF003FFFFFFFFFFFFFFFFF003FFFFFFFFF
FFFFFFFF003FFF0003FFF8003FFF007FF80003FFF80007FF807FE00003FFF80001FF807FC00003
FFF80000FF807F800003FFF800007F807F000003FFF800003F807F000003FFF800003F807E0000
03FFF800001F807E000003FFF800001F807E000003FFF800000F807C000003FFF800000F807C00
0003FFF800000F807C000003FFF800000F807C000003FFF800000F80FC000003FFF800000FC0F8
000003FFF8000007C0F8000003FFF8000007C0F8000003FFF8000007C0F8000003FFF8000007C0
F8000003FFF8000007C000000003FFF80000000000000003FFF80000000000000003FFF8000000
0000000003FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF80000
000000000003FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF800
00000000000003FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF8
0000000000000003FFF80000000000000003FFF80000000000000003FFF80000000000000003FF
F80000000000000003FFF80000000000000003FFF80000000000000003FFF80000000000000003
FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF800000000000000
03FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF8000000000000
0003FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF80000000000
000003FFF80000000000000003FFF80000000000000003FFF80000000000000003FFF800000000
00000003FFF80000000000000003FFF8000000000003FFFFFFFFFFF800000003FFFFFFFFFFF800
000003FFFFFFFFFFF800000003FFFFFFFFFFF800000003FFFFFFFFFFF800004A467CC553>I<FF
FFFFFFF80001FFFFFFC0FFFFFFFFF80001FFFFFFC0FFFFFFFFF80001FFFFFFC0FFFFFFFFF80001
FFFFFFC0FFFFFFFFF80001FFFFFFC0001FFFC000000000FF8000001FFFC0000000003E0000001F
FFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC000000000
3E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFF
C0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E
0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0
000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E00
00001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC000
0000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000
001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC00000
00003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E000000
1FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000
003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001F
FFC0000000003E0000001FFFC0000000003E0000001FFFC0000000003E0000001FFFC000000000
3E0000001FFFC0000000003E0000001FFFC0000000003E0000000FFFC0000000007E0000000FFF
C0000000007C0000000FFFE0000000007C0000000FFFE000000000FC00000007FFE000000000F8
00000007FFE000000001F800000003FFF000000001F800000001FFF000000003F000000001FFF8
00000007E000000000FFF800000007E0000000007FFC0000001FC0000000003FFE0000003F8000
0000001FFF800000FF00000000000FFFE00007FE000000000003FFFE007FFC000000000001FFFF
FFFFF00000000000007FFFFFFFE00000000000000FFFFFFF8000000000000001FFFFFC00000000
000000000FFFC00000000052487CC65B>I<7FFFFFFFF801FFFFFFF0007FFFFFFFF801FFFFFFF0
007FFFFFFFF801FFFFFFF0007FFFFFFFF801FFFFFFF0007FFFFFFFF801FFFFFFF000000FFFF800
0003FF800000000FFFF80000007E0000000007FFFC000000FC0000000003FFFE000001F8000000
0003FFFE000003F80000000001FFFF000003F00000000000FFFF800007E000000000007FFFC000
0FC000000000007FFFC0001FC000000000003FFFE0001F8000000000001FFFF0003F0000000000
001FFFF0007E0000000000000FFFF800FE00000000000007FFFC00FC00000000000003FFFC01F8
00000000000003FFFE03F000000000000001FFFF07F000000000000000FFFF87E0000000000000
00FFFF8FC0000000000000007FFFDF80000000000000003FFFFF80000000000000003FFFFF0000
0000000000001FFFFE00000000000000000FFFFC000000000000000007FFFC0000000000000000
07FFFC000000000000000003FFFE000000000000000001FFFF000000000000000001FFFF000000
000000000000FFFF8000000000000000007FFFC000000000000000003FFFE00000000000000000
7FFFE000000000000000007FFFF00000000000000000FFFFF80000000000000001FFFFF8000000
0000000003FFFFFC0000000000000003F3FFFE0000000000000007E1FFFE000000000000000FC1
FFFF000000000000001FC0FFFF800000000000001F807FFFC00000000000003F007FFFC0000000
0000007E003FFFE0000000000000FE001FFFF0000000000000FC001FFFF0000000000001F8000F
FFF8000000000003F00007FFFC000000000007F00003FFFE000000000007E00003FFFE00000000
000FC00001FFFF00000000001F800000FFFF80000000003F800000FFFF80000000003F0000007F
FFC0000000007E0000003FFFE000000000FC0000001FFFF000000001FC0000001FFFF000000001
F80000000FFFF800000003F000000007FFFC00000007E000000007FFFC0000001FFC00000003FF
FE0000FFFFFFF80003FFFFFFFF80FFFFFFF80003FFFFFFFF80FFFFFFF80003FFFFFFFF80FFFFFF
F80003FFFFFFFF80FFFFFFF80003FFFFFFFF8051477CC65A>88 D<FFFFFFFFF000000FFFFFF8FF
FFFFFFF000000FFFFFF8FFFFFFFFF000000FFFFFF8FFFFFFFFF000000FFFFFF8FFFFFFFFF00000
0FFFFFF8003FFFF0000000001FF000001FFFF0000000000FC000000FFFF8000000001F8000000F
FFFC000000001F80000007FFFC000000003F00000003FFFE000000007E00000003FFFF00000000
FC00000001FFFF00000000FC00000000FFFF80000001F800000000FFFFC0000003F0000000007F
FFC0000003F0000000003FFFE0000007E0000000003FFFF000000FC0000000001FFFF000000FC0
000000000FFFF800001F80000000000FFFFC00003F000000000007FFFC00003F000000000003FF
FE00007E000000000003FFFF0000FC000000000001FFFF0000FC000000000000FFFF8001F80000
00000000FFFFC003F00000000000007FFFC003F00000000000003FFFE007E00000000000003FFF
F00FC00000000000001FFFF00FC00000000000000FFFF81F800000000000000FFFFC3F00000000
00000007FFFC3F0000000000000003FFFE7E0000000000000003FFFFFC0000000000000001FFFF
FC0000000000000000FFFFF80000000000000000FFFFF000000000000000007FFFF00000000000
0000003FFFE000000000000000003FFFC000000000000000001FFF8000000000000000001FFF80
00000000000000001FFF8000000000000000001FFF8000000000000000001FFF80000000000000
00001FFF8000000000000000001FFF8000000000000000001FFF8000000000000000001FFF8000
000000000000001FFF8000000000000000001FFF8000000000000000001FFF8000000000000000
001FFF8000000000000000001FFF8000000000000000001FFF8000000000000000001FFF800000
0000000000001FFF8000000000000000001FFF8000000000000000001FFF800000000000000000
1FFF8000000000000000001FFF8000000000000000001FFF8000000000000000001FFF80000000
00000000001FFF8000000000000000FFFFFFFFF8000000000000FFFFFFFFF8000000000000FFFF
FFFFF8000000000000FFFFFFFFF8000000000000FFFFFFFFF800000055477EC65A>I
E end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin

%%EndSetup
%%Page: 1 1
0 bop 177 46 a Fp(A)40 b(COMMENT)-10 b(AR)g(Y)38 b(ON)i(THE)481
192 y(SIXTH)f(EDITION)138 322 y(UNIX)h(OPERA)-10 b(TING)40
b(SYSTEM)828 1072 y Fo(J.)21 b(Lions.)471 1163 y(Departmen)n(t)g(of)h
(Computer)f(Science)435 1253 y(The)g(Univ)n(ersit)n(y)h(of)f(New)g(South)g(W)
-6 b(ales)-30 2282 y Fn(This)17 b(b)q(o)q(oklet)f(has)g(b)q(een)h(pro)q
(duced)h(for)d(studen)o(ts)j(at)e(the)h(Univ)o(ersit)o(y)f(of)g(New)g(South)h
(W)m(ales)e(taking)g(courses)j(6.602B)-30 2331 y(and)g(6.657G.)c(It)k(is)f
(in)o(tended)h(as)f(a)g(companion)e(to,)j(and)f(commen)o(tary)e(on,)i(the)h
(b)q(o)q(oklet)f Fm(UNIX)h(Op)q(erating)g(System)-30 2381 y(Source)d(Co)q
(de,)f(Lev)o(el)g(Six)p Fn(.)-30 2453 y(The)h(UNIX)f(Soft)o(w)o(are)g(System)
f(w)o(as)h(written)h(b)o(y)e(K.)h(Thompson)f(and)g(D.)h(Ritc)o(hie)f(of)g
(Bell)h(Lab)q(oratories,)g(Murra)o(y)g(Hill,)-30 2503 y(NJ.)g(It)g(has)g(b)q
(een)h(made)e(a)o(v)n(ailable)f(under)i(a)g(license)h(from)d(the)i(W)m
(estern)h(Electric)g(Compan)o(y)m(.)-30 2574 y(This)20 b(do)q(cumen)o(t)g(ma)
o(y)e(con)o(tain)h(information)e(co)o(v)o(ered)k(b)o(y)e(one)h(or)g(more)f
(licenses,)j(cop)o(yrigh)o(ts)e(and)g(non-disclosure)-30 2624
y(agreemen)o(ts.)f(Circulation)13 b(of)g(this)h(do)q(cumen)o(t)f(is)h
(restricted)i(to)e(holders)g(of)f(a)h(license)h(for)e(the)i(UNIX)f(Soft)o(w)o
(are)g(System)-30 2674 y(from)f(W)m(estern)h(Electric.)19 b(All)13
b(other)i(circulation)e(or)h(repro)q(duction)h(is)f(prohibited.)710
2779 y(c)698 2780 y Fl(\015)27 b Fn(Cop)o(yrigh)o(t)13 b(1977)g(J.)h(Lions)p
eop
%%Page: 2 2
1 bop eop
%%Page: 1 3
2 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1150
b(CONTENTS)-30 17 y Fj(Con)n(ten)n(ts)-30 109 y Fi(1)39 b(In)o(tro)q(ductio)o
(n)569 b(1)33 160 y Fn(1.1)41 b(The)15 b(UNIX)f(Op)q(erating)g(System)27
b Fh(:)20 b(:)h(:)f(:)71 b Fn(1)33 211 y(1.2)41 b(Utilities)31
b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71
b Fn(1)33 262 y(1.3)41 b(Other)15 b(Do)q(cumen)o(tation)34
b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(1)33 312 y(1.4)41
b(UNIX)14 b(Programmer's)e(Man)o(ual)35 b Fh(:)20 b(:)h(:)f(:)71
b Fn(1)33 363 y(1.5)41 b(UNIX)14 b(Do)q(cumen)o(ts)e Fh(:)20
b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(2)33 414 y(1.6)41
b(UNIX)14 b(Op)q(erating)h(System)e(Source)i(Co)q(de)52 b(2)33
464 y(1.7)41 b(Source)15 b(Co)q(de)f(Selections)i Fh(:)k(:)h(:)f(:)g(:)g(:)h
(:)f(:)71 b Fn(3)33 515 y(1.8)41 b(Source)15 b(Co)q(de)f(Files)d
Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(3)33
566 y(1.9)41 b(Use)15 b(of)e(these)j(notes)41 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)71 b Fn(3)33 616 y(1.10)20 b(A)14 b(Note)h(on)e(Programming)e
(Standards)i Fh(:)71 b Fn(3)-30 709 y Fi(2)39 b(F)l(undamen)o(tal)o(s)543
b(4)33 760 y Fn(2.1)41 b(The)15 b(Pro)q(cessor)h Fh(:)k(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(4)33 811 y(2.2)41 b(Pro)q(cessor)16
b(Status)f(W)m(ord)i Fh(:)j(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b
Fn(4)33 861 y(2.3)41 b(General)14 b(Registers)k Fh(:)i(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)71 b Fn(4)33 912 y(2.4)41 b(Instruction)15
b(Set)34 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71
b Fn(4)33 963 y(2.5)41 b(Addressing)15 b(Mo)q(des)38 b Fh(:)21
b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(6)33 1014 y(2.6)41
b(Unix)14 b(Assem)o(bler)k Fh(:)i(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
71 b Fn(7)33 1064 y(2.7)41 b(Memory)13 b(Managemen)o(t)36 b
Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(7)33 1115 y(2.8)41
b(Segmen)o(tation)13 b(Registers.)30 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)71
b Fn(7)33 1166 y(2.9)41 b(P)o(age)14 b(Description)g(Register)29
b Fh(:)20 b(:)g(:)g(:)h(:)f(:)71 b Fn(8)33 1216 y(2.10)20 b(Memory)13
b(Allo)q(cation)k Fh(:)k(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71
b Fn(8)33 1267 y(2.11)20 b(Memory)11 b(Managemen)o(t)g(Status)h(Registers)45
b(8)33 1318 y(2.12)20 b(\\i")13 b(and)h(\\d")f(Spaces)24 b
Fh(:)d(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(8)33 1368
y(2.13)20 b(Initial)13 b(Conditions)j Fh(:)k(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)71 b Fn(8)33 1419 y(2.14)20 b(Sp)q(ecial)14 b(Device)g(Registers)26
b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)71 b Fn(8)-30 1512 y Fi(3)39
b(Reading)14 b(\\C")i(Programs)321 b(10)33 1563 y Fn(3.1)41
b(Some)13 b(Selected)i(Examples)j Fh(:)j(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(10)33 1613 y(3.2)41 b(Example)13 b(1)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(10)33 1664 y(3.3)41
b(Example)13 b(2)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)50 b Fn(10)33 1715 y(3.4)41 b(Example)13 b(3)h Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(10)33 1765 y(3.5)41 b(Example)13 b(4)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(11)33 1816 y(3.6)41
b(Example)13 b(5)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)50 b Fn(12)33 1867 y(3.7)41 b(Example)13 b(6)h Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(13)33 1918 y(3.8)41 b(Example)13 b(7)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(13)33 1968 y(3.9)41
b(Example)13 b(8)h Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)50 b Fn(13)33 2019 y(3.10)20 b(Example)13 b(9)h Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(14)33 2070 y(3.11)20 b(Example)13 b(10)25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(14)33 2120 y(3.12)20
b(Example)13 b(11)25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)50 b Fn(14)33 2171 y(3.13)20 b(Example)13 b(12)25 b Fh(:)c(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(15)33 2222 y(3.14)20
b(Example)13 b(13)25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)50 b Fn(15)33 2272 y(3.15)20 b(Example)13 b(14)25 b Fh(:)c(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(15)33 2323 y(3.16)20
b(Example)13 b(15)25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)50 b Fn(15)33 2374 y(3.17)20 b(Example)13 b(16)25 b Fh(:)c(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(16)33 2425 y(3.18)20
b(Example)13 b(17)25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)50 b Fn(16)-30 2517 y Fi(4)39 b(An)15 b(Ov)o(erview)536
b(18)33 2568 y Fn(4.1)41 b(V)m(ariable)13 b(Allo)q(cation)k
Fh(:)k(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(18)33 2619
y(4.2)41 b(Global)12 b(V)m(ariables)36 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)50 b Fn(18)33 2669 y(4.3)41 b(The)15 b(`C')d(Prepro)q(cessor)22
b Fh(:)e(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(18)33 2720 y(4.4)41
b(Section)15 b(One)21 b Fh(:)g(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)50 b Fn(18)33 2771 y(4.5)41 b(The)15 b(First)f(Group)f(of)h(`.h')e(Files)
f Fh(:)20 b(:)g(:)h(:)f(:)50 b Fn(19)33 2822 y(4.6)41 b(Assem)o(bly)13
b(Language)h(Files)40 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)50 b Fn(19)1072
17 y(4.7)42 b(Other)15 b(Files)e(in)h(Section)g(One)f Fh(:)20
b(:)h(:)f(:)g(:)g(:)51 b Fn(19)1072 67 y(4.8)42 b(Section)14
b(Tw)o(o)h Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(19)1072 118 y(4.9)42 b(Section)14 b(Three)22 b Fh(:)e(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(20)1072 169 y(4.10)21 b(Section)14
b(F)m(our)d Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(20)1072 219 y(4.11)21 b(Section)14 b(Fiv)o(e)j Fh(:)j(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(21)1010 312 y Fi(5)38
b(Tw)o(o)16 b(Files)606 b(22)1072 363 y Fn(5.1)42 b(The)14
b(File)f(`mallo)q(c.c')27 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(22)1072 414 y(5.2)42 b(Rules)13 b(for)h(List)g(Main)o(tenance)39
b Fh(:)21 b(:)f(:)g(:)g(:)51 b Fn(22)1072 464 y(5.3)42 b(mallo)q(c)11
b(\(2528\))24 b Fh(:)c(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(23)1072 515 y(5.4)42 b(mfree)13 b(\(2556\))d Fh(:)20 b(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(23)1072 566 y(5.5)42
b(In)13 b(conclusion)h(...)i Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)51 b Fn(24)1072 616 y(5.6)42 b(The)14 b(File)f(`prf.c')31
b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b
Fn(24)1072 667 y(5.7)42 b(prin)o(tf)13 b(\(2340\))41 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(24)1072
718 y(5.8)42 b(prin)o(tn)13 b(\(2369\))31 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(25)1072 769 y(5.9)42 b(putc)o(har)14
b(\(2386\))35 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(25)1072 819 y(5.10)21 b(panic)13 b(\(2419\))h Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(26)1072
870 y(5.11)21 b(prdev)14 b(\(2433\),)f(dev)o(error)i(\(2447\))26
b Fh(:)20 b(:)g(:)g(:)51 b Fn(26)1072 921 y(5.12)21 b(Included)14
b(Files)k Fh(:)i(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(26)1010 1014 y Fi(6)38 b(Getting)13 b(Started)478 b(28)1072
1064 y Fn(6.1)42 b(Op)q(erator)15 b(Actions)21 b Fh(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(28)1072 1115 y(6.2)42 b(start)14
b(\(0612\))25 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(28)1072 1166 y(6.3)42 b(main)11 b(\(1550\))21 b Fh(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(29)1072 1216 y(6.4)42
b(Pro)q(cesses)d Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)51 b Fn(30)1072 1267 y(6.5)42 b(Initialisation)11 b(of)i(pro)q(c[0])19
b Fh(:)i(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(30)1072 1318 y(6.6)42
b(The)14 b(story)g(con)o(tin)o(ues)h(...)24 b Fh(:)d(:)f(:)g(:)h(:)f(:)g(:)g
(:)51 b Fn(30)1072 1368 y(6.7)42 b(sc)o(hed)15 b(\(1940\))d
Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(31)1072 1419 y(6.8)42 b(sleep)14 b(\(2066\))23 b Fh(:)d(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(31)1072 1470 y(6.9)42
b(swtc)o(h)14 b(\(2178\))40 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)51 b Fn(31)1072 1521 y(6.10)21 b(main)11 b(revisited)16
b Fh(:)k(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b
Fn(32)1010 1613 y Fi(7)38 b(Pro)q(cesses)611 b(33)1072 1664
y Fn(7.1)42 b(The)14 b(Pro)q(cess)21 b Fh(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(33)1072 1715 y(7.2)42 b(The)14 b(pro)q(c)g
(Structure)i(\(0358\))j Fh(:)h(:)h(:)f(:)g(:)g(:)51 b Fn(33)1072
1765 y(7.3)42 b(The)14 b(user)h(Structure)h(\(0413\))24 b Fh(:)c(:)h(:)f(:)g
(:)g(:)51 b Fn(34)1072 1816 y(7.4)42 b(The)14 b(P)o(er)h(Pro)q(cess)g(Data)f
(Area)30 b Fh(:)21 b(:)f(:)g(:)g(:)51 b Fn(34)1072 1867 y(7.5)42
b(The)14 b(Segmen)o(ts)j Fh(:)j(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)51 b Fn(34)1072 1918 y(7.6)42 b(Execution)14 b(of)f(an)h(Image)22
b Fh(:)f(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(35)1072 1968 y(7.7)42
b(Kernel)14 b(Mo)q(de)h(Execution)36 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(35)1072 2019 y(7.8)42 b(User)15 b(Mo)q(de)f(Execution)41
b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(35)1072 2070
y(7.9)42 b(An)14 b(Example)e Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)51 b Fn(35)1072 2120 y(7.10)21 b(Setting)14 b(the)g(Segmen)o
(tation)f(Registers)21 b Fh(:)51 b Fn(36)1072 2171 y(7.11)21
b(estabur)15 b(\(1650\))40 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)51 b Fn(36)1072 2222 y(7.12)21 b(sureg)14 b(\(1739\))i
Fh(:)k(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(36)1072 2272 y(7.13)21 b(newpro)q(c)15 b(\(1826\))23 b
Fh(:)e(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(37)1010
2365 y Fi(8)38 b(Pro)q(cess)15 b(Managemen)o(t)366 b(38)1072
2416 y Fn(8.1)42 b(Pro)q(cess)15 b(Switc)o(hing)c Fh(:)20 b(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(38)1072 2467 y(8.2)42 b(In)o(terrupts)26
b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(38)1072 2517 y(8.3)42 b(Program)12 b(Sw)o(apping)23 b
Fh(:)d(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(38)1072 2568
y(8.4)42 b(Jobs)30 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)51 b Fn(38)1072 2619 y(8.5)42 b(Assem)o(bler)13
b(Pro)q(cedures)37 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(38)1072 2669 y(8.6)42 b(sa)o(vu)13 b(\(0725\))30 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(38)1072
2720 y(8.7)42 b(retu)14 b(\(0740\))37 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(39)1072 2771 y(8.8)42 b(aretu)14
b(\(0734\))i Fh(:)k(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(39)1072 2822 y(8.9)42 b(swtc)o(h)14 b(\(2178\))40 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(39)1920
2946 y(i)p eop
%%Page: 2 4
3 bop -30 -144 a Fk(CONTENTS)1150 b(UNIX)14 b(6th)h(Edition)g(Commentary)33
17 y Fn(8.10)20 b(setpri)15 b(\(2156\))41 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(39)33 67 y(8.11)20 b(sleep)15
b(\(2066\))22 b Fh(:)f(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(40)33 117 y(8.12)20 b(w)o(ak)o(eup)14 b(\(2113\))40 b
Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(40)33
166 y(8.13)20 b(setrun)15 b(\(2134\))30 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(40)33 216 y(8.14)20 b(expand)14
b(\(2268\))f Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(40)33 266 y(8.15)20 b(swtc)o(h)15 b(revisited)35 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(41)33 316
y(8.16)20 b(Critical)13 b(Sections)40 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)50 b Fn(41)-30 408 y Fi(9)39 b(Hardw)o(are)15 b(In)o(terrupts)e
(and)i(T)l(raps)151 b(42)33 458 y Fn(9.1)41 b(Hardw)o(are)15
b(In)o(terrupts)31 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(42)33 508 y(9.2)41 b(The)15 b(In)o(terrupt)g(V)m(ector)k
Fh(:)h(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(42)33 558 y(9.3)41
b(In)o(terrupt)15 b(Handlers)29 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)50 b Fn(42)33 608 y(9.4)41 b(Priorities)g Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(43)33 658 y(9.5)41
b(In)o(terrupt)15 b(Priorities)22 b Fh(:)f(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
50 b Fn(43)33 707 y(9.6)41 b(Rules)14 b(for)g(In)o(terrupt)h(Handlers)e
Fh(:)20 b(:)g(:)h(:)f(:)50 b Fn(43)33 757 y(9.7)41 b(T)m(raps)f
Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(43)33 807 y(9.8)41 b(Assem)o(bly)13 b(Language)h(`trap')25
b Fh(:)20 b(:)g(:)g(:)h(:)f(:)50 b Fn(44)33 857 y(9.9)41 b(Return)16
b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(44)-30 949 y Fi(10)15 b(The)g(Assem)o(bler)f(\\T)l(rap")h(Routine)149
b(45)33 999 y Fn(10.1)20 b(Sources)15 b(of)f(T)m(raps)g(and)f(In)o(terrupts)
19 b Fh(:)i(:)f(:)50 b Fn(45)33 1049 y(10.2)20 b(fuib)o(yte)14
b(\(0814\),)e(fuiw)o(ord)h(\(0844\))k Fh(:)j(:)h(:)f(:)50 b
Fn(45)33 1099 y(10.3)20 b(In)o(terrupts)27 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(46)33 1149 y(10.4)20
b(call)13 b(\(0776\))j Fh(:)k(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)50 b Fn(46)33 1199 y(10.5)20 b(User)15 b(Program)e(T)m(raps)31
b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(46)33 1249
y(10.6)20 b(The)15 b(Kernel)f(Stac)o(k)19 b Fh(:)h(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)50 b Fn(47)-30 1340 y Fi(11)15 b(Clo)q(c)o(k)h(In)o(terrupt)o(s)
461 b(48)33 1390 y Fn(11.1)20 b(clo)q(c)o(k)14 b(\(3725\))19
b Fh(:)i(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(48)33 1440 y(11.2)20 b(timeout)13 b(\(3845\))34 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(49)-30
1531 y Fi(12)15 b(T)l(raps)g(and)g(System)g(Calls)315 b(50)33
1581 y Fn(12.1)20 b(trap)14 b(\(2693\))34 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(50)33 1631 y(12.2)20 b(Kernel)15
b(Mo)q(de)f(T)m(raps)j Fh(:)k(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(50)33 1681 y(12.3)20 b(User)15 b(Mo)q(de)g(T)m(raps)22
b Fh(:)e(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(50)33
1731 y(12.4)20 b(System)14 b(Calls)37 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)50 b Fn(51)33 1781 y(12.5)20 b(System)14
b(Call)e(Handlers)42 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(52)33 1831 y(12.6)20 b(The)15 b(File)e(`sysl.c')k Fh(:)j(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(52)33 1881 y(12.7)20 b(exec)15
b(\(3020\))33 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
50 b Fn(52)33 1931 y(12.8)20 b(fork)14 b(\(3322\))38 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(53)33
1981 y(12.9)20 b(sbreak)15 b(\(3354\))26 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(53)33 2031 y(12.10)o(The)15
b(Files)e(`sys2.c')h(and)f(`sys3.c')27 b Fh(:)20 b(:)h(:)f(:)50
b Fn(53)33 2081 y(12.11)o(The)15 b(File)e(`sys4.c')40 b Fh(:)20
b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(53)-30 2172
y Fi(13)15 b(Soft)o(w)o(are)f(In)o(terrupt)o(s)399 b(54)33
2222 y Fn(13.1)20 b(An)o(ticipation)13 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(54)33 2272 y(13.2)20 b(Causation)25
b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(54)33 2322 y(13.3)20 b(E\013ect)39 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(54)33 2372 y(13.4)20
b(T)m(racing)38 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)50 b Fn(54)33 2422 y(13.5)20 b(Pro)q(cedures)42
b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(54)33 2472 y(13.6)20 b(A.)14 b(An)o(ticipation)21 b Fh(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(55)33 2522 y(13.7)20
b(B.)14 b(Causation)35 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)50 b Fn(55)33 2572 y(13.8)20 b(C.)14 b(E\013ect)i Fh(:)k(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(55)33 2622
y(13.9)20 b(D.)13 b(T)m(racing)g Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)50 b Fn(55)33 2672 y(13.10)o(ssig)14 b(\(3614\))f
Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(55)33 2722 y(13.11)o(kill)13 b(\(3630\))21 b Fh(:)f(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(55)33 2772 y(13.12)o(signal)13
b(\(3949\))39 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(55)33 2822 y(13.13)o(psignal)13 b(\(3963\))j Fh(:)k(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(55)1072 17 y(13.14issig)13
b(\(3991\))34 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(56)1072 69 y(13.15psig)13 b(\(4043\))39 b Fh(:)20 b(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(56)1072 122 y(13.16core)14
b(\(4094\))37 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(56)1072 175 y(13.17gro)o(w)13 b(\(4136\))24 b Fh(:)c(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(56)1072 227 y(13.18exit)13
b(\(3219\))d Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(57)1072 280 y(13.19rexit)14 b(\(3205\))26 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(57)1072
332 y(13.20w)o(ait)13 b(\(3270\))33 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(57)1072 385 y(13.21T)m(racing)37
b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(57)1072 438 y(13.22stop)14 b(\(4016\))34 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(58)1072 490 y(13.23w)o(ait)13
b(\(3270\))g(\(con)o(tin)o(ued\))39 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(58)1072 543 y(13.24ptrace)15 b(\(4164\))29 b Fh(:)20 b(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(58)1072 596 y(13.25pro)q(cxm)o(t)13
b(\(4204\))23 b Fh(:)e(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(59)1010 692 y Fi(14)14 b(Program)h(Sw)o(apping)410 b(60)1072
744 y Fn(14.1)21 b(T)m(ext)13 b(Segmen)o(ts)38 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(60)1072 797 y(14.2)21 b(sc)o(hed)15
b(\(1940\))d Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(60)1072 849 y(14.3)21 b(xsw)o(ap)13 b(\(4368\))32 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(61)1072
902 y(14.4)21 b(xallo)q(c)13 b(\(4433\))36 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(61)1072 955 y(14.5)21 b(xfree)14
b(\(4398\))23 b Fh(:)d(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(62)1010 1051 y Fi(15)14 b(In)o(tro)q(duction)e(to)k(Basic)f(I/O)269
b(63)1072 1103 y Fn(15.1)21 b(The)14 b(File)f(`buf.h')19 b
Fh(:)i(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(63)1072
1156 y(15.2)21 b(devtab)14 b(\(4551\))19 b Fh(:)h(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(63)1072 1209 y(15.3)21 b(The)14
b(File)f(`conf.h')36 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(63)1072 1261 y(15.4)21 b(The)14 b(File)f(`conf.c')41 b
Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(63)1072
1314 y(15.5)21 b(System)13 b(Generation)24 b Fh(:)c(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)51 b Fn(63)1072 1366 y(15.6)21 b(sw)o(ap)13 b(\(5196\))22
b Fh(:)e(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(63)1072 1419 y(15.7)21 b(Race)14 b(Conditions)38 b Fh(:)20
b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(64)1072 1472
y(15.8)21 b(Reen)o(trancy)35 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)51 b Fn(65)1072 1524 y(15.9)21 b(F)m(or)13 b(the)i
(Uninitiated)h Fh(:)k(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(65)1072 1577 y(15.10Additional)12 b(Reading)i Fh(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(65)1010 1673 y
Fi(16)14 b(The)i(RK)g(Disk)f(Driv)o(er)377 b(66)1072 1726 y
Fn(16.1)21 b(The)14 b(\014le)g(`rk.c')28 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(66)1072 1778 y(16.2)21 b(rkstrategy)14
b(\(5389\))23 b Fh(:)d(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(67)1072 1831 y(16.3)21 b(rk)n(addr)13 b(\(5420\))24 b
Fh(:)c(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(67)1072
1884 y(16.4)21 b(devstart)15 b(\(5096\))25 b Fh(:)c(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(67)1072 1936 y(16.5)21 b(rkin)o(tr)13
b(\(5451\))39 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(67)1072 1989 y(16.6)21 b(io)q(done)13 b(\(5018\))24 b
Fh(:)c(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(67)1010
2085 y Fi(17)14 b(Bu\013er)h(Manipulatio)o(n)382 b(68)1072
2137 y Fn(17.1)21 b(Flags)14 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(68)1072 2190 y(17.2)21
b(A)14 b(Cac)o(he-lik)o(e)f(Memory)38 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(68)1072 2243 y(17.3)21 b(clrbuf)13 b(\(5038\))38 b
Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(68)1072 2295 y(17.4)21 b(incore)14 b(\(4899\))34 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(68)1072
2348 y(17.5)21 b(getblk)13 b(\(4921\))31 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(68)1072 2401 y(17.6)21 b(brelse)15
b(\(4869\))38 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(69)1072 2453 y(17.7)21 b(binit)13 b(\(5055\))25 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(69)1072
2506 y(17.8)21 b(bread)14 b(\(4754\))41 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(69)1072 2558 y(17.9)21 b(breada)14
b(\(4773\))20 b Fh(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(70)1072 2611 y(17.10b)o(write)14 b(\(4809\))28 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(70)1072
2664 y(17.11ba)o(write)13 b(\(4856\))40 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(70)1072 2716 y(17.12b)q(dwrite)14
b(\(4836\))35 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(70)1072 2769 y(17.13b\015ush)14 b(\(5229\))34 b Fh(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(70)1072
2822 y(17.14ph)o(ysio)13 b(\(5259\))27 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)51 b Fn(70)-30 2946 y(ii)p eop
%%Page: 3 5
4 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1150
b(CONTENTS)-30 17 y Fi(18)15 b(File)f(Access)i(and)f(Con)o(trol)310
b(71)33 70 y Fn(18.1)20 b(File)14 b(Characteristics)j Fh(:)k(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)50 b Fn(71)33 123 y(18.2)20 b(System)14
b(Calls)37 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(71)33 176 y(18.3)20 b(Con)o(trol)13 b(T)m(ables)37 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(71)33 230
y(18.4)20 b(\014le)14 b(\(5507\))25 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(71)33 283 y(18.5)20 b(ino)q(de)14
b(\(5659\))e Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(72)33 336 y(18.6)20 b(Resources)c(Required)d Fh(:)21 b(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)50 b Fn(72)33 390 y(18.7)20 b(Op)q(ening)14
b(a)g(File)34 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(72)33 443 y(18.8)20 b(creat)15 b(\(5781\))20 b Fh(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(72)33 496 y(18.9)20
b(op)q(enl)14 b(\(5804\))e Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)50 b Fn(72)33 549 y(18.10)o(op)q(en)15 b(\(5763\))23
b Fh(:)e(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(73)33 603 y(18.11)o(op)q(enl)14 b(revisited)40 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(73)33 656
y(18.12)o(close)15 b(\(5846\))24 b Fh(:)d(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)50 b Fn(73)33 709 y(18.13)o(closef)14 b(\(6643\))e
Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(73)33 763 y(18.14)o(iput)14 b(\(7344\))36 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(73)33 816 y(18.15)o(Deletion)14
b(of)f(Files)39 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(73)33 869 y(18.16)o(Reading)13 b(and)h(W)m(riting)19 b
Fh(:)h(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(74)33 922 y(18.17)o(rdwr)15
b(\(5731\))24 b Fh(:)d(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(74)33 976 y(18.18)o(readi)14 b(\(6221\))20 b Fh(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(75)33 1029 y(18.19)o(writei)39
b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(75)33 1082 y(18.20)o(iomo)o(v)o(e)12 b(\(6364\))17 b Fh(:)j(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(75)33 1136 y(18.21)o(bmap)13
b(\(6415\))41 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(75)33 1189 y(18.22)o(Lefto)o(v)o(ers)12 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(76)-30 1286
y Fi(19)15 b(File)f(Directories)f(and)i(Directory)f(Files)65
b(77)33 1339 y Fn(19.1)20 b(The)15 b(Directory)f(Data)f(Structure)20
b Fh(:)g(:)h(:)f(:)50 b Fn(77)33 1392 y(19.2)20 b(Directory)15
b(Files)34 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(77)33 1446 y(19.3)20 b(namei)12 b(\(7518\))35 b Fh(:)20
b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(77)33
1499 y(19.4)20 b(Some)13 b(Commen)o(ts)31 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)50 b Fn(78)33 1552 y(19.5)20 b(link)13 b(\(5909\))d
Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(79)33 1606 y(19.6)20 b(wdir)14 b(\(7477\))29 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(79)33
1659 y(19.7)20 b(makno)q(de)13 b(\(7455\))e Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)50 b Fn(79)33 1712 y(19.8)20 b(unlink)13
b(\(3510\))29 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(79)33 1765 y(19.9)20 b(mkno)q(d)13 b(\(5952\))18 b Fh(:)i(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(80)33 1819 y(19.10)o(access)16
b(\(6746\))34 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(80)-30 1916 y Fi(20)15 b(File)f(Systems)546 b(81)33 1969
y Fn(20.1)20 b(The)15 b(`Sup)q(er)f(Blo)q(c)o(k')f(\(5561\))40
b Fh(:)20 b(:)g(:)g(:)h(:)f(:)50 b Fn(81)33 2022 y(20.2)20
b(The)15 b('moun)o(t')c(table)j(\(0272\))40 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)50
b Fn(81)33 2076 y(20.3)20 b(iinit)13 b(\(6922\))36 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(81)33
2129 y(20.4)20 b(Moun)o(ting)32 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(82)33 2182 y(20.5)20 b(smoun)o(t)13
b(\(6086\))42 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(82)33 2236 y(20.6)20 b(Notes)41 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(82)33 2289 y(20.7)20
b(iget)14 b(\(7276\))d Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)50 b Fn(82)33 2342 y(20.8)20 b(getfs)14 b(\(7167\))26
b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(83)33 2395 y(20.9)20 b(up)q(date)15 b(\(7201\))i Fh(:)j(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(83)33 2449 y(20.10)o(sumoun)o(t)13
b(\(6144\))19 b Fh(:)h(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(84)33 2502 y(20.11)o(Resource)15 b(Allo)q(cation)38 b
Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(84)33 2555
y(20.12)o(allo)q(c)13 b(\(6965\))26 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(84)33 2608 y(20.13)o(itrunc)15
b(\(7414\))34 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50
b Fn(84)33 2662 y(20.14)o(free)15 b(\(7000\))d Fh(:)20 b(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(85)33 2715 y(20.15)o(iput)14
b(\(7344\))36 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
50 b Fn(85)33 2768 y(20.16)o(ifree)14 b(\(7134\))33 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)50 b Fn(85)33
2822 y(20.17)o(iup)q(dat)14 b(\(7374\))24 b Fh(:)c(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)50 b Fn(85)1010 17 y Fi(21)14 b(Pip)q(es)695
b(87)1072 67 y Fn(21.1)21 b(pip)q(e)14 b(\(7723\))33 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(87)1072
118 y(21.2)21 b(readp)14 b(\(7758\))41 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)51 b Fn(87)1072 169 y(21.3)21 b(writep)14
b(\(7805\))27 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(87)1072 220 y(21.4)21 b(plo)q(c)o(k)13 b(\(7862\))i Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(87)1072
270 y(21.5)21 b(prele)14 b(\(7882\))23 b Fh(:)d(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(87)1010 363 y Fi(22)14 b(Character)h(Orien)o
(ted)e(Sp)q(ecial)h(Files)126 b(88)1072 414 y Fn(22.1)21 b(LP11)13
b(Line)h(Prin)o(ter)h(Driv)o(er)38 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)51
b Fn(88)1072 465 y(22.2)21 b(lp)q(op)q(en)14 b(\(8850\))20
b Fh(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b
Fn(88)1072 515 y(22.3)21 b(Notes)41 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(88)1072 566 y(22.4)21
b(lp)q(output)13 b(\(8986\))k Fh(:)k(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)51 b Fn(89)1072 617 y(22.5)21 b(lpstart)14 b(\(8967\))22
b Fh(:)e(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b
Fn(89)1072 668 y(22.6)21 b(lpinit\(8976\))26 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(89)1072 718 y(22.7)21
b(lp)o(write)13 b(\(8870\))k Fh(:)j(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)51 b Fn(89)1072 769 y(22.8)21 b(Discussion)d Fh(:)j(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(90)1072 820 y(22.9)21
b(lp)q(canon)13 b(\(8879\))33 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)51 b Fn(90)1072 871 y(22.10F)m(or)13 b(idle)g(readers:)20
b(A)14 b(suggestion)19 b Fh(:)h(:)g(:)g(:)51 b Fn(91)1072 921
y(22.11PC-11)27 b(P)o(ap)q(er)i(T)m(ap)q(e)f(Reader/Punc)o(h)1168
971 y(Driv)o(er)g Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)51 b Fn(91)1010 1064 y Fi(23)14 b(Character)h(Handling)394
b(92)1072 1115 y Fn(23.1)21 b(cinit)13 b(\(8234\))30 b Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(93)1072
1165 y(23.2)21 b(getc)14 b(\(0930\))37 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(93)1072 1216 y(23.3)21 b(putc)14
b(\(0967\))30 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
51 b Fn(93)1072 1267 y(23.4)21 b(Character)15 b(Sets)37 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(94)1072
1318 y(23.5)21 b(Con)o(trol)13 b(Characters)23 b Fh(:)d(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)51 b Fn(94)1072 1368 y(23.6)21 b(Graphic)13
b(Characters)i Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(94)1072 1419 y(23.7)21 b(Graphic)13 b(Character)i(Sets)40
b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(94)1072 1470 y(23.8)21
b(maptab)12 b(\(8117\))36 b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)51 b Fn(95)1072 1521 y(23.9)21 b(partab)13 b(\(7947\))23
b Fh(:)d(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b
Fn(95)1010 1613 y Fi(24)14 b(In)o(teractiv)o(e)f(T)l(erminals)362
b(96)1072 1664 y Fn(24.1)21 b(The)14 b('tt)o(y')f(Structure)j(\(7926\))22
b Fh(:)e(:)h(:)f(:)g(:)g(:)51 b Fn(96)1072 1715 y(24.2)34 b(In)o(teractiv)o
(e)15 b(T)m(erminals)31 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(96)1072 1766 y(24.3)21 b(Initialisation)40 b Fh(:)20 b(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(97)1072 1816 y(24.4)21
b(stt)o(y)14 b(\(8183\))41 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)51 b Fn(97)1072 1867 y(24.5)21 b(sgtt)o(y)14 b(\(8201\))20
b Fh(:)g(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(97)1072 1918 y(24.6)21 b(klsgtt)o(y)13 b(\(8090\))19 b
Fh(:)h(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(97)1072
1969 y(24.7)21 b(t)o(yst)o(y)14 b(\(8577\))20 b Fh(:)g(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(97)1072 2019 y(24.8)21
b(The)28 b(DL11/KL11)e(T)m(erminal)g(Device)1168 2069 y(Handler)31
b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(97)1072 2120 y(24.9)21 b(Device)14 b(Registers)39 b Fh(:)20
b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(98)1072 2171
y(24.10UNIBUS)14 b(Addresses)k Fh(:)i(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(98)1072 2221 y(24.11Soft)o(w)o(are)13 b(Considerations)29
b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(98)1072 2272 y(24.12In)o(terrupt)15
b(V)m(ector)f(Addresses)42 b Fh(:)21 b(:)f(:)g(:)g(:)51 b Fn(98)1072
2323 y(24.13Source)14 b(Co)q(de)g Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)51 b Fn(98)1072 2374 y(24.14klop)q(en)13
b(\(8023\))23 b Fh(:)d(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(99)1072 2424 y(24.15klclose)13 b(\(8055\))24 b Fh(:)c(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(99)1072 2475 y(24.16klxin)o(t)12
b(\(8070\))38 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51
b Fn(99)1072 2526 y(24.17klrin)o(t)13 b(\(8078\))e Fh(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)51 b Fn(99)1010
2619 y Fi(25)14 b(The)i(File)e(\\tt)o(y)l(.c")453 b(101)1072
2669 y Fn(25.1)21 b(\015ush)o(tt)o(y)14 b(\(8252\))37 b Fh(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)30 b Fn(101)1072
2720 y(25.2)21 b(w\015ush)o(tt)o(y)14 b(\(8217\))40 b Fh(:)20
b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)30 b Fn(101)1072 2771
y(25.3)21 b(Character)15 b(Input)43 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)30 b Fn(101)1072 2822 y(25.4)21 b(ttread)14 b(\(8535\))32
b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)30
b Fn(101)1897 2946 y(iii)p eop
%%Page: 4 6
5 bop -30 -144 a Fk(CONTENTS)1150 b(UNIX)14 b(6th)h(Edition)g(Commentary)33
17 y Fn(25.5)20 b(canon)14 b(\(8274\))37 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(101)33 66 y(25.6)20 b(Notes)41
b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29
b Fn(102)33 116 y(25.7)20 b(tt)o(yinput)14 b(\(8333\))25 b
Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(102)33
166 y(25.8)20 b(Character)15 b(Output)g({)e(tt)o(write)i(\(8550\))30
b Fh(:)f Fn(103)33 216 y(25.9)20 b(ttstart)26 b Fh(:)21 b(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(103)33 266
y(25.10)o(ttrstrt)16 b(\(8486\))29 b Fh(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)29 b Fn(103)33 316 y(25.11)o(tt)o(y)o(output)14
b(\(8373\))33 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29
b Fn(103)33 365 y(25.12)o(T)m(erminals)8 b(with)h(a)h(restricted)h(c)o
(haracter)128 415 y(set)29 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(103)33 465 y(25.13)o(A.)19
b(The)h(test)g(for)f('TTLO)o(W)-5 b(A)m(T')18 b(\(Line)128
515 y(8074\))11 b Fh(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)29 b Fn(104)33 565 y(25.14)o(B.)14 b(Inactiv)o(e)g(T)m
(erminals)40 b Fh(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(104)33
614 y(25.15)o(W)m(ell,)12 b(that's)i(all,)e(folks)h(...)40
b Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(105)-30 706 y Fi(26)15
b(Suggested)e(Exercises)370 b(106)33 756 y Fn(26.1)20 b(Section)15
b(One)21 b Fh(:)g(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29
b Fn(106)33 805 y(26.2)20 b(Section)15 b(Tw)o(o)f Fh(:)21 b(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(106)33 855 y(26.3)20
b(Section)15 b(Three)22 b Fh(:)e(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)29 b Fn(107)33 905 y(26.4)20 b(Section)15 b(F)m(our)10 b
Fh(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29
b Fn(107)33 955 y(26.5)20 b(General)35 b Fh(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)29 b Fn(107)-30 2946 y(iv)p
eop
%%Page: 5 7
6 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1150
b(CONTENTS)-30 17 y Fj(Preface)-30 108 y Fn(This)20 b(b)q(o)q(ok)f(is)g(an)g
(attempt)g(to)g(explain)f(in)h(detail)g(the)-30 158 y(n)o(ucleus)13
b(of)e(one)i(of)e(the)h(most)f(in)o(teresting)h(computer)g(op-)-30
208 y(erating)i(systems)g(to)g(app)q(ear)g(in)g(recen)o(t)h(y)o(ears.)33
258 y(It)9 b(is)h(the)g(UNIX)g(Time-sharing)e(System,)h(whic)o(h)h(runs)-30
308 y(on)g(the)h(larger)f(mo)q(dels)f(of)h(Digital)e(Equipmen)o(t)h(Corp)q
(ora-)-30 358 y(tion's)j(PDP11)g(computer)g(system,)g(and)h(w)o(as)f(dev)o
(elop)q(ed)-30 407 y(b)o(y)h(Ken)g(Thompson)f(and)g(Dennis)h(Ritc)o(hie)f(at)
h(Bell)f(Lab-)-30 457 y(oratories.)32 b(It)19 b(w)o(as)f(\014rst)h(announced)
g(to)f(the)h(w)o(orld)f(in)-30 507 y(the)c(July)m(,)e(1974)g(issue)h(of)f
(the)i(\\Comm)n(unications)c(of)i(the)-30 557 y(A)o(CM".)33
607 y(V)m(ery)h(so)q(on)h(in)f(our)g(exp)q(erience)j(with)d(UNIX,)g(it)g
(sug-)-30 657 y(gested)k(itself)e(as)h(an)f(in)o(teresting)h(candidate)g(for)
f(formal)-30 706 y(study)g(b)o(y)f(studen)o(ts,)g(for)g(the)g(follo)o(wing)e
(reasons:)33 799 y Fl(\017)20 b Fn(it)12 b(runs)i(on)e(a)g(system)h(whic)o(h)
f(is)h(already)f(a)o(v)n(ailable)74 849 y(to)i(us;)33 933 y
Fl(\017)20 b Fn(it)14 b(is)g(compact)f(and)g(accessible;)33
1017 y Fl(\017)20 b Fn(it)13 b(pro)o(vides)h(an)g(extensiv)o(e)g(set)h(of)e
(v)o(ery)h(usable)f(fa-)74 1067 y(cilities;)74 1134 y(it)c(is)g(in)o
(trinsically)f(in)o(teresting,)i(and)f(in)g(fact)g(breaks)74
1184 y(new)15 b(ground)e(in)h(a)f(n)o(um)o(b)q(er)h(of)f(areas.)33
1276 y(Not)e(least)g(amongst)e(the)j(c)o(harms)e(and)h(virtues)h(of)e(the)-30
1326 y(UNIX)17 b(Time-sharing)d(System)i(is)g(the)h(compactness)f(of)-30
1376 y(its)k(source)g(co)q(de.)35 b(The)20 b(source)g(co)q(de)g(for)f(the)h
(p)q(erma-)-30 1426 y(nen)o(tly)15 b(residen)o(t)i(\\n)o(ucleus")e(of)f(the)i
(system)f(when)g(only)-30 1476 y(a)c(small)e(n)o(um)o(b)q(er)h(of)h(p)q
(eripheral)g(devices)h(is)f(represen)o(ted,)-30 1526 y(is)j(comfortably)e
(less)j(than)e(9,000)g(lines)h(of)f(co)q(de.)33 1576 y(It)k(has)g(often)f(b)q
(een)i(suggested)g(that)f(1,000)f(lines)g(of)-30 1625 y(co)q(de)e(represen)o
(ts)h(the)f(practical)e(limit)e(in)j(size)g(for)f(a)h(pro-)-30
1675 y(gram)e(whic)o(h)i(is)f(to)h(b)q(e)g(understo)q(o)q(d)h(and)f(main)o
(tained)d(b)o(y)-30 1725 y(a)15 b(single)g(individual.)21 b(Most)15
b(op)q(erating)g(systems)h(either)-30 1775 y(exceed)f(this)e(limit)d(b)o(y)i
(one)h(or)g(ev)o(en)g(t)o(w)o(o)g(orders)h(of)e(mag-)-30 1825
y(nitude,)18 b(or)f(else)h(o\013er)g(the)g(user)g(a)f(v)o(ery)g(limited)e
(set)j(of)-30 1875 y(facilities,)g(i.e.)30 b(either)19 b(the)g(details)e(of)h
(the)g(system)g(are)-30 1924 y(inaccessible)h(to)e(all)e(but)j(the)f(most)f
(determined,)i(dedi-)-30 1974 y(cated)13 b(and)f(long-su\013ering)g(studen)o
(t,)h(or)f(else)g(the)h(system)-30 2024 y(is)h(rather)h(sp)q(ecialised)g(and)
e(of)h(little)f(in)o(trinsic)g(in)o(terest.)33 2074 y(There)25
b(seem)e(to)h(b)q(e)g(three)i(main)21 b(approac)o(hes)k(to)-30
2124 y(teac)o(hing)f(Op)q(erating)f(Systems.)47 b(First)23
b(there)i(is)e(the)-30 2174 y(\\)p Fk(gener)n(al)17 b(principles)p
Fn(")f(approac)o(h,)h(wherein)g(fundamen-)-30 2224 y(tal)11
b(principles)h(are)g(exp)q(ounded,)g(and)f(illustrated)g(b)o(y)h(ref-)-30
2273 y(erences)k(to)d(v)n(arious)g(existing)g(systems,)g(\(most)f(of)h(whic)o
(h)-30 2323 y(happ)q(en)f(to)e(b)q(e)h(outside)g(the)g(studen)o(ts')g
(immediate)d(exp)q(e-)-30 2373 y(rience\).)19 b(This)11 b(is)g(the)h(approac)
o(h)f(adv)o(o)q(cated)g(b)o(y)g(the)h(CO-)-30 2423 y(SINE)17
b(Commi)o(ttee,)d(but)i(in)f(our)h(view,)f(man)o(y)f(studen)o(ts)-30
2473 y(are)d(not)e(mature)g(or)h(exp)q(erienced)i(enough)e(to)f(pro\014t)h
(from)-30 2522 y(it.)33 2573 y(The)j(second)h(approac)o(h)e(is)h(the)g(\\)p
Fk(building)h(blo)n(ck)p Fn(")e(ap-)-30 2622 y(proac)o(h,)20
b(wherein)g(the)f(studen)o(ts)h(are)g(enabled)f(to)g(syn-)-30
2672 y(thesize)d(a)f(small)d(scale)j(or)g(\\to)o(y")e(op)q(erating)i(system)f
(for)-30 2722 y(themselv)o(es.)19 b(While)12 b(undoubtedly)i(this)g(can)f(b)q
(e)i(a)e(v)n(alu-)-30 2772 y(able)18 b(exercise,)i(if)c(prop)q(erly)i
(organised,)g(it)g(cannot)f(but)-30 2822 y(fail)10 b(to)g(encompass)h(the)h
(complexit)o(y)d(and)h(sophistication)1010 17 y(of)j(real)h(op)q(erating)g
(systems,)f(and)h(is)f(usually)g(biased)h(to-)1010 66 y(w)o(ards)h(one)g(asp)
q(ect)i(of)d(op)q(erating)h(system)g(design,)g(suc)o(h)1010
116 y(as)f(pro)q(cess)i(sync)o(hronisation.)1072 167 y(The)26
b(third)g(approac)o(h)f(is)h(the)g(\\)p Fk(c)n(ase)g(study)p
Fn(")f(ap-)1010 217 y(proac)o(h.)17 b(This)c(is)f(the)h(one)f(originally)e
(recommended)h(for)1010 267 y(the)19 b(Systems)f(Programming)e(course)j(in)g
(\\Curriculum)1010 317 y('68",)14 b(the)i(rep)q(ort)g(of)f(the)h(A)o(CM)g
(Curriculum)e(Commi)o(t-)1010 367 y(tee)i(on)f(Computer)g(Science,)h
(published)g(in)e(the)i(Marc)o(h,)1010 417 y(1968)d(issue)h(of)g(the)g
(\\Comm)o(uni)o(cations)d(of)i(the)i(A)o(CM".)1072 468 y(T)m(en)h(y)o(ears)h
(ago,)f(this)h(approac)o(h,)f(whic)o(h)g(adv)o(o)q(cates)1010
518 y(dev)o(oting)10 b(\\most)f(of)g(the)i(course)h(to)e(the)h(study)g(of)e
(a)h(single)1010 567 y(system")j(w)o(as)g(unrealistic)g(b)q(ecause)i(the)e
(cost)h(of)f(pro)o(vid-)1010 617 y(ing)19 b(adequate)h(studen)o(t)h(access)g
(to)e(a)h(suitable)f(system)1010 667 y(w)o(as)14 b(simply)d(to)q(o)j(high.)
1072 718 y(T)m(en)9 b(y)o(ears)h(later,)g(the)g(economic)e(picture)i(has)g(c)
o(hanged)1010 768 y(signi\014can)o(tly)m(,)i(and)i(the)h(costs)h(are)e(no)g
(longer)g(a)h(decisiv)o(e)1010 818 y(disadv)n(an)o(tage)f(if)g(a)h
(minicomputer)e(system)h(can)i(b)q(e)f(the)1010 868 y(sub)r(ject)20
b(of)d(study)m(.)32 b(The)19 b(considerable)g(adv)n(an)o(tages)f(of)1010
917 y(the)e(approac)o(h)f(whic)o(h)g(undertak)o(es)i(a)e(detailed)g(analysis)
1010 967 y(of)e(an)h(existing)f(system)h(are)g(no)o(w)g(attainable.)1072
1019 y(In)20 b(our)g(opinion,)f(it)h(is)f(highly)g(b)q(ene\014cial)h(for)g
(stu-)1010 1068 y(den)o(ts)d(to)g(ha)o(v)o(e)f(the)h(opp)q(ortunit)o(y)f(to)h
(study)g(a)f(w)o(orking)1010 1118 y(op)q(erating)e(system)f(in)h(all)e(its)i
(asp)q(ects.)1072 1169 y(Moreo)o(v)o(er)20 b(it)g(is)g(undoubtedly)g(go)q(o)q
(d)f(for)h(studen)o(ts)1010 1219 y(ma)r(joring)10 b(in)j(Computer)f(Science,)
i(to)f(b)q(e)h(confron)o(ted)f(at)1010 1269 y(least)g(once)h(in)f(their)h
(careers,)h(with)e(the)h(task)f(of)g(reading)1010 1319 y(and)f(understanding)
g(a)g(program)e(of)i(ma)r(jor)e(dimensions.)1072 1370 y(In)g(1976)f(w)o(e)h
(adopted)g(UNIX)g(as)g(the)g(sub)r(ject)i(for)d(case)1010 1420
y(study)17 b(in)g(our)g(courses)i(in)e(Op)q(erating)g(Systems)g(at)g(the)1010
1470 y(Univ)o(ersit)o(y)e(of)g(New)h(South)f(W)m(ales.)22 b(These)17
b(notes)f(w)o(ere)1010 1519 y(prepared)e(originally)c(for)i(the)h(assistance)
h(of)e(studen)o(ts)i(in)1010 1569 y(those)g(courses)i(\(6.602B)d(and)h
(6.657G\).)1072 1620 y(The)j(courses)g(run)g(for)f(one)g(semester)h(eac)o(h.)
25 b(Before)1010 1670 y(en)o(tering)20 b(either)g(Course,)h(studen)o(ts)g
(are)f(presumed)f(to)1010 1720 y(ha)o(v)o(e)12 b(studied)i(the)f(PDP11)f(arc)
o(hitecture)j(and)d(assem)o(bly)1010 1770 y(language,)d(and)g(to)h(ha)o(v)o
(e)f(had)g(an)h(opp)q(ortunit)o(y)f(to)g(use)h(the)1010 1820
y(UNIX)k(op)q(erating)f(system)g(during)g(exercises)j(for)d(earlier)1010
1870 y(courses.)1072 1921 y(In)d(general,)g(studen)o(ts)g(seem)g(to)f(\014nd)
h(the)g(new)f(courses)1010 1971 y(more)16 b(onerous,)i(but)f(m)o(uc)o(h)f
(more)g(satisfying)g(than)h(the)1010 2020 y(previous)f(courses)h(based)f(on)f
(the)i(\\general)e(principles")1010 2070 y(approac)o(h)f(of)f(the)h(COSINE)h
(Commi)o(ttee.)1072 2121 y(Some)g(men)o(tion)f(needs)k(to)d(b)q(e)i(made)e
(regarding)g(the)1010 2171 y(do)q(cumen)o(tation)26 b(pro)o(vided)i(b)o(y)f
(the)h(authors)g(of)f(the)1010 2221 y(UNIX)15 b(system.)22
b(As)16 b(repro)q(duced)h(for)e(use)h(on)f(our)g(cam-)1010
2271 y(pus,)i(this)f(comprises)g(t)o(w)o(o)g(v)o(olumes)e(of)i(A4)g(size)h
(pap)q(er,)1010 2321 y(with)11 b(a)h(total)f(thic)o(kness)i(of)e(3)h(cm,)e
(and)i(a)g(w)o(eigh)o(t)f(of)g(1250)1010 2370 y(grams.)1072
2422 y(A)16 b(\014rst)g(observ)n(ation)f(is)g(that)h(the)g(whole)f(do)q
(cumen-)1010 2472 y(tation)h(is)h(not)f(unreasonably)h(transp)q(ortable)h(in)
e(a)h(stu-)1010 2521 y(den)o(t's)e(brief)f(case.)21 b(Ho)o(w)o(ev)o(er)15
b(it)f(m)o(ust)f(not)h(b)q(e)h(assumed)1010 2571 y(that)g(this)g(amoun)o(t)e
(of)i(do)q(cumen)o(tation,)e(whic)o(h)i(is)g(writ-)1010 2621
y(ten)g(in)g(a)f(fresh,)i(terse,)g(whimsical)c(st)o(yle,)j(is)g(necessarily)
1010 2671 y(inadequate.)1072 2722 y(In)20 b(fact)h(the)g(second)g(observ)n
(ation)f(\(whic)o(h)h(is)f(only)1010 2772 y(made)13 b(after)h(considerable)h
(exp)q(erience\))h(is)e(that)g(for)g(ref-)1010 2822 y(erence)k(purp)q(oses,)f
(the)g(do)q(cumen)o(tation)d(is)i(remark)n(ably)1909 2946 y(v)p
eop
%%Page: 6 8
7 bop -30 -144 a Fk(CONTENTS)1150 b(UNIX)14 b(6th)h(Edition)g(Commentary)-30
17 y Fn(comprehensiv)o(e.)34 b(Ho)o(w)o(ev)o(er)20 b(there)g(is)f(plen)o(t)o
(y)g(of)f(scop)q(e)-30 66 y(for)d(additional)e(tutorial)h(material,)e(one)j
(part)g(of)f(whic)o(h,)-30 116 y(it)g(is)g(hop)q(ed,)g(is)f(satis\014ed)i(b)o
(y)f(these)h(notes.)33 170 y(The)e(actual)g(UNIX)g(op)q(erating)g(system)g
(source)h(co)q(de)-30 219 y(is)k(recorded)i(in)e(a)f(separate)j(companion)c
(v)o(olume)g(en)o(ti-)-30 269 y(tled)10 b(\\UNIX)g(Op)q(erating)g(System)f
(Source)i(Co)q(de",)f(whic)o(h)-30 319 y(w)o(as)16 b(\014rst)h(prin)o(ted)g
(in)e(July)m(,)h(1976.)23 b(This)16 b(is)g(a)g(sp)q(ecially)-30
369 y(edited)g(selection)g(of)e(co)q(de)i(from)d(the)j(Lev)o(el)f(Six)g(v)o
(ersion)-30 419 y(of)f(UNIX,)g(as)f(receiv)o(ed)j(b)o(y)d(us)i(in)e(Decem)o
(b)q(er,)h(1975.)33 472 y(During)19 b(1976,)g(an)h(initial)e(v)o(ersion)i(of)
f(the)h(presen)o(t)-30 522 y(notes)i(w)o(as)e(distributed)h(in)g(roneo)q(ed)g
(form,)f(and)g(only)-30 572 y(in)c(the)i(latter)e(part)h(of)f(the)h(y)o(ear)f
(w)o(ere)i(the)f(facilities)e(of)-30 621 y(the)c(\\nro\013)s(")g(text)g
(formatting)d(program)h(exploited.)16 b(The)-30 671 y(opp)q(ortunit)o(y)g
(has)g(recen)o(tly)i(b)q(een)f(tak)o(en)f(to)g(revise)h(and)-30
721 y(\\nro\013)s(")12 b(the)g(earlier)g(material,)e(to)h(mak)o(e)g(some)f
(revisions)-30 771 y(and)19 b(corrections,)j(and)c(to)h(in)o(tegrate)h(them)e
(in)o(to)g(their)-30 821 y(presen)o(t)e(form.)33 874 y(A)11
b(decision)h(had)f(to)g(b)q(e)h(made)e(quite)i(early)f(regarding)-30
924 y(the)g(order)f(of)f(presen)o(tation)i(of)e(the)i(source)g(co)q(de.)17
b(The)10 b(in-)-30 974 y(ten)o(tion)g(w)o(as)g(to)g(pro)o(vide)g(a)f
(reasonably)h(logical)f(sequence)-30 1023 y(for)k(the)h(studen)o(t)h(who)e(w)
o(an)o(ted)g(to)g(learn)g(the)h(whole)f(sys-)-30 1073 y(tem.)25
b(With)16 b(the)h(b)q(ene\014t)h(of)e(hindsigh)o(t,)g(a)g(great)h(man)o(y)-30
1123 y(impro)o(v)o(emen)o(ts)e(in)h(detail)g(are)i(still)e(p)q(ossible,)h
(and)f(it)h(is)-30 1173 y(in)o(tended)g(that)f(these)i(c)o(hanges)f(will)d(b)
q(e)j(made)e(in)h(some)-30 1223 y(future)f(edition.)33 1276
y(It)f(is)h(our)f(hop)q(e)i(that)e(this)h(b)q(o)q(ok)f(will)f(b)q(e)i(of)f
(in)o(terest)-30 1326 y(and)21 b(v)n(alue)f(to)h(man)o(y)e(studen)o(ts)j(of)e
(the)h(UNIX)g(Time-)-30 1376 y(sharing)c(System.)25 b(Although)15
b(not)i(prepared)g(primarily)-30 1425 y(for)c(use)g(as)g(a)f(reference)j(w)o
(ork,)d(some)g(will)f(wish)h(to)h(use)g(it)-30 1475 y(as)h(suc)o(h.)k(The)c
(indices)g(pro)o(vided)f(at)g(the)g(end)h(should)f(go)-30 1525
y(some)e(of)h(the)g(w)o(a)o(y)f(to)o(w)o(ards)h(satisfying)f(the)i
(requiremen)o(t)-30 1575 y(for)h(reference)i(material)c(at)i(this)g(lev)o
(el.)33 1628 y(Since)k(these)g(notes)g(refer)h(to)e(proprietary)h(material)
-30 1678 y(administered)23 b(b)o(y)h(the)g(W)m(estern)h(Electric)g(Compan)o
(y)m(,)-30 1728 y(they)15 b(can)f(only)f(b)q(e)i(made)e(a)o(v)n(ailable)e(to)
j(licensees)i(of)d(the)-30 1778 y(UNIX)k(Time-sharing)e(System)h(and)g(hence)
i(are)f(unable)-30 1828 y(to)d(b)q(e)h(published)f(through)g(more)f(usual)g
(c)o(hannels.)33 1881 y(Corrections,)23 b(criticism)c(and)h(suggestions)i
(for)e(im-)-30 1931 y(pro)o(v)o(emen)o(t)14 b(of)f(these)i(notes)g(will)d(b)q
(e)j(v)o(ery)f(w)o(elcome.)-30 2048 y Fg(Ac)n(kno)n(wledgmen)n(ts)33
2117 y Fn(The)23 b(preparation)f(of)g(these)i(notes)f(has)g(b)q(een)g(en-)-30
2167 y(couraged)15 b(and)f(supp)q(orted)i(b)o(y)e(man)o(y)e(of)i(m)o(y)f
(colleagues)-30 2217 y(and)24 b(studen)o(ts)i(including)d(Da)o(vid)g
(Carrington,)i(Doug)-30 2267 y(Crompton,)9 b(Ian)h(Ha)o(y)o(es,)g(Da)o(vid)e
(Horsfall,)h(P)o(eter)i(Iv)n(ano)o(v,)-30 2316 y(Ian)19 b(Johnstone,)h(Chris)
e(Maltb)o(y)m(,)g(Da)o(v)o(e)g(Milw)o(a)o(y)m(,)g(John)-30
2366 y(O'Brien)d(and)f(Greg)f(Rose.)33 2420 y(P)o(at)j(Mac)o(kie)g(and)g
(Mary)h(P)o(o)o(wter)f(did)g(m)o(uc)o(h)f(of)h(the)-30 2469
y(initial)11 b(t)o(yping,)g(and)h(Adele)h(Green)f(has)h(assisted)g(greatly)
-30 2519 y(in)h(the)g(transfer)h(of)e(the)i(notes)g(to)e(\\nro\013)s(")h
(format.)33 2573 y(Da)o(vid)21 b(Millis)h(and)g(the)i(Publications)e(Section)
h(of)-30 2622 y(the)d(Univ)o(ersit)o(y)f(of)f(New)h(South)g(W)m(ales)f(ha)o
(v)o(e)h(assisted)-30 2672 y(greatly)c(with)f(the)g(mec)o(hanics)g(of)g
(publication,)f(and)h(Ian)-30 2722 y(Johnstone)k(and)f(the)h(Australian)e
(Graduate)h(Sc)o(ho)q(ol)f(of)-30 2772 y(Managemen)o(t)c(pro)o(vided)h
(facilities)f(for)h(the)h(preparation)-30 2822 y(of)g(the)g(\014nal)f(draft.)
1072 17 y(Throughout)g(this)f(pro)r(ject,)i(m)o(y)c(wife)i(Marianne)h(has)
1010 66 y(giv)o(en)f(me)g(unfailing)e(moral)h(supp)q(ort)i(and)g(m)o(uc)o(h)e
(practi-)1010 116 y(cal)i(supp)q(ort)i(with)f(pro)q(of-reading.)1072
166 y(Finally)8 b(Ken)i(Thompson)e(and)h(Dennis)g(Ritc)o(hie)g(started)1010
216 y(it)k(all.)1072 266 y(T)m(o)j(all)g(the)i(ab)q(o)o(v)o(e,)f(I)g(wish)g
(to)f(express)j(m)o(y)d(sincere)1010 316 y(thanks.)1072 365
y(The)h(co-op)q(eration)g(of)f(the)i(\\nro\013)s(")f(program)e(m)o(ust)1010
415 y(also)i(b)q(e)g(men)o(tioned.)28 b(Without)16 b(it,)h(these)i(notes)f
(could)1010 465 y(nev)o(er)h(ha)o(v)o(e)f(b)q(een)h(pro)q(duced)h(in)d(this)i
(form.)29 b(Ho)o(w)o(ev)o(er)1010 515 y(it)19 b(has)g(yielded)g(some)f(of)g
(its)h(more)f(enigmatic)g(secrets)1010 565 y(so)12 b(reluctan)o(tly)m(,)g
(that)h(the)g(author's)f(gratitude)g(is)g(indeed)1010 614 y(mixed.)19
b(Certainly)c(\\nro\013)s(")f(itself)h(m)o(ust)f(pro)o(vide)g(a)h(fer-)1010
664 y(tile)9 b(\014eld)h(for)g(future)g(practitioners)h(of)e(the)i(program)d
(do)q(c-)1010 714 y(umen)o(ter's)13 b(art.)1614 805 y(John)h(Lions)1614
855 y(Kensington,)g(NSW)1614 905 y(Ma)o(y)m(,)f(1977)-30 2946
y(vi)p eop
%%Page: 1 9
8 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)983
b(1)42 b(INTR)o(ODUCTION)-30 17 y Fj(1)70 b(In)n(tro)r(duction)-30
111 y Fn(\\UNIX")17 b(is)g(the)h(name)d(of)i(a)f(time-sharing)f(system)i(for)
-30 161 y(PDP11)d(computers,)g(written)h(b)o(y)f(Ken)h(Thompson)e(and)-30
211 y(Dennis)22 b(Ritc)o(hie)f(at)g(Bell)g(Lab)q(oratories.)41
b(It)21 b(w)o(as)g(de-)-30 260 y(scrib)q(ed)12 b(b)o(y)d(them)g(in)h(the)g
(July)m(,)g(1974)f(issue)h(of)f(the)i(\\Com-)-30 310 y(m)o(unications)h(of)i
(the)g(A)o(CM".)33 362 y(UNIX)k(has)g(pro)o(v)o(ed)g(to)f(b)q(e)i(e\013ectiv)
o(e,)h(e\016cien)o(t)e(and)-30 412 y(reliable)e(in)g(op)q(eration)h(and)f(w)o
(as)h(in)f(use)h(at)f(more)g(than)-30 461 y(150)e(installations)e(b)o(y)i
(the)g(end)h(of)e(1976.)33 513 y(The)i(amoun)o(t)e(of)h(e\013ort)h(to)g
(write)g(UNIX,)g(while)f(not)-30 563 y(inconsiderable)e(in)f(itself)h(\()p
Ff(~)p Fn(10)f(man)f(y)o(ears)i(up)g(to)f(the)h(re-)-30 613
y(lease)j(of)f(the)g(Lev)o(el)g(Six)g(system\))g(is)g(insigni\014can)o(t)f
(when)-30 662 y(compared)f(to)f(other)h(systems.)18 b(\(F)m(or)11
b(instance,)i(b)o(y)e(1968,)-30 712 y(OS/360)16 b(w)o(as)g(reputed)h(to)f(ha)
o(v)o(e)f(consumed)h(more)f(then)-30 762 y(\014v)o(e)g(man)d(millennia)f(and)
j(TSS/360,)f(another)i(IBM)f(op-)-30 812 y(erating)g(system,)f(more)g(than)h
(one)g(man)f(millennium)o(.)o(\))33 863 y(Of)h(course)h(there)h(are)f
(systems)f(whic)o(h)g(are)h(easier)g(to)-30 913 y(understand)23
b(than)e(UNIX)g(but,)i(it)e(ma)o(y)e(b)q(e)i(asserted,)-30
963 y(these)13 b(are)f(in)o(v)n(ariably)d(m)o(uc)o(h)h(simpler)g(and)h(more)f
(mo)q(dest)-30 1013 y(in)k(what)g(they)h(attempt)e(to)h(ac)o(hiev)o(e.)19
b(As)c(far)e(as)h(the)h(list)-30 1063 y(of)i(features)i(o\013ered)g(to)e
(users)i(is)f(concerned,)i(UNIX)e(is)-30 1112 y(in)d(the)g(\\big)e(league".)
20 b(In)15 b(fact)f(it)g(o\013ers)i(man)o(y)d(features)-30
1162 y(whic)o(h)19 b(are)h(notable)e(b)o(y)h(their)g(absence)i(from)c(some)h
(of)-30 1212 y(the)d(w)o(ell-kno)o(wn)e(ma)r(jor)f(systems.)-30
1338 y Fg(1.1)56 b(The)18 b(UNIX)h(Op)r(erating)f(System)-30
1418 y Fn(The)d(purp)q(ose)h(of)d(this)h(do)q(cumen)o(t,)g(and)g(its)g
(companion,)-30 1467 y(the)j(\\UNIX)f(Op)q(erating)g(System)f(Source)i(Co)q
(de",)e(is)h(to)-30 1517 y(presen)o(t)c(in)d(detail)g(that)g(part)h(of)f(the)
h(UNIX)g(time-sharing)-30 1567 y(system)j(whic)o(h)f(w)o(e)h(c)o(ho)q(ose)g
(to)f(call)g(the)h(\\UNIX)g(Op)q(erat-)-30 1617 y(ing)d(System",)g(namely)f
(the)i(co)q(de)g(whic)o(h)f(is)g(p)q(ermanen)o(tly)-30 1667
y(residen)o(t)16 b(in)f(the)g(main)e(memory)f(during)i(the)i(op)q(eration)-30
1717 y(of)g(UNIX.)g(This)g(co)q(de)g(has)g(the)h(follo)o(wing)c(ma)r(jor)i
(func-)-30 1766 y(tions:)33 1865 y Fl(\017)20 b Fn(initialisation;)33
1955 y Fl(\017)g Fn(pro)q(cess)c(managemen)o(t;)33 2045 y Fl(\017)k
Fn(system)14 b(calls;)33 2135 y Fl(\017)20 b Fn(in)o(terrupt)15
b(handling;)33 2225 y Fl(\017)20 b Fn(input/output)14 b(op)q(erations;)33
2315 y Fl(\017)20 b Fn(\014le)14 b(managemen)o(t.)-30 2441
y Fg(1.2)56 b(Utilities)-30 2521 y Fn(The)10 b(remaining)e(part)h(of)g(UNIX)g
(\(whic)o(h)h(is)f(m)o(uc)o(h)f(larger!\))-30 2571 y(is)16
b(comp)q(osed)g(of)f(a)g(set)i(of)e(suitably)h(tailored)f(programs)-30
2621 y(whic)o(h)e(run)g(as)f(\\user)i(programs",)c(and)j(whic)o(h,)f(for)g(w)
o(an)o(t)-30 2670 y(of)i(a)f(b)q(etter)j(term,)d(ma)o(y)f(b)q(e)i(termed)g
(\\utilities".)33 2722 y(Under)f(this)g(heading)f(come)f(a)h(n)o(um)o(b)q(er)
g(of)g(programs)-30 2772 y(with)j(a)g(v)o(ery)g(strong)h(sym)o(biotic)d
(relationship)h(with)h(the)-30 2822 y(op)q(erating)f(system)g(suc)o(h)h(as)
1072 17 y Fl(\017)21 b Fn(the)26 b(\\shell")g(\(the)h(command)d(language)h
(in)o(ter-)1114 66 y(preter\))1072 143 y Fl(\017)c Fn(\\/etc/init")e(\(the)h
(terminal)f(con\014guration)g(con-)1114 193 y(troller\))1010
270 y(and)12 b(a)h(n)o(um)o(b)q(er)e(of)h(\014le)h(system)f(managemen)o(t)e
(programs)1010 319 y(suc)o(h)k(as:)1142 396 y(c)o(hec)o(k)147
b(du)205 b(rmdir)1142 445 y(c)o(hmo)q(d)123 b(mkdir)142 b(sync)1142
495 y(clri)186 b(mkfs)164 b(umoun)o(t)1142 545 y(df)208 b(moun)o(t)133
b(up)q(date)1072 671 y(It)13 b(should)f(b)q(e)i(p)q(oin)o(ted)e(out)h(that)g
(man)o(y)e(of)h(the)h(func-)1010 721 y(tions)f(carried)h(out)f(b)o(y)g(the)h
(ab)q(o)o(v)o(e-named)e(programs)g(are)1010 771 y(regarded)24
b(as)f(op)q(erating)f(system)h(functions)g(in)f(other)1010
821 y(computer)10 b(systems,)h(and)g(that)f(this)h(certainly)g(do)q(es)g
(con-)1010 870 y(tribute)k(signi\014can)o(tly)f(to)g(the)h(bulk)f(of)g(these)
i(other)g(sys-)1010 920 y(tems)g(as)h(compared)f(with)h(the)g(UNIX)h(Op)q
(erating)f(Sys-)1010 970 y(tem)c(\(in)g(the)i(w)o(a)o(y)e(w)o(e)h(ha)o(v)o(e)
g(de\014ned)h(it\).)1072 1020 y(Descriptions)10 b(of)f(the)h(function)g(and)f
(use)h(of)f(the)h(ab)q(o)o(v)o(e)1010 1070 y(programs)18 b(ma)o(y)g(b)q(e)j
(found)e(in)g(the)i(\\UNIX)f(Program-)1010 1120 y(mer's)14
b(Man)o(ual")f(\(UPM\),)i(either)h(in)e(Section)h(I)g(\(for)f(the)1010
1169 y(commonly)g(used)k(programs\))f(or)g(in)g(Section)h(VI)q(I)q(I)g(\(for)
1010 1219 y(the)c(programs)f(used)i(only)e(b)o(y)h(the)g(System)f(Manager\).)
1010 1333 y Fg(1.3)55 b(Other)19 b(Do)r(cumen)n(tation)1010
1409 y Fn(These)14 b(notes)g(mak)o(e)e(frequen)o(t)i(reference)i(to)d(the)h
(\\UNIX)1010 1459 y(Programmer's)20 b(Man)o(ual")h(\(UPM\),)h(o)q(ccasional)g
(refer-)1010 1509 y(ence)16 b(to)f(the)h(\\UNIX)g(Do)q(cumen)o(ts")e(b)q(o)q
(oklet,)h(and)g(con-)1010 1559 y(stan)o(t)22 b(reference)j(to)c(the)i(\\UNIX)
f(Op)q(erating)h(System)1010 1609 y(Source)15 b(Co)q(de".)1072
1658 y(All)10 b(these)j(are)e(relev)n(an)o(t)h(to)f(a)f(complete)h
(understand-)1010 1708 y(ing)k(of)h(the)g(system.)24 b(In)16
b(addition,)f(a)h(full)f(study)h(of)f(the)1010 1758 y(assem)o(bly)8
b(language)h(routines)h(requires)h(reference)h(to)d(the)1010
1808 y(\\PDP11)14 b(Pro)q(cessor)i(Handb)q(o)q(ok",)e(published)h(b)o(y)f
(Digi-)1010 1858 y(tal)f(Equipmen)o(t)g(Corp)q(oration.)1010
1971 y Fg(1.4)55 b(UNIX)19 b(Programmer's)d(Man)n(ual)1010
2048 y Fn(The)d(UPM)g(is)f(divided)h(in)o(to)f(eigh)o(t)g(ma)r(jor)f
(sections,)i(pre-)1010 2098 y(ceded)22 b(b)o(y)e(a)h(table)f(of)g(con)o(ten)o
(ts)i(and)e(a)h(KWIC)f(\(Key)1010 2148 y(W)m(ord)13 b(In)h(Con)o(text\))g
(index.)k(The)d(latter)f(is)g(mostly)e(v)o(ery)1010 2197 y(useful)d(but)h(is)
f(o)q(ccasionally)g(anno)o(ying,)f(as)i(some)f(indexed)1010
2247 y(material)i(do)q(es)i(not)g(exist,)f(and)h(some)f(existing)g(material)
1010 2297 y(is)i(not)f(indexed.)1072 2347 y(Within)18 b(eac)o(h)g(section)i
(of)e(the)h(man)o(ual,)d(the)j(mate-)1010 2397 y(rial)j(is)h(arranged)g
(alphab)q(etically)f(b)o(y)g(sub)r(ject)j(name.)1010 2446 y(The)h(section)g
(n)o(um)o(b)q(er)e(is)h(con)o(v)o(en)o(tionally)f(app)q(ended)1010
2496 y(to)19 b(the)i(sub)r(ject)g(name,)f(since)g(some)f(sub)r(jects)j(app)q
(ear)1010 2546 y(in)d(more)h(than)g(one)g(section,)i(e.g.)36
b(\\CHDIR\(I\)")19 b(and)1010 2596 y(\\CHDIR\(I)q(I\)".)1010
2672 y Fi(Section)14 b(I)20 b Fn(con)o(tains)28 b(commands)d(whic)o(h)i
(either)i(are)1114 2722 y(recognised)e(b)o(y)g(the)g(\\shell")f(command)e(in)
o(ter-)1114 2772 y(preter,)13 b(or)e(are)h(the)g(names)e(of)h(standard)h
(user)g(util-)1114 2822 y(it)o(y)h(programs;)1910 2946 y(1)p
eop
%%Page: 2 10
9 bop -30 -144 a Fk(1)43 b(INTR)o(ODUCTION)982 b(UNIX)14 b(6th)h(Edition)g
(Commentary)-30 17 y Fi(Section)f(I)q(I)22 b Fn(con)o(tains)16
b(\\system)h(calls")f(whic)o(h)h(are)g(op-)74 66 y(erating)10
b(system)g(routines)h(whic)o(h)f(ma)o(y)e(b)q(e)j(in)o(v)o(ok)o(ed)74
116 y(from)h(a)h(user)h(program)e(to)h(obtain)g(op)q(erating)g(sys-)74
166 y(tem)g(service.)19 b(A)13 b(study)h(of)e(the)i(op)q(erating)f(system)74
216 y(will)g(render)i(most)e(of)g(these)i(quite)f(familiar;)-30
306 y Fi(Section)g(I)q(I)q(I)22 b Fn(con)o(tains)e(\\subroutines")g(whic)o(h)
g(are)h(li-)74 356 y(brary)g(routines)f(whic)o(h)h(ma)o(y)d(b)q(e)j(called)f
(from)e(a)74 405 y(user)f(program.)23 b(T)m(o)15 b(the)h(ordinary)f
(programmer,)74 455 y(the)10 b(distinctions)f(b)q(et)o(w)o(een)i(Sections)f
(I)q(I)g(and)f(I)q(I)q(I)g(of-)74 505 y(ten)15 b(app)q(ear)f(somewhat)e
(arbitrary)m(.)18 b(Most)c(of)f(Sec-)74 555 y(tion)h(I)q(I)q(I)g(is)f
(irrelev)n(an)o(t)h(to)g(the)g(op)q(erating)g(system;)-30 645
y Fi(Section)g(IV)21 b Fn(describ)q(es)d(\\sp)q(ecial)f(\014les",)f(whic)o(h)
g(is)g(an-)74 695 y(other)j(name)e(for)h(p)q(eripheral)h(devices.)32
b(Some)17 b(of)74 744 y(these)f(are)f(relev)n(an)o(t,)g(and)f(some)g(merely)g
(in)o(terest-)74 794 y(ing.)k(It)c(dep)q(ends)h(where)g(y)o(ou)f(are;)-30
884 y Fi(Section)g(V)21 b Fn(describ)q(es)h(\\File)e(F)m(ormats)e(and)i(Con)o
(v)o(en-)74 934 y(tions".)d(A)12 b(lot)g(of)g(highly)e(relev)n(an)o(t)j
(information)c(is)74 984 y(tuc)o(k)o(ed)15 b(a)o(w)o(a)o(y)e(in)g(this)h
(section;)-30 1074 y Fi(Sections)g(VI)i(and)f(VI)q(I)22 b Fn(describ)q(e)11
b(\\User)f(Main)o(tained")74 1124 y(programs)18 b(and)i(subroutines.)36
b(No)19 b(UNIXophile)74 1173 y(will)g(ignore)g(these)i(sections,)h(but)e
(they)h(are)f(not)74 1223 y(particularly)12 b(relev)n(an)o(t)g(to)g(the)h(op)
q(erating)f(system;)-30 1313 y Fi(Section)i(VI)q(I)q(I)22 b
Fn(describ)q(es)11 b(\\system)e(main)o(tenance")f(\(soft-)74
1363 y(w)o(are,)16 b(not)g(hardw)o(are!\).)23 b(There)17 b(is)e(lots)h(of)f
(useful)74 1413 y(information)f(here,)19 b(esp)q(ecially)e(if)f(y)o(ou)h(are)
h(in)o(ter-)74 1463 y(ested)c(in)d(ho)o(w)h(a)g(UNIX)h(installation)d(is)i
(managed.)-30 1588 y Fg(1.5)56 b(UNIX)19 b(Do)r(cumen)n(ts)-30
1668 y Fn(This)e(is)f(a)g(somewhat)f(miscellaneous)g(collection)h(of)g(es-)
-30 1718 y(sa)o(ys)f(of)e(v)n(arying)g(degrees)i(of)e(relev)n(ance:)33
1816 y Fl(\017)20 b Fk(Setting)k(up)g(UNIX)e Fn(really)h(b)q(elongs)g(in)f
(Section)74 1866 y(VI)q(I)q(I)14 b(of)g(the)g(UPM)h(\(it's)e(relev)n(an)o
(t\);)33 1956 y Fl(\017)20 b Fk(The)j(UNIX)g(Time-sharing)f(System)i
Fn(is)e(an)h(up-)74 2005 y(dated)g(v)o(ersion)f(of)g(the)h(original)e(\\Comm)
n(unica-)74 2055 y(tions)10 b(of)f(the)i(A)o(CM")f(pap)q(er.)17
b(It)10 b(should)g(b)q(e)h(re-read)74 2105 y(at)j(least)g(once)h(p)q(er)f
(mon)o(th;)33 2195 y Fl(\017)20 b Fk(UNIX)f(for)g(Be)n(ginners)g
Fn(is)g(useful)g(if)f(y)o(our)g(UNIX)74 2245 y(exp)q(erience)e(is)e(limited;)
33 2335 y Fl(\017)20 b Fn(The)15 b(tutorials)e(on)h(\\C")f(and)h(the)h
(editor,)e(and)h(the)74 2385 y(reference)j(man)o(uals)c(for)h(\\C")g(and)h
(the)g(assem)o(bler)74 2434 y(are)21 b(highly)e(useful)h(unless)h(y)o(ou)f
(are)h(completely)74 2484 y(exp)q(ert;)33 2574 y Fl(\017)f
Fk(The)11 b(UNIX)f(I/O)h(System)e Fn(pro)o(vides)h(a)f(go)q(o)q(d)g(o)o(v)o
(erview)74 2624 y(of)14 b(man)o(y)e(features)j(of)e(the)h(op)q(erating)g
(system;)33 2714 y Fl(\017)20 b Fk(UNIX)e(Summary)g Fn(pro)o(vides)g(a)g(c)o
(hec)o(k)h(list)e(whic)o(h)74 2764 y(will)12 b(b)q(e)i(useful)f(in)g(answ)o
(ering)g(the)h(question)g(what)74 2814 y(do)q(es)h(an)f(op)q(erating)f
(system)h(do?)1010 17 y Fg(1.6)55 b(UNIX)19 b(Op)r(erating)f(System)e(Source)
1137 75 y(Co)r(de)1010 151 y Fn(This)c(is)f(an)h(edited)h(v)o(ersion)f(of)f
(the)h(op)q(erating)g(system)g(as)1010 201 y(supplied)i(b)o(y)f(Bell)h(Lab)q
(oratories.)1072 251 y(The)h(co)q(de)h(selection)g(presumes)f(a)f(\\mo)q
(del")f(system)1010 301 y(consisting)h(of:)1072 373 y Fl(\017)21
b Fn(PDP11/40)12 b(pro)q(cessor;)1072 448 y Fl(\017)21 b Fn(RK05)13
b(disk)h(driv)o(es;)1072 524 y Fl(\017)21 b Fn(LP11)13 b(line)h(prin)o(ter;)
1072 599 y Fl(\017)21 b Fn(PC11)13 b(pap)q(er)i(tap)q(e)f(reader/punc)o(h;)
1072 674 y Fl(\017)21 b Fn(KL11)13 b(terminal)f(in)o(terface.)1072
747 y(The)22 b(principal)f(editorial)g(c)o(hanges)i(to)e(the)i(source)1010
796 y(co)q(de)15 b(are)f(as)g(follo)o(ws:)1072 869 y Fl(\017)21
b Fn(the)i(order)h(of)f(presen)o(tation)h(of)e(\014les)i(has)f(b)q(een)1114
918 y(c)o(hanged;)1072 994 y Fl(\017)e Fn(the)c(order)g(of)e(material)g
(within)g(sev)o(eral)i(\014les)g(has)1114 1044 y(b)q(een)e(c)o(hanged;)1072
1119 y Fl(\017)21 b Fn(to)12 b(a)g(v)o(ery)g(limited)f(exten)o(t,)i(co)q(de)g
(has)f(b)q(een)i(trans-)1114 1169 y(ferred)d(b)q(et)o(w)o(een)h(\014les)f
(\(with)f(hindsigh)o(t)g(a)g(lot)g(more)1114 1219 y(of)j(this)h(w)o(ould)f
(ha)o(v)o(e)h(b)q(een)h(desirable\);)1072 1294 y Fl(\017)21
b Fn(ab)q(out)13 b(5\045)g(of)g(the)h(lines)g(ha)o(v)o(e)f(b)q(een)i
(shortened)h(in)1114 1344 y(v)n(arious)i(w)o(a)o(ys)h(to)g(less)h(than)f(66)g
(c)o(haracters)i(\(b)o(y)1114 1393 y(elimination)10 b(of)k(blanks,)f
(rearrangemen)o(t)h(of)f(com-)1114 1443 y(men)o(ts,)f(splitting)h(in)o(to)h
(t)o(w)o(o)f(lines,)g(etc.\);)1072 1519 y Fl(\017)21 b Fn(a)14
b(n)o(um)o(b)q(er)f(of)h(commen)o(ts)f(consisting)h(of)g(a)g(line)g(of)1114
1568 y(underscore)19 b(c)o(haracters)g(ha)o(v)o(e)e(b)q(een)h(in)o(tro)q
(duced,)1114 1618 y(particularly)13 b(at)g(the)i(end)f(of)g(pro)q(cedures;)
1072 1694 y Fl(\017)21 b Fn(the)10 b(size)g(of)f(eac)o(h)i(\014le)e(has)h(b)q
(een)h(adjusted)f(to)f(an)h(ex-)1114 1743 y(act)h(m)o(ultiple)e(of)h(50)g
(lines)h(b)o(y)g(padding)f(with)h(blank)1114 1793 y(lines;)1072
1865 y(The)i(source)h(co)q(de)f(has)f(b)q(een)i(prin)o(ted)e(in)g(double)h
(col-)1010 1915 y(umn)f(format)h(with)g(\014ft)o(y)h(lines)g(p)q(er)g
(column,)e(giving)h(one)1010 1965 y(h)o(undred)j(lines)f(p)q(er)h(sheet)h
(\(or)e(page\).)22 b(Th)o(us)16 b(there)g(is)f(a)1010 2015
y(con)o(v)o(enien)o(t)i(relationship)g(b)q(et)o(w)o(een)i(line)d(n)o(um)o(b)q
(ers)h(and)1010 2065 y(sheet)e(n)o(um)o(b)q(ers.)1072 2114
y(A)h(n)o(um)o(b)q(er)f(of)g(summaries)f(ha)o(v)o(e)h(b)q(een)i(included)f
(at)1010 2164 y(the)e(b)q(eginning)g(of)f(the)h(Source)h(Co)q(de)f(v)o
(olume:)1072 2236 y Fl(\017)21 b Fn(A)g Fk(T)m(able)h(of)g(Contents)f
Fn(sho)o(wing)g(\014les)h(in)f(order)1114 2286 y(of)15 b(app)q(earance,)i
(together)g(with)e(the)i(Pro)q(cedures)1114 2336 y(they)d(con)o(tain;)1072
2411 y Fl(\017)21 b Fn(An)g Fk(alphab)n(etic)n(al)h(list)e
Fn(of)h(pro)q(cedures)j(with)d(line)1114 2461 y(n)o(um)o(b)q(ers;)1072
2537 y Fl(\017)g Fn(A)14 b Fk(list)g(of)g(De\014ne)n(d)i(Symb)n(ols)f
Fn(with)e(their)h(v)n(alues;)1072 2612 y Fl(\017)21 b Fn(A)26
b Fk(Cr)n(oss)f(R)n(efer)n(enc)n(e)h(Listing)g Fn(giving)f(the)i(line)1114
2662 y(n)o(um)o(b)q(ers)21 b(where)i(eac)o(h)f(sym)o(b)q(ol)e(is)i(used.)42
b(\(Re-)1114 2712 y(serv)o(ed)19 b(w)o(ords)g(in)f(\\C")g(and)g(a)g(n)o(um)o
(b)q(er)g(of)f(com-)1114 2761 y(monly)8 b(used)k(sym)o(b)q(ols)d(suc)o(h)i
(as)g(\\p")f(and)h(\\u")f(ha)o(v)o(e)1114 2811 y(b)q(een)15
b(omitted.\))-30 2946 y(2)p eop
%%Page: 3 11
10 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)983
b(1)42 b(INTR)o(ODUCTION)-30 17 y Fg(1.7)56 b(Source)18 b(Co)r(de)h
(Selections)-30 94 y Fn(The)13 b(source)f(co)q(de)h(has)f(b)q(een)g(divided)f
(in)o(to)g(\014v)o(e)h(sections,)-30 144 y(eac)o(h)k(dev)o(oted)f(primarily)e
(to)i(a)f(single)h(ma)r(jor)e(asp)q(ect)j(of)-30 194 y(the)f(system.)33
244 y(The)e(in)o(ten)o(tion,)g(whic)o(h)g(has)g(b)q(een)h(largely)f(ac)o
(hiev)o(ed,)-30 294 y(has)26 b(b)q(een)g(to)e(mak)o(e)g(eac)o(h)h(section)h
(su\016cien)o(tly)f(self-)-30 344 y(con)o(tained)16 b(so)g(that)g(it)f(ma)o
(y)f(b)q(e)j(studied)f(as)g(a)f(unit)h(and)-30 394 y(b)q(efore)f(its)f
(successors)j(ha)o(v)o(e)c(b)q(een)i(mastered:)-30 487 y Fi(Section)f(One)20
b Fn(deals)13 b(with)f(system)g(initialisation,)d(and)74 537
y(pro)q(cess)17 b(managemen)o(t.)h(It)d(also)f(con)o(tains)h(all)e(the)74
587 y(assem)o(bly)g(language)g(routines;)-30 672 y Fi(Section)h(Tw)o(o)21
b Fn(deals)14 b(with)e(in)o(terrupts,)i(traps,)g(system)74
721 y(calls)g(and)f(signals)h(\(soft)o(w)o(are)g(in)o(terrupts\);)-30
806 y Fi(Section)g(Three)20 b Fn(deals)h(primarily)e(with)i(disk)f(op)q(era-)
74 856 y(tions)c(for)g(program)e(sw)o(apping)h(and)h(basic,)g(blo)q(c)o(k)74
906 y(orien)o(ted)f(input/output.)k(It)14 b(also)g(deals)g(with)g(the)74
956 y(manipulation)d(of)i(the)i(p)q(o)q(ol)e(of)g(large)h(bu\013ers;)-30
1041 y Fi(Section)g(F)l(our)20 b Fn(deals)25 b(with)g(\014les)g(and)g(\014le)
g(systems:)74 1091 y(their)10 b(creation,)g(main)o(tenance,)f(manipulation)d
(and)74 1140 y(destruction;)-30 1225 y Fi(Section)14 b(Fiv)o(e)20
b Fn(deals)c(with)f(\\c)o(haracter)h(sp)q(ecial)g(\014les",)74
1275 y(whic)o(h)10 b(is)f(the)h(UNIX)g(term)e(for)i(slo)o(w)e(sp)q(eed)j(p)q
(eriph-)74 1325 y(eral)k(devices)h(whic)o(h)f(op)q(erate)h(out)f(of)f(a)h
(common,)74 1375 y(c)o(haracter)h(orien)o(ted,)d(bu\013er)i(p)q(o)q(ol.)33
1468 y(The)e(con)o(ten)o(ts)g(of)f(eac)o(h)h(section)g(is)g(outlined)f(in)g
(more)-30 1518 y(detail)i(in)f(Chapter)i(F)m(our.)-30 1637
y Fg(1.8)56 b(Source)18 b(Co)r(de)h(Files)-30 1714 y Fn(Eac)o(h)e(of)e(the)h
(\014v)o(e)h(sections)g(just)f(describ)q(ed)h(consists)g(of)-30
1764 y(sev)o(eral)f(source)g(co)q(de)g(\014les.)21 b(The)15
b(name)f(of)g(eac)o(h)h(\014le)g(in-)-30 1814 y(cludes)g(a)f(su\016x)g(whic)o
(h)f(iden)o(ti\014es)i(its)f(t)o(yp)q(e:)-30 1907 y Fi(\\.s")21
b Fn(denotes)27 b(a)e(\014le)h(of)e(assem)o(bly)h(language)f(state-)74
1957 y(men)o(ts;)-30 2042 y Fi(\\.c")e Fn(denotes)k(a)f(\014le)h(of)e
(executable)j(\\C")e(language)74 2092 y(statemen)o(ts;)-30
2177 y Fi(\\.h")c Fn(denotes)k(a)e(\014le)h(of)f(\\C")g(language)f(statemen)o
(ts)74 2227 y(whic)o(h)h(is)g(not)f(for)h(separate)h(compilation,)d(but)74
2277 y(for)14 b(inclusion)e(in)i(other)g(\\.c")f(\014les)h(when)g(they)g(are)
74 2326 y(compiled)c(i.e.)17 b(the)11 b(\\.h")g(\014les)g(con)o(tain)g
(global)f(dec-)74 2376 y(larations.)-30 2495 y Fg(1.9)56 b(Use)19
b(of)f(these)g(notes)-30 2573 y Fn(These)d(notes,)e(whic)o(h)g(are)h(in)o
(tended)f(to)g(supplemen)o(t)g(the)-30 2622 y(commen)o(ts)j(already)h(presen)
o(t)i(in)e(the)h(source)h(co)q(de,)f(are)-30 2672 y(not)11
b(essen)o(tial)g(for)f(understanding)i(the)f(UNIX)g(op)q(erating)-30
2722 y(system.)21 b(It)15 b(is)f(p)q(erfectly)i(p)q(ossible)f(to)g(pro)q
(ceed)h(without)-30 2772 y(them,)f(and)g(y)o(ou)g(should)h(attempt)e(to)i(do)
f(so)h(as)f(long)g(as)-30 2822 y(y)o(ou)f(can.)1072 17 y(The)21
b(notes)f(are)h(a)f(crutc)o(h,)i(to)e(aid)f(y)o(ou)h(when)g(the)1010
66 y(going)g(b)q(ecomes)i(di\016cult.)40 b(If)21 b(y)o(ou)g(attempt)g(to)h
(read)1010 116 y(eac)o(h)12 b(\014le)g(or)f(pro)q(cedure)j(on)d(y)o(our)h(o)o
(wn)f(\014rst,)i(y)o(our)e(initial)1010 166 y(progress)20 b(is)f(lik)o(ely)e
(to)i(b)q(e)g(slo)o(w)o(er,)h(but)f(y)o(our)g(ultimate)1010
216 y(progress)e(m)o(uc)o(h)d(faster.)25 b(Reading)15 b(other)h(p)q(eople's)g
(pro-)1010 266 y(grams)8 b(is)i(an)f(art)h(whic)o(h)f(should)h(b)q(e)g(learn)
o(t)g(and)f(practised)1010 316 y(b)q(ecause)15 b(it)f(is)g(useful!)1010
432 y Fg(1.10)56 b(A)20 b(Note)f(on)h(Programming)d(Stan-)1166
490 y(dards)1010 566 y Fn(Y)m(ou)12 b(will)g(\014nd)h(that)g(most)e(of)h(the)
i(co)q(de)g(in)e(UNIX)h(is)g(of)f(a)1010 616 y(v)o(ery)k(high)g(standard.)25
b(Man)o(y)16 b(sections)h(whic)o(h)g(initially)1010 666 y(seem)g(complex)f
(and)h(obscure,)i(app)q(ear)f(in)f(the)h(ligh)o(t)e(of)1010
716 y(further)f(in)o(v)o(estigation)d(and)i(re\015ection,)h(to)e(b)q(e)i(p)q
(erfectly)1010 766 y(ob)o(vious)e(and)h(\\the)g(only)f(w)o(a)o(y)g(to)h
(\015y".)1072 816 y(F)m(or)e(this)h(reason,)g(the)h(o)q(ccasional)e(commen)o
(ts)f(in)h(the)1010 865 y(notes)f(on)g(programmi)o(ng)d(st)o(yle,)j(almost)e
(in)o(v)n(ariably)f(refer)1010 915 y(to)13 b(apparen)o(t)h(lapses)h(from)d
(the)i(usual)f(standard)h(of)g(near)1010 965 y(p)q(erfection.)1072
1015 y(What)f(caused)i(these?)20 b(Sometimes)11 b(it)i(app)q(ears)i(that)1010
1065 y(the)24 b(original)f(co)q(de)h(has)h(b)q(een)g(patc)o(hed)f(exp)q
(edien)o(tly)m(.)1010 1114 y(More)13 b(than)f(once)h(apparen)o(t)f(lapses)h
(ha)o(v)o(e)f(pro)o(v)o(ed)g(not)g(to)1010 1164 y(b)q(e)j(suc)o(h:)21
b(the)15 b(\\bad")f(co)q(de)i(has)f(b)q(een)h(found)e(in)g(fact)h(to)1010
1214 y(incorp)q(orate)10 b(some)f(subtle)i(feature)f(whic)o(h)g(w)o(as)g(not)
g(at)f(all)1010 1264 y(apparen)o(t)14 b(initially)m(.)h(And)f(some)f(allo)o
(w)o(ance)f(is)i(certainly)1010 1314 y(needed)h(for)f(o)q(ccasional)f(h)o
(uman)f(w)o(eakness.)1072 1363 y(But)i(on)e(the)i(whole)f(y)o(ou)f(will)g
(\014nd)h(that)g(the)h(authors)1010 1413 y(of)e(UNIX,)h(Ken)g(Thompson)f(and)
g(Dennis)h(Ritc)o(hie,)f(ha)o(v)o(e)1010 1463 y(created)17
b(a)e(program)f(of)h(great)h(strength,)g(in)o(tegrit)o(y)f(and)1010
1513 y(e\013ectiv)o(eness,)h(whic)o(h)e(y)o(ou)g(should)f(admire)g(and)h
(seek)h(to)1010 1563 y(em)o(ulate.)1910 2946 y(3)p eop
%%Page: 4 12
11 bop -30 -144 a Fk(2)43 b(FUND)o(AMENT)m(ALS)968 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fj(2)70 b(F)-6 b(undamen)n(tals)-30
115 y Fn(UNIX)16 b(runs)f(on)g(the)g(larger)g(mo)q(dels)f(of)g(the)i(PDP11)e
(se-)-30 165 y(ries)k(of)e(computers)g(man)o(ufactured)g(b)o(y)h(Digital)d
(Equip-)-30 214 y(men)o(t)19 b(Corp)q(oration.)33 b(This)19
b(c)o(hapter)h(pro)o(vides)f(a)g(brief)-30 264 y(summary)12
b(of)i(certain)h(selected)h(features)f(of)e(these)j(com-)-30
314 y(puters)g(with)d(particular)h(reference)i(to)e(the)g(PDP11/40.)33
368 y(If)k(the)h(reader)h(has)e(not)h(previously)f(made)g(the)h(ac-)-30
418 y(quain)o(tance)14 b(of)g(the)g(PDP11)g(series)h(then)g(he)f(is)g
(directed)-30 467 y(forth)o(with)23 b(to)g(the)h(\\PDP11)e(Pro)q(cessor)k
(Handb)q(o)q(ok",)-30 517 y(published)15 b(b)o(y)e(DEC.)33
571 y(A)e(PDP11)h(computer)f(consists)i(of)d(a)i(pro)q(cessor)h(\(also)-30
621 y(called)25 b(a)g(CPU)g(connected)i(to)e(one)g(or)g(more)f(mem-)-30
670 y(ory)19 b(storage)g(units)f(and)h(p)q(eripheral)g(con)o(trollers)f(via)g
(a)-30 720 y(bidirectional)12 b(parallel)e(comm)o(unication)f(line)i(called)h
(the)-30 770 y(\\Unibus".)-30 907 y Fg(2.1)56 b(The)18 b(Pro)r(cessor)-30
991 y Fn(The)e(pro)q(cessor,)i(whic)o(h)d(is)h(designed)g(around)g(a)f
(sixteen)-30 1041 y(bit)f(w)o(ord)f(length)h(for)f(instructions,)h(data)f
(and)g(program)-30 1090 y(addresses,)h(incorp)q(orates)e(a)f(n)o(um)o(b)q(er)
f(of)g(high)h(sp)q(eed)h(reg-)-30 1140 y(isters.)-30 1277 y
Fg(2.2)56 b(Pro)r(cessor)18 b(Status)h(W)-5 b(ord)-30 1361
y Fn(This)14 b(sixteen)g(bit)f(register)h(has)f(sub\014elds)i(whic)o(h)e(are)
g(in-)-30 1411 y(terpreted)k(as)d(follo)o(ws:)58 1511 y Fi(bits)65
b(description)58 1561 y Fn(14,15)48 b(curren)o(t)15 b(mo)q(de)e(\(00)h(=)g(k)
o(ernel;\))58 1611 y(12,13)48 b(previous)14 b(mo)q(de)f(\(11)h(=)g(user;\))58
1661 y(5,6,7)57 b(pro)q(cessor)16 b(priorit)o(y)d(\(range)h(0..7\))58
1711 y(4)123 b(trap)14 b(bit)58 1760 y(3)123 b(N,)14 b(set)g(if)f(the)i
(previous)202 1810 y(result)g(w)o(as)e(negativ)o(e)58 1860
y(2)123 b(Z,)14 b(set)h(if)e(the)h(previous)202 1910 y(result)h(w)o(as)e
(zero)58 1960 y(1)123 b(V,)14 b(set)g(if)f(the)i(previous)202
2010 y(result)g(ga)o(v)o(e)e(an)h(o)o(v)o(er\015o)o(w)58 2059
y(0)123 b(C,)13 b(set)i(if)e(the)i(previous)202 2109 y(op)q(eration)f(ga)o(v)
o(e)f(a)h(carry)33 2161 y(The)9 b(pro)q(cessor)j(can)d(op)q(erate)h(in)f(t)o
(w)o(o)g(di\013eren)o(t)h(mo)q(des:)-30 2211 y(k)o(ernel)h(and)g(user.)18
b(Kernel)11 b(mo)q(de)e(is)i(the)g(more)e(privileged)-30 2261
y(of)14 b(the)g(t)o(w)o(o)g(and)g(is)g(reserv)o(ed)i(b)o(y)d(the)i(op)q
(erating)f(system)-30 2310 y(for)g(its)g(o)o(wn)f(use.)19 b(The)c(c)o(hoice)f
(of)f(mo)q(de)g(determines:)33 2417 y Fl(\017)20 b Fn(The)10
b(set)g(of)f(memory)e(managemen)o(t)g(segmen)o(tation)74 2467
y(registers)19 b(whic)o(h)f(is)f(used)h(to)f(translate)h(program)74
2517 y(virtual)13 b(addresses)j(to)e(ph)o(ysical)f(addresses;)33
2615 y Fl(\017)20 b Fn(The)k(actual)f(register)h(used)g(as)f(r6,)i(the)e
(\\stac)o(k)74 2665 y(p)q(oin)o(ter";)33 2764 y Fl(\017)d Fn(Whether)g
(certain)f(instructions)g(suc)o(h)g(as)g(\\halt")74 2814 y(will)13
b(b)q(e)h(ob)q(ey)o(ed.)1010 17 y Fg(2.3)55 b(General)18 b(Registers)1010
94 y Fn(The)13 b(pro)q(cessor)i(incorp)q(orates)f(a)f(n)o(um)o(b)q(er)f(of)g
(sixteen)i(bit)1010 144 y(registers)k(of)e(whic)o(h)g(eigh)o(t)h(are)g
(accessible)h(at)e(an)o(y)g(time)1010 194 y(as)g(\\general)g(registers".)26
b(These)17 b(are)g(kno)o(wn)e(as)h(r0,)h(r1,)1010 244 y(r2,)c(r3,)h(r4,)f
(r5,)g(r6)h(and)g(r7.)1072 294 y(The)d(\014rst)g(six)f(of)g(the)h(general)g
(registers)g(are)g(a)o(v)n(ailable)1010 344 y(for)k(use)i(as)f(accum)o
(ulators,)f(address)i(p)q(oin)o(ters)f(or)g(index)1010 394
y(registers.)31 b(The)18 b(con)o(v)o(en)o(tion)f(in)g(UNIX)h(for)f(the)h(use)
h(of)1010 444 y(these)c(registers)h(is)d(as)h(follo)o(ws:)1010
537 y Fi(r0,)i(r1)k Fn(are)13 b(used)h(as)f(temp)q(orary)f(accum)o(ulators)g
(during)1114 587 y(expression)f(ev)n(aluation,)e(to)h(return)h(results)g
(from)d(a)1114 637 y(pro)q(cedure,)13 b(and)e(in)g(some)g(cases)i(to)e(comm)o
(unicate)1114 687 y(actual)i(parameters)h(during)g(a)f(pro)q(cedure)j(call;)
1010 772 y Fi(r2,)g(r3,)f(r4)21 b Fn(are)15 b(used)h(for)f(lo)q(cal)g(v)n
(ariables)f(during)h(pro-)1114 822 y(cedure)23 b(execution.)44
b(Their)22 b(v)n(alues)g(are)h(almost)1114 871 y(alw)o(a)o(ys)15
b(stored)j(up)q(on)e(pro)q(cedure)i(en)o(try)m(,)f(and)g(re-)1114
921 y(stored)d(up)q(on)g(pro)q(cedure)i(exit;)1010 1006 y Fi(r5)k
Fn(is)10 b(used)h(as)f(the)h(head)f(p)q(oin)o(ter)h(to)f(a)f(\\dynamic)g(c)o
(hain")1114 1056 y(of)15 b(pro)q(cedure)i(activ)n(ation)d(records)k(stored)e
(in)f(the)1114 1106 y(curren)o(t)j(stac)o(k.)27 b(It)17 b(is)f(referred)j(to)
e(as)f(the)i(\\en)o(vi-)1114 1156 y(ronmen)o(t)13 b(p)q(oin)o(ter".)1072
1249 y(The)j(last)e(t)o(w)o(o)h(of)f(the)i(\\general)f(registers")h(do)f(ha)o
(v)o(e)1010 1299 y(a)c(sp)q(ecial)h(signi\014cance)h(and)e(are)i(to)e(all)g
(in)o(ten)o(ts,)h(\\sp)q(ecial)1010 1349 y(purp)q(ose":)1010
1443 y Fi(r6)20 b Fn(\(also)28 b(kno)o(wn)f(as)h(\\sp"\))g(is)g(used)h(as)f
(the)h(stac)o(k)1114 1492 y(p)q(oin)o(ter.)36 b(The)21 b(PDP11/40)d(pro)q
(cessor)k(incorp)q(o-)1114 1542 y(rates)i(t)o(w)o(o)f(separate)i(registers)g
(whic)o(h)e(ma)o(y)e(b)q(e)1114 1592 y(used)15 b(as)f(\\sp",)g(dep)q(ending)h
(on)f(whether)i(the)f(pro-)1114 1642 y(cessor)e(is)e(in)h(k)o(ernel)g(or)f
(user)i(mo)q(de.)j(No)c(other)g(one)1114 1692 y(of)17 b(the)i(general)g
(registers)h(is)e(duplicated)g(in)g(this)1114 1741 y(w)o(a)o(y;)1010
1827 y Fi(r7)i Fn(\(also)g(kno)o(wn)f(as)i(\\p)q(c"\))f(is)g(used)h(as)f(the)
h(program)1114 1877 y(instruction)14 b(address)h(register.)1010
1996 y Fg(2.4)55 b(Instruction)19 b(Set)1010 2073 y Fn(The)d(PDP11)f
(instruction)h(set)h(includes)f(double,)f(single)1010 2123
y(and)i(zero)h(op)q(erand)g(instructions.)28 b(Instruction)18
b(length)1010 2173 y(is)f(usually)f(one)i(w)o(ord,)f(with)g(some)f
(instructions)i(b)q(eing)1010 2223 y(extended)c(to)f(t)o(w)o(o)f(or)h(three)h
(w)o(ords)f(with)g(additional)d(ad-)1010 2273 y(dressing)15
b(information.)1072 2323 y(With)i(single)g(op)q(erand)i(instructions,)f(the)h
(op)q(erand)1010 2373 y(is)24 b(usually)f(called)h(the)g(\\destination";)k
(with)c(double)1010 2423 y(op)q(erand)18 b(instructions,)h(the)f(t)o(w)o(o)f
(op)q(erands)h(are)g(called)1010 2472 y(the)12 b(\\source")g(and)f
(\\destination".)16 b(The)c(v)n(arious)f(mo)q(des)1010 2522
y(of)i(addressing)i(are)f(describ)q(ed)i(later.)1072 2573 y(The)11
b(follo)o(wing)d(instructions)k(ha)o(v)o(e)e(b)q(een)i(used)f(in)f(the)1010
2622 y(\014le)15 b(\\m40.s")e(i.e.)21 b(the)16 b(\014le)f(of)g(assem)o(bly)f
(language)g(sup-)1010 2672 y(p)q(ort)c(routines)g(for)f(use)h(with)f(the)h
(11/40)e(pro)q(cessor.)19 b(Note)1010 2722 y(that)12 b(N,)g(Z,)f(V)i(and)e(C)
h(are)h(the)g(condition)e(co)q(des)i(i.e.)k(bits)1010 2772
y(in)12 b(the)i(pro)q(cessor)h(status)e(w)o(ord)g(\(\\ps"\),)g(and)g(that)g
(these)1010 2822 y(are)j(set)g(as)f(side)h(e\013ects)h(of)e(man)o(y)f
(instructions)i(b)q(esides)-30 2946 y(4)p eop
%%Page: 5 13
12 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)968
b(2)42 b(FUND)o(AMENT)m(ALS)-30 17 y Fn(just)14 b(\\bit",)d(\\cmp")h(and)h
(\\tst")g(\(whose)g(stated)h(function)-30 66 y(is)g(to)g(set)h(the)f
(condition)f(co)q(des\).)-30 155 y Fi(adc)21 b Fn(Add)15 b(the)h(con)o(ten)o
(ts)g(of)f(the)g(C)g(bit)g(to)g(the)h(destina-)74 205 y(tion;)-30
287 y Fi(add)k Fn(Add)15 b(the)f(source)h(to)f(the)g(destination;)-30
369 y Fi(ash)21 b Fn(Shift)c(the)h(con)o(ten)o(ts)h(of)f(the)g(de\014ned)h
(register)g(left)74 418 y(the)k(n)o(um)o(b)q(er)f(of)g(times)g(sp)q
(eci\014ed)i(b)o(y)e(the)h(shift)74 468 y(coun)o(t.)53 b(\(A)26
b(negativ)o(e)g(v)n(alue)e(implies)g(a)h(righ)o(t)74 518 y(shift.\);)-30
600 y Fi(ashc)c Fn(Similar)9 b(to)i(\\ash")g(except)i(that)e(t)o(w)o(o)g
(registers)i(are)74 650 y(in)o(v)o(olv)o(ed;)-30 732 y Fi(asl)21
b Fn(Shift)c(all)g(bits)h(one)h(place)f(to)g(the)h(left.)30
b(Bit)18 b(0)g(b)q(e-)74 782 y(comes)c(0)f(and)h(bit)g(15)f(is)h(loaded)f(in)
o(to)g(C;)-30 863 y Fi(asr)21 b Fn(Shift)15 b(all)g(bits)h(one)g(place)g(to)g
(the)h(righ)o(t.)23 b(Bit)16 b(15)g(is)74 913 y(replicated)f(and)e(bit)h(0)g
(is)f(loaded)h(in)o(to)f(C;)-30 995 y Fi(b)q(eq)21 b Fn(Branc)o(h)15
b(if)e(eaual,)g(i.e.)k(if)c(Z)i(=)f(l;)-30 1077 y Fi(bge)20
b Fn(Branc)o(h)15 b(if)e(greater)i(than)f(or)g(equal)f(to,)h(i.e.)j(if)74
1127 y(N)d(=)g(V;)-30 1209 y Fi(bhi)20 b Fn(Branc)o(h)14 b(if)f(higher,)h
(i.e)f(if)g(C)h(=)g(0)g(and)f(Z)i(=)f(0;)-30 1291 y Fi(bhis)19
b Fn(Branc)o(h)c(if)e(higher)h(or)g(the)g(same,)f(i.e.)k(if)c(C)h(=)g(0;)-30
1373 y Fi(bic)20 b Fn(Clear)d(eac)o(h)g(bit)f(to)g(zero)i(in)e(the)h
(destination)g(that)74 1422 y(corresp)q(onds)f(to)e(a)f(non-zero)i(bit)e(in)h
(the)g(source;)-30 1504 y Fi(bis)20 b Fn(P)o(erform)14 b(an)h(\\inclusiv)o(e)
g(or")f(of)h(source)h(and)f(desti-)74 1554 y(nation)c(and)h(store)h(the)g
(result)f(in)g(the)g(destination;)-30 1636 y Fi(bit)20 b Fn(P)o(erform)12
b(a)i(logical)d(\\and")i(of)g(the)i(source)g(and)e(des-)74
1686 y(tination)g(to)h(set)h(the)f(condition)f(co)q(des;)-30
1768 y Fi(ble)20 b Fn(Branc)o(h)14 b(if)f(greater)i(than)e(or)h(equal)f(to,)g
(i.e)g(if)g(Z)h(=)g(1)74 1818 y(or)g(N)g(=)g(V;)-30 1900 y
Fi(blo)20 b Fn(Branc)o(h)15 b(if)e(lo)o(w)o(er)g(\(than)h(zero\),)h(if)e(C)g
(=)i(l;)-30 1981 y Fi(bne)20 b Fn(Branc)o(h)15 b(if)e(not)h(equal)f(\(to)h
(zero\),)h(i.e.)i(if)c(Z)h(=)g(0;)-30 2063 y Fi(br)20 b Fn(Branc)o(h)15
b(to)f(a)f(lo)q(cation)g(within)h(the)g(range)g(\(.)g(-128,)74
2113 y(.)g(+127\))f(where)i(\\.")j(is)13 b(the)i(curren)o(t)g(lo)q(cation;)
-30 2195 y Fi(clc)21 b Fn(Clear)14 b(C;)-30 2277 y Fi(clr)20
b Fn(Clear)14 b(destination)g(to)g(zero;)-30 2359 y Fi(cmp)21
b Fn(Compare)8 b(the)i(source)g(and)g(destination)f(to)g(set)h(the)74
2409 y(condition)16 b(co)q(des.)27 b(N)16 b(is)h(set)g(if)f(the)h(source)g(v)
n(alue)74 2459 y(is)d(less)h(than)e(the)i(destination)f(v)n(alue;)-30
2540 y Fi(dec)21 b Fn(Subtract)13 b(one)f(from)f(the)i(con)o(ten)o(ts)g(of)f
(the)h(destina-)74 2590 y(tion;)-30 2672 y Fi(div)20 b Fn(The)14
b(32)f(bit)f(t)o(w)o(o's)h(complemen)o(t)e(in)o(teger)j(stored)g(in)74
2722 y(rn)g(and)f(r\(n+l\))h(\(where)h(n)f(is)f(ev)o(en\))h(is)g(divided)f(b)
o(y)74 2772 y(the)f(source)g(op)q(erand.)18 b(The)11 b(quotien)o(t)g(is)g
(left)g(in)g(rn,)74 2822 y(and)j(the)g(remainder)g(in)f(r\(n+l\);)1010
17 y Fi(inc)20 b Fn(Add)14 b(one)g(to)g(the)g(con)o(ten)o(ts)h(of)e(the)i
(destination;)1010 106 y Fi(jmp)k Fn(Jump)13 b(to)h(the)h(destination;)1010
195 y Fi(jsr)20 b Fn(Jump)15 b(to)g(subroutine.)25 b(Register)16
b(v)n(alues)g(are)g(sh)o(uf-)1114 245 y(\015ed)e(as)g(follo)o(ws:)1114
314 y(p)q(c,)g(rn,)f({\(sp\))i(=)f(dest.,)g(p)q(c,)g(rn)1010
404 y Fi(mfpi)19 b Fn(Push)c(on)o(to)e(the)i(curren)o(t)h(stac)o(k)e(the)h(v)
n(alue)f(of)f(the)1114 454 y(designated)24 b(w)o(ord)f(in)g(the)h
(\\previous")g(address)1114 503 y(space;)1010 593 y Fi(mo)o(v)c
Fn(Cop)o(y)14 b(the)g(source)h(v)n(alue)e(to)h(the)h(destination;)1010
682 y Fi(m)o(tpi)j Fn(P)o(op)c(the)h(curren)o(t)g(stac)o(k)g(and)f(store)h
(the)f(v)n(alue)g(in)1114 732 y(the)c(designated)h(w)o(ord)f(in)f(the)i
(\\previous")f(address)1114 781 y(space;)1010 871 y Fi(m)o(ul)19
b Fn(Multiply)11 b(the)j(con)o(ten)o(ts)g(of)e(rn)h(and)g(the)g(source.)19
b(If)1114 921 y(n)12 b(is)g(ev)o(en,)g(the)h(pro)q(duct)g(is)f(left)f(in)h
(rn)g(and)g(r\(n+l\);)1010 1010 y Fi(reset)19 b Fn(Set)d(the)g(INIT)f(line)g
(on)g(the)h(Unibus)f(for)g(10)g(mil-)1114 1060 y(liseconds.)30
b(This)18 b(will)e(ha)o(v)o(e)i(the)h(e\013ect)g(of)e(reini-)1114
1109 y(tialising)12 b(all)g(the)j(device)g(con)o(trollers;)1010
1199 y Fi(ror)20 b Fn(Rotate)15 b(all)e(bits)j(of)e(the)i(destination)f(one)g
(place)g(to)1114 1248 y(the)21 b(righ)o(t.)37 b(Bit)21 b(0)f(is)g(loaded)g
(in)o(to)g(C,)g(and)g(the)1114 1298 y(previous)14 b(v)n(alue)f(of)g(C)h(is)g
(loaded)f(in)o(to)h(bit)f(15;)1010 1388 y Fi(rts)20 b Fn(Return)f(from)e
(subroutine.)33 b(Reload)17 b(p)q(c)i(from)e(rn,)1114 1437
y(and)c(reload)h(rn)g(from)e(the)j(stac)o(k;)1010 1527 y Fi(rtt)k
Fn(Return)13 b(from)e(in)o(terrupt)i(or)g(trap.)k(Reload)12
b(b)q(oth)g(p)q(c)1114 1576 y(and)h(ps)i(from)d(the)i(stac)o(k;)1010
1666 y Fi(sb)q(c)20 b Fn(Subtract)15 b(the)g(carry)f(bit)g(from)e(the)i
(destination;)1010 1755 y Fi(sob)20 b Fn(Subtract)d(one)f(from)e(the)j
(designated)g(register.)25 b(If)1114 1805 y(the)20 b(result)h(is)f(not)g
(zero,)h(branc)o(h)g(bac)o(k)f(\\o\013set")1114 1855 y(w)o(ords;)1010
1944 y Fi(sub)f Fn(Subtract)c(the)g(source)g(from)d(the)j(destination;)1010
2033 y Fi(sw)o(ab)20 b Fn(Exc)o(hange)g(the)h(high)e(and)g(lo)o(w)g(order)h
(b)o(ytes)h(in)1114 2083 y(the)14 b(destination;)1010 2172
y Fi(tst)20 b Fn(Set)13 b(the)h(condition)f(co)q(des,)h(N)g(and)f(Z,)g
(according)g(to)1114 2222 y(the)h(con)o(ten)o(ts)h(of)e(the)i(destination;)
1010 2311 y Fi(w)o(ait)20 b Fn(Idle)12 b(the)h(pro)q(cessor)h(and)e(release)i
(the)f(Unibus)f(un-)1114 2361 y(til)h(a)g(hardw)o(are)i(in)o(terrupt)f(o)q
(ccurs.)1072 2458 y(The)f(\\b)o(yte")g(v)o(ersion)f(of)g(the)h(follo)o(wing)d
(instructions)1010 2508 y(are)15 b(used)h(in)f(the)g(\014le)g(\\m40.s",)e(as)
i(w)o(ell)f(as)h(the)h(\\w)o(ord")1010 2558 y(v)o(ersions)e(describ)q(ed)i
(ab)q(o)o(v)o(e:)1260 2657 y(bis)264 b(inc)1260 2707 y(clr)269
b(mo)o(v)1260 2757 y(cmp)238 b(tst)1910 2946 y(5)p eop
%%Page: 6 14
13 bop -30 -144 a Fk(2)43 b(FUND)o(AMENT)m(ALS)968 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fg(2.5)56 b(Addressing)19
b(Mo)r(des)-30 98 y Fn(Muc)o(h)c(of)f(the)h(no)o(v)o(elt)o(y)e(and)h
(complexit)o(y)f(of)g(the)i(PDP11)-30 148 y(instruction)26
b(set)g(lies)g(in)f(the)g(v)n(ariet)o(y)g(of)g(addressing)-30
197 y(mo)q(des)17 b(whic)o(h)g(ma)o(y)f(b)q(e)i(used)g(for)f(de\014ning)g
(the)h(source)-30 247 y(and)c(destination)g(op)q(erands.)33
300 y(The)9 b(addressing)h(mo)q(des)f(whic)o(h)g(are)h(used)g(in)f(\\m40.s")
-30 349 y(are)15 b(describ)q(ed)g(b)q(elo)o(w.)-30 451 y Fi(Register)f(Mo)q
(de:)21 b Fn(The)i(op)q(erand)f(resides)i(in)d(one)h(of)74
500 y(the)15 b(general)f(registers,)h(e.g.)161 621 y Ff(clr)22
b(r0)161 671 y(mov)g(rl,r0)161 720 y(add)g(r4,r2)74 841 y Fn(In)15
b(the)g(follo)o(wing)d(mo)q(des,)i(the)h(designated)h(regis-)74
890 y(ter)d(con)o(tains)f(an)g(address)h(v)n(alue)e(whic)o(h)h(is)g(used)h
(to)74 940 y(lo)q(cate)h(the)h(op)q(erand.)-30 1033 y Fi(Register)f(Deferred)
g(Mo)q(de:)21 b Fn(The)13 b(register)h(con)o(tains)74 1083
y(the)h(address)g(of)e(the)i(op)q(erand,)f(e.g.)161 1203 y
Ff(inc)22 b(\(rl\))161 1253 y(asr)g(\(sp\))161 1303 y(add)g(\(r2\),rl)-30
1423 y Fi(Autoincremen)o(t)12 b(Mo)q(de:)21 b Fn(The)10 b(register)g(con)o
(tains)g(the)74 1473 y(address)17 b(of)e(the)h(op)q(erand.)23
b(As)16 b(a)f(side)h(e\013ect,)h(the)74 1523 y(register)23
b(is)f(incremen)o(ted)g(after)h(the)f(op)q(eration,)74 1573
y(e.g.)161 1693 y Ff(clr)43 b(\(rl\)+)161 1743 y(mfpi)21 b(\(r0\)+)161
1793 y(mov)43 b(\(r1\)+,r0)161 1842 y(mov)g(r2,\(r0\)+)161
1892 y(cmp)22 b(\(sp\)+,\(sp\)+)-30 2012 y Fi(Auto)q(decremen)o(t)13
b(Mo)q(de:)21 b Fn(The)10 b(register)g(is)g(decremen)o(ted)74
2062 y(and)k(then)h(op)q(erand,)e(e.g.)161 2183 y Ff(inc)22
b(-\(r0\))161 2232 y(mov)g(-\(r1\),r2)161 2282 y(mov)g(\(r0\)+,-\(sp\))161
2332 y(clr)g(-\(sp\))-30 2452 y Fi(Index)16 b(Mo)q(de:)21 b
Fn(The)12 b(register)h(con)o(tains)f(a)g(v)n(alue)g(whic)o(h)74
2502 y(is)18 b(added)f(to)h(a)f(sixteen)h(bit)f(w)o(ord)g(follo)o(wing)e(the)
74 2552 y(instruction)f(to)g(form)e(the)j(op)q(erand)f(address,)h(e.g.)161
2672 y Ff(clr)43 b(2\(r0\))161 2722 y(movb)21 b(6\(sp\),\(sp\))161
2772 y(movb)g(_reloc\(r0\),r0)161 2822 y(mov)43 b(-10\(r2\),\(rl\))1114
17 y Fn(Dep)q(ending)18 b(on)g(y)o(our)g(viewp)q(oin)o(t,)h(in)f(this)g(mo)q
(de)1114 66 y(the)i(register)h(is)f(either)h(an)f(index)g(register)h(or)f(a)
1114 116 y(base)g(register.)36 b(The)20 b(latter)f(case)i(actually)d(pre-)
1114 166 y(dominates)i(in)i(\\m40.s".)40 b(The)22 b(third)g(example)1114
216 y(ab)q(o)o(v)o(e)12 b(is)h(actually)f(one)h(of)g(the)g(few)h(uses)g(of)e
(a)h(reg-)1114 266 y(ister)g(as)f(an)g(index)h(register.)19
b(\(Note)13 b(that)f(\\)p 1811 266 13 2 v 15 w(relo)q(c")1114
316 y(is)h(an)h(acceptable)h(v)n(ariable)e(name.\))1114 380
y(There)h(are)g(t)o(w)o(o)f(addressing)h(mo)q(des)e(whose)i(use)g(is)1114
430 y(limited)d(to)j(the)h(follo)o(wing)c(t)o(w)o(o)i(examples:)1201
528 y Ff(jsr)21 b(pc,\(r0\)+)1201 578 y(jmp)g(*0f\(r0\))1114
676 y Fn(The)12 b(\014rst)h(example)e(in)o(v)o(olv)o(es)h(the)g(use)i(of)d
(the)i(\\)p Fk(au-)1114 726 y(toincr)n(ement)i(deferr)n(e)n(d)p
Fn(")f(mo)q(de.)21 b(\(This)15 b(o)q(ccurs)i(in)1114 776 y(the)g(routine)f
(\\call")g(on)g(lines)g(0785,)g(0799.\))25 b(The)1114 825 y(address)14
b(of)f(a)h(routine)f(in)o(tended)i(for)e(execution)h(is)1114
875 y(to)g(b)q(e)i(found)e(in)g(the)i(w)o(ord)e(addressed)j(b)o(y)e(r0,)f
(i.e.)1114 925 y(t)o(w)o(o)9 b(lev)o(els)g(of)g(indirection)g(are)h(in)o(v)o
(olv)o(ed.)15 b(The)10 b(fact)1114 975 y(that)16 b(r0)g(is)g(incremen)o(ted)h
(as)f(a)g(side)g(e\013ect)i(is)e(not)1114 1025 y(relev)n(an)o(t)e(in)f(this)h
(usage.)1114 1089 y(The)20 b(second)g(example)e(\(whic)o(h)i(o)q(ccurs)h(on)e
(lines)1114 1139 y(1055,)e(1066\))f(is)i(an)f(instance)h(of)f(the)h(\\)p
Fk(index)h(de-)1114 1189 y(ferr)n(e)n(d)p Fn(")12 b(mo)q(de.)17
b(The)d(destination)f(of)g(the)h(\\jump")1114 1239 y(is)k(the)h(con)o(ten)o
(t)g(of)f(the)h(w)o(ord)f(whose)h(address)h(is)1114 1289 y(lab)q(elled)14
b(b)o(y)g(\\0f)s(")g Fk(plus)h Fn(the)g(v)n(alue)f(of)g(r0)h(\(a)f(small)1114
1339 y(p)q(ositiv)o(e)i(in)o(teger\).)29 b(This)17 b(is)g(a)f(standard)i(w)o
(a)o(y)e(to)1114 1388 y(implem)o(en)o(t)c(a)h(m)o(ulti-w)o(a)o(y)e(switc)o
(h.)1114 1453 y(The)23 b(follo)o(wing)d(t)o(w)o(o)j(mo)q(des)f(use)i(the)g
(program)1114 1503 y(coun)o(ter)16 b(as)g(the)h(designated)f(register)h(to)f
(ac)o(hiev)o(e)1114 1553 y(certain)e(sp)q(ecial)g(e\013ects.)1010
1632 y Fi(Immediate)g(Mo)q(de:)21 b Fn(This)15 b(is)g(the)h(p)q(c)g
(autoincremen)o(t)1114 1682 y(mo)q(de.)f(The)10 b(op)q(erand)g(is)f(th)o(us)h
(extracted)h(from)c(the)1114 1732 y(program)k(string,)i(i.e.)18
b(it)12 b(b)q(ecomes)i(an)f(immediate)1114 1782 y(op)q(erand,)h(e.g.)1201
1880 y Ff(add)21 b($2,r0)1201 1930 y(add)g($2,\(rl\))1201 1980
y(bic)g($17,r0)1201 2029 y(mov)g($KISA0,r0)1201 2079 y(mov)g($77406,\(rl\)+)
1010 2177 y Fi(Relativ)o(e)13 b(Mo)q(de:)21 b Fn(This)15 b(is)f(the)h(p)q(c)g
(index)g(mo)q(de.)k(The)1114 2227 y(address)10 b(relativ)o(e)f(to)g(the)h
(curren)o(t)h(program)d(coun)o(ter)1114 2277 y(v)n(alue)20
b(is)i(extracted)h(from)c(the)j(program)e(string)1114 2327
y(and)f(added)h(to)f(the)h(p)q(c)g(v)n(alue)f(to)h(form)d(the)j(ab-)1114
2376 y(solute)14 b(address)h(of)e(the)i(op)q(erand,)f(e.g.)1201
2474 y Ff(bic)21 b($340,PS)1201 2524 y(bit)g($l,SSR0)1201 2574
y(inc)g(SSR0)1201 2624 y(mov)g(\(sp\),KISA6)1072 2722 y Fn(It)f(ma)o(y)e(b)q
(e)i(noted)g(that)g(eac)o(h)g(of)f(the)i(mo)q(des)e(\\in-)1010
2772 y(dex",)11 b(\\index)f(deferred",)j(\\imm)o(ediate")8
b(and)j(\\relativ)o(e")1010 2822 y(extends)k(the)g(instruction)f(size)g(b)o
(y)g(one)g(w)o(ord.)-30 2946 y(6)p eop
%%Page: 7 15
14 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)968
b(2)42 b(FUND)o(AMENT)m(ALS)33 17 y Fn(The)15 b(existence)h(of)e(the)h
(\\autoincremen)o(t")f(and)g(\\au-)-30 66 y(to)q(decremen)o(t")i(mo)q(des,)e
(together)i(with)f(the)h(sp)q(ecial)f(at-)-30 116 y(tributes)d(of)e(r6,)g
(mak)o(e)f(it)h(con)o(v)o(enien)o(tly)h(p)q(ossible)f(to)h(store)-30
166 y(man)o(y)d(op)q(erands)j(in)e(a)h(stac)o(k,)g(or)g(LIF)o(O)g(list,)f
(whic)o(h)h(gro)o(ws)-30 216 y(do)o(wn)o(w)o(ards)15 b(in)f(memory)m(.)j
(There)e(are)g(a)f(n)o(um)o(b)q(er)g(of)g(ad-)-30 266 y(v)n(an)o(tages)h
(whic)o(h)g(\015o)o(w)g(from)e(this:)20 b(co)q(de)c(string)f(lengths)-30
316 y(are)j(shorter)g(and)e(it)h(is)f(easier)i(to)f(write)g(p)q(osition)f
(inde-)-30 365 y(p)q(enden)o(t)g(co)q(de.)-30 481 y Fg(2.6)56
b(Unix)18 b(Assem)n(bler)-30 557 y Fn(The)c(UNIX)g(assem)o(bler)f(is)h(a)f(t)
o(w)o(o)g(pass)h(assem)o(bler)f(with-)-30 607 y(out)23 b(macro)f(facilities.)
44 b(A)23 b(full)f(description)h(ma)o(y)e(b)q(e)-30 657 y(found)14
b(in)f(the)h(\\UNIX)f(Assem)o(bler)h(Reference)h(Man)o(ual")-30
707 y(whic)o(h)f(is)g(con)o(tained)g(in)f(the)i(\\UNIX)f(Do)q(cumen)o(ts")33
757 y(The)h(follo)o(wing)c(brief)j(notes)i(should)e(b)q(e)h(of)e(some)h(as-)
-30 806 y(sistance:)-30 893 y Fi(\(a\))21 b Fn(a)16 b(string)h(of)f(digits)g
(ma)o(y)e(de\014ne)k(a)e(constan)o(t)h(n)o(um-)74 943 y(b)q(er.)25
b(This)16 b(is)g(assumed)g(to)f(b)q(e)i(an)f(o)q(ctal)f(n)o(um)o(b)q(er)74
993 y(unless)21 b(the)g(string)f(is)g(terminated)g(b)o(y)f(a)h(p)q(erio)q(d)
74 1042 y(\(\\."\),)10 b(when)h(it)e(is)h(in)o(terpreted)i(as)e(a)g(decimal)e
(n)o(um-)74 1092 y(b)q(er.)-30 1173 y Fi(\(b\))20 b Fn(The)e(c)o(haracter)g
(\\/")f(is)g(used)h(to)g(signify)e(that)h(the)74 1223 y(rest)e(of)f(the)g
(line)f(is)h(a)g(commen)o(t;)-30 1304 y Fi(\(c\))21 b Fn(If)16
b(t)o(w)o(o)h(or)g(more)g(statemen)o(ts)g(o)q(ccur)i(on)e(the)h(same)74
1354 y(line,)13 b(they)i(m)o(ust)d(b)q(e)j(separated)g(b)o(y)f(semicolons;)
-30 1435 y Fi(\(d\))20 b Fn(The)11 b(c)o(haracter)h(\\.")k(is)11
b(used)g(to)g(denote)g(the)g(curren)o(t)74 1485 y(lo)q(cation;)-30
1566 y Fi(\(e\))20 b Fn(UNIX)14 b(assem)o(bler)f(uses)h(the)g(c)o(haracters)h
($)e(and)g(\\*")74 1616 y(where)i(the)g(DEC)f(assem)o(blers)g(use)h(\\#")e
(and)h(\\@")74 1666 y(resp)q(ectiv)o(ely)m(.)-30 1747 y Fi(\(f)5
b(\))19 b Fn(An)d(iden)o(ti\014er)g(consists)h(of)e(a)g(set)h(of)f(alphan)o
(umeric)74 1797 y(c)o(haracters)20 b(\(including)d(the)h(underscore\).)32
b(Only)74 1847 y(the)19 b(\014rst)g(eigh)o(t)f(c)o(haracters)i(are)f
(signi\014can)o(t)f(and)74 1896 y(the)d(\014rst)f(ma)o(y)e(not)i(b)q(e)h(n)o
(umeric;)-30 1978 y Fi(\(g\))20 b Fn(Names)15 b(whic)o(h)g(o)q(ccur)i(in)e
(\\C")g(programs)g(for)g(v)n(ari-)74 2027 y(ables)24 b(whic)o(h)f(are)g(to)g
(b)q(e)h(kno)o(wn)f(globally)m(,)f(are)74 2077 y(mo)q(di\014ed)10
b(b)o(y)g(the)i(addition)d(of)i(a)f(pre\014x)i(consisting)74
2127 y(of)i(a)h(single)f(underscore.)22 b(Th)o(us)15 b(for)g(example)e(the)74
2177 y(v)n(ariable)j(\\)p 256 2177 13 2 v 15 w(reglo)q(c")h(whic)o(h)f(o)q
(ccurs)j(on)d(line)h(1025)74 2227 y(in)d(the)h(assem)o(bly)d(language)i
(\014le,)f(\\m40.s",)e(refers)74 2276 y(to)k(the)h(same)e(v)n(ariable)g(as)h
(\\reglo)q(c")g(at)g(line)g(2677)74 2326 y(of)f(the)g(\014le,)f(\\trap.c";)
-30 2407 y Fi(\(h\))20 b Fn(There)13 b(are)g(t)o(w)o(o)f(kinds)g(of)g
(statemen)o(t)g(lab)q(els:)17 b(name)74 2457 y(lab)q(els)e(and)g(n)o(umeric)f
(lab)q(els.)21 b(The)15 b(latter)g(consist)74 2507 y(of)d(a)g(single)g(digit)
g(follo)o(w)o(ed)e(b)o(y)j(a)f(colon,)f(and)i(need)74 2557
y(not)f(b)q(e)h(unique.)18 b(A)12 b(reference)i(to)e(\\nf)s(")g(where)h(\\n")
74 2607 y(is)h(a)g(digit,)e(refers)k(to)e(the)g(\014rst)h(o)q(ccurrence)i(of)
c(the)74 2656 y(lab)q(el)h(\\n:")j(found)d(b)o(y)f(searc)o(hing)i(forw)o
(ard.)74 2722 y(A)e(reference)i(to)e(\\n)o(b")f(is)h(similar)d(except)k(that)
f(the)74 2772 y(searc)o(h)20 b(is)e(conducted)i(in)e(the)h(bac)o(kw)o(ards)g
(direc-)74 2822 y(tion;)1010 17 y Fi(\(i\))g Fn(An)14 b(assignmen)o(t)f
(statemen)o(t)h(of)f(the)h(form)1319 127 y(iden)o(ti\014er)g(=)g(expression)
1114 237 y(asso)q(ciates)j(a)g(v)n(alue)e Fi(and)h Fn(t)o(yp)q(e)h(with)f
(the)i(iden)o(ti-)1114 287 y(\014er.)g(In)c(the)h(example)1447
398 y(.)j(=)c(60)p Ff(^)p Fn(.)1114 508 y(the)g(op)q(erator)h(')p
Ff(^)p Fn(')d(deliv)o(ers)j(the)f(v)n(alue)f(of)h(the)g(\014rst)1114
558 y(op)q(erand)i(and)f(the)h(t)o(yp)q(e)h(of)e(the)h(second)h(op)q(erand)
1114 608 y(\(in)c(this)h(case,)h(\\lo)q(cation"\);)1010 693
y Fi(\(j\))k Fn(The)c(string)f(quote)g(sym)o(b)q(ols)e(are)i(\\)p
Fh(<)p Fn(")g(and)g(\\)p Fh(>)p Fn(".)1010 778 y Fi(\(k\))20
b Fn(Statemen)o(ts)14 b(of)f(the)i(form)1411 888 y(.globl)d(x,)h(y)m(,)g(z)
1114 998 y(serv)o(e)21 b(to)e(mak)o(e)g(the)h(names)f(\\x",)h(\\y")f(and)h
(\\z")1114 1048 y(external;)1010 1133 y Fi(\(l\))f Fn(The)26
b(names)g(\\)p 1341 1133 V 14 w(edata")g(and)g(\\)p 1615 1133
V 15 w(end")g(are)g(loader)1114 1183 y(pseudo)16 b(v)n(ariables)f(whic)o(h)h
(the)g(de\014ne)h(the)f(size)h(of)1114 1233 y(the)d(data)f(segmen)o(t,)g(and)
g(the)i(data)e(segmen)o(t)g(plus)1114 1283 y(the)h(bss)h(segmen)o(t)e(resp)q
(ectiv)o(ely)m(.)1010 1402 y Fg(2.7)55 b(Memory)17 b(Managemen)n(t)1010
1479 y Fn(Programs)e(running)i(on)f(the)i(PDP11)e(ma)o(y)f(address)j(di-)1010
1529 y(rectly)11 b(up)f(to)h(64K)f(b)o(ytes)h(\(32K)f(w)o(ords\))h(of)f
(storage.)17 b(This)1010 1579 y(is)i(consisten)o(t)h(with)f(an)g(address)h
(size)g(of)e(sixteen)i(bits.)1010 1628 y(Since)d(it)e(is)i(economical)d(and)i
(not)g(unreasonable)h(to)f(do)1010 1678 y(so)d(the)h(larger)e(PDP11)h(mo)q
(dels)f(ma)o(y)f(b)q(e)j(equipp)q(ed)f(with)1010 1728 y(larger)18
b(amoun)o(ts)f(of)g(memory)f(\(up)j(to)f(256K)f(b)o(ytes)i(for)1010
1778 y(the)i(PDP11/40\))f(plus)g(a)h(mec)o(hanism)d(for)i(con)o(v)o(erting)
1010 1828 y(sixteen)11 b(bit)f Fk(virtual)g Fn(\(program\))f(addresses)j(in)o
(to)e Fk(physic)n(al)1010 1878 y Fn(addresses)j(of)d(eigh)o(teen)h(bits)g(or)
g(more.)16 b(The)11 b(mec)o(hanism,)1010 1927 y(whic)o(h)16
b(is)g(kno)o(wn)g(as)h(the)g(memory)d(managemen)o(t)g(unit,)1010
1977 y(is)i(simpler)e(on)i(the)g(PDP11/40)f(than)h(on)g(the)g(11/45)f(or)1010
2027 y(the)f(11/70.)1072 2077 y(On)25 b(the)f(PDP11/40)f(the)i(memory)d
(managemen)o(t)1010 2127 y(unit)d(consists)h(of)e(t)o(w)o(o)h(sets)h(of)f
(registers)i(for)d(mapping)1010 2177 y(virtual)d(addresses)j(to)e(ph)o
(ysical)g(addresses.)27 b(These)18 b(are)1010 2227 y(kno)o(wn)c(as)h(\\activ)
o(e)g(page)g(registers")h(or)e(\\segmen)o(tation)1010 2277
y(registers".)32 b(One)18 b(set)h(is)f(used)h(when)g(the)f(pro)q(cessor)i(is)
1010 2326 y(in)f(user)i(mo)q(de)e(and)h(the)g(other)h(set,)h(in)d(k)o(ernel)i
(mo)q(de.)1010 2376 y(Changing)f(the)h(con)o(ten)o(ts)h(of)e(these)i
(registers)g(c)o(hanges)1010 2426 y(the)14 b(details)g(of)g(these)h
(mappings.)i(The)d(abilit)o(y)f(to)h(mak)o(e)1010 2476 y(these)h(c)o(hanges)g
(is)f(a)g(privilege)g(that)g(the)h(op)q(erating)f(sys-)1010
2526 y(tem)f(k)o(eeps)i(\014rmly)d(to)i(itself.)1010 2644 y
Fg(2.8)55 b(Segmen)n(tation)17 b(Registers.)1010 2722 y Fn(Eac)o(h)g(set)h
(of)f(segmen)o(tation)f(registers)j(is)e(comp)q(osed)g(of)1010
2772 y(eigh)o(t)e(pairs,)g(eac)o(h)h(consisting)f(of)f(a)h(\\)p
Fk(p)n(age)i(addr)n(ess)f(r)n(e)n(g-)1010 2822 y(ister)p Fn(")d(\(P)m(AR\))g
(and)h(a)f(\\)p Fk(description)i(r)n(e)n(gister)p Fn(")d(\(PDR\).)1910
2946 y(7)p eop
%%Page: 8 16
15 bop -30 -144 a Fk(2)43 b(FUND)o(AMENT)m(ALS)968 b(UNIX)14
b(6th)h(Edition)g(Commentary)33 17 y Fn(Eac)o(h)j(pair)f(of)g(registers)j
(con)o(trols)d(the)i(mapping)c(of)-30 66 y(one)g Fk(p)n(age)f
Fn(i.e.)k(one)c(eigh)o(th)g(part)g(of)g(the)g(virtual)f(address)-30
116 y(space)i(whic)o(h)f(8K)g(b)o(ytes)h(\(4K)f(w)o(ords\).)33
166 y(Eac)o(h)i(page)f(ma)o(y)e(b)q(e)k(regarded)f(as)g(an)f(aggregate)g(of)
-30 216 y(128)d(blo)q(c)o(ks,)g(eac)o(h)h(of)e(64)h(b)o(ytes)h(\(32)f(w)o
(ords\).)17 b(This)12 b(latter)-30 266 y(size)21 b(is)g(the)f(\\grain)g
(size")g(for)g(the)h(memory)d(mapping)-30 316 y(function,)d(and)g(as)h(a)f
(practical)g(consequence,)i(it)e(is)g(also)-30 365 y(the)g(\\grain)e(size")h
(for)g(memory)d(allo)q(cation.)33 415 y(An)o(y)25 b(virtual)f(address)i(b)q
(elongs)f(to)g(one)g(page)g(or)-30 465 y(other.)18 b(The)12
b(corresp)q(onding)f(ph)o(ysical)g(address)h(is)f(gener-)-30
515 y(ated)i(b)o(y)e(adding)h(the)g(relativ)o(e)g(address)h(within)e(the)i
(page)-30 565 y(to)j(the)g(con)o(ten)o(ts)h(of)e(the)h(corresp)q(onding)h(P)m
(AR)e(to)g(form)-30 614 y(an)d(extended)i(address)f(\(18)f(bits)g(on)f(the)i
(PDP11/40)e(and)-30 664 y(11/45;)i(22)g(bits)h(on)g(the)g(11/70\).)33
714 y(Th)o(us)i(eac)o(h)g(page)g(address)h(register)g(acts)f(as)g(a)g(relo-)
-30 764 y(cation)e(register)h(for)f(one)g(page.)33 814 y(Eac)o(h)g(page)g
(can)g(b)q(e)h(divided)f(on)g(a)f(32)h(w)o(ord)g(b)q(ound-)-30
863 y(ary)j(in)o(to)f(t)o(w)o(o)g(parts,)h(an)f(upp)q(er)i(part)e(and)h(lo)o
(w)o(er)f(part.)-30 913 y(Eac)o(h)f(suc)o(h)f(part)h(has)f(a)f(size)i(whic)o
(h)f(is)g(a)f(m)o(ultiple)f(of)h(32)-30 963 y(w)o(ords.)18
b(In)12 b(particular)f(one)h(part)g(ma)o(y)e(b)q(e)j(n)o(ull,)d(in)i(whic)o
(h)-30 1013 y(case)j(the)g(other)f(part)g(coincides)h(with)e(the)i(whole)f
(page.)33 1063 y(One)g(of)e(the)i(t)o(w)o(o)e(parts)i(is)f(deemed)g(to)g(con)
o(tain)f(v)n(alid)-30 1113 y(virtual)i(addresses.)22 b(Addresses)16
b(in)e(the)h(remaining)e(part)-30 1162 y(are)k(declared)g(in)o(v)n(alid.)23
b(An)o(y)17 b(attempt)e(to)h(reference)j(an)-30 1212 y(in)o(v)n(alid)f
(address)j(will)d(b)q(e)i(trapp)q(ed)h(b)o(y)e(the)i(hardw)o(are.)-30
1262 y(The)c(adv)n(an)o(tage)e(of)h(this)g(sc)o(heme)h(is)f(that)g(space)h
(in)f(the)-30 1312 y(ph)o(ysical)22 b(memory)e(need)k(only)d(b)q(e)i(allo)q
(cated)f(for)g(the)-30 1362 y(v)n(alid)13 b(r\)art)h(of)f(a)h(page.)-30
1477 y Fg(2.9)56 b(P)n(age)19 b(Description)f(Register)-30
1553 y Fn(The)d(page)f(description)g(register)h(de\014nes:)-30
1638 y Fi(\(a\))21 b Fn(the)e(size)g(of)g(the)g(lo)o(w)o(er)f(part)h(of)f
(the)i(page.)32 b(\(The)74 1688 y(n)o(um)o(b)q(er)18 b(stored)h(is)f
(actually)f(the)i(n)o(um)o(b)q(er)f(of)f(32)74 1737 y(w)o(ord)d(blo)q(c)o(ks)
g(less)g(one\);)-30 1818 y Fi(\(b\))20 b Fn(a)c(bit)g(whic)o(h)g(is)g(set)h
(when)g(the)g(upp)q(er)g(part)g(is)f(the)74 1867 y(v)n(alid)j(part.)36
b(\(Also)19 b(kno)o(wn)h(as)g(the)g(\\expansion)74 1917 y(direction")14
b(bit\);)-30 1998 y Fi(\(c\))21 b Fn(access)15 b(mo)q(de)e(bits)g(de\014ning)
h(\\no)f(access")i(or)e(\\read)74 2047 y(only)g(access")j(or)e(\\read/write)g
(access".)33 2132 y(Note)e(that)g(if)f(the)i(v)n(alid)e(part)h(is)g(n)o(ull,)
f(this)h(fact)g(m)o(ust)-30 2182 y(b)q(e)j(sho)o(wn)f(b)o(y)f(setting)i(the)f
(access)i(bits)e(to)f(\\no)h(access".)-30 2297 y Fg(2.10)56
b(Memory)17 b(Allo)r(cation)-30 2373 y Fn(The)k(hardw)o(are)g(do)q(es)g(not)g
(dictate)f(the)h(w)o(a)o(y)f(areas)h(in)-30 2423 y(ph)o(ysical)j(memory)e
(whic)o(h)i(corresp)q(ond)i(to)e(the)h(v)n(alid)-30 2473 y(parts)19
b(of)f(pages)g(should)h(b)q(e)f(allo)q(cated)g(\(except)i(to)e(the)-30
2523 y(exten)o(t)d(that)f(they)h(m)o(ust)e(b)q(egin)h(and)g(end)g(on)g(a)f
(32)h(w)o(ord)-30 2573 y(b)q(oundary\).)32 b(These)19 b(areas)g(ma)o(y)e(b)q
(e)i(allo)q(cated)e(in)h(an)o(y)-30 2622 y(order)d(and)f(ma)o(y)e(o)o(v)o
(erlap)h(to)h(an)o(y)f(exten)o(t.)33 2672 y(In)20 b(practice)h(the)f(allo)q
(cation)e(of)i(areas)g(of)f(ph)o(ysical)-30 2722 y(memory)d(is)j(m)o(uc)o(h)e
(more)h(disciplined)g(as)g(w)o(e)h(shall)e(see)-30 2772 y(in)i(Chapter)g(Sev)
o(en.)33 b(Areas)19 b(for)g(pages)g(whic)o(h)f(are)h(re-)-30
2822 y(lated)d(are)f(most)f(often)i(allo)q(cated)f(con)o(tiguously)f(and)h
(in)1010 17 y(the)21 b(order)g(of)f(their)i(page)e(n)o(um)o(b)q(ers,)i(so)e
(that)h(all)e(the)1010 66 y(segmen)o(t)12 b(areas)h(asso)q(ciated)g(with)f(a)
h(single)f(program)f(are)1010 116 y(con)o(tained)j(within)g(one)h(or)f(at)g
(most)g(t)o(w)o(o)g(large)g(areas)h(of)1010 166 y(ph)o(ysical)e(memory)m(.)
1010 282 y Fg(2.11)56 b(Memory)10 b(Managemen)n(t)h(Status)i(Reg-)1166
340 y(isters)1010 416 y Fn(In)19 b(addition)f(to)i(the)f(segmen)o(tation)g
(registers,)i(on)e(the)1010 466 y(PDP11/40)11 b(there)j(are)f(t)o(w)o(o)e
(memory)f(managemen)o(t)g(sta-)1010 516 y(tus)k(registers:)1010
604 y Fi(SR0)20 b Fn(con)o(tains)14 b(ab)q(ort)g(error)h(\015ags)g(and)f
(other)h(essen)o(tial)1114 654 y(information)9 b(for)j(the)h(op)q(erating)f
(system.)18 b(In)12 b(par-)1114 704 y(ticular)g(memory)e(managemen)o(t)g(is)j
(enabled)g(when)1114 754 y(bit)g(0)h(of)f(SR0)g(is)h(on;)1010
835 y Fi(SR2)20 b Fn(is)e(loaded)g(with)g(the)h(16)e(bit)h(virtual)g(address)
h(at)1114 885 y(the)14 b(b)q(eginning)f(of)h(eac)o(h)g(instruction)g(fetc)o
(h.)1010 1001 y Fg(2.12)56 b(\\i")18 b(and)h(\\d")g(Spaces)1010
1077 y Fn(In)13 b(the)h(PDP11/45)e(and)h(11/70)f(systems,)h(there)i(are)e
(ad-)1010 1127 y(ditional)j(sets)j(of)e(segmen)o(tation)g(registers.)32
b(Addresses)1010 1177 y(created)13 b(using)f(the)h(p)q(c)g(register)g(\(r7\))
f(are)h(said)e(to)h(b)q(elong)1010 1227 y(to)g(\\i")e(space,)j(and)f(are)g
(translated)h(b)o(y)e(a)h(di\013eren)o(t)h(set)g(of)1010 1277
y(segmen)o(tation)i(registers)j(from)d(those)j(used)f(for)f(the)i(re-)1010
1326 y(maining)12 b(addresses)17 b(whic)o(h)d(are)h(said)g(to)f(b)q(elong)h
(to)g(\\d")1010 1376 y(space.)1072 1426 y(The)e(adv)n(an)o(tage)f(of)g(this)h
(arrangemen)o(t)f(is)h(that)g(b)q(oth)1010 1476 y(\\i")i(and)i(\\d")f(spaces)
i(ma)o(y)c(o)q(ccup)o(y)j(up)g(to)f(32K)g(w)o(ords,)1010 1526
y(th)o(us)d(allo)o(wing)e(the)j(maxim)n(um)9 b(space)14 b(whic)o(h)f(can)g(b)
q(e)h(al-)1010 1575 y(lo)q(cated)i(to)h(a)f(program)f(to)h(b)q(e)h(increased)
g(to)g(t)o(wice)f(the)1010 1625 y(space)f(a)o(v)n(ailable)c(on)j(the)h
(PDP11/40.)1010 1741 y Fg(2.13)56 b(Initial)17 b(Conditions)1010
1817 y Fn(When)10 b(the)h(system)f(is)g(\014rst)h(started)h(after)e(all)f
(the)i(devices)1010 1867 y(on)j(the)h(Unibus)f(ha)o(v)o(e)g(b)q(een)i
(reinitialised,)d(the)i(memory)1010 1917 y(managemen)o(t)g(unit)i(is)g
(disabled)h(and)f(the)h(pro)q(cessor)h(is)1010 1967 y(in)13
b(k)o(ernel)i(mo)q(de.)1072 2017 y(Under)21 b(these)h(circumstances,)g
(virtual)d(\(b)o(yte\))h(ad-)1010 2067 y(dresses)13 b(in)e(the)h(range)g(0)f
(to)g(56K)g(are)h(mapp)q(ed)f(in)o(to)f(iden-)1010 2116 y(tically)e(v)n
(alued)h(ph)o(ysical)g(addresses.)18 b(Ho)o(w)o(ev)o(er)10
b(the)g(high-)1010 2166 y(est)i(page)f(of)g(the)h(virtual)e(address)j(space)f
(is)f(mapp)q(ed)g(in)o(to)1010 2216 y(the)k(highest)g(page)g(of)g(the)g(ph)o
(ysical)f(address)i(space,)g(i.e.)1010 2266 y(on)d(the)i(PDP11/40)e(or)h
(11/45,)e(addresses)k(in)d(the)i(range)1293 2354 y(0160000)d(to)i(0177777)
1010 2442 y(are)g(mapp)q(ed)f(in)o(to)g(the)i(range)1293 2530
y(0760000)d(to)i(0777777)1010 2645 y Fg(2.14)56 b(Sp)r(ecial)17
b(Device)g(Registers)1010 2722 y Fn(The)g(high)g(page)g(of)g(ph)o(ysical)f
(memory)f(is)i(reserv)o(ed)i(for)1010 2772 y(v)n(arious)11
b(sp)q(ecial)h(registers)h(asso)q(ciated)g(with)e(the)i(pro)q(ces-)1010
2822 y(sor)k(and)f(the)i(p)q(eripheral)f(devices.)27 b(By)17
b(sacri\014cing)g(one)-30 2946 y(8)p eop
%%Page: 9 17
16 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)968
b(2)42 b(FUND)o(AMENT)m(ALS)-30 17 y Fn(page)16 b(of)f(memory)d(space)17
b(in)e(this)g(w)o(a)o(y)m(,)f(the)i(PDP11)f(de-)-30 66 y(signers)i(ha)o(v)o
(e)f(b)q(een)i(able)e(to)g(mak)o(e)f(the)h(v)n(arious)g(device)-30
116 y(registers)c(accessible)g(without)e(the)h(need)g(to)g(pro)o(vide)f(sp)q
(e-)-30 166 y(cial)k(instruction)g(t)o(yp)q(es.)33 216 y(The)i(metho)q(d)e
(of)h(assignmen)o(t)g(of)f(addresses)k(to)d(reg-)-30 266 y(isters)22
b(in)d(this)h(page)g(is)g(a)g(blac)o(k)f(art:)31 b(the)21 b(v)n(alues)e(are)
-30 316 y(hallo)o(w)o(ed)11 b(b)o(y)h(tradition)f(and)h(are)g(not)g(to)g(b)q
(e)g(questioned.)1910 2946 y(9)p eop
%%Page: 10 18
17 bop -30 -144 a Fk(3)43 b(READING)16 b(\\C")f(PR)o(OGRAMS)777
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(3)70 b(Reading)22
b(\\C")g(Programs)-30 108 y Fn(Learning)14 b(to)g(read)h(programs)e(written)i
(in)e(the)i(\\C")f(lan-)-30 157 y(guage)h(is)f(one)h(of)f(the)h(h)o(urdles)g
(that)g(m)o(ust)e(b)q(e)i(o)o(v)o(ercome)-30 207 y(b)q(efore)g(y)o(ou)f(will)
f(b)q(e)i(able)e(to)h(study)h(the)g(source)g(co)q(de)g(of)-30
257 y(UNIX)g(e\013ectiv)o(ely)m(.)33 307 y(As)g(with)g(natural)f(languages,)h
(reading)f(is)h(an)g(easier)-30 357 y(skill)d(to)g(acquire)h(than)f(writing.)
17 b(Ev)o(en)c(so)g(y)o(ou)f(will)f(need)-30 406 y(to)19 b(b)q(e)g(careful)g
(lest)g(some)f(of)g(the)h(more)f(subtle)h(p)q(oin)o(ts)-30
456 y(pass)c(y)o(ou)e(b)o(y)m(.)33 506 y(There)g(are)f(t)o(w)o(o)g(of)g(the)g
(\\UNIX)g(Do)q(cumen)o(ts")g(whic)o(h)-30 556 y(relate)j(directly)f(to)g(the)
g(\\C")g(language:)33 606 y(\\C)f(Reference)j(Man)o(ual",)c(b)o(y)i(Dennis)g
(Ritc)o(hie)33 656 y(\\Programmi)o(ng)k(in)j(C)g({)g(A)h(T)m(utorial",)f(b)o
(y)g(Brian)-30 705 y(Kernighan)33 755 y(Y)m(ou)16 b(should)h(read)g(them)f
(no)o(w,)h(as)g(far)g(as)g(y)o(ou)f(can,)-30 805 y(and)f(return)i(to)e
(reread)h(them)e(from)g(time)f(to)i(time)f(with)-30 855 y(increasing)h
(comprehension.)33 905 y(Learning)c(to)h(write)g(\\C")f(programs)f(is)i(not)f
(required.)-30 954 y(Ho)o(w)o(ev)o(er)20 b(if)e(y)o(ou)g(ha)o(v)o(e)h(the)h
(opp)q(ortunit)o(y)m(,)e(y)o(ou)h(should)-30 1004 y(attempt)i(to)g(write)h
(at)f(least)g(a)g(few)g(small)e(programs.)-30 1054 y(This)i(do)q(es)g
(represen)o(t)i(the)e(accepted)h(w)o(a)o(y)d(to)i(learn)f(a)-30
1104 y(programming)11 b(language,)h(and)h(y)o(our)h(understanding)g(of)-30
1154 y(the)h(prop)q(er)g(use)g(of)e(suc)o(h)h(items)f(as:)33
1203 y(semicolons;)-30 1253 y(\\=")h(and)g(\\==")-30 1303 y(\\)p
Fl(f)p Fn(")g(and)f(\\)p Fl(g)p Fn(")-30 1353 y(\\++")h(and)g(\\)p
Fl(\000\000)p Fn(")-30 1403 y(declarations;)-30 1453 y(register)i(v)n
(ariables;)-30 1502 y(\\if)s(")d(and)h(\\for")f(statemen)o(ts)33
1602 y(Y)m(ou)g(will)e(\014nd)j(that)f(\\C")g(is)g(a)g(v)o(ery)h(con)o(v)o
(enien)o(t)g(lan-)-30 1652 y(guage)19 b(for)f(accessing)i(and)f(manipulating)
c(data)k(struc-)-30 1702 y(tures)f(and)f(c)o(haracter)h(strings,)f(whic)o(h)g
(is)f(what)h(a)f(large)-30 1751 y(part)22 b(of)e(op)q(erating)i(systems)f(is)
g(ab)q(out.)40 b(As)22 b(b)q(e\014ts)g(a)-30 1801 y(terminal)12
b(orien)o(ted)i(language,)e(whic)o(h)h(requires)h(concise,)-30
1851 y(compact)g(expression,)h(\\C")e(uses)j(a)d(large)h(c)o(haracter)i(set)
-30 1901 y(and)11 b(mak)o(es)e(man)o(y)f(sym)o(b)q(ols)h(suc)o(h)i(as)f(\\*")
g(and)g(\\&")g(w)o(ork)-30 1951 y(hard.)39 b(In)20 b(this)h(resp)q(ect)h(it)f
(in)o(vites)f(comparison)f(with)-30 2000 y(APL.)33 2050 y(There)c(man)o(y)e
(features)i(of)f(\\C")g(whic)o(h)g(are)h(reminis-)-30 2100
y(cen)o(t)h(of)e(PL/1,)g(but)h(it)f(go)q(es)h(w)o(ell)f(b)q(ey)o(ond)h(the)g
(latter)g(in)-30 2150 y(the)i(range)g(of)f(facilities)f(pro)o(vided)h(for)g
(structured)j(pro-)-30 2200 y(gramming.)-30 2316 y Fg(3.1)56
b(Some)17 b(Selected)g(Examples)-30 2393 y Fn(The)e(examples)e(whic)o(h)h
(follo)o(w)e(are)i(tak)o(en)g(directly)g(from)-30 2442 y(the)h(source)g(co)q
(de.)-30 2559 y Fg(3.2)56 b(Example)16 b(1)-30 2635 y Fn(The)f(simplest)f(p)q
(ossible)h(pro)q(cedure,)h(whic)o(h)f(do)q(es)g(noth-)-30 2685
y(ing,)e(o)q(ccurs)i(t)o(wice\(!\))k(in)13 b(the)h(source)h(co)q(de)g(as)f
(\\n)o(ullsys")-30 2735 y(\(2864\))g(and)f(\\n)o(ulldev")g(\(6577\),)g(sic.)
1053 17 y Ff(6577)21 b(nulldev)g(\(\))1162 66 y({)1162 116
y(})1072 215 y Fn(While)11 b(there)i(are)e(no)h(parameters,)f(the)h(paren)o
(theses,)1010 265 y(\\\(")d(and)h(\\\)",)f(are)h(still)f(required.)18
b(The)10 b(brac)o(k)o(ets)g(\\)p Fl(f)p Fn(")f(and)1010 314
y(\\)p Fl(g)p Fn(")k(delimit)f(the)i(pro)q(cedure)i(b)q(o)q(dy)m(,)d(whic)o
(h)h(is)f(empt)o(y)m(.)1010 440 y Fg(3.3)55 b(Example)17 b(2)1010
520 y Fn(The)d(next)h(example)d(is)i(a)f(little)h(less)g(trivial:)1053
620 y Ff(6566)21 b(nodev)g(\(\))1162 670 y({)1184 720 y(u.u_error)f(=)i
(ENODEV;)1162 769 y(})1072 868 y Fn(The)10 b(additional)d(statemen)o(t)i(is)h
(an)f(assignmen)o(t)f(state-)1010 918 y(men)o(t.)16 b(It)c(is)g(terminated)f
(b)o(y)h(a)f(semicolon)f(whic)o(h)i(is)g(part)1010 968 y(of)17
b(the)h(statemen)o(t,)f(not)h(a)f(statemen)o(t)g(separator)h(as)g(in)1010
1017 y(Algol-lik)o(e)11 b(languages.)1072 1069 y(\\ENODEV")16
b(is)f(a)g(de\014ned)h(sym)o(b)q(ol,)e(i.e.)22 b(a)15 b(sym)o(b)q(ol)1010
1119 y(whic)o(h)e(is)h(replaced)h(b)o(y)e(an)g(asso)q(ciated)i(c)o(haracter)g
(string)1010 1169 y(b)o(y)10 b(the)h(compiler)f(prepro)q(cessor)j(b)q(efore)e
(actual)g(compila-)1010 1218 y(tion.)16 b(\\ENODEV")10 b(is)g(de\014ned)h(on)
f(line)f(0484)g(as)h(19.)17 b(The)1010 1268 y(UNIX)d(con)o(v)o(en)o(tion)g
(is)g(that)g(de\014ned)h(sym)o(b)q(ols)e(are)h(writ-)1010 1318
y(ten)k(in)f(upp)q(er)i(case,)g(and)e(all)g(other)h(sym)o(b)q(ols)e(in)h(lo)o
(w)o(er)1010 1368 y(case.)1072 1419 y(\\=")11 b(is)f(the)i(assignmen)o(t)e
(op)q(erator,)h(and)g(\\u.u)p 1810 1419 13 2 v 14 w(error")1010
1469 y(is)i(an)h(elemen)o(t)f(of)g(the)h(structure)i(\\u".)i(\(See)c(line)f
(0419.\))1010 1519 y(Note)k(the)h(use)g(of)e(\\.")27 b(as)17
b(the)h(op)q(erator)f(whic)o(h)g(selects)1010 1569 y(an)i(elemen)o(t)g(of)g
(a)g(structure.)38 b(The)20 b(elemen)o(t)f(name)f(is)1010 1619
y(\\u)p 1056 1619 V 15 w(error")11 b(whic)o(h)f(ma)o(y)f(b)q(e)i(tak)o(en)g
(as)g(a)f(paradigm)e(for)i(the)1010 1668 y(w)o(a)o(y)h(names)g(of)h
(structure)i(elemen)o(ts)e(are)g(constructed)j(in)1010 1718
y(the)21 b(UNIX)f(source)h(co)q(de:)32 b(a)19 b(distinguishing)g(letter)i(is)
1010 1768 y(follo)o(w)o(ed)12 b(b)o(y)i(an)f(underscore)j(follo)o(w)o(ed)d(b)
o(y)g(a)h(name.)1010 1894 y Fg(3.4)55 b(Example)17 b(3)1053
1974 y Ff(6585)k(bcopy)g(\(from,)g(to,)g(count\))1162 2023
y(int)h(*from,)e(*to;)1162 2073 y({)1184 2123 y(register)g(*a,)h(*b,)h(c;)
1184 2173 y(a)g(=)f(from;)1184 2223 y(b)h(=)f(to;)1184 2273
y(c)h(=)f(count;)1184 2322 y(do)1228 2372 y(*b++)g(=)g(*a++;)1184
2422 y(while)g(\(--cc\);)1162 2472 y(})1072 2570 y Fn(The)12
b(function)g(of)f(this)h(pro)q(cedure)h(is)f(v)o(ery)g(simple:)j(it)1010
2620 y(copies)g(a)f(sp)q(eci\014ed)j(n)o(um)o(b)q(er)c(of)i(w)o(ords)f(from)f
(one)i(set)h(of)1010 2670 y(consecutiv)o(e)f(lo)q(cations)f(to)f(another)i
(set.)1072 2721 y(There)g(are)f(three)i(parameters.)i(The)c(second)h(line)
1075 2822 y Ff(int)21 b(*from,)g(*to;)-30 2946 y Fn(10)p eop
%%Page: 11 19
18 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)776
b(3)42 b(READING)16 b(\\C")f(PR)o(OGRAMS)-30 17 y Fn(sp)q(eci\014es)h(that)d
(the)i(\014rst)f(t)o(w)o(o)f(v)n(ariables)g(are)h(p)q(oin)o(ters)g(to)-30
66 y(in)o(tegers.)27 b(Since)16 b(no)h(sp)q(eci\014cation)g(is)f(supplied)g
(for)g(the)-30 116 y(third)g(parameter,)e(it)h(is)g(assumed)g(to)g(b)q(e)g
(an)g(in)o(teger)h(b)o(y)-30 166 y(default.)33 216 y(The)c(three)i(lo)q(cal)d
(v)n(ariables,)h(a,)g(b,)g(and)g(c,)g(ha)o(v)o(e)h(b)q(een)-30
266 y(assigned)g(to)e(registers,)j(b)q(ecause)f(registers)h(are)e(more)f(ac-)
-30 316 y(cessible)21 b(and)d(the)i(ob)r(ject)g(co)q(de)f(to)g(reference)j
(them)c(is)-30 365 y(shorter.)28 b(\\a")16 b(and)h(\\b")f(are)h(p)q(oin)o
(ters)h(to)e(in)o(tegers)i(and)-30 415 y(\\c")i(is)f(an)g(in)o(teger.)35
b(The)20 b(register)h(declaration)e(could)-30 465 y(ha)o(v)o(e)14
b(b)q(een)h(written)g(more)d(p)q(edan)o(tically)i(as)36 553
y Ff(register)20 b(int)h(*a,)g(*b,)h(c;)-30 642 y Fn(to)14
b(emphasise)g(the)g(connection)h(with)e(in)o(tegers.)33 692
y(The)j(three)h(lines)f(b)q(eginning)g(with)f(\\do")g(should)h(b)q(e)-30
742 y(studied)j(carefully)m(.)29 b(If)17 b(\\b")h(is)f(a)h(\\p)q(oin)o(ter)g
(to)f(in)o(teger")-30 791 y(t)o(yp)q(e,)d(then)58 880 y Ff(*b)-30
968 y Fn(denotes)19 b(the)f(in)o(teger)g(p)q(oin)o(ted)f(to.)29
b(Th)o(us)17 b(to)h(cop)o(y)f(the)-30 1018 y(v)n(alue)e(p)q(oin)o(ted)g(to)f
(b)o(y)h(\\a")f(to)h(the)g(lo)q(cation)f(designated)-30 1068
y(b)o(y)g(\\b",)f(w)o(e)h(could)g(write)58 1156 y Ff(*b)21
b(=)h(*a;)-30 1245 y Fn(If)14 b(w)o(e)g(wrote)h(instead)58
1333 y Ff(b)21 b(=)h(a;)33 1422 y Fn(this)17 b(w)o(ould)g(mak)o(e)f(the)i(v)n
(alue)e(of)h(\\b")g(the)h(same)f(as)-30 1472 y(the)h(v)n(alue)e(of)g(\\a",)g
(i.e.)26 b(\\b")16 b(and)h(\\a")f(w)o(ould)g(p)q(oin)o(t)g(to)-30
1521 y(the)h(same)f(place.)25 b(Here)17 b(at)g(least,)f(that)g(is)h(not)f
(what)g(is)-30 1571 y(required.)33 1621 y(Ha)o(ving)10 b(copied)i(the)g
(\014rst)g(w)o(ord)f(from)f(source)j(to)e(des-)-30 1671 y(tination,)i(w)o(e)h
(need)h(to)e(increase)i(the)g(v)n(alues)e(of)h(\\b")f(and)-30
1721 y(\\a")19 b(so)h(that)g(the)g(p)q(oin)o(t)f(to)g(the)h(next)h(w)o(ords)e
(of)g(their)-30 1770 y(resp)q(ectiv)o(e)d(sets.)k(This)13 b(can)i(b)q(e)f
(done)g(b)o(y)g(writing)58 1859 y Ff(b)21 b(=)h(b+1;)f(a)g(=)h(a+1;)-30
1947 y Fn(but)13 b(\\C")f(pro)o(vides)g(a)g(shorter)i(notation)d(\(whic)o(h)i
(is)f(more)-30 1997 y(useful)i(when)h(the)f(v)n(ariable)f(names)g(are)i
(longer\))e(viz.)58 2086 y Ff(b++;)21 b(a++;)33 2174 y Fn(No)o(w)e(there)i
(is)e(no)h(di\013erence)h(b)q(et)o(w)o(een)g(the)f(state-)-30
2224 y(men)o(ts)14 b(\\b++;")f(and)h(\\++b;")g(here.)33 2274
y(Ho)o(w)o(ev)o(er)21 b(\\b++")f(and)h(\\++b")f(ma)o(y)f(b)q(e)i(used)h(as)
-30 2323 y(terms)15 b(in)g(an)f(expression,)i(in)e(whic)o(h)h(case)h(they)f
(are)h(dif-)-30 2373 y(feren)o(t.)j(In)13 b(b)q(oth)g(cases)h(the)f(e\013ect)
i(of)d(incremen)o(ting)g(\\b")-30 2423 y(is)k(retained,)f(but)h(the)g(v)n
(alue)f(whic)o(h)g(en)o(ters)h(the)g(expres-)-30 2473 y(sion)k(is)h(the)g
(initial)d(v)n(alue)i(for)g(\\b++")g(and)g(the)h(\014nal)-30
2523 y(v)n(alue)14 b(for)f(\\++b".)33 2573 y(The)f(\\)p Fl(\000\000)p
Fn(")h(op)q(erator)g(ob)q(eys)g(the)f(same)g(rules)h(as)f(the)-30
2622 y(\\++")k(op)q(erator,)g(except)i(that)d(it)h(decremen)o(ts)g(b)o(y)g
(one.)-30 2672 y(Th)o(us)d(\\)p Fl(\000\000)p Fn(c")f(en)o(ters)i(an)d
(expression)j(as)e(the)g(v)n(alue)f(after)-30 2722 y(decremen)o(tation.)33
2772 y(The)i(\\++")g(and)f(\\)p Fl(\000\000)p Fn(")h(op)q(erators)h(are)f(v)o
(ery)g(useful,)-30 2822 y(and)18 b(are)f(used)h(throughout)g(UNIX.)f
(Occasionally)f(y)o(ou)1010 17 y(will)d(ha)o(v)o(e)i(to)f(go)g(bac)o(k)h(to)g
(\014rst)g(principles)g(to)g(w)o(ork)f(out)1010 66 y(exactly)f(what)g(their)h
(use)g(implies.)i(Note)d(also)g(there)h(is)f(a)1010 116 y(di\013erence)j(b)q
(et)o(w)o(een)f Ff(*b++)e Fn(and)h Ff(\(*b\)++)p Fn(.)1072
166 y(These)22 b(op)q(erators)g(are)g(applicable)e(to)h(p)q(oin)o(ters)g(to)
1010 216 y(structures)16 b(as)e(w)o(ell)f(as)h(to)f(simple)f(data)i(t)o(yp)q
(es.)k(When)c(a)1010 266 y(p)q(oin)o(ter)i(whic)o(h)h(has)f(b)q(een)i
(declared)f(with)f(reference)j(to)1010 316 y(a)f(particular)g(t)o(yp)q(e)g
(of)g(structure)i(is)e(incremen)o(ted,)h(the)1010 365 y(actual)f(v)n(alue)g
(of)g(the)h(p)q(oin)o(ter)f(is)h(incremen)o(ted)f(b)o(y)g(the)1010
415 y(size)c(of)g(the)g(structure.)1010 465 y(W)m(e)f(can)h(no)o(w)g(see)h
(the)g(meaning)d(of)h(the)h(line)1097 554 y Ff(*b++)21 b(=)h(*a++;)1010
642 y Fn(The)i(w)o(ord)g(is)g(copied)g(and)f(the)i(p)q(oin)o(ters)f(are)h
(incre-)1010 692 y(men)o(ted,)13 b(all)f(in)i(one)g(hit.)1010
742 y(The)g(line)1097 830 y Ff(while)21 b(\(--c\);)1010 919
y Fn(delimits)12 b(the)i(end)g(of)g(the)g(set)h(of)e(statemen)o(ts)h(whic)o
(h)g(b)q(e-)1010 969 y(gan)h(after)h(the)g(\\do".)22 b(The)16
b(expression)h(in)e(paren)o(theses)1010 1019 y(\\)p Fl(\000\000)p
Fn(c",)20 b(is)f(ev)n(aluated)g(and)g(tested)h(\(the)g(v)n(alue)e(tested)1010
1068 y(is)f(the)g(v)n(alue)f(after)i(decremen)o(tation\).)27
b(If)16 b(the)i(v)n(alue)e(is)1010 1118 y(non-zero,)c(the)h(lo)q(op)d(is)i
(rep)q(eated,)i(else)e(it)g(is)f(terminated.)1072 1168 y(Ob)o(viously)17
b(if)g(the)h(initial)e(v)n(alue)g(for)i(\\coun)o(t")f(w)o(ere)1010
1218 y(negativ)o(e,)k(the)g(lo)q(op)e(w)o(ould)g(not)h(terminate)g(prop)q
(erly)m(.)1010 1268 y(If)e(this)h(w)o(ere)h(a)e(serious)i(p)q(ossibilit)o(y)d
(then)j(the)f(routine)1010 1317 y(w)o(ould)13 b(ha)o(v)o(e)h(to)f(b)q(e)i(mo)
q(di\014ed.)1010 1433 y Fg(3.5)55 b(Example)17 b(4)1053 1510
y Ff(6619)k(getf)g(\(f\))1162 1560 y({)1206 1609 y(register)f(*fp,)h(rf;)1206
1659 y(rf)g(=)h(f;)1206 1709 y(if)f(\(rf)h(<)f(0)h(||)f(rf)g(>=)h(NOFILE\))
1250 1759 y(goto)f(bad;)1206 1809 y(fp)g(=)h(u.u_ofile[rf];)1206
1858 y(if)f(\(fp)h(!=)f(NULL\))1206 1908 y(return)g(\(fp\);)1162
1958 y(bad:)1206 2008 y(u.u_error)f(=)h(EBADF;)1206 2058 y(return)g
(\(NULL\);)1162 2108 y(})1072 2196 y Fn(The)12 b(parameter)g(\\f)s(")f(is)g
(a)h(presumed)g(in)o(teger,)g(and)f(is)1010 2246 y(copied)g(directly)g(in)o
(to)f(the)i(register)g(v)n(ariable)d(\\rf)s(".)17 b(\(This)1010
2296 y(pattern)j(will)d(b)q(ecome)i(so)g(famili)o(ar)d(that)j(w)o(e)g(will)e
(no)o(w)1010 2346 y(cease)e(to)f(remark)f(up)q(on)h(it.\))1010
2395 y(The)g(three)h(simple)e(relational)f(expressions)1053
2484 y Ff(rf)22 b(<)f(0)87 b(rf)22 b(>=NOFILE)85 b(fp)22 b(!=)f(NULL)1010
2573 y Fn(are)f(eac)o(h)g(accorded)h(the)g(v)n(alue)e(one)h(if)f(true,)j(and)
d(the)1010 2622 y(v)n(alue)f(zero)i(if)e(false.)33 b(The)19
b(\014rst)h(tests)g(if)e(the)h(v)n(alue)g(of)1010 2672 y(\\rf)s(")14
b(is)h(less)g(than)g(zero,)g(the)g(second,)g(if)f(\\rf)s(")h(is)f(greater)
1010 2722 y(than)d(the)g(v)n(alue)g(de\014ned)h(b)o(y)e(\\NOFILE")h(and)g
(the)h(third,)1010 2772 y(if)h(the)h(v)n(alue)g(of)f(\\fp")g(is)h(not)f
(equal)h(to)g(\\NULL")f(\(whic)o(h)1010 2822 y(is)h(de\014ned)h(to)e(b)q(e)i
(zero\).)1890 2946 y(11)p eop
%%Page: 12 20
19 bop -30 -144 a Fk(3)43 b(READING)16 b(\\C")f(PR)o(OGRAMS)777
b(UNIX)14 b(6th)h(Edition)g(Commentary)33 17 y Fn(The)c(conditions)f(tested)i
(b)o(y)e(the)h(\\if)s(")f(statemen)o(ts)g(are)-30 66 y(the)15
b(arithmetic)e(expressions)i(con)o(tained)f(within)f(paren-)-30
116 y(theses.)33 167 y(If)g(the)h(expression)h(is)f(greater)h(than)e(zero)i
(the)f(test)h(is)-30 217 y(successful)h(and)e(the)h(follo)o(wing)c(statemen)o
(t)j(is)g(executed.)-30 266 y(Th)o(us)21 b(if)f(for)g(instance,)j(\\fp")c
(had)i(the)g(v)n(alue)f(001375,)-30 316 y(then)58 411 y Ff(fp)h(!=)g(NULL)-30
505 y Fn(is)11 b(true,)h(and)e(as)h(a)f(term)g(in)g(an)g(arithmetic)g
(expression,)i(is)-30 555 y(accorded)17 b(the)e(v)n(alue)f(one.)21
b(This)15 b(v)n(alue)f(is)h(greater)h(than)-30 605 y(zero,)f(and)e(hence)j
(the)e(statemen)o(t)58 700 y Ff(return\(fp\);)-30 794 y Fn(w)o(ould)h(b)q(e)h
(executed,)h(to)e(terminate)g(further)h(execution)-30 844 y(of)j(\\getf)s(",)
g(and)g(to)g(return)h(the)g(v)n(alue)e(of)g(\\fp")g(to)h(the)-30
893 y(calling)13 b(pro)q(cedure)j(as)e(the)g(result)h(of)e(\\getf)s(".)33
944 y(The)h(expression)58 1039 y Ff(rf)21 b(<)h(0)f(||)h(rf)f(>=)g(NOFILE)-30
1133 y Fn(is)d(the)g(logical)d(disjunction)i(\(\\or"\))h(of)e(the)i(t)o(w)o
(o)f(simple)-30 1183 y(relational)c(expressions.)33 1233 y(An)k(example)e(of)
h(a)h(\\goto")e(statemen)o(t)i(and)g(asso)q(ci-)-30 1283 y(ated)e(lab)q(el)e
(will)f(b)q(e)j(noted.)33 1333 y(\\fp")h(is)g(assigned)h(a)g(v)n(alue,)f
(whic)o(h)h(is)f(an)h Fi(address)p Fn(,)-30 1383 y(from)h(the)i(\\rf)s("-th)f
(elemen)o(t)g(of)f(the)i(arra)o(y)f(of)g(in)o(tegers)-30 1433
y(\\u)p 16 1433 13 2 v 15 w(o\014le",)13 b(whic)o(h)h(is)g(em)o(b)q(edded)g
(in)f(the)i(structure)h(\\u".)33 1484 y(The)c(pro)q(cedure)i(\\getf)s(")e
(returns)h(a)f(v)n(alue)f(to)h(its)g(call-)-30 1533 y(ing)k(pro)q(cedure.)27
b(This)16 b(is)g(either)h(the)g(v)n(ale)f(of)f(\\fp")h(\(i.e.)-30
1583 y(an)e(address\))h(or)f(\\NULL".)-30 1703 y Fg(3.6)56
b(Example)16 b(5)14 1781 y Ff(2113)21 b(wakeup)g(\(chan\))123
1831 y({)167 1881 y(register)f(struct)g(proc)h(*p;)167 1930
y(register)f(c,)h(i;)167 1980 y(c=)g(chan;)167 2030 y(p=)g(&proc[0];)167
2080 y(i=)g(NPROC;)167 2130 y(do)g({)254 2180 y(if)g(\(p->p_wchan)f(==)h(c\))
g({)297 2229 y(setrun\(p\);)254 2279 y(})254 2329 y(p++;)167
2379 y(})g(while)g(\(--i\);)123 2429 y(})33 2523 y Fn(There)15
b(are)f(a)f(n)o(um)o(b)q(er)g(of)g(similarities)f(b)q(et)o(w)o(een)j(this)-30
2573 y(example)c(and)h(the)h(previous)g(one.)k(W)m(e)12 b(ha)o(v)o(e)g(a)g
(new)h(con-)-30 2622 y(cept)k(ho)o(w)o(ev)o(er,)e(an)g(arra)o(y)g(of)g
(structures.)25 b(T)m(o)15 b(b)q(e)g(just)h(a)-30 2672 y(little)i(confusing,)
g(in)g(this)g(example)f(it)h(turns)h(out)f(that)-30 2722 y(b)q(oth)d(the)g
(arra)o(y)f(and)h(the)g(structure)h(are)f(called)g(\\pro)q(c")-30
2772 y(\(y)o(es,)g(\\C")f(allo)o(ws)f(this\).)20 b(They)14
b(are)h(declared)g(on)g(Sheet)-30 2822 y(03)f(in)f(the)i(follo)o(wing)c
(form:)1053 17 y Ff(0358)21 b(struct)g(proc)1162 66 y({)1206
116 y(char)g(p_stat;)1206 166 y(..........)1206 216 y(int)g(p_wchan;)1206
266 y(..........)1162 316 y(})h(proc[NPROC];)1072 408 y Fn(\\p")d(is)f(a)h
(register)h(v)n(ariable)e(of)g(t)o(yp)q(e)h(p)q(oin)o(ter)h(to)e(a)1010
458 y(structure)e(of)d(t)o(yp)q(e)i(\\pro)q(c".)1097 551 y
Ff(p)22 b(=)f(&proc[0];)1010 644 y Fn(assigns)e(to)f(\\p")g(the)h(address)h
(of)e(the)h(\014rst)h(elemen)o(t)e(of)1010 694 y(the)12 b(arra)o(y)g(\\pro)q
(c".)18 b(The)12 b(op)q(erator)h(\\&")f(in)f(this)h(con)o(text)1010
744 y(means)h(\\the)h(address)h(of)s(".)1072 794 y(Note)k(that)f(if)f(an)h
(arra)o(y)f(has)i(n)f(elemen)o(ts,)g(the)h(ele-)1010 844 y(men)o(ts)13
b(ha)o(v)o(e)h(subscripts)h(0,)e(1,)g(..,)g(\(n-1\).)18 b(Also)13
b(it)h(is)f(p)q(er-)1010 894 y(missible)f(to)j(write)f(the)h(ab)q(o)o(v)o(e)f
(statemen)o(t)g(more)f(simply)1010 944 y(as)1097 1037 y Ff(p)22
b(=)f(proc;)1072 1130 y Fn(There)d(are)e(t)o(w)o(o)g(statemen)o(ts)g(in)g(b)q
(et)o(w)o(een)i(the)f(\\do")1010 1179 y(and)12 b(the)h(\\while".)k(The)c
(\014rst)g(of)f(these)i(could)e(b)q(e)i(rewrit-)1010 1229 y(ten)g(more)f
(simply)f(as)1097 1323 y Ff(if)21 b(\(p->p)g(wchan)g(==)g(c\))h(setrun)e
(\(p\);)1010 1415 y Fn(i.e.)27 b(the)17 b(brac)o(k)o(ets)h(are)g(sup)q
(er\015uous)g(in)f(this)g(case,)h(and)1010 1465 y(since)c(\\C")f(is)g(a)h
(free)g(form)d(language,)i(the)h(arrangemen)o(t)1010 1515 y(of)f(text)i(b)q
(et)o(w)o(een)g(lines)f(is)f(not)h(signi\014can)o(t.)1010 1565
y(The)g(statemen)o(t)1097 1658 y Ff(setrun)21 b(\(p\);)1010
1751 y Fn(in)o(v)o(ok)o(es)11 b(the)i(pro)q(cedure)g(\\setrun")g(passing)f
(the)g(v)n(alue)g(of)1010 1801 y(\\p")j(as)h(a)f(parameter)h(\(All)f
(parameters)g(are)i(passed)f(b)o(y)1010 1851 y(v)n(alue.\).)h(The)d(relation)
1097 1944 y Ff(p->p_wchan)20 b(==)h(c)1010 2037 y Fn(tests)15
b(the)g(equalit)o(y)e(of)h(the)g(v)n(alue)g(of)f(\\c")h(and)g(the)h(v)n(alue)
1010 2087 y(of)g(the)g(elemen)o(t)g(\\p)p 1332 2087 V 15 w(w)o(c)o(han")g(of)
g(the)h(structure)h(p)q(oin)o(ted)1010 2137 y(to)d(b)o(y)h(\\p".)20
b(Note)15 b(that)g(it)f(w)o(ould)g(ha)o(v)o(e)h(b)q(een)h(wrong)e(to)1010
2186 y(ha)o(v)o(e)g(written)1097 2280 y Ff(p.p_wchan)20 b(==)h(c)1010
2373 y Fn(b)q(ecause)15 b(\\p")f(is)g(not)f(the)i Fi(name)e
Fn(of)g(a)h(structure.)1072 2423 y(The)20 b(second)h(statemen)o(t,)g(whic)o
(h)e(cannot)h(b)q(e)g(com-)1010 2473 y(bined)c(with)f(the)h(\014rst,)h
(incremen)o(ts)e(\\p")h(b)o(y)f(the)h(size)h(of)1010 2522 y(the)e(\\pro)q(c")
h(structure,)h(whatev)o(er)e(that)h(is.)21 b(\(The)15 b(com-)1010
2572 y(piler)f(can)g(\014gure)g(it)g(out.\))1072 2622 y(In)22
b(order)i(to)e(do)g(this)g(calculation)g(correctly)m(,)i(the)1010
2672 y(compiler)j(needs)j(to)f(kno)o(w)f(the)h(kind)g(of)f(structure)1010
2722 y(p)q(oin)o(ted)16 b(at.)24 b(When)17 b(this)f(is)g(not)g(a)f
(consideration,)i(y)o(ou)1010 2772 y(will)12 b(notice)i(that)f(often)h(in)f
(similar)e(situations,)i(\\p")g(will)1010 2822 y(b)q(e)h(declared)h(simply)d
(as)-30 2946 y(12)p eop
%%Page: 13 21
20 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)776
b(3)42 b(READING)16 b(\\C")f(PR)o(OGRAMS)58 17 y Ff(register)20
b(*p;)-30 106 y Fn(b)q(ecause)d(it)e(w)o(as)g(easier)h(for)f(the)g
(programmer,)e(and)i(the)-30 156 y(compiler)e(do)q(es)i(not)e(insist.)33
206 y(The)22 b(latter)g(part)h(of)e(this)h(pro)q(cedure)i(could)e(ha)o(v)o(e)
-30 256 y(b)q(een)15 b(written)g(equiv)n(alen)o(tly)e(but)h(less)g(e\016cien)
o(tly)g(as)101 345 y Ff(............)101 395 y(i)22 b(=)f(0;)101
445 y(do)145 495 y(if)g(\(proc[i].p_wchan)e(==)i(c\))188 544
y(setrun)g(\(&proc[i]\);)101 594 y(while)g(\(++i)g(<)h(NPROC\);)-30
710 y Fg(3.7)56 b(Example)16 b(6)14 787 y Ff(5336)21 b(geterror)f(\(abp\))123
837 y(struct)h(buf)g(*abp;)123 886 y({)167 936 y(register)f(struct)g(buf)h
(bp;)167 986 y(bp)g(=)h(abp;)167 1036 y(if)f(\(bp->b)g(flags)f(&)i(B_ERROR\))
210 1086 y(if)g(\(\(u.u_error=bp-)o(>b_er)o(ror\)=)o(=0\))254
1135 y(u.u_error)e(=)h(EIO;)123 1185 y(})33 1275 y Fn(This)15
b(pro)q(cedure)i(simply)c(c)o(hec)o(ks)j(if)e(there)i(has)g(b)q(een)-30
1325 y(an)f(error,)g(and)g(if)f(the)h(error)h(indicator)e(\\u.u)p
696 1325 13 2 v 14 w(error")i(has)-30 1374 y(not)e(b)q(een)h(set,)g(sets)g
(it)e(to)h(a)g(general)g(error)h(indication)33 1424 y(\\B)p
85 1424 V 15 w(ERR)o(OR")c(has)i(the)g(v)n(alue)e(04)h(\(see)i(line)e(4575\))
g(so)-30 1474 y(that,)i(with)g(only)g(one)g(bit)g(set,)h(it)e(can)i(b)q(e)g
(used)g(as)f(mask)-30 1524 y(to)g(isolate)g(bit)g(n)o(um)o(b)q(er)f(2.)19
b(The)14 b(op)q(erator)h(\\&")f(as)g(used)-30 1574 y(in)58
1663 y Ff(bp->b_flags)19 b(&)j(B_ERROR)-30 1753 y Fn(is)d(the)g(bit)o(wise)g
(logical)d(conjunction)j(\(\\and"\))f(applied)-30 1802 y(to)c(arithmetic)f(v)
n(alues.)33 1852 y(The)j(ab)q(o)o(v)o(e)f(expression)h(is)f(greater)i(than)e
(one)g(if)g(bit)-30 1902 y(2)k(of)f(the)i(elemen)o(t)e(\\b)p
343 1902 V 15 w(\015ags")g(of)h(the)g(\\buf)s(")g(structure)-30
1952 y(p)q(oin)o(ted)14 b(to)g(b)o(y)g(\\bp",)f(is)h(set.)33
2002 y(Th)o(us)g(if)f(there)i(has)f(b)q(een)h(an)f(error,)g(the)h(expression)
58 2091 y Ff(\(u.u_error\))k(=)j(bp->b_error\))-30 2181 y Fn(is)14
b(ev)n(aluated)f(and)g(compared)g(with)f(zero.)19 b(No)o(w)13
b(this)h(ex-)-30 2231 y(pression)f(includes)f(an)f(assignmen)o(t)g(op)q
(erator)h(\\=".)17 b(The)-30 2280 y(v)n(alue)g(of)f(the)i(expression)g(is)f
(the)h(v)n(alue)e(of)h(\\u.u)p 771 2280 V 14 w(error")-30 2330
y Fi(after)12 b Fn(the)i(v)n(alue)f(of)f(\\bp-)p Fh(>)p Fn(b)p
443 2330 V 15 w(\015ags")h(has)g(b)q(een)h(assigned)-30 2380
y(to)g(it.)33 2430 y(This)f(use)i(of)e(an)h(assignmen)o(t)f(as)h(part)g(of)f
(an)g(expres-)-30 2480 y(sion)h(is)g(useful)g(and)f(quite)h(common.)-30
2596 y Fg(3.8)56 b(Example)16 b(7)14 2672 y Ff(3428)21 b(stime)g(\(\))123
2722 y({)167 2772 y(if)g(\(suser\(\)\))f({)210 2822 y(time[0])h(=)g
(u.u_ar0[R0];)1250 17 y(time[1])f(=)h(u.u_ar0[R1];)1250 66
y(wakeup)f(\(tout\);)1206 116 y(})1162 166 y(})1072 278 y Fn(In)c(this)f
(example,)g(y)o(ou)g(should)g(note)h(that)g(the)g(pro-)1010
328 y(cedure)d(\\suser")g(returns)h(a)d(v)n(alue)h(whic)o(h)f(is)h(used)h
(for)e(the)1010 378 y(\\if)s(")18 b(test.)37 b(The)20 b(three)h(statemen)o
(ts)f(whose)g(execution)1010 427 y(dep)q(ends)d(on)e(this)h(v)n(alue)f(are)g
(enclosed)i(in)e(the)h(brac)o(k)o(ets)1010 477 y(\\)p Fl(f)p
Fn(")d(and)h(\\)p Fl(g)p Fn(".)1072 532 y(Note)d(that)g(a)g(call)f(on)h(a)f
(pro)q(cedure)j(with)e(no)f(parame-)1010 582 y(ters)i(m)o(ust)d(still)h(b)q
(e)h(written-with)g(a)f(set)i(of)e(empt)o(y)g(paren-)1010 632
y(theses,)15 b(sic.)1097 749 y Ff(suser)21 b(\(\))1010 892
y Fg(3.9)55 b(Example)17 b(8)1010 979 y Fn(\\C")c(pro)o(vides)h(a)g
(conditional)f(expression.)19 b(Th)o(us)c(if)e(\\a")1010 1028
y(and)h(\\b")f(are)h(in)o(teger)h(v)n(ariables,)1097 1146 y
Ff(\(a)21 b(>)h(b)g(?)f(a)h(:)f(b\))1010 1257 y Fn(is)13 b(an)f(expression)i
(whose)g(v)n(alue)e(is)h(that)g(of)f(the)i(larger)f(of)1010
1307 y(\\a")g(and)h(\\b".)1072 1362 y(Ho)o(w)o(ev)o(er)i(this)f(do)q(es)h
(not)g(w)o(ork)f(if)f(\\a")h(and)g(\\b")g(are)1010 1412 y(to)d(b)q(e)i
(regarded)g(as)e(unsigned)h(in)o(tegers.)19 b(Hence)14 b(there)g(is)1010
1462 y(a)f(use)i(for)f(the)g(pro)q(cedure)1053 1579 y Ff(6326)21
b(max)h(\(a,)f(b\))1162 1629 y(char)g(*a,)h(*b;)1162 1679 y({)1206
1728 y(if)f(\(a)h(>)f(b\))1250 1778 y(return\(a\);)1206 1828
y(return\(b\);)1162 1878 y(})1072 1990 y Fn(The)13 b(tric)o(k)g(here)h(is)f
(that)g(\\a")f(and)g(\\b",)g(ha)o(ving)g(b)q(een)1010 2040
y(declared)20 b(as)f(p)q(oin)o(ters)h(to)f(c)o(haracters)i(are)e(treated)h
(for)1010 2089 y(comparison)12 b(purp)q(oses)k(as)e(unsigned)g(in)o(tegers.)
1072 2144 y(The)c(b)q(o)q(dy)g(of)f(the)h(pro)q(cedure)h(could)e(ha)o(v)o(e)h
(b)q(een)g(writ-)1010 2194 y(ten)k(as)1097 2311 y Ff(max)21
b(\(a,)g(b\))1097 2361 y(char)g(*a,)g(*b;)1097 2411 y({)1141
2461 y(if)g(\(a)g(>)h(b\))1184 2510 y(return\(a\);)1141 2560
y(else)1184 2610 y(return\(b\);)1097 2660 y(})1010 2772 y Fn(but)17
b(the)g(nature)g(of)f(\\return")h(is)f(suc)o(h)h(that)g(the)g(\\else")1010
2822 y(is)d(not)f(needed)j(here!)1890 2946 y(13)p eop
%%Page: 14 22
21 bop -30 -144 a Fk(3)43 b(READING)16 b(\\C")f(PR)o(OGRAMS)777
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fg(3.10)56
b(Example)16 b(9)-30 94 y Fn(Here)g(are)f(t)o(w)o(o)f(quic)o(kies)h(whic)o(h)
f(in)o(tro)q(duce)i(some)d(di\013er-)-30 144 y(en)o(t)i(and)f(exotic)g(lo)q
(oking)e(expressions.)19 b(First:)14 236 y Ff(7679)i(schar\(\))123
286 y({)167 336 y(return)f(*u.u_dirp++)g(&)h(0377\);)123 385
y(})-30 478 y Fn(where)16 b(the)e(declaration)58 570 y Ff(char)21
b(*u_dirp;)-30 662 y Fn(is)14 b(part)g(of)g(the)g(declaration)g(of)f(the)h
(structure)i(\\u".)33 712 y(\\u.u)p 114 712 13 2 v 14 w(dirp")d(is)f(a)h(c)o
(haracter)h(p)q(oin)o(ter.)k(Therefore)c(the)-30 762 y(v)n(alue)h(of)f
(\\*u.u)p 229 762 V 14 w(dirp++")h(is)g(a)g(c)o(haracter.)22
b(\(Incremen-)-30 812 y(tation)14 b(of)f(the)h(p)q(oin)o(ter)h(o)q(ccurs)g
(as)f(a)f(side)i(e\013ect.\))33 862 y(When)k(a)f(c)o(haracter)j(is)d(loaded)h
(in)o(to)f(a)g(sixteen)i(bit)-30 912 y(register,)i(sign)d(extension)h(ma)o(y)
e(o)q(ccur.)35 b(By)20 b(\\and"ing)-30 962 y(the)15 b(w)o(ord)f(with)f(0377)g
(an)o(y)h(extraneous)h(high)e(order)i(bits)-30 1012 y(are)h(eliminated.)k(Th)
o(us)15 b(the)h(result)g(returned)h(is)e(simply)-30 1061 y(a)f(c)o(haracter.)
33 1111 y(Note)g(that)h(an)o(y)f(in)o(teger)g(whic)o(h)g(b)q(egins)h(with)f
(a)g(zero)-30 1161 y(\(e.g.)k(0377\))13 b(is)h(in)o(terpreted)i(as)e(an)f(o)q
(ctal)h(in)o(teger.)33 1211 y(The)g(second)h(example)e(is:)14
1304 y Ff(1771)21 b(nseg\(n\))123 1354 y({)167 1403 y(return)f
(\(\(n+127\)>>7\);)123 1453 y(})33 1545 y Fn(The)j(v)n(alue)f(returned)j(is)e
(n)g(divided)f(b)o(y)h(128)f(and)-30 1595 y(rounded)15 b(up)f(to)g(the)g
(next)h(highest)f(\\in)o(teger".)33 1645 y(Note)e(the)g(use)h(of)e(the)h
(righ)o(t)g(shift)f(op)q(erator)h(\\)p Fh(>>)p Fn(")g(in)-30
1695 y(preference)17 b(to)d(the)g(division)f(op)q(erator)h(\\/".)-30
1813 y Fg(3.11)56 b(Example)16 b(10)-30 1890 y Fn(Man)o(y)22
b(of)f(the)h(p)q(oin)o(ts)g(whic)o(h)f(ha)o(v)o(e)h(b)q(een)h(in)o(tro)q
(duced)-30 1939 y(ab)q(o)o(v)o(e)14 b(are)g(collected)h(in)e(the)i(follo)o
(wing)c(pro)q(cedure:)14 2032 y Ff(2134)21 b(setrun)g(\(p\))123
2082 y({)167 2132 y(register)f(struct)g(proc)h(*rp;)167 2181
y(rp)g(=)h(p;)167 2231 y(rp->p_wchan)d(=)j(0;)167 2281 y(rp->p_stat)d(=)j
(SRUN;)167 2331 y(if)f(\(rp->p_pri)f(<)h(curpri\))210 2381
y(runrun++;)167 2430 y(if)g(\(runout)f(!=)i(0)f(&&)254 2480
y(\(rp->p_flag)e(&)j(SLOAD\))e(==)i(0\))f({)232 2530 y(runout)g(=)g(0;)232
2580 y(wakeup)g(\(&runout\);)167 2630 y(})123 2680 y(})-30
2772 y Fn(Chec)o(k)e(y)o(our)e(understanding)i(of)e(\\C")g(b)o(y)h
(\014guring)f(out)-30 2822 y(what)d(this)g(one)g(do)q(es.)1072
17 y(There)f(are)g(t)o(w)o(o)f(additional)e(features)j(y)o(ou)f(ma)o(y)e
(need)1010 66 y(to)k(kno)o(w)f(ab)q(out:)1072 116 y(\\&&")i(is)f(the)i
(logical)c(conjunction)j(\(\\and"\))f(for)h(re-)1010 166 y(lational)d
(expressions.)19 b(\(Cf.)f(\\)p Ff(||)p Fn(")13 b(in)o(tro)q(duced)i
(earlier.\))1072 216 y(The)f(last)g(statemen)o(t)g(con)o(tains)g(the)g
(expression)1097 306 y Ff(&runout)1072 396 y Fn(whic)o(h)19
b(is)h(syn)o(tactically)f(an)g(address)h(v)n(ariable)f(but)1010
446 y(seman)o(tically)12 b(just)i(a)f(unique)h(bit)g(pattern.)1072
496 y(This)20 b(is)f(an)h(example)f(of)g(a)g(device)i(whic)o(h)f(is)f(used)
1010 546 y(throughout)9 b(UNIX.)g(The)h(programmer)d(needed)k(a)e(unique)1010
595 y(bit)21 b(pattern)h(for)f(a)g(particular)g(purp)q(ose.)41
b(The)21 b(exact)1010 645 y(v)n(alue)14 b(did)h(not)g(matter)f(as)h(long)g
(as)g(it)f(w)o(as)h(unique.)22 b(An)1010 695 y(adequate)e(solution)e(to)i
(the)g(problem)e(w)o(as)h(to)g(use)h(the)1010 745 y(address)15
b(of)e(a)h(suitable)g(global)e(v)n(ariable.)1010 861 y Fg(3.12)56
b(Example)16 b(11)1053 937 y Ff(4856)21 b(bawrite)g(\(bp\))1162
987 y(struct)g(buf)g(*bp;)1162 1037 y({)1206 1087 y(register)f(struct)h(buf)g
(*rbp;)1206 1137 y(rbp)g(=)h(bp;)1206 1187 y(rbp->b_flags)d(=|)j(B_ASYNC;)
1206 1236 y(bwrite)f(\(rbp\);)1162 1286 y(})1072 1376 y Fn(The)11
b(second)i(last)d(statemen)o(t)h(is)g(in)o(teresting)g(b)q(ecause)1010
1426 y(it)i(could)h(ha)o(v)o(e)g(b)q(een)h(written)f(as)1075
1516 y Ff(rbp->b_flags)20 b(=)h(rbp->b_flags)e(|)j(B_ASYNC;)1072
1606 y Fn(In)16 b(this)g(statemen)o(t)g(the)h(bit)e(mask)g(\\B)h(ASYNC")g(is)
1010 1656 y(\\or"ed)e(in)o(to)f(\\rbp-)p Fh(>)p Fn(b)p 1382
1656 V 15 w(\015ags".)18 b(The)c(sym)o(b)q(ol)e(\\)p Ff(|)p
Fn(")i(is)f(the)1010 1706 y(logical)f(disjunction)i(for)f(arithmetic)g(v)n
(alues.)1072 1756 y(This)19 b(is)h(an)f(example)f(of)h(a)g(v)o(ery)g(useful)h
(construc-)1010 1806 y(tion)9 b(in)g(UNIX,)h(whic)o(h)f(can)h(sa)o(v)o(e)g
(the)g(programmer)d(m)o(uc)o(h)1010 1855 y(lab)q(our.)17 b(If)d(\\O")g(is)f
(an)o(y)h(binary)f(op)q(erator,)h(then)1097 1945 y Ff(x)22
b(=)f(x)h(O)f(a;)1010 2036 y Fn(where)16 b(\\a")f(is)g(an)g(expression,)h
(can)g(b)q(e)g(rewritten)g(more)1010 2085 y(succinctly)f(as)1097
2176 y Ff(x)22 b(=O)43 b(a;)1072 2266 y Fn(A)21 b(programmer)d(using)i(this)h
(construction)g(has)g(to)1010 2315 y(b)q(e)12 b(careful)g(ab)q(out)g(the)g
(placemen)o(t)f(of)h(blank)f(c)o(haracters,)1010 2365 y(since)1097
2455 y Ff(x)22 b(=+)f(1;)1010 2545 y Fn(is)14 b(di\013eren)o(t)g(from)1097
2636 y Ff(x)22 b(=)f(+1;)1010 2726 y Fn(What)13 b(is)h(to)g(b)q(e)g(the)h
(meaning)d(of)1097 2816 y Ff(x)22 b(=+1;)173 b(?)-30 2946 y
Fn(14)p eop
%%Page: 15 23
22 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)776
b(3)42 b(READING)16 b(\\C")f(PR)o(OGRAMS)-30 17 y Fg(3.13)56
b(Example)16 b(12)14 93 y Ff(6824)21 b(ufalloc)f(\(\))123 143
y({)167 193 y(register)g(i;)167 243 y(for)h(\(i=0;)g(i<NOFILE;)e(i++\))210
293 y(if)j(\(u.u_ofile[i]==)o(NULL\))c({)254 342 y(u.u_ar0[R0])h(=)j(i;)254
392 y(return)e(\(i\);)210 442 y(})167 492 y(u.u_error)g(=)h(EMFILE;)167
542 y(return)f(\(-1\);)123 591 y(})33 682 y Fn(This)g(example)g(in)o(tro)q
(duces)h(the)g(\\for")f(statemen)o(t,)-30 732 y(whic)o(h)h(has)g(a)f(v)o(ery)
h(general)g(syn)o(tax)g(making)d(it)j(b)q(oth)-30 782 y(p)q(o)o(w)o(erful)14
b(and)g(compact.)33 831 y(The)23 b(structure)i(of)d(the)h(\\for")f(statemen)o
(t)g(is)h(ade-)-30 881 y(quately)16 b(describ)q(ed)i(on)e(page)g(10)g(of)f
(the)i(\\C)f(T)m(utorial",)-30 931 y(and)e(that)g(description)h(is)e(not)h
(rep)q(eated)i(here.)33 981 y(The)h(Algol)f(equiv)n(alen)o(t)h(of)g(the)h(ab)
q(o)o(v)o(e)f(\\for")f(state-)-30 1031 y(men)o(t)d(w)o(ould)g(b)q(e)36
1121 y Ff(for)21 b(i:=1)g(step)g(1)h(until)e(NOFILE-1)g(do)33
1212 y Fn(The)g(p)q(o)o(w)o(er)g(of)f(the)h(\\for")f(statemen)o(t)h(in)f
(\\C")g(de-)-30 1262 y(riv)o(es)f(from)d(the)j(great)g(freedom)e(the)i
(programmer)d(has)-30 1312 y(in)f(c)o(ho)q(osing)g(what)h(to)f(include)g(b)q
(et)o(w)o(een)i(the)f(paren)o(the-)-30 1361 y(ses.)26 b(Certainly)16
b(there)i(is)e(nothing)f(whic)o(h)h(restricts)i(the)-30 1411
y(calculations)h(to)f(in)o(tegers,)j(as)e(the)g(next)h(example)d(will)-30
1461 y(demonstrate.)-30 1577 y Fg(3.14)56 b(Example)16 b(13)14
1654 y Ff(3949)21 b(signal)g(\(tp,)g(sig\))123 1704 y({)167
1753 y(register)f(struct)g(proc)h(*p;)167 1803 y(for)g(\(p=proc;p<&proc[)o
(NPROC)o(];p++)o(\))210 1853 y(if)h(\(p->p)e(ttyp)h(==)h(tp\))254
1903 y(psignal)e(\(p,sig\);)123 1953 y(})33 2043 y Fn(In)k(this)h(example)e
(of)h(the)i(\\for")d(statemen)o(t,)k(the)-30 2093 y(p)q(oin)o(ter)20
b(v)n(ariable)e(\\p")g(is)h(stepp)q(ed)i(through)e(eac)o(h)g(ele-)-30
2143 y(men)o(t)13 b(of)h(the)g(arra)o(y)g(\\pro)q(c")g(in)f(turn.)33
2193 y(Actually)g(the)i(original)d(co)q(de)i(had)36 2283 y
Ff(for)21 b(\(p=&proc[0];p<&pro)o(c[NP)o(ROC];)o(p++\))-30
2374 y Fn(but)13 b(it)e(w)o(ouldn't)g(\014t)h(on)g(the)g(line!)17
b(As)c(noted)f(earlier,)g(the)-30 2424 y(use)21 b(of)d(\\pro)q(c")h(as)h(an)f
(alternativ)o(e)g(to)g(the)h(expression)-30 2473 y(\\&pro)q(c[0]")14
b(is)f(acceptable)i(in)f(this)g(con)o(text.)33 2523 y(This)h(kind)h(of)f
(\\for")g(statemen)o(t)g(is)h(almost)e(a)h(clic)o(he)-30 2573
y(in)k(UNIX)g(so)g(y)o(ou)g(had)f(b)q(etter)j(learn)e(to)g(recognise)h(it.)
-30 2623 y(Read)14 b(it)g(as)33 2697 y Fk(for)g(p)h(=)g(e)n(ach)g(pr)n(o)n(c)
n(ess)g(in)g(turn)-30 2772 y Fn(Note)23 b(that)f(\\pro)q(c[NPR)o(OC]")f(is)g
(the)i(address)g(of)e(the)-30 2822 y(\(NPR)o(OC+1\)-th)d(elemen)o(t)g(of)f
(the)h(arra)o(y)f(\(whic)o(h)h(do)q(es)1010 17 y(not)e(of)g(course)i(exist\))
f(i.e.)26 b(it)16 b(is)g(the)i(\014rst)f(lo)q(cation)f(b)q(e-)1010
66 y(y)o(ond)d(the)i(end)f(of)f(the)i(arra)o(y)m(.)1072 116
y(A)o(t)e(the)h(risk)f(of)g(o)o(v)o(erkill)f(w)o(e)h(w)o(ould)f(p)q(oin)o(t)h
(out)g(again)1010 166 y(that)h(whereas)h(in)e(the)i(previous)f(example)1097
254 y Ff(i++;)1072 342 y Fn(mean)o(t)f(add)h(one)g(to)f(the)i(in)o(teger)f
(\\i",)f(here)1097 430 y Ff(p++;)1072 518 y Fn(means)g(\\skip)h(p)g(to)f(p)q
(oin)o(t)h(to)f(the)i(next)f(structure".)1010 633 y Fg(3.15)56
b(Example)16 b(14)1053 710 y Ff(8870)21 b(lpwrite)g(\(\))1162
760 y({)1184 810 y(register)f(int)h(c;)1184 859 y(while)g(\(\(c=cpass\(\)\))e
(>=)j(0\))1228 909 y(lpcanon\(c\);)1162 959 y(})1072 1047 y
Fn(This)e(is)g(an)g(example)e(of)i(the)h(\\while")e(statemen)o(t,)1010
1097 y(whic)o(h)9 b(should)h(b)q(e)g(compared)f(with)g(the)h(\\do)f(...)16
b(while)9 b(...")1010 1147 y(construction)16 b(encoun)o(tered)h(earlier.)22
b(\(Cf.)g(the)16 b(\\while")1010 1196 y(and)e(\\rep)q(eat")g(statemen)o(ts)g
(of)g(P)o(ascal.\))1010 1246 y(The)g(meaning)e(of)h(the)i(pro)q(cedure)h(is)
1072 1296 y Fk(Ke)n(ep)e(c)n(al)r(ling)g(\\cp)n(ass")g(while)f(the)h(r)n
(esult)f(is)h(p)n(ositive,)1010 1346 y(and)j(p)n(ass)g(the)f(r)n(esult)g(as)g
(a)h(p)n(ar)n(ameter)f(to)g(a)h(c)n(al)r(l)e(on)i(lp-)1010
1396 y(c)n(anon.)1072 1446 y Fn(Note)d(the)g(redundan)o(t)h(\\in)o(t")e(in)g
(the)h(declaration)f(for)1010 1495 y(\\c".)18 b(It)c(isn't)f(alw)o(a)o(ys)g
(omitted!)1010 1611 y Fg(3.16)56 b(Example)16 b(15)1010 1688
y Fn(The)d(next)h(example)d(is)i(abbreviated)h(from)d(the)i(original:)1053
1776 y Ff(5861)21 b(seek)g(\(\))1162 1825 y({)1206 1875 y(int)g(n[2];)1206
1925 y(register)f(*fp,)h(t;)1206 1975 y(fp)g(=)h(getf)f(\(u.u_ar0[R0]\);)1206
2025 y(...........)1206 2074 y(t)h(=)f(u.u_arg[1];)1206 2124
y(switch)g(\(t\))g({)1206 2224 y(case)g(1:)1206 2274 y(case)g(4:)1250
2323 y(n[0])g(=+)g(fp->f_offset[0];)1250 2373 y(dpadd)f(\(n,)h
(fp->f_offset[1]\);)1250 2423 y(break;)1206 2523 y(default:)1250
2573 y(n[0])g(=+)g(fp->f_inode->i)e(size0)i(&)g(0377;)1250
2622 y(dpadd\(n,fp->f_i)o(node-)o(>i_si)o(ze1\);)1206 2722
y(case)g(0:)1206 2772 y(case)g(3:)1250 2822 y(;)1890 2946 y
Fn(15)p eop
%%Page: 16 24
23 bop -30 -144 a Fk(3)43 b(READING)16 b(\\C")f(PR)o(OGRAMS)777
b(UNIX)14 b(6th)h(Edition)g(Commentary)167 17 y Ff(})167 66
y(...........)123 116 y(})33 207 y Fn(Note)f(the)g(arra)o(y)f(declaration)g
(for)g(the)h(t)o(w)o(o)g(w)o(ord)f(ar-)-30 257 y(ra)o(y)20
b(\\n",)h(and)f(the)h(use)g(of)f(getf)g(\(whic)o(h)g(app)q(eared)h(in)-30
307 y(Example)13 b(4\).)33 357 y(The)c(\\switc)o(h")h(statemen)o(t)f(mak)o
(es)f(a)h(m)o(ultiw)o(a)o(y)d(branc)o(h)-30 406 y(dep)q(ending)15
b(on)f(the)h(v)n(alue)f(of)f(the)i(expression)h(in)d(paren-)-30
456 y(theses.)20 b(The)15 b(individual)d(parts)i(ha)o(v)o(e)g(\\case)g(lab)q
(els":)33 547 y Fl(\017)20 b Fn(If)12 b(\\t")h(is)f(one)h(or)g(four,)f(then)h
(one)g(set)g(of)f(actions)h(is)74 597 y(in)h(order.)33 680
y Fl(\017)20 b Fn(If)c(\\t")f(is)h(zero)h(or)e(three,)i(nothing)f(is)f(to)h
(b)q(e)g(done)74 729 y(at)e(all.)33 812 y Fl(\017)20 b Fn(If)d(\\t")g(is)g
(an)o(ything)f(else,)j(then)f(a)f(set)h(of)f(actions)74 862
y(lab)q(elled)d(\\default")f(is)g(to)h(b)q(e)h(executed.)33
953 y(Note)21 b(the)h(use)g(of)e(\\break")h(as)h(an)e(escap)q(e)j(to)e(the)
-30 1003 y(next)14 b(statemen)o(t)g(after)g(the)g(end)g(of)f(the)h(\\switc)o
(h")f(state-)-30 1052 y(men)o(t.)42 b(Without)22 b(the)g(\\break",)i(the)f
(normal)d(execu-)-30 1102 y(tion)9 b(sequence)j(w)o(ould)d(b)q(e)h(follo)o(w)
o(ed)e(within)h(the)h(\\switc)o(h")-30 1152 y(statemen)o(t.)33
1202 y(Th)o(us)16 b(a)f(\\break")g(w)o(ould)g(normally)e(b)q(e)j(required)h
(at)-30 1252 y(the)e(end)f(of)g(the)g(\\default")f(actions.)19
b(It)14 b(has)g(b)q(een)h(omit-)-30 1302 y(ted)21 b(safely)f(here)h(b)q
(ecause)h(the)f(only)e(remaining)f(cases)-30 1351 y(actually)13
b(ha)o(v)o(e)h(n)o(ull)f(actions)h(asso)q(ciated)h(with)e(them.)33
1401 y(The)20 b(t)o(w)o(o)f(non-trivial)g(pairs)g(of)h(actions)f(represen)o
(t)-30 1451 y(the)d(addition)e(of)h(one)g(32)g(bit)g(in)o(teger)h(to)f
(another.)22 b(The)-30 1501 y(later)j(v)o(ersions)h(of)e(the)h(\\C")f
(compiler)g(will)f(supp)q(ort)-30 1551 y(\\long")16 b(v)n(ariables)g(and)h
(mak)o(e)e(this)i(sort)h(of)e(co)q(de)i(m)o(uc)o(h)-30 1600
y(easier)d(to)f(write)g(\(and)g(read\).)33 1650 y(Note)g(also)f(that)h(in)g
(the)g(expression)58 1741 y Ff(fp->f_inode->i_s)o(ize0)-30
1832 y Fn(there)i(are)e(t)o(w)o(o)f(lev)o(els)h(of)g(indirection.)-30
1948 y Fg(3.17)56 b(Example)16 b(16)14 2025 y Ff(6672)21 b(closei)g(\(ip,)g
(rw\))123 2074 y(int)g(*ip;)123 2124 y({)167 2174 y(register)f(*rip;)167
2224 y(register)g(dev,)h(maj;)167 2274 y(rip)g(=)g(ip;)167
2323 y(dev)g(=)g(rip->i_addr[0];)167 2373 y(maj)g(=)g(rip->i_addr[0].d)e
(major;)167 2423 y(switch)h(\(rip->i_mode&IFMT\))e({)167 2523
y(case)j(IFCHR:)210 2573 y(\(*cdevsw[maj].d_cl)o(ose\)\()o(dev,r)o(w\);)210
2622 y(break;)167 2722 y(case)g(IFBLK:)210 2772 y(\(*bdevsw[maj].d_cl)o
(ose\)\()o(dev,r)o(w\);)167 2822 y(})1206 17 y(iput\(rip\);)1162
66 y(})1072 155 y Fn(This)c(example)f(has)i(a)f(n)o(um)o(b)q(er)g(of)f(in)o
(teresting)i(fea-)1010 205 y(tures.)1072 255 y(The)c(declaration)g(for)g(\\d)
p 1482 255 13 2 v 14 w(ma)r(jor")e(is)1097 344 y Ff(struct)21
b({)1162 394 y(char)g(d_minor;)1162 444 y(char)g(d_major;)1097
494 y(})1010 583 y Fn(so)10 b(that)g(the)g(v)n(alue)f(assigned)h(to)g(\\ma)r
(j")e(is)i(the)g(hiqh)f(order)1010 632 y(b)o(yte)14 b(of)f(the)i(v)n(alue)e
(assigned)h(to)g(\\dev".)1072 682 y(In)23 b(this)g(example,)h(the)g(\\switc)o
(h")f(statemen)o(t)g(has)1010 732 y(onlv)13 b(t)o(w)o(o)g(non-n)o(ull)g
(cases,)h(and)g(no)g(\\default".)j(The)d(ac-)1010 782 y(tions)g(for)f(the)i
(recognised)g(cases,)f(e.g.)1119 871 y Ff(\(*bdevsw[maj].d_)o(close)o
(\)\(dev)o(,rw\);)1010 960 y Fn(lo)q(ok)f(formidable)1072 1010
y(First)g(it)f(should)g(b)q(e)h(noted)g(that)f(this)h(is)f(a)g(pro)q(cedure)
1010 1060 y(call,)g(with)i(parameters)g(\\dev")g(and)f(\\rw".)1072
1109 y(Second)j(\\b)q(devsw")f(\(and)f(\\cdevsw"\))i(are)f(arra)o(ys)g(of)
1010 1159 y(structures,)i(whose)e(\\d)p 1386 1159 V 14 w(close")g(elemen)o(t)
f(is)g(a)h(p)q(oin)o(ter)f(to)1010 1209 y(a)f(function,)h(i.e.)1119
1298 y Ff(bdevsw[maj])1010 1387 y Fn(is)g(the)g(name)f(of)g(a)h(structure,)h
(and)1119 1476 y Ff(bdevsw[maj].d_cl)o(ose)1010 1565 y Fn(is)c(an)g(elemen)o
(t)g(of)g(that)h(structure)h(whic)o(h)f(happ)q(ens)g(to)f(b)q(e)1010
1615 y(a)i(p)q(oin)o(ter)i(to)e(a)h(function,)f(so)h(that)1119
1704 y Ff(*bdevsw[maj].d_c)o(lose)1010 1793 y Fn(is)h(the)h(name)e(of)h(a)g
(function.)22 b(The)16 b(\014rst)g(pair)f(of)g(paren-)1010
1843 y(theses)g(is)e(\\syn)o(tactical)g(sugar")g(to)g(put)h(the)g(compiler)e
(in)1010 1893 y(the)i(righ)o(t)g(frame)e(of)i(mind!)1010 2008
y Fg(3.18)56 b(Example)16 b(17)1010 2085 y Fn(W)m(e)d(o\013er)i(the)f(follo)o
(wing)e(as)i(a)f(\014nal)g(example:)1053 2174 y Ff(4043)21
b(psig)g(\(\))1162 2224 y({)1206 2274 y(register)f(n,)h(p;)1206
2323 y(.........)1206 2373 y(switch)g(\(n\))g({)1206 2473 y(case)g(SIGQIT:)
1206 2523 y(case)g(SIGINS:)1206 2573 y(case)g(SIGTRC:)1206
2622 y(case)g(SIGIOT:)1206 2672 y(case)g(SIGEMT:)1206 2722
y(case)g(SIGEPT:)1206 2772 y(case)g(SIGBUS:)1206 2822 y(case)g(SIGSEG:)-30
2946 y Fn(16)p eop
%%Page: 17 25
24 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)776
b(3)42 b(READING)16 b(\\C")f(PR)o(OGRAMS)167 17 y Ff(case)21
b(SIGSYS:)254 66 y(u.u)g(arg[0])g(=)g(n;)254 116 y(if)g(\(core\(\)\))297
166 y(n)h(=+)f(0200;)167 216 y(})167 266 y(u.u_arg[0]=\(u.u_)o(ar0[)o(R0]<<)o
(8\))e(|)i(n;)167 316 y(exit)g(\(\);)123 365 y(})33 457 y Fn(Here)15
b(the)f(\\switc)o(h")g(selects)i(certain)e(v)n(alues)g(for)f(\\n")-30
506 y(for)k(whic)o(h)f(the)i(one)f(set)g(of)f(actions)h(should)g(b)q(e)g
(carried)-30 556 y(out.)33 606 y(An)9 b(alternativ)o(e)g(w)o(ould)g(ha)o(v)o
(e)g(b)q(een)i(to)e(write)h(a)f(\\mon-)-30 656 y(ster")15 b(\\if)s(")e
(statemen)o(t)h(suc)o(h)h(as)36 747 y Ff(if)21 b(\(n==SIGQUIT)f(||)h
(n==SIGINS)f(||)h(...)276 797 y(...)g(||)g(n==SIGSYS\))-30
888 y Fn(but)13 b(that)g(w)o(ould)e(not)i(ha)o(v)o(e)f(b)q(een)i(either)f
(transparen)o(t)h(or)-30 938 y(e\016cien)o(t.)33 988 y(Note)k(the)h(addition)
e(of)g(an)h(o)q(ctal)g(constan)o(t)g(to)g(\\n")-30 1038 y(and)e(the)h(metho)q
(d)f(of)f(comp)q(osing)g(a)g(16)h(bit)g(v)n(alue)f(from)-30
1088 y(t)o(w)o(o)f(eigh)o(t)g(bit)f(v)n(alues.)1890 2946 y(17)p
eop
%%Page: 18 26
25 bop -30 -144 a Fk(4)43 b(AN)15 b(O)o(VER)l(VIEW)1012 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fj(4)70 b(An)23 b(Ov)n(erview)-30
112 y Fn(The)14 b(purp)q(ose)h(of)d(this)i(c)o(hapter)g(is)f(to)g(surv)o(ey)h
(the)g(source)-30 162 y(co)q(de)j(as)f(a)g(whole)f(i.e.)24
b(to)16 b(presen)o(t)h(the)g(\\w)o(o)q(o)q(d")e(b)q(efore)-30
212 y(the)g(\\trees")33 264 y(Examination)10 b(of)j(the)h(source)h(co)q(de)f
(will)e(rev)o(eal)i(that)-30 314 y(it)g(consists)h(of)e(some)g(44)h(distinct)
g(\014les,)f(of)h(whic)o(h:)33 414 y Fl(\017)20 b Fn(t)o(w)o(o)9
b(are)i(in)e(assem)o(bly)f(language,)h(and)h(ha)o(v)o(e)f(names)74
464 y(ending)14 b(in)f(\\s";)33 557 y Fl(\017)20 b Fn(28)d(are)g(in)g(the)g
(\\C")g(language)f(and)h(ha)o(v)o(e)f(names)74 606 y(ending)e(in)f(\\c";)33
699 y Fl(\017)20 b Fn(14)d(are)i(in)e(the)h(\\C")f(language,)h(but)g(are)g
(not)f(in-)74 749 y(tended)12 b(for)e(indep)q(enden)o(t)h(compilation,)d(and)
i(ha)o(v)o(e)74 799 y(names)j(ending)h(in)g(\\h".)33 899 y(The)19
b(\014les)g(and)f(their)i(con)o(ten)o(ts)f(w)o(ere)h(arranged)f(b)o(y)-30
949 y(the)h(programmers)d(presumably)h(to)g(suit)h(their)h(con)o(v)o(e-)-30
999 y(nience)13 b(and)d(not)i(for)e(ours.)18 b(In)11 b(man)o(y)e(w)o(a)o(ys)i
(the)h(divisions)-30 1049 y(b)q(et)o(w)o(een)k(\014les)f(is)f(irrelev)n(an)o
(t)h(to)f(the)h(presen)o(t)h(discussion)-30 1099 y(and)e(migh)o(t)e(w)o(ell)h
(b)q(e)i(ab)q(olished)e(en)o(tirely)m(.)33 1151 y(As)h(men)o(tioned)f
(already)g(in)g(Chapter)i(One,)f(the)g(\014les)-30 1201 y(ha)o(v)o(e)d(b)q
(een)g(organised)f(in)o(to)g(\014v)o(e)g(sections.)18 b(As)11
b(far)e(as)i(w)o(as)-30 1250 y(p)q(ossible,)k(the)g(sections)h(w)o(ere)g(c)o
(hosen)f(to)g(b)q(e)g(of)f(roughly)-30 1300 y(equal)i(size,)h(to)e(cluster)j
(\014les)e(whic)o(h)g(are)g(strongly)g(asso-)-30 1350 y(ciated)h(and)f(to)g
(separate)h(\014les)g(whic)o(h)f(are)g(only)f(w)o(eakly)-30
1400 y(asso)q(ciated.)-30 1529 y Fg(4.1)56 b(V)-5 b(ariable)19
b(Allo)r(cation)-30 1610 y Fn(The)g(PDP11)f(arc)o(hitecture)i(allo)o(ws)d
(e\016cien)o(t)i(access)h(to)-30 1659 y(v)n(ariables)9 b(whose)h(absolute)g
(address)h(is)e(kno)o(wn,)h(or)f(whose)-30 1709 y(address)18
b(relativ)o(e)d(to)h(the)g(stac)o(k)g(p)q(oin)o(ter)g(can)g(b)q(e)h(deter-)
-30 1759 y(mined)c(exactly)h(at)g(compile)e(time.)33 1811 y(There)j(is)f(no)g
(hardw)o(are)g(supp)q(ort)h(for)f(m)o(ultiple)d(lexi-)-30 1861
y(cal)h(lev)o(els)g(for)g(v)n(ariable)f(declarations)h(suc)o(h)g(as)g(are)h
(a)o(v)n(ail-)-30 1911 y(able)g(in)g(blo)q(c)o(k)g(structured)i(languages)e
(suc)o(h)h(as)f(Algol)f(or)-30 1961 y(P)o(ascal.)29 b(Th)o(us)17
b(\\C")g(as)g(implemen)o(ted)e(on)i(the)h(PDP11)-30 2011 y(supp)q(orts)e
(only)d(t)o(w)o(o)g(lexical)g(lev)o(els:)18 b(global)12 b(and)i(lo)q(cal.)33
2063 y(Global)k(v)n(ariables)h(are)h(allo)q(cated)f(statically;)j(lo)q(cal)
-30 2113 y(v)n(ariables)13 b(are)h(allo)q(cated)f(dynamically)e(within)i(the)
h(cur-)-30 2162 y(ren)o(t)20 b(stac)o(k)f(area)g(or)g(in)f(the)h(general)g
(registers)h(\(r2,)g(r3)-30 2212 y(and)14 b(r4)g(are)g(used)h(in)f(this)f(w)o
(a)o(y\).)-30 2341 y Fg(4.2)56 b(Global)18 b(V)-5 b(ariables)-30
2422 y Fn(In)12 b(UNIX)g(with)f(v)o(ery)h(few)g(exceptions,)g(the)h
(declarations)-30 2472 y(for)h(global)e(v)n(ariables)h(ha)o(v)o(e)h(b)q(een)h
(all)d(gathered)j(in)o(to)e(the)-30 2522 y(set)i(of)f(\\h")f(\014les.)18
b(The)d(exceptions)g(are:)-30 2622 y Fi(\(a\))21 b Fn(the)9
b(static)h(v)n(ariable)e(\\p")h(\(2180\))g(declared)h(in)f(\\swtc)o(h")74
2672 y(whic)o(h)j(is)g(stored)g(globally)m(,)e(but)i(is)f(accessible)i(only)
74 2722 y(from)f(within)g(the)i(pro)q(cedure)h(\\swtc)o(h")f(\(Actually)74
2772 y(\\p")e(is)g(a)g(v)o(ery)h(p)q(opular)f(name)f(for)h(lo)q(cal)f(v)n
(ariables)74 2822 y(in)j(UNIX.\);)1010 17 y Fi(\(b\))19 b Fn(a)c(n)o(um)o(b)q
(er)f(of)h(v)n(ariables)f(suc)o(h)i(as)f(\\swbuf)s(")g(\(4721\))1114
66 y(whic)o(h)9 b(are)g(referenced)j(only)d(b)o(y)g(pro)q(cedures)i(within)
1114 116 y(a)f(single)h(\014le,)g(and)f(are)i(declared)f(at)g(the)h(b)q
(eginning)1114 166 y(of)h(that)h(\014le.)1072 276 y(Global)24
b(v)n(ariables)h(ma)o(y)f(b)q(e)i(declared)g(separately)1010
326 y(within)14 b(eac)o(h)i(\014le)f(in)g(whic)o(h)h(they)f(are)h
(referenced.)25 b(It)15 b(is)1010 375 y(then)d(the)g(job)f(of)g(the)i
(loader,)e(whic)o(h)g(links)g(the)i(compiled)1010 425 y(v)o(ersions)i(of)g
(the)g(program)f(\014les)h(together)h(to)f(matc)o(h)f(up)1010
475 y(the)g(di\013eren)o(t)h(declarations)f(for)g(the)g(same)f(v)n(ariable.)
1010 616 y Fg(4.3)55 b(The)19 b(`C')f(Prepro)r(cessor)1010
701 y Fn(If)h(global)e(declarations)i(m)o(ust)f(b)q(e)i(rep)q(eated)h(in)e
(full)f(in)1010 750 y(eac)o(h)h(\014le)g(\(as)g(is)g(required)h(b)o(y)f(F)m
(ortran,)h(for)e(instance\))1010 800 y(then)11 b(the)g(bulk)f(of)g(the)h
(program)d(is)j(increased,)g(and)g(mo)q(d-)1010 850 y(ifying)17
b(a)h(declaration)h(is)f(at)h(b)q(est)g(a)g(n)o(uisance,)h(and)e(at)1010
900 y(w)o(orst,)c(highly)e(error-prone.)1072 954 y(These)i(di\016culties)d
(are)i(a)o(v)o(oided)e(in)h(UNIX)h(b)o(y)f(use)h(of)1010 1004
y(the)i(prepro)q(cessor)i(facilit)o(y)12 b(of)i(the)h(\\C")e(compiler.)18
b(This)1010 1054 y(allo)o(ws)c(declarations)i(for)g(most)e(global)h(v)n
(ariables)g(to)g(b)q(e)1010 1104 y(recorded)g(once)g(only)e(in)h(one)g(of)f
(the)h(few)g(\\h")g(\014les.)1072 1158 y(Whenev)o(er)e(the)f(declaration)f
(for)g(a)g(particular)h(global)1010 1208 y(v)n(ariable)d(is)h(required)h(the)
g(appropriate)g(\\h")f(\014le)g(can)g(then)1010 1258 y(b)q(e)14
b(\\included")g(in)f(the)i(\014le)f(b)q(eing)g(compiled.)1072
1312 y(UNIX)g(also)e(uses)i(the)g(\\h")f(\014les)g(as)h(v)o(ehicles)f(for)g
(lists)1010 1362 y(of)19 b(standard)i(de\014nitions)f(for)g(man)o(y)e(sym)o
(b)q(olic)h(names)1010 1412 y(whic)o(h)d(represen)o(t)i(constan)o(ts)f(and)f
(adjustable)g(parame-)1010 1462 y(ters,)e(and)g(for)g(declaration)f(of)h
(some)f(structure)j(t)o(yp)q(es.)1072 1516 y(F)m(or)f(example,)f(if)g(the)i
(\014le)g(b)q(ottle.c)f(con)o(tains)g(a)g(pro-)1010 1566 y(cedure)23
b(\\glug")e(whic)o(h)g(global)f(v)n(ariable)h(called)g(\\gin")1010
1616 y(whic)o(h)16 b(is)h(declared)g(in)f(the)h(\014le)g(\\b)q(o)o(x.h")e
(then)i(a)f(state-)1010 1665 y(men)o(t:)1184 1780 y Ff(#include)k("box.h")
1010 1889 y Fn(m)o(ust)14 b(b)q(e)i(inserted)g(at)f(the)h(b)q(eginning)e(of)h
(the)g(\014le)g(\\b)q(ot-)1010 1939 y(tle.c")e(When)h(the)h(\014le)e(\\b)q
(ottle.c")h(is)f(compiled,)f(all)g(dec-)1010 1989 y(larations)17
b(in)g(\\b)q(o)o(x.h")g(are)h(compiled,)e(and)i(since)h(they)1010
2039 y(are)14 b(found)f(b)q(efore)h(the)g(b)q(eginning)f(of)f(an)o(y)h(pro)q
(cedure)j(in)1010 2089 y(\\b)q(ottle.c")f(they)h(are)g(\015agged)f(as)h
(external)g(in)f(the)h(relo-)1010 2138 y(catable)e(mo)q(dule)e(whic)o(h)i(is)
g(pro)q(duced.)1072 2193 y(When)25 b(all)f(the)i(ob)r(ject)g(mo)q(dules)e
(are)h(link)o(ed)f(to-)1010 2243 y(gether,)17 b(a)e(reference)j(to)e(\\gin")e
(will)g(b)q(e)j(found)e(in)g(ev)o(ery)1010 2292 y(\014le)e(for)f(whic)o(h)h
(the)g(source)h(included)f(\\b)q(o)o(x.h")f(All)g(these)1010
2342 y(references)17 b(will)12 b(b)q(e)j(consisten)o(t)g(and)f(the)h(loader)e
(will)g(al-)1010 2392 y(lo)q(cate)19 b(a)f(single)g(space)i(for)e(\\gin")g
(and)g(adjust)h(all)e(the)1010 2442 y(references)g(accordingly)m(.)1010
2582 y Fg(4.4)55 b(Section)18 b(One)1010 2668 y Fn(Section)13
b(One)h(con)o(tains)f(man)o(y)f(of)g(the)i(\\h")f(\014les)g(and)g(the)1010
2717 y(assem)o(bly)g(language)g(\014les.)1072 2772 y(It)e(also)g(con)o(tains)
g(a)f(n)o(um)o(b)q(er)h(of)f(\014les)h(concerned)i(with)1010
2822 y(system)h(initialisation)d(and)i(pro)q(cess)j(managemen)o(t.)-30
2946 y(18)p eop
%%Page: 19 27
26 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1012
b(4)42 b(AN)15 b(O)o(VER)l(VIEW)-30 17 y Fg(4.5)56 b(The)18
b(First)h(Group)g(of)f(`.h')g(Files)-30 99 y Fi(param.h)i Fn([Sheet)e(01])f
(con)o(tains)g(no)g(v)n(ariable)g(declara-)74 148 y(tions,)c(but)g(man)o(y)f
(de\014nitions)h(for)g(op)q(erating)g(sys-)74 198 y(tem)e(constan)o(ts)h(and)
f(parameters,)h(and)f(the)h(decla-)74 248 y(rations)j(for)f(three)j(simple)c
(structures.)23 b(The)16 b(con-)74 298 y(v)o(en)o(tion)21 b(will)f(b)q(e)i
(noted)f(of)g(using)g(\\upp)q(er)h(case)74 348 y(only")13 b(for)h(de\014ned)h
(constan)o(ts.)-30 442 y Fi(systm.h)20 b Fn([Sheet)g(02;)i(Chapter)e(19])e
(consists)j(en)o(tirely)74 492 y(of)14 b(declarations)h(\(with)g
(de\014nitions)f(of)g(the)i(struc-)74 542 y(tures)h(\\callout")e(and)g
(\\moun)o(t")f(as)i(side-e\013ects\).)74 592 y(Note)h(that)g(none)g(of)f(the)
i(v)n(ariables)e(is)g(initialised)74 641 y(explicitly)m(,)10
b(and)h(hence)h(all)e(are)i(initialised)d(to)i(zero.)74 714
y(The)16 b(dimensions)f(for)g(the)h(\014rst)h(three)g(arra)o(ys)e(are)74
763 y(parameters)10 b(de\014ned)g(in)f(param.h.)15 b(Hence)c(an)o(y)e(\014le)
74 813 y(whic)o(h)14 b(\\includes")f(\\systm.h")g(m)o(ust)f(ha)o(v)o(e)i
(previ-)74 863 y(ously)g(included)g(\\param.h".)-30 957 y Fi(seg.h)21
b Fn([Sheet)12 b(03])g(con)o(tains)g(a)g(few)g(de\014nitions)g(and)g(one)74
1007 y(declaration,)e(whic)o(h)g(are)g(used)h(for)e(referencing)i(the)74
1057 y(segmen)o(tation)i(registers.)19 b(This)13 b(\014le)h(could)f(b)q(e)h
(ab-)74 1107 y(sorb)q(ed)d(in)o(to)e(\\param.h")e(and)i(\\systm.h")f(without)
74 1157 y(an)o(y)14 b(real)f(loss.)-30 1251 y Fi(pro)q(c.h)21
b Fn([Sheet)16 b(03;)g(Chapter)h(7])e(con)o(tains)h(the)h(imp)q(or-)74
1301 y(tan)o(t)i(declaration)g(for)g(\\pro)q(c")g(whic)o(h)g(is)g(b)q(oth)g
(a)74 1351 y(structure)24 b(t)o(yp)q(e)e(and)g(an)f(arra)o(y)g(of)g(suc)o(h)i
(struc-)74 1401 y(tures.)28 b(Eac)o(h)17 b(elemen)o(t)f(of)g(the)i(\\pro)q
(c")f(structure)74 1450 y(has)i(a)g(name)e(whic)o(h)i(b)q(egins)g(with)f(\\p)
p 710 1450 13 2 v 15 w(")g(and)h(no)74 1500 y(other)g(v)n(ariable)d(is)i(so)f
(named.)29 b(Similar)15 b(con)o(v)o(en-)74 1550 y(tions)e(are)h(used)g(for)f
(naming)e(the)i(elemen)o(ts)h(of)e(the)74 1600 y(other)j(structures.)74
1672 y(The)h(sets)h(of)e(v)n(alues)g(for)h(the)g(\014rst)g(t)o(w)o(o)f
(elemen)o(ts,)74 1722 y(\\p)p 120 1722 V 15 w(stat")h(and)h(\\p)p
369 1722 V 14 w(\015ag")f(ha)o(v)o(e)g(individual)e(names)74
1772 y(whic)o(h)g(are)g(de\014ne.)-30 1866 y Fi(user.h)20 b
Fn([Sheet)14 b(04;)f(Chapter)h(7])e(con)o(tains)i(the)g(declara-)74
1916 y(tion)g(for)h(the)g(v)o(ery)g(imp)q(ortan)o(t)e(\\user")i(structure,)74
1966 y(plus)f(a)g(set)h(of)e(de\014ned)i(v)n(alues)e(for)h(\\u)p
685 1966 V 15 w(error".)74 2038 y(Only)j(one)h(instance)f(of)g(the)h(\\user")
g(structure)h(is)74 2088 y(ev)o(er)13 b(accessible)f(at)g(one)g(time.)j(This)
d(is)f(referenced)74 2138 y(under)j(the)f(name)e(\\u")h(and)g(is)h(in)f(the)h
(lo)o(w)e(address)74 2187 y(part)18 b(of)f(a)g(1024)g(b)o(yte)h(area)f(kno)o
(wn)g(as)h(the)g(\\p)q(er)74 2237 y(pro)q(cess)e(data)e(area".)74
2309 y(In)e(general)f(the)i(complete)e(\\h")g(\014les)g(are)h(not)g(anal-)74
2359 y(ysed)h(in)f(detail)f(later)i(in)e(this)h(text.)18 b(It)13
b(is)f(exp)q(ected)74 2409 y(that)17 b(the)f(reader)i(will)d(refer)i(to)f
(them)g(from)e(time)74 2459 y(to)k(time)f(\(with)h(increasing)g(famili)o
(arit)o(y)d(and)j(un-)74 2509 y(derstanding\).)-30 2640 y Fg(4.6)56
b(Assem)n(bly)17 b(Language)i(Files)-30 2722 y Fn(There)11
b(are)f(t)o(w)o(o)g(\014les)g(in)f(assem)o(bly)g(language)f(whic)o(h)i(com-)
-30 2772 y(prise)17 b(ab)q(out)f(10\045)f(of)g(the)i(source)g(co)q(de.)25
b(A)16 b(reasonable)-30 2822 y(acquain)o(tance)f(with)e(these)i(\014les)g(is)
e(necessary)m(.)1010 17 y Fi(lo)o(w.s)20 b Fn([Sheet)d(05,)f(Chapter)h(9])f
(con)o(tains)g(information,)1114 66 y(including)f(the)i(trap)f(v)o(ector,)i
(for)e(initialising)d(the)1114 116 y(lo)o(w)j(address)j(part)f(of)e(main)g
(memory)m(.)26 b(This)17 b(\014le)1114 166 y(is)c(generated)h(b)o(y)f(a)g
(utilit)o(y)f(program)f(called)i(\\mk-)1114 216 y(conf)s(")e(to)g(suit)g(the)
h(set)g(of)e(p)q(eripheral)i(devices)g(pre-)1114 266 y(sen)o(t)i(at)g(a)g
(particular)f(installation.)1010 354 y Fi(m40.s)20 b Fn([Sheets)k(06..14;)g
(Chapters)f(6,)h(8,)g(9,)g(10,)f(22])1114 404 y(con)o(tains)16
b(a)g(set)h(of)e(routines)i(appropriate)f(to)g(the)1114 454
y(PDP11/40,)25 b(to)f(carry)h(out)g(a)f(v)n(ariet)o(y)f(of)h(sp)q(e-)1114
504 y(cialised)j(functions)h(whic)o(h)f(cannot)h(b)q(e)g(imple-)1114
554 y(men)o(ted)13 b(directly)h(in)g(\\C".)1072 651 y(Sections)h(of)f(this)h
(\014le)f(are)h(in)o(tro)q(duced)g(in)o(to)f(the)h(dis-)1010
701 y(cussion)h(as)g(and)g(where)h(appropriate.)23 b(\(The)17
b(largest)f(of)1010 750 y(the)i(assem)o(bler)g(pro)q(cedures,)j(\\bac)o(kup")
c(has)h(b)q(een)h(left)1010 800 y(to)14 b(the)g(reader)h(to)f(surv)o(ey)h(as)
e(an)h(exercise.\))1072 851 y(There)h(is)f(an)g(alternativ)o(e)g(to)g
(\\m40.s")d(whic)o(h)j(is)g(not)1010 901 y(presen)o(ted)20
b(here,)g(namely)c(\\m45.s")g(whic)o(h)i(is)g(used)h(on)1010
951 y(PDP11/45's)13 b(and)g(70's.)1010 1075 y Fg(4.7)55 b(Other)19
b(Files)e(in)i(Section)f(One)1010 1154 y Fi(main.c)i Fn([Sheets)27
b(15..17;)j(Chapters)e(6,)h(7])c(con)o(tains)1114 1204 y(\\main")14
b(whic)o(h)i(p)q(erforms)h(v)n(arious)f(initialisation)1114
1254 y(tasks)g(to)h(get)f(UNIX)h(running.)25 b(It)16 b(also)g(con)o(tains)
1114 1303 y(\\sureg")c(and)f(\\estabur")h(whic)o(h)g(set)h(the)f(user)h(seg-)
1114 1353 y(men)o(tation)f(registers.)1010 1442 y Fi(slp.c)20
b Fn([Sheets)15 b(18..22;)d(Chapters)j(6,)f(7,)f(8,)h(14])f(con)o(tains)1114
1492 y(the)26 b(ma)r(jor)e(pro)q(cedures)k(required)e(for)f(pro)q(cess)1114
1542 y(managemen)o(t)19 b(including)h(\\newpro)q(c",)k(\\sc)o(hed",)1114
1591 y(\\sleep")14 b(and)g(\\swtc)o(h".)1010 1680 y Fi(prf.c)20
b Fn([Sheets)e(23,)f(24;)h(Chapter)f(5])g(con)o(tains)g(\\panic")1114
1730 y(and)12 b(a)h(n)o(um)o(b)q(er)f(of)h(other)g(pro)q(cedures)i(whic)o(h)e
(pro-)1114 1780 y(vide)19 b(a)f(simple)g(mec)o(hanism)f(for)i(displa)o(ying)e
(ini-)1114 1830 y(tialisation)8 b(messages)j(and)g(error)g(messages)g(to)f
(the)1114 1879 y(op)q(erator.)1010 1968 y Fi(mallo)q(c.c)20
b Fn([Sheet)c(25;)f(Chapter)h(5])f(con)o(tains)g(\\mallo)q(c")1114
2018 y(and)d(\\mfree")g(whic)o(h)h(are)h(used)f(to)g(manage)f(mem-)1114
2068 y(ory)h(resources.)1010 2192 y Fg(4.8)55 b(Section)18
b(Tw)n(o)1010 2271 y Fn(Section)d(Tw)o(o)f(is)g(concerned)j(with)d(traps,)h
(hardw)o(are)g(in-)1010 2321 y(terrupts)g(and)f(soft)o(w)o(are)g(in)o
(terrupts.)1072 2372 y(T)m(raps)19 b(and)g(hardw)o(are)h(in)o(terrupts)g(in)o
(tro)q(duce)g(sud-)1010 2422 y(den)13 b(switc)o(hes)g(in)o(to)e(the)i(CPU's)f
(normal)e(instruction)j(ex-)1010 2471 y(ecution)18 b(sequence.)32
b(This)18 b(pro)o(vides)f(a)h(mec)o(hanism)d(for)1010 2521
y(handling)10 b(sp)q(ecial)i(conditions)f(whic)o(h)g(o)q(ccur)i(outside)e
(the)1010 2571 y(CPU's)j(immedia)o(te)e(con)o(trol.)1072 2622
y(Use)19 b(is)e(made)g(of)g(this)h(facilit)o(y)e(as)i(part)g(of)f(another)
1010 2672 y(mec)o(hanism)10 b(called)i(the)i(\\system)e(call")f(whereb)o(y)j
(a)e(user)1010 2722 y(program)f(ma)o(y)g(execute)j(a)f(\\trap")f(instruction)
h(to)g(cause)1010 2772 y(a)e(trap)h(delib)q(erately)h(and)e(so)h(obtain)f
(the)i(op)q(erating)f(sys-)1010 2822 y(tem's)h(atten)o(tion)g(and)h
(assistance.)1890 2946 y(19)p eop
%%Page: 20 28
27 bop -30 -144 a Fk(4)43 b(AN)15 b(O)o(VER)l(VIEW)1012 b(UNIX)14
b(6th)h(Edition)g(Commentary)33 17 y Fn(The)g(soft)o(w)o(are)f(in)o(terrupt)h
(\(or)g(\\signal")d(is)j(a)f(mec)o(ha-)-30 66 y(nism)e(for)h(comm)o
(unication)d(b)q(et)o(w)o(een)15 b(pro)q(cesses,)h(partic-)-30
116 y(ularly)d(when)i(there)g(is)f(\\bad)f(news".)-30 193 y
Fi(reg.h)20 b Fn([Sheet)d(26;)f(Chapter)g(10])f(de\014nes)i(a)f(set)g(of)g
(con-)74 243 y(stan)o(ts)g(whic)o(h)g(are)f(used)i(in)d(referencing)j(the)f
(pre-)74 293 y(vious)11 b(user)h(mo)q(de)f(register)h(v)n(alues)f(when)h
(they)f(are)74 343 y(stored)k(in)f(the)g(k)o(ernel)g(stac)o(k.)-30
420 y Fi(trap.c)21 b Fn([Sheets)k(26..28;)i(Chapter)e(12])e(con)o(tains)h
(the)74 470 y(\\C")19 b(pro)q(cedure)j(\\trap")d(whic)o(h)g(recognises)i(and)
74 519 y(handles)14 b(traps)h(of)e(v)n(arious)g(kinds.)-30
597 y Fi(sysen)o(t.c)20 b Fn([Sheet)11 b(29;)f(Chapter)g(12])f(con)o(tains)h
(the)h(decla-)74 646 y(ration)i(and)f(initialisation)f(of)h(the)h(arra)o(y)g
(\\sysen)o(t")74 696 y(whic)o(h)j(is)g(used)h(b)o(y)f(\\trap")g(to)g(asso)q
(ciate)h(the)g(ap-)74 746 y(propriate)e(k)o(ernel)g(mo)q(de)e(routine)i(with)
f(eac)o(h)h(sys-)74 796 y(tem)e(call)g(t)o(yp)q(e.)-30 873
y Fi(sysl.c)21 b Fn([Sheets)k(30..33;)h(Chapters)f(12,)g(13])e(con)o(tains)74
923 y(v)n(arious)13 b(routines)g(asso)q(ciated)h(with)f(system)g(calls,)74
973 y(including)g(\\exec")i(\\exit")e(\\w)o(ait")g(and)g(\\fork".)-30
1050 y Fi(sys4.c)21 b Fn([Sheets)11 b(34..36;)e(Chapters)i(12,)f(13,)g(19])f
(con)o(tains)74 1100 y(routines)j(for)f(\\unlink",)f(\\kill")f(and)i(v)n
(arious)f(other)74 1150 y(minor)i(system)i(calls.)-30 1227
y Fi(clo)q(c)o(k.c)21 b Fn([Sheets)11 b(37,)e(38;)h(Chapter)g(11])e(con)o
(tains)h(\\clo)q(c)o(k")74 1277 y(whic)o(h)k(is)g(the)h(handler)g(for)f(clo)q
(c)o(k)g(in)o(terrupts,)h(and)74 1326 y(whic)o(h)e(do)q(es)h(m)o(uc)o(h)e(of)
g(the)i(inciden)o(tal)e(housek)o(eep-)74 1376 y(ing)i(and)h(basic)g(accoun)o
(ting.)-30 1454 y Fi(sig.c)21 b Fn([Sheets)15 b(39..42;)c(Chapter)k(13])e
(con)o(tains)h(the)h(pro-)74 1503 y(cedures)20 b(whic)o(h)e(handle)g
(\\signals")f(or)h(\\soft)o(w)o(are)74 1553 y(in)o(terrupts")f(These)h(pro)o
(vide)e(facilities)f(for)h(in)o(ter-)74 1603 y(pro)q(cess)g(comm)o(unicatio)o
(n)11 b(and)j(tracing.)-30 1717 y Fg(4.9)56 b(Section)18 b(Three)-30
1793 y Fn(Section)12 b(Three)g(is)f(concerned)h(with)f(basic)g(input/output)
-30 1843 y(op)q(erations)g(b)q(et)o(w)o(een)g(the)g(main)c(memory)h(and)i
(disk)f(stor-)-30 1893 y(age.)33 1943 y(These)k(op)q(erations)g(are)g
(fundamen)o(tal)d(to)j(the)g(activi-)-30 1993 y(ties)h(of)f(program)f(sw)o
(apping)h(and)g(the)h(creation)g(and)g(ref-)-30 2042 y(erencing)h(of)f(disk)f
(\014les.)33 2092 y(This)i(section)i(also)e(in)o(tro)q(duces)i(pro)q(cedures)
h(for)d(the)-30 2142 y(use)c(and)e(manipulatio)o(n)e(of)h(the)i(large)f
(\(512)g(b)o(yte\))h(bu\013ers.)-30 2219 y Fi(text.h)20 b Fn([Sheet)g(43;)h
(Chapter)f(14])e(de\014nes)j(the)f(\\text")74 2269 y(structure)e(and)e(arra)o
(y)m(.)23 b(One)17 b(\\text")f(structure)i(is)74 2318 y(used)c(to)e(de\014ne)
i(the)f(status)g(of)f(a)h(shared)g(text)g(seg-)74 2368 y(men)o(t.)-30
2445 y Fi(text.c)21 b Fn([Sheets)10 b(43,)f(44;)h(Chapter)g(14])f(con)o
(tains)g(the)h(pro-)74 2495 y(cedures)23 b(whic)o(h)d(manage)f(the)i(shared)g
(text)g(seg-)74 2545 y(men)o(ts.)-30 2622 y Fi(buf.h)f Fn([Sheet)k(45;)j
(Chapter)d(15])e(de\014nes)j(the)f(\\buf)s(")74 2672 y(structure)e(and)d
(arra)o(y)m(,)g(the)h(structure)h(\\devtab")74 2722 y(and)j(names)f(for)g
(the)h(v)n(alues)f(of)g(\\b)p 692 2722 13 2 v 15 w(error")i(All)74
2772 y(these)18 b(are)g(needed)g(for)e(the)i(managemen)o(t)c(of)i(the)74
2822 y(large)e(\(512)f(b)o(yte\))h(bu\013ers.)1010 17 y Fi(conf.h)20
b Fn([Sheet)g(46;)h(Chapter)f(15])e(de\014nes)j(the)f(arra)o(ys)1114
66 y(of)c(structures)k(\\b)q(devsw")e(and)f(\\cdevsw")h(whic)o(h)1114
116 y(sp)q(ecify)12 b(the)g(device)h(orien)o(ted)f(pro)q(cedures)i(needed)
1114 166 y(to)f(carry)i(out)f(logical)e(\014le)i(op)q(erations.)1010
252 y Fi(conf.c)20 b Fn([Sheet)j(46;)i(Chapter)e(15])e(is)h(generated,)j(lik)
o(e)1114 301 y(\\lo)o(w.s")18 b(b)o(y)h(the)i(\\mk)o(conf)s(")d(utilit)o(y)g
(to)i(suit)f(the)1114 351 y(set)13 b(of)g(p)q(eripheral)g(devices)h(presen)o
(t)h(at)d(a)h(particu-)1114 401 y(lar)i(installation.)24 b(It)16
b(con)o(tains)g(the)h(initialisation)1114 451 y(for)c(the)h(arra)o(ys)g(\\b)q
(devsw")g(and)g(\\cdevsw")g(whic)o(h)1114 501 y(con)o(trol)f(the)i(basic)f
(i/o)f(op)q(erations.)1010 586 y Fi(bio.c)20 b Fn([Sheets)h(47..53;)g
(Chapters)h(15,)f(16,)g(17])e(is)h(the)1114 636 y(largest)15
b(\014le)f(after)h(\\m40.s")d(It)j(con)o(tains)g(the)g(pro-)1114
686 y(cedures)g(for)f(manipulation)c(of)j(the)i(large)e(bu\013ers,)1114
736 y(and)g(for)h(basic)g(blo)q(c)o(k)f(orien)o(ted)i(i/o.)1010
821 y Fi(rk.c)21 b Fn([Sheets)11 b(53,)f(54;)h(Chapter)g(16])e(is)h(the)h
(device)g(driv)o(er)1114 871 y(for)i(the)i(RK11/K05)d(disk)i(con)o(troller.)
1010 990 y Fg(4.10)56 b(Section)17 b(F)-5 b(our)1010 1068 y
Fn(Section)10 b(F)m(our)f(is)h(concerned)h(with)e(\014les)h(and)g(\014le)f
(systems.)1072 1118 y(A)15 b(\014le)g(system)f(is)h(a)f(set)i(of)e(\014les)h
(and)g(asso)q(ciated)g(ta-)1010 1168 y(bles)f(and)f(directories)i(organised)f
(on)o(to)f(a)g(single)h(storage)1010 1218 y(device)h(suc)o(h)f(as)g(a)g(disk)
f(pac)o(k.)1072 1269 y(This)18 b(section)h(co)o(v)o(ers)g(the)g(means)e(of)h
(creating)g(and)1010 1318 y(accessing)c(\014les;)f(lo)q(cating)f(\014les)h
(via)g(directories)h(organis-)1010 1368 y(ing)i(and)i(main)o(taini)o(ng)d
(\014le)i(systems.)28 b(It)18 b(also)f(includes)1010 1418 y(the)d(co)q(de)h
(for)f(an)f(exotic)h(breed)h(of)f(\014le)g(called)f(a)h(\\pip)q(e".)1010
1512 y Fi(\014le.h)19 b Fn([Sheet)26 b(55;)31 b(Chapter)26
b(18])f(de\014nes)i(the)g(\\\014le")1114 1562 y(structure)16
b(and)d(arra)o(y)m(.)1010 1647 y Fi(\014lsys.h)19 b Fn([Sheet)14
b(55;)f(Chapter)i(20])e(de\014nes)i(the)f(\\\014lsys")1114
1697 y(structure)e(whic)o(h)f(is)g(copied)g(to)f(and)h(from)e(the)i(\\su-)
1114 1747 y(p)q(er)j(blo)q(c)o(k")g(on)f(\\moun)o(ted")g(\014le)h(systems.)
1010 1832 y Fi(ino.h)19 b Fn([Sheet)11 b(56])d(describ)q(es)k(the)f
(structure)h(of)d(\\ino)q(des")1114 1882 y(as)14 b(recorded)i(on)e(the)h
(\\moun)o(ted")d(devices.)21 b(Since)1114 1932 y(this)15 b(\014le)g(is)f(not)
h(\\included")g(in)f(an)o(y)h(other,)g(it)g(re-)1114 1982 y(ally)d(exists)j
(for)e(information)e(only)m(.)1010 2067 y Fi(ino)q(de.h)19
b Fn([Sheet)11 b(56;)f(Chapter)h(18])f(de\014nes)i(the)f(\\ino)q(de")1114
2117 y(structure)20 b(and)e(arra)o(y)m(.)30 b(\\ino)q(des")18
b(are)h(of)f(funda-)1114 2167 y(men)o(tal)c(imp)q(ortance)h(in)g(managing)e
(the)j(accesses)1114 2216 y(of)d(pro)q(cesses)j(to)e(\014les.)1010
2302 y Fi(sys2.c)21 b Fn([Sheets)16 b(57..59;)e(Chapters)j(18,)e(19])g(con)o
(tains)g(a)1114 2352 y(set)c(of)f(routines)h(asso)q(ciated)g(with)f(system)g
(calls)g(in-)1114 2402 y(cluding)j(\\read",)h(\\write",)g(\\creat",)g(\\op)q
(en")g(and)1114 2451 y(\\close")1010 2537 y Fi(sys3.c)21 b
Fn([Sheets)16 b(60,)e(61;)h(Chapters)h(19,)e(20])g(con)o(tains)h(a)1114
2587 y(set)g(of)f(routines)i(asso)q(ciated)f(with)g(v)n(arious)f(minor)1114
2636 y(system)f(calls.)1010 2722 y Fi(rdwri.c)20 b Fn([Sheets)12
b(62,)g(63;)f(Chapter)i(18])d(con)o(tains)i(in)o(ter-)1114
2772 y(mediate)k(lev)o(el)g(routines)i(in)o(v)o(olv)o(ed)e(with)g(reading)
1114 2822 y(and)d(writing)g(\014les.)-30 2946 y(20)p eop
%%Page: 21 29
28 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1012
b(4)42 b(AN)15 b(O)o(VER)l(VIEW)-30 17 y Fi(subr.c)20 b Fn([Sheets)e(64,)e
(65;)h(Chapter)g(18])f(con)o(tains)h(more)74 66 y(in)o(termediate)e(lev)o(el)
g(routines)h(for)e(i/o,)h(esp)q(ecially)74 116 y(\\bmap")f(whic)o(h)i
(translates)h(logical)d(\014le)i(p)q(oin)o(ters)74 166 y(in)o(to)d(ph)o
(ysical)h(disk)f(addresses.)-30 254 y Fi(\014o.c)21 b Fn([Sheets)13
b(66..6;)e(Chapters)i(18,)f(19])f(con)o(tains)i(in)o(ter-)74
304 y(mediate)e(lev)o(el)g(routines)h(for)f(\014le)h(op)q(ening,)f(closing)74
353 y(and)j(con)o(trol)g(of)f(access.)-30 441 y Fi(allo)q(c.c)21
b Fn([Sheets)14 b(69..72;)c(Chapter)k(20])d(con)o(tains)i(pro)q(ce-)74
491 y(dures)k(whic)o(h)e(manage)e(the)j(allo)q(cation)d(of)i(en)o(tries)74
541 y(in)10 b(the)g(\\ino)q(de")g(arra)o(y)f(and)h(of)f(blo)q(c)o(ks)h(of)g
(disk)f(stor-)74 591 y(age.)-30 678 y Fi(iget.c)20 b Fn([Sheets)k(72..74;)h
(Chapters)e(18,)h(19,)g(20])e(con-)74 728 y(tains)d(pro)q(cedures)j
(concerned)f(with)d(referencing)74 778 y(and)c(up)q(dating)f(\\ino)q(des".)
-30 865 y Fi(nami.c)20 b Fn([Sheets)h(75,)f(76;)i(Chapter)f(19])d(con)o
(tains)i(the)74 915 y(pro)q(cedure)15 b(\\namei")c(whic)o(h)i(searc)o(hes)i
(the)e(\014le)g(di-)74 965 y(rectories.)-30 1053 y Fi(pip)q(e.c)20
b Fn([Sheets)f(77,)e(78;)h(Chapter)g(21])f(is)g(the)h(\\device)74
1103 y(driv)o(er")f(for)g(\\pip)q(es")g(whic)o(h)g(are)g(a)g(sp)q(ecial)g
(form)74 1152 y(of)11 b(short)i(disk)e(\014le)h(used)h(to)e(transmit)g
(information)74 1202 y(from)h(one)i(pro)q(cess)i(to)e(another.)-30
1325 y Fg(4.11)56 b(Section)18 b(Fiv)n(e)-30 1403 y Fn(Section)i(Fiv)o(e)g
(is)f(the)i(\014nal)e(section.)36 b(It)19 b(is)h(concerned)-30
1453 y(with)10 b(input/output)f(for)g(the)h(slo)o(w)o(er,)f(c)o(haracter)i
(orien)o(ted)-30 1503 y(p)q(eripheral)k(devices.)33 1554 y(Suc)o(h)c(devices)
h(share)g(a)e(common)f(bu\013er)i(p)q(o)q(ol,)g(whic)o(h)-30
1604 y(is)j(manipulated)e(b)o(y)i(a)f(set)i(of)e(standard)i(pro)q(cedures.)33
1655 y(The)i(set)g(of)f(c)o(haracter)h(p)q(eripheral)g(devices)h(are)f(ex-)
-30 1705 y(empli\014ed)c(b)o(y)h(the)g(follo)o(wing:)58 1803
y Fi(KL/DL11)49 b Fn(in)o(teractiv)o(e)14 b(terminal)58 1852
y Fi(PC11)138 b Fn(pap)q(er)14 b(tap)q(e)g(reader/punc)o(h)58
1902 y Fi(LP11)143 b Fn(line)13 b(prin)o(ter)-30 1999 y Fi(tt)o(y)l(.h)20
b Fn([Sheet)11 b(79;)g(Chapters)g(23,)f(24])f(de\014nes)j(the)f(\\clist")74
2048 y(structure)22 b(\(used)g(as)e(a)g(list)f(head)i(for)e(c)o(haracter)74
2098 y(bu\013er)12 b(queues\),)h(the)e(\\tt)o(y")g(structure)i(\(stores)g
(rel-)74 2148 y(ev)n(an)o(t)18 b(data)g(for)g(con)o(trolling)e(an)i
(individual)e(ter-)74 2198 y(minal\),)f(declares)j(the)g(\\partab")e(table)h
(\(used)h(to)74 2248 y(con)o(trol)f(transmission)e(of)h(individual)f(c)o
(haracters)74 2298 y(to)e(terminals\))g(and)g(de\014nes)i(names)d(for)h(man)o
(y)f(as-)74 2347 y(so)q(ciated)j(parameters.)-30 2435 y Fi(kl.c)21
b Fn([Sheet)12 b(80;)f(Chapters)h(24,)f(25])f(is)h(the)h(device)f(driv)o(er)
74 2485 y(for)g(terminals)g(connected)i(via)e(KL11)g(or)h(DL11)e(in-)74
2535 y(terfaces.)-30 2622 y Fi(tt)o(y)l(.c)21 b Fn([Sheets)16
b(81..85;)d(Chapters)k(23,)d(24,)h(25])f(con)o(tains)74 2672
y(common)8 b(pro)q(cedures)14 b(whic)o(h)d(are)g(indep)q(enden)o(t)h(of)74
2722 y(the)h(attac)o(hing)e(in)o(terfaces,)i(for)e(con)o(trolling)f(trans-)74
2772 y(mission)i(to)i(or)g(from)e(terminals,)g(and)i(whic)o(h)g(tak)o(e)74
2822 y(in)o(to)f(accoun)o(t)i(v)n(arious)e(terminal)f(idiosyncrasies.)1010
17 y Fi(p)q(c.c)21 b Fn([Sheets)16 b(86,87;)e(Chapter)h(22])f(is)h(the)h
(device)f(han-)1114 66 y(dler)k(for)g(the)h(PC11)f(pap)q(er)h(tap)q(e)g
(reader/punc)o(h)1114 116 y(con)o(troller.)1010 199 y Fi(lp.c)g
Fn([Sheets)15 b(88,)f(89;)f(Chapter)i(22])e(is)h(the)h(device)g(han-)1114
249 y(dler)f(for)f(the)i(LP11)e(line)h(prin)o(ter)g(con)o(troller.)1010
332 y Fi(mem.c)21 b Fn([Sheet)16 b(90])e(con)o(tains)i(pro)q(cedures)i(whic)o
(h)d(pro-)1114 382 y(vide)10 b(access)j(to)e(main)e(memory)f(as)j(though)g
(it)f(w)o(ere)1114 432 y(an)f(ordinary)g(\014le.)17 b(This)10
b(co)q(de)g(has)g(b)q(een)h(left)f(to)f(the)1114 482 y(reader)15
b(to)e(surv)o(ey)i(as)f(an)g(exercise.)1890 2946 y(21)p eop
%%Page: 22 30
29 bop -30 -144 a Fk(5)43 b(TWO)15 b(FILES)1083 b(UNIX)14 b(6th)h(Edition)g
(Commentary)-30 17 y Fj(Section)22 b(One)-30 110 y Fe(Section)17
b(One)f(contains)g(many)f(of)g(the)h(global)f(decla)o(ration)-30
160 y(\014les)g(and)g(the)f(assembly)g(language)g(\014les.)33
211 y(It)f(also)h(comtains)f(a)h(numb)q(er)i(of)d(\014les)i(concerned)i(with)
-30 260 y(system)d(initialisation)f(and)i(p)o(ro)q(cess)g(management.)-30
404 y Fj(5)70 b(Tw)n(o)22 b(Files)-30 497 y Fn(This)16 b(c)o(hapter)g(is)f
(in)o(tended)h(to)f(pro)o(vide)h(a)f(gen)o(tle)g(in)o(tro-)-30
547 y(duction)d(to)f(the)h(source)h(co)q(de)g(b)o(y)e(lo)q(oking)f(at)h(t)o
(w)o(o)g(\014les)h(in)-30 597 y(Section)k(One)g(whic)o(h)e(can)i(b)q(e)f
(isolated)g(reasonably)f(w)o(ell)-30 647 y(from)f(the)h(rest.)33
698 y(The)c(discussion)g(of)f(these)i(\014les)e(supplemen)o(ts)h(the)g(dis-)
-30 747 y(cussion)k(of)e(Chapter)h(Three)h(and)e(includes)h(a)f(n)o(um)o(b)q
(er)g(of)-30 797 y(additional)i(commen)o(ts)h(regarding)g(the)i(syn)o(tax)e
(and)h(se-)-30 847 y(man)o(tics)d(of)g(the)i(\\C")e(language.)-30
970 y Fg(5.1)56 b(The)18 b(File)g(`mallo)r(c.c')-30 1048 y
Fn(This)f(\014le)g(is)g(found)f(on)h(Sheet)h(25)e(of)g(the)i(Source)f(co)q
(de,)-30 1098 y(and)d(consists)h(of)e(just)h(t)o(w)o(o)g(pro)q(cedures:)36
1196 y Ff(malloc)20 b(\(2528\))65 b(mfree)20 b(\(2556\))33
1292 y Fn(These)k(are)f(concerned)h(with)f(the)g(allo)q(cation)e(and)-30
1342 y(subsequen)o(t)28 b(release)f(of)e(t)o(w)o(o)g(kinds)h(of)f(memory)e
(re-)-30 1391 y(sources,)16 b(namely:)-30 1487 y Fi(main)f(memory)20
b Fn(in)14 b(units)g(of)f(32)g(w)o(ords)h(\(64)g(b)o(ytes\);)-30
1575 y Fi(disk)h(sw)o(ap)h(area)21 b Fn(in)11 b(units)g(of)g(256)g(w)o(ords)g
(\(512)g(b)o(ytes\).)33 1671 y(F)m(or)26 b(eac)o(h)i(of)e(these)j(t)o(w)o(o)d
(kinds)h(of)f(resource,)32 b(a)-30 1721 y(list)21 b(of)g(a)o(v)n(ailable)e
(areas)i(is)g(main)o(tained)e(within)h(a)h(re-)-30 1771 y(source)h(\\map")c
(\(either)j(\\coremap")e(or)h(\\sw)o(apmap"\).)-30 1821 y(A)15
b(p)q(oin)o(ter)f(to)h(the)g(appropriate)f(resource)i(\\map")c(is)j(al-)-30
1871 y(w)o(a)o(ys)j(passed)g(to)g(\\malloc")d(and)j(\\mfree")e(so)i(that)f
(the)-30 1920 y(routines)g(themselv)o(es)f(do)g(not)g(ha)o(v)o(e)f(to)h(kno)o
(w)g(the)g(kind)-30 1970 y(of)e(resource)i(with)d(whic)o(h)h(they)g(are)h
(dealing.)33 2021 y(Eac)o(h)21 b(of)f(\\coremap")f(and)i(\\sw)o(apmap")d(is)i
(an)h(ar-)-30 2071 y(ra)o(y)15 b(of)g(structures)i(of)e(the)g(t)o(yp)q(e)h
(\\map")d(as)i(declared)h(at)-30 2121 y(line)f(2515.)21 b(This)15
b(structure)i(consists)f(of)f(t)o(w)o(o)f(c)o(haracter)-30
2171 y(p)q(oin)o(ters)h(i.e.)i(t)o(w)o(o)d(unsigned)g(in)o(tegers.)33
2222 y(The)g(declarations)f(of)g(\\coremap")f(and)i(\\sw)o(apmap")-30
2272 y(are)22 b(on)e(lines)h(0203,)g(0204.)38 b(Here)22 b(the)f(\\map")e
(struc-)-30 2321 y(ture)14 b(is)e(completely)f(ignored)i({)f(a)g(regrettable)
h(program-)-30 2371 y(ming)j(short-cut)i(whic)o(h)f(is)g(p)q(ossible)g(b)q
(ecause)i(it)e(is)g(not)-30 2421 y(detected)j(b)o(y)d(the)h(loader.)28
b(Th)o(us)17 b(the)h(actual)f(n)o(um)o(b)q(ers)-30 2471 y(of)g(list)f(elemen)
o(ts)g(in)h(\\coremap")e(and)i(\\sw)o(apmap")d(are)-30 2521
y(\\CMAPSIZ/2")g(and)g(\\SMAPSIZ/2")g(resp)q(ectiv)o(ely)m(.)-30
2643 y Fg(5.2)56 b(Rules)18 b(for)h(List)e(Main)n(tenance)-30
2722 y Fi(\(a\))k Fn(Eac)o(h)d(a)o(v)n(ailable)d(area)j(is)f(de\014ned)i(b)o
(y)f(its)f(size)i(and)74 2772 y(relativ)o(e)13 b(address)g(\(rec)o(k)o(oned)h
(in)e(the)h(units)g(appro-)74 2822 y(priate)h(to)g(the)h(resource\);)1010
17 y Fi(\(b\))k Fn(The)g(elemen)o(ts)f(of)g(eac)o(h)g(list)g(are)h(arranged)f
(at)g(all)1114 66 y(times)d(in)h(order)h(of)f(increasing)g(relativ)o(e)g
(address.)1114 116 y(Care)d(is)g(tak)o(en)g(that)g(no)f(t)o(w)o(o)h(list)f
(elemen)o(ts)h(repre-)1114 166 y(sen)o(t)e(con)o(tiguous)f(areas)h({)f(the)h
(alternativ)o(e)f(course,)1114 216 y(to)f(merge)g(the)h(t)o(w)o(o)f(areas)h
(in)o(to)e(a)h(single)h(larger)f(area)1114 266 y(is)k(alw)o(a)o(ys)g(tak)o
(en;)1010 361 y Fi(\(c\))20 b Fn(The)f(whole)g(list)f(can)i(b)q(e)f(scanned)h
(b)o(y)f(lo)q(oking)e(at)1114 411 y(successiv)o(e)c(elemen)o(ts)e(of)g(the)h
(arra)o(y)m(,)e(starting)h(with)1114 460 y(the)16 b(\014rst,)g(un)o(til)f(an)
g(elemen)o(t)h(with)f(a)g(zero)i(size)f(is)1114 510 y(encoun)o(tered.)j(This)
11 b(last)h(elemen)o(t)f(is)g(a)g(\\sen)o(tinel")1114 560 y(whic)o(h)i(is)h
(not)g(part)g(of)f(the)i(list)e(prop)q(er.)1072 663 y(The)20
b(ab)q(o)o(v)o(e)f(rules)h(pro)o(vide)g(a)f(complete)g(sp)q(eci\014ca-)1010
713 y(tion)e(for)h(\\mfree",)f(and)h(a)g(sp)q(eci\014cation)g(for)g(\\mallo)q
(c")1010 763 y(whic)o(h)e(is)f(complete)h(except)h(in)e(one)h(resp)q(ect:)25
b(W)m(e)15 b(need)1010 813 y(to)k(sp)q(ecify)h(ho)o(w)e(the)i(resource)h
(allo)q(cation)d(is)h(actually)1010 863 y(made)13 b(when)h(there)h(exists)g
(more)e(than)h(one)g(w)o(a)o(y)f(of)g(p)q(er-)1010 912 y(forming)e(it.)1072
965 y(The)k(metho)q(d)f(adopted)h(in)f(\\mallo)q(c")e(is)j(one)f(kno)o(wn)
1010 1015 y(as)f(\\First)g(Fit")f(for)h(reasons)h(whic)o(h)f(should)g(b)q
(ecome)f(ob-)1010 1065 y(vious.)1072 1118 y(As)20 b(an)g(illustration)e(of)h
(ho)o(w)g(the)i(resource)g(\\map")1010 1168 y(is)13 b(main)o(tained,)d(supp)q
(ose)15 b(the)e(follo)o(wing)e(three)j(resource)1010 1217 y(areas)g(w)o(ere)h
(a)o(v)n(ailable:)1072 1321 y Fl(\017)21 b Fn(an)10 b(area)g(of)g(size)h(15)e
(b)q(eginning)h(at)g(lo)q(cation)g(47)f(and)1114 1371 y(ending)k(at)h(lo)q
(cation)f(61;)1072 1466 y Fl(\017)21 b Fn(an)11 b(area)h(of)g(size)g(13)g
(spanning)f(addresses)j(27)e(to)g(39)1114 1515 y(inclusiv)o(e;)1072
1611 y Fl(\017)21 b Fn(an)13 b(area)h(of)g(size)g(7)g(b)q(eginning)f(at)h(lo)
q(cation)f(65.)1010 1714 y(Then)h(the)h(\\map")c(w)o(ould)j(con)o(tain:)1235
1818 y Fi(En)o(try)49 b(Size)g(Address)1285 1867 y Fn(0)120
b(13)133 b(27)1285 1917 y(1)120 b(15)133 b(47)1285 1967 y(2)d(7)144
b(65)1285 2017 y(3)130 b(0)145 b(??)1285 2067 y(4)121 b(??)135
b(??)1072 2168 y(If)15 b(a)g(request)j(for)d(a)g(space)h(of)f(size)i(7)e(w)o
(ere)h(receiv)o(ed,)1010 2218 y(the)d(area)g(w)o(ould)e(b)q(e)j(allo)q(cated)
e(starting)g(at)g(lo)q(cation)g(27,)1010 2268 y(and)i(the)g(\\map")e(w)o
(ould)h(b)q(ecome:)1235 2371 y Fi(En)o(try)49 b(Size)g(Address)1285
2421 y Fn(0)130 b(6)144 b(34)1285 2471 y(1)120 b(15)133 b(47)1285
2521 y(2)d(7)144 b(65)1285 2571 y(3)130 b(0)145 b(??)1285 2620
y(4)121 b(??)135 b(??)1072 2722 y(If)11 b(the)h(area)g(spanning)f(addresses)j
(40)d(to)g(46)g(inclusiv)o(e)1010 2772 y(is)17 b(returned)h(to)f(the)g(a)o(v)
n(ailable)e(list,)i(the)g(\\map")e(w)o(ould)1010 2822 y(b)q(ecome:)-30
2946 y(22)p eop
%%Page: 23 31
30 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1082
b(5)43 b(TWO)14 b(FILES)196 10 y Fi(En)o(try)48 b(Size)h(Address)245
60 y Fn(0)120 b(28)134 b(34)245 110 y(1)d(7)144 b(65)245 159
y(2)131 b(0)145 b(??)245 209 y(3)121 b(??)136 b(??)33 310 y(Note)24
b(ho)o(w)e(the)i(n)o(um)o(b)q(er)f(of)g(elemen)o(ts)g(has)g(actu-)-30
360 y(ally)h(decreased)i(b)o(y)f(one)g(b)q(ecause)h(of)e(amalgam)n(ation)-30
409 y(though)15 b(the)g(total)f(a)o(v)n(ailable)e(resources)17
b(ha)o(v)o(e)d(of)g(course)-30 459 y(increased.)33 512 y(Let)e(us)h(no)o(w)e
(turn)i(to)f(a)g(consideration)g(of)f(the)i(actual)-30 562
y(source)j(co)q(de.)-30 692 y Fg(5.3)56 b(mallo)r(c)16 b(\(2528\))-30
774 y Fn(The)e(b)q(o)q(dy)f(of)g(this)g(pro)q(cedure)i(consists)f(of)e(a)h
(\\for")f(lo)q(op)-30 824 y(to)i(searc)o(h)h(the)g(\\map")c(arra)o(y)j(un)o
(til)f(either:)-30 926 y Fi(\(a\))21 b Fn(the)15 b(end)g(of)g(the)g(list)g
(of)f(a)o(v)n(ailable)e(resources)18 b(is)c(en-)74 976 y(coun)o(tered;)h(or)
-30 1070 y Fi(\(b\))20 b Fn(an)12 b(area)h(large)f(enough)g(to)h(honour)f
(the)h(curren)o(t)h(re-)74 1120 y(quest)h(is)f(found;)-30 1220
y Fi(2534:)21 b Fn(The)11 b(\\for")e(statemen)o(t)i(initialises)e(\\bp")h(to)
g(p)q(oin)o(t)74 1269 y(to)16 b(the)h(\014rst)f(elemen)o(t)g(of)f(the)i
(resource)h(map.)23 b(A)o(t)74 1319 y(eac)o(h)12 b(succeeding)h(iteration)e
(\\bp")f(is)h(incremen)o(ted)74 1369 y(to)j(p)q(oin)o(t)f(to)h(the)h(next)f
(\\map")e(structure.)33 1471 y(Note)i(that)g(the)g(con)o(tin)o(uation)f
(condition)-30 1521 y(\\bp-)p Fh(>)p Fn(m)p 121 1521 13 2 v
14 w(size")g(is)f(an)g(expression,)h(whic)o(h)f(b)q(ecomes)h(zero)-30
1571 y(with)22 b(the)h(sen)o(tinel)g(is)f(referenced.)46 b(This)23
b(expression)-30 1621 y(could)k(ha)o(v)o(e)f(b)q(een)h(written)g(equiv)n
(alen)o(tly)e(but)i(more)-30 1671 y(transparen)o(tly)15 b(as)f(\\bp-)p
Fh(>)p Fn(m)p 429 1671 V 13 w(size)p Fh(>)p Fn(0".)33 1723
y(Note)e(also)g(that)g(no)g(explicit)f(test)j(for)d(the)i(end)g(of)e(the)-30
1773 y(arra)o(y)k(is)g(made.)20 b(\(It)15 b(can)g(b)q(e)h(sho)o(wn)f(that)g
(this)g(latter)g(is)-30 1823 y(not)h(necessary)i(pro)o(vided)e(CMAPSIZ,)g
(SMAPSIZ)h Fl(\025)f Fn(2)-30 1873 y(*)e(NPR)o(OC)g(!\))-30
1975 y Fi(2535:)21 b Fn(If)12 b(the)h(list)f(elemen)o(t)g(de\014nes)i(an)e
(area)h(at)f(least)h(as)74 2025 y(large)h(as)g(that)g(requested,)h(then)g
(...)-30 2119 y Fi(2536:)21 b Fn(Remem)o(b)q(er)d(the)i(address)g(of)f(the)h
(\014rst)g(unit)f(of)74 2169 y(the)c(area;)-30 2263 y Fi(2537:)21
b Fn(Incremen)o(t)f(the)h(address)g(stored)g(in)e(the)i(arra)o(y)74
2313 y(elemen)o(t;)-30 2407 y Fi(2538:)g Fn(Decremen)o(t)10
b(the)g(size)g(stored)g(in)f(the)h(elemen)o(t)f(and)74 2456
y(compare)16 b(the)i(result)f(with)g(zero)g(\(i.e.)27 b(w)o(as)16
b(it)h(an)74 2506 y(exact)e(\014t?\);)-30 2600 y Fi(2539:)21
b Fn(In)15 b(the)i(case)f(of)f(an)g(exact)h(\014t,)g(mo)o(v)o(e)e(all)g(the)i
(re-)74 2650 y(maining)8 b(list)h(elemen)o(ts)h(\(up)h(to)f(and)g(including)f
(the)74 2700 y(sen)o(tinel\))15 b(do)o(wn)e(one)h(place.)74
2772 y(Note)f(that)f(\\\(bp-l\)")f(p)q(oin)o(ts)h(to)g(the)g(structure)i(b)q
(e-)74 2822 y(fore)g(the)h(one)f(referenced)i(b)o(y)e(\\bp";)1010
17 y Fi(2542:)20 b Fn(The)28 b(\\while")f(con)o(tin)o(uation)f(condition)h
(do)q(es)1114 66 y Fi(not)11 b Fn(test)i(the)g(equalit)o(y)f(of)f
(\\\(bp-l\)-)p Fh(>)p Fn(m)p 1755 66 V 13 w(size")i(and)1114
116 y(bm-)p Fh(>)p Fn(m)p 1257 116 V 12 w(size)i(!)1114 186
y(The)f(v)n(alue)f(tested)j(is)d(the)i(v)n(alue)e(assigned)h(to)1114
235 y(\\\(bp-)p Fh(>)p Fn(m)p 1281 235 V 13 w(size")h(copied)f(from)e(\\bp-)p
Fh(>)p Fn(m)p 1770 235 V 14 w(size".)1114 305 y(\(Y)m(ou)k(are)h(forgiv)o(en)
e(for)i(not)f(recognising)h(this)f(at)1114 355 y(once.\);)1010
444 y Fi(2543:)k Fn(Return)15 b(the)g(address)h(of)e(the)h(area.)k(This)c
(repre-)1114 493 y(sen)o(ts)d(the)g(end)g(of)f(the)h(pro)q(cedure)h(and)e
(hence)i(v)o(ery)1114 543 y(de\014nitely)h(the)g(end)h(of)e(the)h(\\for")f
(lo)q(op.)1114 612 y(Note)g(that)f(a)h(v)n(alue)f(of)g(zero)h(returned)i
(means)d(\\no)1114 662 y(luc)o(k")18 b(This)g(is)g(based)h(on)g(the)g
(assumption)e(that)1114 712 y(no)c(v)n(alid)f(area)i(can)h(ev)o(er)f(b)q
(egin)g(at)g(lo)q(cation)f(zero.)1010 836 y Fg(5.4)55 b(mfree)17
b(\(2556\))1010 915 y Fn(This)i(pro)q(cedure)j(returns)f(the)f(area)g(of)f
(size)h(\\size")g(at)1010 965 y(address)c(\\aa")e(to)h(the)h(\\resource)h
(map")d(designated)h(b)o(y)1010 1015 y(\\mp".)h(The)d(b)q(o)q(dy)g(of)g(the)h
(pro)q(cedure)g(consists)h(of)d(a)h(one)1010 1065 y(line)18
b(\\for")h(statemen)o(t,)h(follo)o(w)o(ed)d(b)o(y)i(a)g(m)o(ultiline)d(\\if)s
(")1010 1115 y(statemen)o(t.)1010 1212 y Fi(2564:)k Fn(The)c(semicolon)e(at)h
(the)h(end)g(of)f(this)h(line)f(is)g(ex-)1114 1262 y(tremely)c(signi\014can)o
(t,)g(terminating)f(as)i(it)f(do)q(es)h(the)1114 1312 y(empt)o(y)17
b(statemen)o(t.)31 b(\(It)19 b(w)o(ould)e(aid)h(legibilit)o(y)e(if)1114
1361 y(this)10 b(c)o(haracter)h(w)o(ere)g(mo)o(v)o(ed)e(to)h(a)f(line)h(on)g
(its)g(o)o(wn,)1114 1411 y(as)k(is)f(done)h(on)g(line)g(2394.\))1114
1481 y(Dep)q(ending)h(on)h(y)o(our)f(p)q(oin)o(t)g(of)g(view,)g(this)g
(state-)1114 1530 y(men)o(t)k(demonstrates)i(either)g(the)g(p)q(o)o(w)o(er)g
(or)f(the)1114 1580 y(obscurit)o(y)e(of)g(the)h(\\C")f(language.)31
b(T)m(ry)18 b(writing)1114 1630 y(equiv)n(alen)o(t)d(co)q(de)i(to)f(this)g
(statemen)o(t)g(in)g(another)1114 1680 y(language)d(suc)o(h)h(as)g(P)o(ascal)
g(or)g(PL/1.)1114 1749 y(Step)k(\\bp")g(through)g(the)g(list)g(un)o(til)f(an)
h(elemen)o(t)1114 1799 y(is)13 b(encoun)o(tered)j(either)e(with)g(an)f
(address)i(greater)1114 1849 y(than)e(the)i(address)g(of)e(the)i(area)f(b)q
(eing)g(returned.)1114 1918 y(i.e.)j(not)d(\\bp-)p Fh(>)p Fn(m)p
1410 1918 V 13 w(addr)g Fl(\024)h Fn(a")1114 1987 y(or)e(whic)o(h)h
(indicates)g(the)h(end)f(of)g(the)g(list)1114 2057 y(i.e.)j(not)d(\\bp-)p
Fh(>)p Fn(m)p 1410 2057 V 13 w(size)h(!=)f(0";)1010 2146 y
Fi(2565:)20 b Fn(W)m(e)12 b(ha)o(v)o(e)g(no)o(w)g(lo)q(cated)g(the)h(elemen)o
(t)e(in)h(fron)o(t)g(of)1114 2195 y(whic)o(h)j(w)o(e)h(should)g(insert)g(the)
h(new)f(list)f(elemen)o(t.)1114 2245 y(The)h(question)f(is:)22
b(Will)13 b(the)k(list)e(gro)o(w)g(larger)g(b)o(y)1114 2295
y(one)20 b(elemen)o(t)f(or)h(will)f(amalgam)o(a)o(tion)e(k)o(eep)j(the)1114
2345 y(n)o(um)o(b)q(er)14 b(of)h(elemen)o(ts)g(the)h(same)f(or)g(ev)o(en)h
(reduce)1114 2395 y(it)d(b)o(y)h(one?)1114 2464 y(If)i(\\bp)g
Fh(>)h Fn(mp")e(w)o(e)h(are)h(not)g(trying)f(to)g(insert)h(at)1114
2514 y(the)d(b)q(eginning)f(of)h(the)g(list.)k(If)1114 2564
y(\(bp-l\)-)p Fh(>)p Fn(m)p 1302 2564 V 13 w(addr+\(bp-l\)-)p
Fh(>)p Fn(m)p 1616 2564 V 14 w(size==a)1114 2633 y(then)12
b(the)h(area)f(b)q(eing)g(return)h(abuts)f(the)h(previous)1114
2683 y(elemen)o(t)g(in)g(the)i(list;)1010 2772 y Fi(2566:)20
b Fn(Increase)14 b(the)f(size)g(of)f(the)g(previous)h(list)f(elemen)o(t)1114
2822 y(b)o(y)h(the)i(size)f(of)g(the)g(area)g(b)q(eing)g(returned;)1890
2946 y(23)p eop
%%Page: 24 32
31 bop -30 -144 a Fk(5)43 b(TWO)15 b(FILES)1083 b(UNIX)14 b(6th)h(Edition)g
(Commentary)-30 17 y Fi(2567:)21 b Fn(Do)q(es)16 b(the)g(area)f(b)q(eing)g
(returned)i(also)e(abut)g(the)74 66 y(next)g(elemen)o(t)e(of)g(the)i(list?)i
(If)d(so)-30 149 y Fi(2568:)21 b Fn(Add)15 b(the)h(size)g(of)e(the)i(next)f
(elemen)o(t)g(of)f(the)i(list)74 199 y(to)e(the)g(size)h(of)e(the)i(previous)
f(elemen)o(t;)-30 282 y Fi(2569:)21 b Fn(Mo)o(v)o(e)15 b(all)e(the)i
(remaining)e(list)h(elemen)o(ts)h(\(up)g(to)74 332 y(the)j(one)g(con)o
(taining)f(the)h(\014nal)f(zero)i(size\))f(do)o(wn)74 382 y(one)c(place.)74
448 y(Note)g(that)f(if)f(the)i(test)g(on)f(line)f(2567)h(fortuitously)74
498 y(giv)o(es)g(a)f(true)i(result)f(when)g(\\bp-)p Fh(>)p
Fn(m)p 667 498 13 2 v 14 w(size")g(is)g(zero)74 548 y(no)h(harm)e(is)i(done;)
-30 631 y Fi(2576:)21 b Fn(This)14 b(statemen)o(t)f(is)h(reac)o(hed)h(if)e
(the)h(test)h(on)e(line)74 681 y(2565)c(failed)f(i.e.)17 b(the)10
b(area)g(b)q(eing)f(returned)j(cannot)74 731 y(b)q(e)f(amalgam)o(a)o(ted)d
(with)i(the)g(previous)g(elemen)o(t)g(on)74 780 y(the)15 b(list.)74
847 y(Can)22 b(it)f(b)q(e)h(amalgam)o(ated)d(with)i(the)h(next)g(ele-)74
897 y(men)o(t?)f(Note)15 b(the)h(c)o(hec)o(k)g(that)f(the)h(next)f(elemen)o
(t)74 946 y(is)f(not)g(n)o(ull;)-30 1030 y Fi(2579:)21 b Fn(Pro)o(vided)i
(the)h(area)f(b)q(eing)h(returned)h(is)e(gen-)74 1079 y(uinely)11
b(non-n)o(ull)f(\(p)q(erhaps)i(this)g(test)g(should)f(ha)o(v)o(e)74
1129 y(b)q(een)20 b(made)e(so)q(oner?\))35 b(add)19 b(a)g(new)g(elemen)o(t)g
(to)74 1179 y(the)e(list)f(and)g(push)h(all)e(the)i(remaining)e(elemen)o(ts)
74 1229 y(up)f(one)g(place.)-30 1345 y Fg(5.5)56 b(In)19 b(conclusion)f(...)
-30 1422 y Fn(The)12 b(co)q(de)g(for)f(these)i(t)o(w)o(o)e(pro)q(cedures)i
(has)f(b)q(een)g(written)-30 1471 y(v)o(ery)e(tigh)o(tly)m(.)15
b(There)c(is)f(little,)f(if)g(an)o(y)m(,)g(\\fat")f(whic)o(h)i(could)-30
1521 y(b)q(e)h(remo)o(v)o(ed)e(to)h(impro)o(v)o(e)e(run)i(time)f(e\016ciency)
m(.)17 b(Ho)o(w)o(ev)o(er)-30 1571 y(it)d(w)o(ould)g(b)q(e)h(p)q(ossible)g
(to)f(write)h(these)g(pro)q(cedures)i(in)d(a)-30 1621 y(more)f(transparen)o
(t)i(fashion.)33 1671 y(If)k(y)o(ou)h(feel)g(strongly)f(on)h(this)g(p)q(oin)o
(t,)g(then)h(as)f(an)-30 1720 y(exercise,)k(y)o(ou)19 b(should)h(rewrite)i
(\\mfree")d(to)h(mak)o(e)f(its)-30 1770 y(function)14 b(more)f(easily)g
(discernible.)33 1820 y(Note)i(also)g(that)g(the)h(correct)h(functioning)d
(of)g(\\mal-)-30 1870 y(lo)q(c")j(and)f(\\mfree")f(dep)q(ends)j(on)e(correct)
i(initialisation)-30 1920 y(of)12 b(\\coremap")g(and)g(\\sw)o(apmap".)k(The)d
(co)q(de)g(to)f(do)h(this)-30 1970 y(o)q(ccurs)h(in)e(the)h(pro)q(cedure)h
(\\main")9 b(at)j(lines)g(1568,)f(1583.)-30 2086 y Fg(5.6)56
b(The)18 b(File)g(`prf.c')-30 2162 y Fn(This)12 b(\014le)g(is)g(found)g(on)g
(Sheets)h(23)f(and)g(24,)f(and)h(con)o(tains)-30 2212 y(the)j(follo)o(wing)c
(pro)q(cedures:)58 2304 y Ff(printf)20 b(\(2340\))108 b(panic)21
b(\(2416\))58 2353 y(printn)f(\(2369\))108 b(prdev)21 b(\(2433\))58
2403 y(putchar)f(\(2386\))86 b(deverror)20 b(\(2447\))33 2494
y Fn(The)i(calling)d(relationship)i(b)q(et)o(w)o(een)i(these)g(pro)q(ce-)-30
2544 y(dures)16 b(is)d(illustrated)h(b)q(elo)o(w:)1293 17 y
Ff(panic)86 b(deverror)1380 66 y(|)131 b(|)1380 116 y(|)87
b(prdev)1380 166 y(|)131 b(|)1402 216 y(\\)87 b(/)1402 266
y(printf)1446 316 y(|)1402 365 y(printn)1446 415 y(|)1402 465
y(putchar)1010 581 y Fg(5.7)55 b(prin)n(tf)19 b(\(2340\))1010
658 y Fn(The)11 b(pro)q(cedure)i(\\prin)o(tf)s(")e(pro)o(vides)g(a)g(direct,)
h(unsophis-)1010 707 y(ticated)j(lo)o(w-lev)o(el,)e(un)o(bu\013ered)j(w)o(a)o
(y)e(for)h(the)g(op)q(erating)1010 757 y(system)e(to)g(send)h(messages)f(to)g
(the)h(system)f(console)g(ter-)1010 807 y(minal.)i(It)e(is)g(used)h(during)e
(initialisation)e(and)j(to)g(rep)q(ort)1010 857 y(hardw)o(are)e(errors)g(or)g
(the)g(imm)o(inen)o(t)d(collapse)i(of)g(the)h(sys-)1010 907
y(tem.)1072 957 y(\(These)19 b(v)o(ersions)e(of)g(\\prin)o(tf)s(")f(and)h
(\\putc)o(har")h(run)1010 1006 y(in)11 b(k)o(ernel)h(mo)q(de)f(and)g(are)h
(similar)e(to,)h(but)h(not)g(the)g(same)1010 1056 y(as,)18
b(the)g(v)o(ersions)g(in)o(v)o(ok)o(ed)f(b)o(y)g(a)g(\\C")g(program)f(whic)o
(h)1010 1106 y(runs)g(in)f(user)h(mo)q(de.)22 b(The)16 b(latter)f(v)o
(ersions)h(of)f(\\prin)o(tf)s(")1010 1156 y(and)26 b(\\putc)o(har")h(liv)o(e)
f(in)g(the)h(library)e(\\/lib/lib)q(c.a".)1010 1206 y(Y)m(ou)20
b(ma)o(y)g(still)g(\014nd)h(it)g(useful)g(to)g(read)h(the)g(sections)1010
1255 y(\\PRINTF\(I)q(I)q(I\)")10 b(and)g(\\PUTCHAR\(I)q(I)q(I\)")g(of)f(the)i
(UPM)1010 1305 y(at)j(this)g(p)q(oin)o(t.\))1010 1396 y Fi(2340:)20
b Fn(The)25 b(programmer)c(m)o(ust)i(ha)o(v)o(e)g(b)q(een)i(carried)1114
1445 y(a)o(w)o(a)o(y)11 b(when)j(he)f(declared)h(all)d(the)j(parameters)e
(for)1114 1495 y(this)18 b(pro)q(cedure.)35 b(In)18 b(fact)h(the)g(pro)q
(cedure)i(b)q(o)q(dy)1114 1545 y(only)13 b(con)o(tains)h(references)i(to)e
(\\xl")f(and)g(\\fm)o(t".)1072 1635 y(This)21 b(serv)o(es)h(to)e(rev)o(eal)h
(one)g(of)f(the)i(facts)f(of)f(\\C")1010 1685 y(programmi)o(ng.)j(The)17
b(rules)g(for)f(matc)o(hing)f(parameters)1010 1735 y(in)j(pro)q(cedure)i
(calls)e(and)h(pro)q(cedure)h(declarations)f(are)1010 1785
y(not)12 b(enforced,)i(not)e(ev)o(en)i(with)e(resp)q(ect)j(to)d(the)h(n)o(um)
o(b)q(ers)1010 1835 y(of)g(parameters.)1072 1884 y(P)o(arameters)j(are)f
(placed)h(on)f(the)h(stac)o(k)g(in)e Fi(rev)o(erse)1010 1934
y Fn(order.)26 b(Th)o(us)17 b(when)g(\\prin)o(tf)s(")e(is)h(called)g(\\fm)o
(t")f(will)f(b)q(e)1010 1984 y(nearer)h(to)f(the)g(\\top)g(of)f(stac)o(k")h
(than)g(\\xl",)e(etc.)1184 2074 y Ff(|)65 b(.)h(|)1184 2124
y(---------)1184 2174 y(|)f(.)h(|)1184 2224 y(---------)1184
2274 y(|)f(.)h(|)174 b(stack)20 b(grows)h(down)1184 2323 y(---------)1184
2373 y(|)65 b(.)h(|)1184 2423 y(---------)1184 2473 y(|)44
b(x2)65 b(|)1184 2523 y(---------)1184 2573 y(|)44 b(xl)65
b(|)1184 2622 y(---------)1184 2672 y(|)44 b(fmt)f(|)1184 2722
y(---------)1184 2772 y(|)65 b(.)h(|)174 b(top)21 b(of)g(stack)1184
2822 y(---------)-30 2946 y Fn(24)p eop
%%Page: 25 33
32 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1082
b(5)43 b(TWO)14 b(FILES)33 17 y Fn(\\xl")9 b(has)i(a)f(higher)g(address)i
(then)f(\\fm)o(t")d(but)j(a)f(lo)o(w)o(er)-30 66 y(address)k(then)g(\\x2",)d
(b)q(ecause)j(stac)o(ks)g(gro)o(w)e(do)o(wn)o(w)o(ards)-30
116 y(on)i(the)h(PDP11.)-30 213 y Fi(2341:)21 b Fn(\\fm)o(t")7
b(ma)o(y)h(b)q(e)i(in)o(terpreted)h(as)f(a)f(constan)o(t)i(c)o(har-)74
263 y(acter)22 b(p)q(oin)o(ter.)40 b(This)21 b(declaration)g(is)g(\(almost\))
74 313 y(equiv)n(alen)o(t)13 b(to)74 382 y(\\c)o(har)h(*fm)o(t;")74
451 y(The)g(di\013erence)h(is)e(that)g(here)i(the)f(v)n(alue)e(of)h(\\fm)o
(t")74 501 y(cannot)h(b)q(e)h(c)o(hanged;)-30 590 y Fi(2346:)21
b Fn(\\adx")10 b(is)h(set)h(to)e(p)q(oin)o(t)h(to)f(\\xl".)16
b(The)c(expression)74 640 y(\\&xl")i(is)g(the)h(address)h(of)d(\\xl".)19
b(Note)14 b(that)h(since)74 689 y(\\xl")9 b(is)h(a)g(stac)o(k)g(lo)q(cation,)
f(this)h(expression)i(cannot)74 739 y(b)q(e)j(ev)n(aluated)e(at)h(compile)e
(time.)74 809 y(\(Man)o(y)18 b(of)g(the)h(expressions)h(y)o(ou)e(will)f
(\014nd)h(else-)74 858 y(where)f(in)o(v)o(olving)c(the)j(addresses)h(of)e(v)n
(ariables)g(or)74 908 y(arra)o(ys)e(are)g(e\013ectiv)o(e)h(b)q(ecause)g(they)
f Fi(can)f Fn(b)q(e)i(ev)n(al-)74 958 y(uated)h(at)e(compile)g(or)g(load)g
(time.\);)-30 1047 y Fi(2348:)21 b Fn(Extract)11 b(in)o(to)f(the)h(register)h
(\\c")e(successiv)o(e)j(c)o(har-)74 1096 y(acters)j(from)c(the)i(format)e
(string;)-30 1185 y Fi(2349:)21 b Fn(If)13 b(\\c")h(is)g(not)g(a)f(`\045')g
(then)h(...)-30 1274 y Fi(2350:)21 b Fn(If)10 b(\\c")g(is)h(a)f(n)o(ull)f(c)o
(haracter)j(\(`)p Ff(\\)p Fn(0'\),)e(this)g(indicates)74 1324
y(the)21 b(end)f(of)g(the)g(format)f(string)h(in)f(the)i(normal)74
1373 y(w)o(a)o(y)m(,)12 b(and)i(\\prin)o(tf)s(")f(terminates;)-30
1462 y Fi(2351:)21 b Fn(Otherwise)d(call)e(\\putc)o(har")g(to)h(send)g(the)h
(c)o(har-)74 1512 y(acter)d(to)f(the)g(system)g(console)g(terminal;)-30
1601 y Fi(2353:)21 b Fn(A)12 b(`\045')e(c)o(haracter)j(has)f(b)q(een)h(seen.)
18 b(Get)12 b(the)g(next)74 1650 y(c)o(haracter)k(\(it)d(had)h(b)q(etter)h
(not)f(b)q(e)h(the)f(`)p Ff(\\)p Fn(0')5 b(!\);)-30 1739 y
Fi(2354:)21 b Fn(If)f(this)h(c)o(haracter)h(is)f(a)f(`d')g(or)h(`l')e(or)i
(`o',)f(call)74 1789 y(\\prin)o(tn")13 b(passing)h(as)g(parameters)f(the)i(v)
n(alue)e(ref-)74 1839 y(erenced)j(b)o(y)e(\\adx")e(and)i(either)g(the)h(v)n
(alue)e(\\8")g(or)74 1889 y(\\10")h(dep)q(ending)i(on)f(whether)h(\\c")f(is)g
(`o')e(or)i(not.)74 1938 y(\(The)g(`d')e(and)g(`l')g(co)q(des)i(are)f
(clearly)g(equiv)n(alen)o(t.\))74 2008 y(\\prin)o(tn")k(expresses)k(the)d
(binary)g(n)o(um)o(b)q(ers)f(as)h(a)74 2057 y(set)d(of)f(digit)f(c)o
(haracters)j(according)e(to)g(the)g(radix)74 2107 y(supplied)f(as)g(the)h
(second)g(parameter;)-30 2196 y Fi(2356:)21 b Fn(If)d(the)h(editing)f(c)o
(haracter)i(is)e(`s',)h(then)g(all)e(but)74 2246 y(the)f(last)e(c)o(haracter)
i(of)e(a)h(n)o(ull)e(terminated)i(string)74 2296 y(is)j(to)f(b)q(e)i(sen)o(t)
f(to)g(the)g(terminal.)28 b(\\adx")17 b(should)74 2345 y(p)q(oin)o(t)d(to)f
(a)h(c)o(haracter)h(p)q(oin)o(ter)f(in)g(this)g(case;)-30 2434
y Fi(2361:)21 b Fn(Incremen)o(t)16 b(\\adx")e(to)i(p)q(oin)o(t)f(to)g(the)h
(next)g(w)o(ord)74 2484 y(in)c(the)h(stac)o(k)f(i.e.)17 b(to)12
b(the)h(next)g(parameter)f(passed)74 2534 y(to)i(\\prin)o(tf)s(";)-30
2622 y Fi(2362:)21 b Fn(Go)13 b(bac)o(k)g(to)h(line)f(2347)g(and)g(con)o(tin)
o(ue)h(scanning)74 2672 y(the)h(format)e(string.)19 b(En)o(th)o(usiasts)c
(for)f(structured)74 2722 y(programming)c(will)h(prefer)j(to)f(replace)h
(lines)f(2347)74 2772 y(and)e(this)g(b)o(y)g(\\while)f(\(1\))i
Fl(f)p Fn(")e(and)h(\\)p Fl(g)p Fn(")f(resp)q(ectiv)o(ely)74
2822 y(.)1010 17 y Fg(5.8)55 b(prin)n(tn)19 b(\(2369\))1010
98 y Fn(This)g(pro)q(cedure)j(calls)d(itself)g(recursiv)o(ely)i(in)e(order)h
(to)1010 148 y(generate)e(the)f(required)g(digits)f(in)g(the)h(required)h
(order.)1010 198 y(It)g(migh)o(t)e(b)q(e)j(p)q(ossible)g(to)f(co)q(de)h(this)
f(pro)q(cedure)i(more)1010 247 y(e\016cien)o(tly)f(but)g(not)g(more)e
(completely)m(.)32 b(\(An)o(yw)o(a)o(y)m(,)19 b(in)1010 297
y(view)12 b(of)g(the)h(implemen)o(tatio)o(n)d(of)i(\\putc)o(har",)g
(e\016ciency)1010 347 y(is)i(hardly)f(a)h(consideration)g(here.\))1072
399 y(Supp)q(ose)f(n)g(=)g(A*b)f(+)g(B)h(where)h(A)e(=)h(ldiv\(n,b\))e(and)
1010 449 y(where)16 b(B)f(=)h(lrem\(n,b\))e(satis\014es)i(0)d
Fl(\024)h Fh(B)i(<)e(b)p Fn(.)21 b(Then)16 b(in)1010 499 y(order)e(to)f
(displa)o(y)f(the)i(v)n(alue)f(for)g(n,)g(w)o(e)h(need)g(to)f(displa)o(y)1010
549 y(the)h(v)n(alue)g(for)f(A)h(follo)o(w)o(ed)e(b)o(y)i(the)h(v)n(alue)e
(for)g(B.)1072 601 y(The)h(latter)g(is)f(easy)h(for)f(b)h(=)g(8)f(or)h(10:)j
(it)c(consists)i(of)1010 651 y(a)f(single)h(c)o(haracter.)21
b(The)15 b(former)f(is)g(easy)h(if)f(A)h(=)g(0.)20 b(It)1010
701 y(is)c(also)g(easy)h(if)f(\\prin)o(tn")g(is)g(called)g(recursiv)o(ely)m
(.)27 b(Since)1010 751 y(A)14 b Fh(<)f Fn(n,)h(the)g(c)o(hain)f(of)g
(recursiv)o(e)i(calls)f(m)o(ust)e(terminate.)1010 852 y Fi(2375:)20
b Fn(Arithmetic)j(v)n(alues)h(corresp)q(onding)h(to)f(digits)1114
902 y(are)j(con)o(v)o(enien)o(tly)h(con)o(v)o(erted)g(to)f(their)h(corre-)
1114 952 y(sp)q(onding)10 b(c)o(haracter)j(represen)o(tations)f(b)o(y)f(the)g
(ad-)1114 1002 y(dition)i(of)g(the)h(c)o(haracter)i(`0'.)1072
1103 y(The)21 b(pro)q(cedures)h(\\ldiv")d(and)g(\\lrem")g(treat)i(their)1010
1153 y(\014rst)15 b(parameter)e(as)h(an)g(unsigned)g(in)o(teger)h(\(i.e.)j
(no)13 b(sign)1010 1203 y(extension,)23 b(when)e(a)g(16)g(bit)g(v)n(alue)f
(is)h(extended)h(to)f(a)1010 1252 y(32)16 b(bit)h(v)n(alue)f(b)q(efore)h(the)
h(actual)e(division)g(op)q(eration\).)1010 1302 y(They)k(ma)o(y)d(b)q(e)j
(found)f(b)q(eginning)g(on)g(lines)h(1392)e(and)1010 1352 y(1400)13
b(resp)q(ectiv)o(ely)m(.)1010 1482 y Fg(5.9)55 b(putc)n(har)20
b(\(2386\))1010 1563 y Fn(This)12 b(pro)q(cedure)i(transmits)d(to)h(the)h
(system)f(console)g(the)1010 1613 y(c)o(haracter)j(whic)o(h)f(w)o(as)g
(passed)h(as)f(a)f(parameter.)1072 1665 y(It)f(illustrates)g(in)f(a)h(small)d
(w)o(a)o(y)i(the)i(basic)f(features)h(of)1010 1715 y(i/o)g(op)q(erations)h
(on)g(the)g(PDP11)g(computer.)1010 1817 y Fi(2391:)20 b Fn(\\SW")e(is)g
(de\014ned)i(on)e(line)g(0166)g(as)h(the)g(v)n(alue)1114 1866
y(\\0177570".)33 b(This)20 b(is)g(the)h(k)o(ernel)f(address)h(of)e(a)1114
1916 y(read)d(only)e(pro)q(cessor)k(register)e(whic)o(h)g(stores)g(the)1114
1966 y(setting)e(of)f(the)i(console)f(switc)o(h)g(register.)1114
2037 y(The)c(meaning)e(of)h(the)i(statemen)o(t)f(is)g(clear:)16
b(get)10 b(the)1114 2087 y(con)o(ten)o(ts)17 b(at)g(lo)q(cation)f(0177570)f
(and)i(see)h(if)e(they)1114 2137 y(are)i(zero.)33 b(The)18
b(problem)g(is)g(to)g(express)i(this)f(in)1114 2187 y(\\C".)12
b(The)j(co)q(de)1114 2258 y(if)e(\(SW)g(==)i(0\))1114 2330
y(w)o(ould)8 b(not)h(ha)o(v)o(e)g(con)o(v)o(ey)o(ed)h(this)g(meaning.)k
(Clearly)1114 2380 y(\\SW")24 b(is)g(a)h(p)q(oin)o(ter)g(v)n(alue)f(whic)o(h)
h(should)f(b)q(e)1114 2430 y(dereferenced.)h(The)16 b(compiler)e(migh)o(t)f
(ha)o(v)o(e)i(b)q(een)1114 2479 y(c)o(hanged)f(to)g(accept)1114
2551 y(if)f(\(SW-)p Fh(>)h Fn(==)g(0\))1114 2622 y(but)19 b(as)h(it)f
(stands,)i(this)e(is)g(syn)o(tactically)g(incor-)1114 2672
y(rect.)26 b(By)16 b(in)o(v)o(en)o(ting)f(a)h(dumm)o(y)d(structure,)18
b(with)1114 2722 y(an)g(elemen)o(t)f(\\in)o(teg")g(\(see)j(line)e(0175\),)f
(the)i(pro-)1114 2772 y(grammer)11 b(has)j(found)g(a)g(satisfactory)g
(solution)f(to)1114 2822 y(his)g(problem.)1890 2946 y(25)p
eop
%%Page: 26 34
33 bop -30 -144 a Fk(5)43 b(TWO)15 b(FILES)1083 b(UNIX)14 b(6th)h(Edition)g
(Commentary)33 17 y Fn(Sev)o(eral)d(other)h(examples)e(of)g(this)h
(programming)c(de-)-30 66 y(vice)15 b(will)d(b)q(e)j(found)e(in)g(this)h(pro)
q(cedure)i(and)e(elsewhere.)33 116 y(In)19 b(hardw)o(are)h(terms,)h(the)f
(system)f(console)h(termi-)-30 166 y(nal)f(in)o(terface)g(consists)h(of)e
(four)h(16)f(bit)h(con)o(trol)g(regis-)-30 216 y(ters)g(whic)o(h)f(are)g(giv)
o(en)f(consecutiv)o(e)i(addresses)h(on)d(the)-30 266 y(Unibus)k(b)q(eginning)
f(at)g(k)o(ernel)h(address)h(0177560)c(\(see)-30 316 y(the)g(declaration)e
(for)g(\\KL")g(on)g(line)g(0165.\))25 b(F)m(or)16 b(a)g(de-)-30
365 y(scription)11 b(of)e(the)i(formats)e(and)h(usage)g(of)g(these)i
(registers,)-30 415 y(see)j(Chapter)e(Tw)o(en)o(t)o(y-F)m(our)g(of)f(the)h
(\\PDP11)g(P)o(eripher-)-30 465 y(als)h(Handb)q(o)q(ok".)33
515 y(In)e(soft)o(w)o(are)g(terms,)g(this)g(in)o(terface)h(is)f(the)h
(unnamed)-30 565 y(structure)19 b(whic)o(h)e(is)f(de\014ned)i(b)q(eginning)e
(on)g(line)g(2313,)-30 614 y(with)11 b(four)f(elemen)o(ts)h(whic)o(h)f(name)f
(the)j(four)e(con)o(trol)g(reg-)-30 664 y(isters.)21 b(It)15
b(do)q(es)g(not)f(matter)g(that)h(the)g(structure)h(is)f(un-)-30
714 y(named)h(b)q(ecause)j(it)d(is)h(not)g(necessary)i(to)e(allo)q(cate)f(an)
o(y)-30 764 y(instances)d(of)d(it)h(\(the)h(one)g(w)o(e)f(are)h(in)o
(terested)g(in)f(is)g(essen-)-30 814 y(tially)i(prede\014ned,)i(at)f(the)g
(address)h(giv)o(en)f(b)o(y)f(\\KL"\).)-30 903 y Fi(2393:)21
b Fn(While)10 b(bit)g(7)g(of)g(the)h(transmitter)f(status)i(register)74
953 y(\(\\XST"\))18 b(is)f(o\013,)g(k)o(eep)h(doing)f(nothing,)g(b)q(ecause)
74 1003 y(the)i(in)o(terface)g(is)f(not)g(ready)g(to)g(accept)h(another)74
1053 y(c)o(haracter.)33 1142 y(This)f(is)g(a)f(classic)i(case)g(of)e(\\busy)h
(w)o(aiting")f(where)-30 1192 y(the)g(pro)q(cessor)h(is)e(allo)o(w)o(ed)e(to)
i(cycle)h(uselessly)g(through)-30 1242 y(a)g(set)h(of)f(instructions)h(un)o
(til)e(some)g(externally)i(de\014ned)-30 1292 y(ev)o(en)o(t)e(o)q(ccurs.)22
b(Suc)o(h)15 b(w)o(aste)g(of)g(pro)q(cessing)h(p)q(o)o(w)o(er)f(can-)-30
1341 y(not)c(normally)d(b)q(e)j(tolerated)g(but)f(this)h(pro)q(cedure)h(is)e
(only)-30 1391 y(used)15 b(in)f(un)o(usual)f(situations.)-30
1481 y Fi(2395:)21 b Fn(The)15 b(need)h(for)e(this)h(statemen)o(t)g(is)f
(tied)h(up)g(with)74 1531 y(the)g(statemen)o(t)f(on)f(line)h(2405;)-30
1613 y Fi(2397:)21 b Fn(Sa)o(v)o(e)12 b(the)h(curren)o(t)h(con)o(ten)o(ts)g
(of)e(the)h(transmitter)74 1663 y(status)i(register;)-30 1745
y Fi(2398:)21 b Fn(Clear)9 b(the)h(transmitter)f(status)h(register)g
(prepara-)74 1795 y(tory)k(to)g(sending)g(the)h(next)f(c)o(haracter:)-30
1877 y Fi(2399:)21 b Fn(With)14 b(bit)h(7)f(of)g(the)i(con)o(trol)f(status)g
(register)h(re-)74 1927 y(set,)h(mo)o(v)o(e)c(the)k(next)f(c)o(haracter)h(to)
e(b)q(e)h(transmit-)74 1977 y(ted)k(to)f(the)g(transmitter)g(bu\013er)h
(register.)34 b(This)74 2027 y(initiates)14 b(the)g(next)g(output)h(op)q
(eration;)-30 2109 y Fi(2400:)21 b Fn(A)16 b(\\new)g(line")f(c)o(haracter)i
(needs)g(to)f(b)q(e)g(accom-)74 2159 y(panied)h(b)o(y)g(a)f(\\carriage)h
(return")h(c)o(haracter)g(and)74 2209 y(this)k(is)g(accomplished)f(b)o(y)g(a)
h(recursiv)o(e)h(call)e(on)74 2258 y(\\putc)o(har".)74 2325
y(A)27 b(couple)f(of)g(extra)g(\\delete")h(c)o(haracters)h(are)74
2374 y(thro)o(wn)12 b(in)g(also)f(to)h(allo)o(w)e(for)i(an)o(y)g(dela)o(ys)g
(in)f(com-)74 2424 y(pleting)19 b(the)g(carriage)g(return)h(op)q(eration)e
(at)h(the)74 2474 y(terminal;)-30 2556 y Fi(2405:)i Fn(This)g(call)g(on)g
(\\putc)o(har")g(with)g(an)g(argumen)o(t)74 2606 y(of)14 b(zero)i(e\013ectiv)
o(ely)g(results)f(in)g(a)f(re-execution)i(of)74 2656 y(lines)e(2391)f(to)h
(2394.)74 2722 y(\(It)k(is)f(v)o(ery)h(hard)f(to)g(see)i(wh)o(y)e(the)h
(programmer)74 2772 y(c)o(hose)12 b(to)g(use)g(a)f(recursiv)o(e)h(call)f
(here)h(in)f(preference)74 2822 y(to)g(simply)e(rep)q(eating)j(lines)f(2393)g
(and)g(2394,)f(since)1114 17 y(b)q(oth)16 b(co)q(de)h(e\016ciency)g(and)f
(compactness)g(not)g(to)1114 66 y(men)o(tion)c(clarit)o(y)h(seem)h(to)g(ha)o
(v)o(e)f(su\013ered.\);)1010 154 y Fi(2406:)20 b Fn(Restore)15
b(the)g(con)o(ten)o(ts)g(of)e(the)h(transmitter)g(sta-)1114
204 y(tus)c(register.)18 b(In)10 b(particular)g(if)f(bit)g(6)h(w)o(as)g
(formerly)1114 254 y(set)k(to)g(enable)g(in)o(terrupts)h(then)g(this)f
(resets)i(it.)1010 377 y Fg(5.10)56 b(panic)18 b(\(2419\))1010
455 y Fn(This)11 b(pro)q(cedure)j(is)e(called)f(from)f(a)h(n)o(um)o(b)q(er)g
(of)h(lo)q(cations)1010 505 y(in)d(the)i(op)q(erating)f(system.)16
b(\(e.g.)h(line)9 b(1605\).)16 b(When)10 b(cir-)1010 555 y(cumstances)16
b(exist)f(under)h(whic)o(h)f(con)o(tin)o(ued)g(op)q(eration)1010
605 y(of)e(the)i(system)e(seems)h(undesirable.)1072 656 y(UNIX)h(do)q(es)h
(not)f(profess)h(to)e(b)q(e)i(a)f(\\fault)e(toleran)o(t")1010
706 y(or)g(\\fail)e(soft")i(system,)f(and)h(in)g(man)o(y)e(cases)j(the)g
(call)e(on)1010 755 y(\\panic")17 b(can)i(b)q(e)g(in)o(terpreted)g(as)g(a)f
(fairly)e(unsophisti-)1010 805 y(cated)f(resp)q(onse)g(to)f(a)g(straigh)o
(tforw)o(ard)f(problem.)1072 856 y(Ho)o(w)o(ev)o(er)26 b(more)f(complicated)f
(resp)q(onses)k(require)1010 906 y(additional)15 b(co)q(de,)k(lots)e(of)g
(it,)g(and)g(this)g(is)h(con)o(trary)f(to)1010 956 y(the)d(general)g(UNIX)h
(philosoph)o(y)d(of)i(\\k)o(eep)g(it)g(simple".)1010 1052 y
Fi(2419:)20 b Fn(The)13 b(reason)f(for)f(this)h(statemen)o(t)g(is)g(giv)o(en)
f(in)g(the)1114 1102 y(commen)o(t)g(b)q(eginning)j(at)f(line)h(2323;)1010
1190 y Fi(2420:)20 b Fn(\\up)q(date")e(causes)h(all)d(the)i(large)g(blo)q(c)o
(k)f(bu\013ers)1114 1240 y(to)c(b)q(e)i(written)f(out.)k(See)d(Chapter)g(Tw)o
(en)o(t)o(y;)1010 1327 y Fi(2421:)20 b Fn(\\prin)o(tf)s(")d(is)g(called)g
(with)g(a)g(format)e(string)i(and)1114 1377 y(one)d(parameter,)f(whic)o(h)h
(w)o(as)f(passed)i(to)f(\\panic";)1010 1465 y Fi(2422:)20 b
Fn(This)12 b(\\for")f(statemen)o(t)h(de\014nes)h(an)e(in\014nite)h(lo)q(op)
1114 1515 y(in)k(whic)o(h)h(the)g(only)g(action)f(is)h(a)g(call)f(on)h(the)g
(as-)1114 1565 y(sem)o(bly)12 b(language)h(pro)q(cedure)j(\\idle")d
(\(1284\).)1114 1633 y(\\idle")20 b(drops)i(the)g(pro)q(cessor)h(priorit)o(y)
d(to)i(zero,)1114 1683 y(and)17 b(p)q(erforms)f(a)h(\\w)o(ait".)27
b(This)17 b(is)h(a)e(\\do)h(noth-)1114 1733 y(ing")11 b(instruction)i(of)f
(inde\014nite)h(duration.)18 b(It)12 b(ter-)1114 1783 y(minates)g(when)j(a)e
(hardw)o(are)i(in)o(terrupt)f(o)q(ccurs.)1114 1852 y(An)d(in\014nite)h(set)g
(of)f(calls)g(on)g(\\idle")g(is)g(b)q(etter)i(than)1114 1902
y(the)21 b(execution)g(of)f(a)h(\\halt")e(instruction,)j(since)1114
1951 y(an)o(y)15 b(i/o)h(activities)g(whic)o(h)g(w)o(ere)h(under)g(w)o(a)o(y)
f(can)1114 2001 y(b)q(e)f(allo)o(w)o(ed)f(to)g(complete)g(and)h(the)g(system)
g(clo)q(c)o(k)1114 2051 y(can)f(k)o(eep)g(tic)o(king.)1114
2120 y(The)d(only)f(w)o(a)o(y)h(for)f(the)i(op)q(erator)g(to)f(reco)o(v)o(er)
h(from)1114 2170 y(a)j(\\panic")h(is)g(to)g(reinitialise)f(the)i(system,)f
(\(after)1114 2219 y(taking)d(a)g(core)i(dump,)d(if)h(desired\).)1010
2342 y Fg(5.11)56 b(prdev)17 b(\(2433\),)h(dev)n(error)g(\(2447\))1010
2421 y Fn(These)g(pro)q(cedures)h(pro)o(vide)e(w)o(arning)f(messages)i(when)
1010 2471 y(errors)11 b(are)g(o)q(ccurring)f(in)g(i/o)f(op)q(erations.)17
b(A)o(t)10 b(this)g(stage,)1010 2521 y(their)24 b(only)e(in)o(terest)j(is)e
(as)h(examples)e(of)h(the)h(use)h(of)1010 2570 y(\\prin)o(tf)s(".)1010
2693 y Fg(5.12)56 b(Included)18 b(Files)1010 2772 y Fn(It)i(will)f(b)q(e)i
(noted)f(that)g(whereas)i(the)f(\014le)f(\\mallo)q(c.c")1010
2822 y(con)o(tains)15 b(no)h(request)h(to)e(include)h(other)g(\014les,)g
(requests)-30 2946 y(26)p eop
%%Page: 27 35
34 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1082
b(5)43 b(TWO)14 b(FILES)-30 17 y Fn(to)20 b(include)h(four)e(separate)j
(\014les)e(are)h(included)f(at)g(the)-30 66 y(b)q(eginning)14
b(of)f(\\prf.c".)33 116 y(\(The)i(observ)n(an)o(t)g(reader)h(will)e(note)h
(that)g(these)h(\014les)-30 166 y(are)i(presumed)f(to)f(reside)i(one)f(lev)o
(el)f(higher)h(in)f(the)i(\014le)-30 216 y(hierarc)o(h)o(y)d(than)f(\\prf.c")
f(itself.\))33 266 y(The)h(statemen)o(t)f(on)g(line)g(2304)f(is)h(to)g(b)q(e)
h(understo)q(o)q(d)-30 316 y(as)i(if)f(it)g(w)o(ere)h(replaced)h(b)o(y)e(the)
h(en)o(tire)h(con)o(ten)o(ts)f(of)f(the)-30 365 y(\014le)k(\\param.h".)29
b(This)18 b(then)h(supplies)g(de\014nitions)f(for)-30 415 y(the)11
b(iden)o(ti\014ers)f(\\SW",)f(\\KL")g(and)h(\\in)o(teg")f(whic)o(h)h(o)q
(ccur)-30 465 y(in)k(\\putc)o(har".)33 515 y(W)m(e)21 b(noted)i(earlier)f
(that)g(declarations)h(for)e(\\KL",)-30 565 y(\\SW")h(and)g(\\in)o(teg")g(o)q
(ccurred)i(on)e(lines)h(0165,)g(0166)-30 614 y(and)e(0175)f(resp)q(ectiv)o
(ely)m(,)j(but)f(this)f(w)o(ould)f(ha)o(v)o(e)h(b)q(een)-30
664 y(meaningless,)10 b(if)h(the)g(\014le)g(\\param.h")e(had)i(not)f(b)q(een)
j(\\in-)-30 714 y(cluded")i(in)e(\\prf.c".)33 764 y(The)22
b(\014les)g(\\buf.h")e(and)i(\\conf.h")e(ha)o(v)o(e)i(b)q(een)g(in-)-30
814 y(cluded)10 b(to)f(pro)o(vide)h(declarations)f(for)g(\\d)p
618 814 13 2 v 15 w(ma)r(jor",)e(\\d)p 826 814 V 15 w(minor",)-30
863 y(\\b)p 16 863 V 15 w(dev")15 b(and)f(\\b)p 255 863 V 15
w(blkno",)f(whic)o(h)h(are)g(used)i(in)d(\\prdev")-30 913 y(and)h(\\dev)o
(error".)33 963 y(The)j(reason)h(for)f(the)h(inclusion)f(of)f(the)i(fourth)f
(\014le,)-30 1013 y(\\seg.h",)f(is)g(a)g(little)g(harder)h(to)f(\014nd.)25
b(In)16 b(fact)g(it)g(is)g(not)-30 1063 y(necessary)h(as)e(the)h(co)q(de)g
(stands,)f(and)g(the)h(author)e(o)o(w)o(es)-30 1113 y(his)h(readers)h(an)e
(ap)q(ology)m(.)k(In)d(editing)e(the)j(source)f(co)q(de,)-30
1162 y(it)g(seemed)g(lik)o(e)e(a)i(go)q(o)q(d)f(idea)g(to)h(mo)o(v)o(e)e(the)
i(declaration)-30 1212 y(for)f(\\in)o(teg")f(from)f(\\seg.h")i(to)g
(\\param.h".)h(Q.E.D.)33 1262 y(Note)f(that)g(the)h(v)n(ariable)d
(\\panicstr")i(\(2328\))g(is)f(also)-30 1312 y(global)e(but)i(since)g(it)f
(is)h(not)f(referenced)j(outside)e(\\prf.c",)-30 1362 y(its)h(declaration)e
(has)h(not)g(b)q(een)i(placed)e(in)f(an)o(y)h(\\.h")f(\014le.)1890
2946 y(27)p eop
%%Page: 28 36
35 bop -30 -144 a Fk(6)43 b(GETTING)15 b(ST)m(AR)m(TED)910
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(6)70 b(Getting)21
b(Started)-30 108 y Fn(This)11 b(c)o(hapter)h(considers)g(the)f(sequence)i
(of)d(ev)o(en)o(ts)i(whic)o(h)-30 158 y(o)q(ccur)g(when)e(UNIX)h(is)f(\\reb)q
(o)q(oted")h(i.e.)16 b(it)10 b(is)g(loaded)g(and)-30 208 y(initiated)k(in)f
(an)h(idle)f(mac)o(hine.)33 258 y(A)d(study)h(of)f(the)h(initialisation)c
(pro)q(cess)13 b(is)d(of)f(in)o(terest)-30 308 y(in)15 b(itself,)f(but)g
(more)g(imp)q(ortan)o(tly)m(,)e(it)i(allo)o(ws)f(a)h(n)o(um)o(b)q(er)-30
358 y(of)e(imp)q(ortan)o(t)e(features)k(of)d(the)i(system)f(to)g(b)q(e)h
(presen)o(ted)-30 408 y(in)h(an)g(orderly)g(manner.)33 458
y(The)f(op)q(erating)h(system)f(ma)o(y)e(ha)o(v)o(e)i(to)g(b)q(e)h(restarted)
-30 508 y(in)d(the)h(aftermath)e(of)h(a)g(system)g(crash.)18
b(It)11 b(will)f(also)h(ha)o(v)o(e)-30 558 y(to)k(b)q(e)g(restarted)h
(frequen)o(tly)f(for)f(quite)h(ordinary)m(,)e(op)q(er-)-30
607 y(ational)j(reasons,)h(e.g.)26 b(after)17 b(an)f(o)o(v)o(ernigh)o(t)g(sh)
o(utdo)o(wn.)-30 657 y(If)h(w)o(e)h(assume)e(the)i(latter)f(case,)i(then)e(w)
o(e)h(can)f(assume)-30 707 y(that)d(all)e(the)i(disk)f(\014les)h(are)g(in)o
(tact)f(and)g(that)g(no)g(sp)q(ecial)-30 757 y(circumstance)i(needs)g(to)f(b)
q(e)g(recognised)h(or)f(dealt)g(with.)33 807 y(In)c(particular,)h(w)o(e)g
(can)g(assume)f(there)i(is)e(a)g(\014le)h(in)f(the)-30 857
y(ro)q(ot)18 b(directory)g(called)g(\\/unix",)f(whic)o(h)g(is)h(the)g(ob)r
(ject)-30 907 y(co)q(de)d(for)f(the)g(op)q(erating)g(system.)33
957 y(This)i(\014le)f(b)q(egan)i(life)e(as)h(a)f(set)i(of)e(source)j(\014les)
e(suc)o(h)-30 1007 y(as)h(w)o(e)f(are)h(in)o(v)o(estigating.)24
b(These)18 b(w)o(ere)f(compiled)e(and)-30 1057 y(link)o(ed)f(together)i(in)e
(the)h(normal)d(w)o(a)o(y)i(to)g(form)f(a)h(single)-30 1106
y(ob)r(ject)d(program)d(\014le,)h(and)h(stored)g(in)f(the)h(ro)q(ot)g
(directory)m(.)-30 1225 y Fg(6.1)56 b(Op)r(erator)18 b(Actions)-30
1302 y Fn(Reinitialisation)10 b(requires)j(op)q(erator)f(action)g(at)f(the)i
(pro-)-30 1352 y(cessor)j(console.)i(The)d(op)q(erator)f(m)o(ust:)33
1445 y Fl(\017)20 b Fn(stop)10 b(the)g(pro)q(cessor)h(b)o(y)e(setting)h(the)f
(\\enable/halt")74 1495 y(switc)o(h)14 b(to)g(\\halt";)33 1580
y Fl(\017)20 b Fn(set)13 b(the)g(switc)o(h)f(register)i(with)d(the)i(address)
h(of)d(the)74 1630 y(hardw)o(are)k(b)q(o)q(otstrap)f(loader)g(program;)33
1714 y Fl(\017)20 b Fn(depress)12 b(and)d(release)h(the)g(\\)f(load)f
(address")j(switc)o(h;)33 1799 y Fl(\017)20 b Fn(mo)o(v)o(e)12
b(the)j(\\enable/halt")e(switc)o(h)h(to)g(\\enable";)33 1884
y Fl(\017)20 b Fn(depress)c(and)e(release)h(the)f(\\start")g(switc)o(h.)33
1977 y(This)j(activ)n(ates)g(the)g(b)q(o)q(otstrap)h(program)d(whic)o(h)i(is)
-30 2027 y(p)q(ermanen)o(tly)d(recorded)h(in)f(a)f(R)o(OM)h(in)f(the)i(pro)q
(cessor.)33 2077 y(The)22 b(b)q(o)q(otstrap)h(loader)e(program)g(loads)g(a)h
(larger)-30 2127 y(loader)12 b(program)d(\(from)h(blo)q(c)o(k)h(#0)g(of)g
(the)h(system)f(disk\),)-30 2176 y(whic)o(h)j(lo)q(oks)g(for)f(and)h(loads)f
(a)h(\014le)g(called)g(\\/unix")e(in)o(to)-30 2226 y(the)j(lo)o(w)e(part)h
(of)f(memory)m(.)33 2277 y(It)c(then)h(transfers)h(con)o(trol)e(to)g(the)h
(instruction)f(loaded)-30 2326 y(at)14 b(address)h(zero.)33
2377 y(Address)20 b(zero)f(is)f(o)q(ccupied)h(b)o(y)f(a)g(branc)o(h)h
(instruc-)-30 2426 y(tion)11 b(\(line)g(0508\),)f(whic)o(h)h(branc)o(hes)i
(to)d(lo)q(cation)h(000040,)-30 2476 y(whic)o(h)28 b(con)o(tains)g(a)f(jump)f
(instruction)i(\(line)f(0522\),)-30 2526 y(whic)o(h)17 b(jumps)e(to)h(the)h
(instruction)g(lab)q(elled)f(\\start")g(in)-30 2576 y(the)f(\014le)f
(\\m40.s")d(\(line)j(0612\).)-30 2694 y Fg(6.2)56 b(start)19
b(\(0612\))-30 2772 y Fi(0613:)i Fn(The)c(\\enabled")g(bit)f(of)g(the)h
(memory)e(manage-)74 2822 y(men)o(t)j(status)h(register,)h(SR0,)e(is)g
(tested.)33 b(If)18 b(this)1114 17 y(set,)f(the)f(pro)q(cessor)i(will)c(dw)o
(ell)i(forev)o(er)g(in)g(a)g(t)o(w)o(o)1114 66 y(instruction)g(lo)q(op.)26
b(This)16 b(register)i(will)d(normally)1114 116 y(b)q(e)21
b(cleared)h(when)g(the)g(op)q(erator)f(activ)n(ates)g(the)1114
166 y(\\clear")14 b(button)g(on)g(the)h(console)g(b)q(efore)g(starting)1114
216 y(the)f(system.)1114 281 y(A)f(n)o(um)o(b)q(er)g(of)g(reasons)h(ha)o(v)o
(e)g(b)q(een)g(suggested)h(for)1114 331 y(the)f(necessit)o(y)h(for)e(this)g
(lo)q(op.)k(The)d(most)e(lik)o(ely)g(is)1114 381 y(that)f(in)f(the)i(case)g
(of)e(a)h(double)g(bus)g(timeout)f(error,)1114 431 y(the)g(pro)q(cessor)i
(will)d(branc)o(h)h(to)g(lo)q(cation)f(zero,)i(and)1114 481
y(in)16 b(this)i(situation)e(it)h(should)g(not)g(b)q(e)h(allo)o(w)o(ed)e(to)
1114 530 y(go)d(further.)1010 611 y Fi(0615:)20 b Fn(\\reset")d(clears)g(and)
f(initialises)e(all)h(the)i(p)q(eriph-)1114 661 y(eral)c(device)i(con)o(trol)
f(and)f(status)i(registers)1114 726 y Fk(The)24 b(system)g(wil)r(l)e(now)j(b)
n(e)f(running)g(in)g(kernel)1114 776 y(mo)n(de)15 b(with)f(memory)h
(management)h(disable)n(d.)1010 857 y Fi(0619:)k Fn(KISA0)j(and)f(KISD0)g
(are)h(the)g(high)f(core)h(ad-)1114 907 y(dresses)d(of)e(the)i(\014rst)f
(pair)f(of)g(k)o(ernel)h(mo)q(de)f(seg-)1114 957 y(men)o(tation)d(registers.)
30 b(The)18 b(\014rst)g(six)f(k)o(ernel)h(de-)1114 1007 y(scriptor)25
b(registers)i(are)e(initialised)e(to)i(077406,)1114 1056 y(whic)o(h)9
b(is)g(the)h(description)g(of)f(a)g(full)g(size,)h(4K)g(w)o(ord,)1114
1106 y(read/write)k(segmen)o(t.)1114 1172 y(The)j(\014rst)g(six)f(k)o(ernel)h
(address)h(registers)g(are)f(ini-)1114 1221 y(tialised)k(to)i(0,)g(0200,)g
(0400,)g(0600,)g(01000)e(and)1114 1271 y(01200)12 b(resp)q(ectiv)o(ely)m(.)
1114 1337 y(As)18 b(a)f(result)i(the)f(\014rst)g(six)g(k)o(ernel)g(segmen)o
(ts)g(are)1114 1386 y(initialised)f(\(without)h(an)o(y)h(reference)i(to)e
(the)g(ac-)1114 1436 y(tual)g(size)h(of)f(UNIX\))h(to)f(p)q(oin)o(t)g(to)h
(the)g(\014rst)g(six)1114 1486 y(4K)13 b(w)o(ord)h(segmen)o(ts)g(of)f(ph)o
(ysical)h(memory)m(.)h(Th)o(us)1114 1536 y(the)d(\\k)o(ernel)f(to)h(ph)o
(ysical)f(address")h(translation)f(is)1114 1586 y(trivial)k(for)h(k)o(ernel)h
(addresses)h(in)e(the)h(range)g(0)f(to)1114 1636 y(0137777;)1010
1716 y Fi(0632:)k Fn(\\)p 1162 1716 13 2 v 15 w(end")12 b(is)g(a)g(loader)g
(pseudo)h(v)n(ariable)e(whic)o(h)h(de-)1114 1766 y(\014nes)g(the)g(exten)o(t)
h(of)e(the)h(program)e(co)q(de)j(and)e(data)1114 1816 y(area.)31
b(This)18 b(v)n(alue)g(is)g(rounded)h(up)f(to)h(the)g(next)1114
1866 y(m)o(ultiple)13 b(of)j(64)f(b)o(ytes)i(and)f(is)f(stored)i(in)f(the)g
(ad-)1114 1916 y(dress)21 b(register)g(for)e(the)h(sev)o(en)o(th)h(segmen)o
(t)f(\(seg-)1114 1965 y(men)o(t)13 b(#6\).)1114 2031 y(Note)e(that)h(the)f
(address)i(of)d(this)i(register)g(is)f(stored)1114 2081 y(in)k(\\k)n(a6",)g
(so)h(that)h(the)f(con)o(ten)o(t)h(of)f(this)g(register)1114
2130 y(is)d(accessible)j(as)e(\\*k)n(a6";)1010 2211 y Fi(0634:)20
b Fn(The)10 b(corresp)q(onding)g(descriptor)h(register)f(is)f(loaded)1114
2261 y(with)h(a)h(v)n(alue)g(whic)o(h)g(\(since)h(\\USIZE")f(is)g(equal)g(to)
1114 2311 y(16\))g(is)h(the)g(description)h(of)e(a)h(read/write)g(segmen)o(t)
1114 2361 y(whic)o(h)h(is)h(16)f(x)h(32)g(=)g(512)f(w)o(ords)h(long.)1114
2426 y(The)h(v)n(alue)g(007406)f(is)h(obtained)g(b)o(y)g(shifting)f(the)1114
2476 y(o)q(ctal)19 b(v)n(alue)g(017)f(eigh)o(t)i(places)g(to)f(the)h(left)f
(and)1114 2526 y(then)14 b(\\or"ing)f(in)g(the)i(v)n(alue)e(6;)1010
2607 y Fi(0641:)20 b Fn(The)11 b(eigh)o(th)f(segmen)o(t)f(is)h(mapp)q(ed)f
(in)o(to)g(the)i(high-)1114 2657 y(est)16 b(4K)f(w)o(ord)g(segmen)o(t)g(of)g
(the)h(ph)o(ysical)f(address)1114 2706 y(space.)1114 2772 y(It)10
b(should)f(b)q(e)i(noted)f(that)g(with)g(memory)d(manage-)1114
2822 y(men)o(t)i(disabled,)h(the)h(same)f(translation)f(is)h(already)-30
2946 y(28)p eop
%%Page: 29 37
36 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)910
b(6)43 b(GETTING)14 b(ST)m(AR)m(TED)74 17 y Fn(in)f(force)h(i.e.)j(addresses)
e(in)e(the)h(highest)g(4K)f(w)o(ord)74 66 y(segmen)o(t)20 b(of)g(the)h(32K)f
(program)f(address)j(space)74 116 y(are)11 b(automatically)6
b(mapp)q(ed)k(in)o(to)f(the)h(highest)h(4K)74 166 y(w)o(ord)j(segmen)o(t)f
(of)h(the)g(ph)o(ysical)g(address)h(space.)33 267 y(W)m(e)j(ma)o(y)f(note)h
(that)h(from)e(this)i(p)q(oin)o(t)f(on,)h(all)e(the)-30 317
y(k)o(ernel)d(mo)q(de)d(segmen)o(tation)h(registers)i(will)d(remain)h(un-)-30
367 y(c)o(hanged)17 b(with)g(the)g(single)f(exception)h(of)f(the)h
Fi(sev)o(en)o(th)-30 417 y(k)o(ernel)d(segmen)o(tation)f(address)h(register)p
Fn(.)33 469 y(This)e(register)h(is)f(explicitly)f(manipulated)f(b)o(y)h(UNIX)
-30 519 y(to)k(p)q(oin)o(t)g(to)f(a)h(v)n(ariet)o(y)f(of)g(lo)q(cations)h(in)
f(ph)o(ysical)g(mem-)-30 569 y(ory)m(.)k(Eac)o(h)c(suc)o(h)g(lo)q(cation)e
(is)i(the)g(b)q(eginning)e(of)h(an)h(area)-30 619 y(512)c(w)o(ords)g(long,)f
(kno)o(wn)h(as)g(a)g(\\p)q(er)h(pro)q(cess)h(data)d(area".)33
671 y(The)18 b(sev)o(en)o(th)h(k)o(ernel)f(address)h(register)g(is)e(no)o(w)h
(set)-30 721 y(to)d(p)q(oin)o(t)e(to)h(the)h(segmen)o(t)f(whic)o(h)g(will)f
(b)q(ecome)h(the)h(p)q(er)-30 771 y(pro)q(cess)h(data)e(area)g(for)f(pro)q
(cess)j(#0.)-30 872 y Fi(0646:)21 b Fn(The)12 b(stac)o(k)f(p)q(oin)o(ter)h
(is)f(set)h(to)g(p)q(oin)o(t)e(to)i(the)f(high-)74 922 y(est)k(w)o(ord)f(of)f
(the)i(p)q(er)f(pro)q(cess)i(data)e(area;)-30 1015 y Fi(0647:)21
b Fn(By)13 b(incremen)o(ting)f(the)h(v)n(alue)f(of)h(SR0)f(from)f(zero)74
1065 y(to)19 b(one,)g(the)g(\\memory)d(managemen)o(t)g(enabled")74
1114 y(bit)e(is)g(con)o(v)o(enien)o(tly)f(set.)33 1216 y Fk(F)m(r)n(om)d
(this)h(p)n(oint,)h(al)r(l)e(pr)n(o)n(gr)n(am)g(addr)n(esses)i(ar)n(e)e(tr)n
(ans-)-30 1266 y(late)n(d)h(to)g(physic)n(al)g(addr)n(esses)g(the)g(memory)g
(management)-30 1315 y(har)n(dwar)n(e.)-30 1417 y Fi(0649:)21
b Fn(\\bss")d(refers)h(to)e(the)h(second)h(part)f(of)f(the)h(pro-)74
1466 y(gram)h(data)h(area,)i(whic)o(h)e(is)h(not)f(initialised)f(b)o(y)74
1516 y(the)12 b(loader)g(\(see)h(\\A.OUT\(V\)")e(in)g(the)i(PM\).)e(The)74
1566 y(lo)o(w)o(er)g(and)g(upp)q(er)h(limits)c(of)j(this)g(area)g(are)h
(de\014ned)74 1616 y(b)o(y)j(the)g(loader)f(pseudo)i(v)n(ariables,)e(\\)p
678 1616 13 2 v 14 w(edata")h(and)74 1666 y(\\)p 97 1666 V
15 w(end")f(resp)q(ectiv)o(ely;)-30 1759 y Fi(0668:)21 b Fn(The)c(pro)q
(cessor)h(status)f(w)o(ord)f(\(PS\))g(is)g(c)o(hanged)74 1809
y(to)25 b(indicate)f(that)h(the)g(\\previous)g(mo)q(de")e(w)o(as)74
1858 y(\\user)15 b(mo)q(de".)74 1930 y(This)20 b(prepares)h(the)g(w)o(a)o(y)e
(for)h(the)g(in)o(v)o(estigation)74 1980 y(and)27 b(initialisation)d(of)j
(the)g(areas)h(of)e(ph)o(ysical)74 2029 y(memory)12 b(whic)o(h)j(are)g(not)g
(part)g(of)f(the)h(k)o(ernel)g(ad-)74 2079 y(dress)22 b(space.)38
b(\(This)20 b(in)o(v)o(olv)o(es)f(use)i(of)e(the)i(sp)q(e-)74
2129 y(cial)h(instructions)i(\\m)o(tpi")c(and)j(\\mfpi")d(\(Mo)o(v)o(e)74
2179 y(T)m(o/F)m(rom)7 b(Previous)j(Instruction)g(space\))g(together)74
2229 y(with)h(some)e(manipulation)f(of)i(the)h(user)h(mo)q(de)d(seg-)74
2279 y(men)o(tation)j(registers.\);)-30 2372 y Fi(0669:)21
b Fn(A)11 b(call)f(is)h(then)h(made)e(to)h(the)g(pro)q(cedure)i(\\main")74
2421 y(\(1550\).)33 2523 y(It)k(will)e(b)q(e)j(seen)g(later)f(that)g(\\main")
d(calls)j(\\sc)o(hed")-30 2573 y(whic)o(h)k(nev)o(er)h(terminates.)38
b(The)21 b(need)h(for)e(or)h(use)g(of)-30 2622 y(the)g(last)f(three)i
(instructions)f(of)e(\\start")i(\(lines)f(0670,)-30 2672 y(0671)f(and)g
(0672\))g(is)g(therefore)i(somewhat)e(enigmatic.)-30 2722 y(The)f(reason)f
(will)f(come)g(later.)27 b(In)17 b(the)h(mean)o(time)c(y)o(ou)-30
2772 y(migh)o(t)f(lik)o(e)h(to)h(p)q(onder)h(\\wh)o(y?".)j(What)c(do)f(these)
j(lines)-30 2822 y(do)d(an)o(yw)o(a)o(y?)1010 17 y Fg(6.3)55
b(main)18 b(\(1550\))1010 95 y Fn(Up)q(on)c(en)o(try)g(to)g(this)g(pro)q
(cedure:)1010 191 y Fi(\(a\))20 b Fn(the)11 b(pro)q(cessor)h(is)e(running)h
(at)f(priorit)o(y)f(zero,)j(in)e(k)o(er-)1114 241 y(nel)k(mo)q(de)f(and)h
(with)g(the)h(previous)g(mo)q(de)e(sho)o(wn)1114 291 y(as)h(user)h(mo)q(de;)
1010 379 y Fi(\(b\))k Fn(the)i(k)o(ernel)g(mo)q(de)e(segmen)o(tation)g
(registers)j(ha)o(v)o(e)1114 428 y(b)q(een)d(set)g(and)f(the)g(memory)e
(managemen)o(t)f(unit)1114 478 y(has)f(b)q(een)h(enabled;)1010
566 y Fi(\(c\))20 b Fn(all)10 b(the)i(data)f(areas)g(used)h(b)o(y)f(the)h(op)
q(erating)f(system)1114 616 y(ha)o(v)o(e)i(b)q(een)i(initialised;)1010
703 y Fi(\(d\))k Fn(the)e(stac)o(k)f(p)q(oin)o(ter)g(\(SP)g(or)g(r6\))g(p)q
(oin)o(ts)g(to)g(a)f(w)o(ord)1114 753 y(whic)o(h)e(con)o(tains)h(a)g(return)h
(address)g(in)e(\\start".)1010 848 y Fi(1559:)20 b Fn(The)c(\014rst)g(action)
e(of)h(\\main")d(w)o(ould)j(app)q(ear)g(to)1114 898 y(b)q(e)21
b(redundan)o(t,)i(since)e(\\up)q(dlo)q(c)o(k")g(should)f(ha)o(v)o(e)1114
948 y(already)12 b(b)q(een)i(set)g(to)e(zero)i(as)f(part)g(of)f(the)h
(initial-)1114 997 y(isation)g(p)q(erformed)g(b)o(y)h(\\start";)1010
1085 y Fi(1560:)20 b Fn(\\i")e(is)h(initialised)e(to)i(the)h(ordinal)d(of)i
(the)g(\014rst)1114 1135 y(32)c(w)o(ord)h(blo)q(c)o(k)g(b)q(ey)o(ond)g(the)h
(\\p)q(er)f(pro)q(cess)i(data)1114 1185 y(area")13 b(for)h(pro)q(cess)i(#0;)
1010 1272 y Fi(1562:)k Fn(The)j(\014rst)g(pair)e(of)h(user)h(mo)q(de)e
(segmen)o(tation)1114 1322 y(registers)c(are)f(used)g(to)f(pro)o(vide)h(a)f
(\\mo)o(ving)e(win-)1114 1372 y(do)o(w")i(in)o(to)g(higher)h(areas)g(of)f
(the)h(ph)o(ysical)g(mem-)1114 1422 y(ory)m(.)1114 1490 y(A)o(t)d(eac)o(h)g
(p)q(osition)f(of)g(the)i(windo)o(w)e(an)g(attempt)g(is)1114
1540 y(made)17 b(\(using)h(\\fuib)o(yte"\))g(to)g(read)h(the)g(\014rst)g(ac-)
1114 1590 y(cessible)h(w)o(ord)f(in)g(the)i(windo)o(w.)33 b(If)19
b(this)h(is)f(not)1114 1640 y(successful,)f(it)f(is)f(assumed)g(that)h(the)g
(end)g(of)f(the)1114 1690 y(ph)o(ysical)i(memory)f(has)j(b)q(een)g(reac)o
(hed.)36 b(Other-)1114 1740 y(wise)17 b(the)h(next)g(32)e(w)o(ord)i(blo)q(c)o
(k)e(is)i(initialised)d(to)1114 1789 y(zero)j(\(using)g(\\clearseg")g
(\(0676\)\))f(and)h(added)g(to)1114 1839 y(the)c(list)g(of)f(a)o(v)n(ailable)
f(memory)m(,)e(and)k(the)h(windo)o(w)1114 1889 y(is)e(adv)n(anced)h(b)o(y)g
(32)f(w)o(ords.)1072 1985 y(\\fuib)o(yte")k(and)g(\\clearseg")g(are)h(b)q
(oth)f(to)h(b)q(e)f(found)1010 2035 y(in)f(\\m40.s",)e(\\fuib)o(yte")i(will)f
(normally)f(return)k(a)e(p)q(osi-)1010 2085 y(tiv)o(e)h(v)n(alue)f(in)g(the)i
(range)f(0)g(to)g(255.)26 b(Ho)o(w)o(ev)o(er,)18 b(in)e(the)1010
2134 y(exceptional)f(case)i(where)f(the)h(memory)c(lo)q(cation)h(refer-)1010
2184 y(enced)19 b(do)q(es)f(not)f(resp)q(ond,)i(the)f(v)n(alue)f({1)g(is)g
(returned.)1010 2234 y(The)h(w)o(a)o(y)e(this)i(is)f(brough)o(t)g(ab)q(out)g
(is)g(a)h(little)e(obscure,)1010 2284 y(and)e(will)e(b)q(e)i(explained)g
(later)g(in)g(Chapter)g(T)m(en.\))1010 2380 y Fi(1582:)20 b
Fn(\\maxmem)o(")8 b(de\014nes)k(the)g(maxim)n(um)7 b(amoun)o(t)i(of)1114
2430 y(main)15 b(memory)g(whic)o(h)i(ma)o(y)e(b)q(e)j(used)g(b)o(y)f(a)g
(user)1114 2479 y(program.)f(This)e(is)g(the)g(minim)n(um)c(of:)1163
2576 y Fl(\017)21 b Fn(the)10 b(ph)o(ysically)e(a)o(v)n(ailable)f(memory)g
(\(\\maxmem)o(")o(\);)1163 2645 y Fl(\017)21 b Fn(an)9 b(installation)e
(de\014nable)j(parameter)f(\(\\MAXMEM"\))1205 2695 y(\(0135\);)1163
2764 y Fl(\017)21 b Fn(the)10 b(ultimate)d(limit)g(imp)q(osed)h(b)o(y)h(the)h
(PDP11)1205 2814 y(arc)o(hitecture;)1890 2946 y(29)p eop
%%Page: 30 38
37 bop -30 -144 a Fk(6)43 b(GETTING)15 b(ST)m(AR)m(TED)910
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(1583:)21
b Fn(\\sw)o(apmap")e(de\014nes)j(a)o(v)n(ailable)d(space)j(on)f(the)74
66 y(sw)o(apping)15 b(disk)f(whic)o(h)h(ma)o(y)e(b)q(e)i(used)h(when)g(user)
74 116 y(programs)g(are)h(sw)o(app)q(ed)h(out)e(of)g(main)f(memory)m(.)74
166 y(It)10 b(is)f(initialised)f(to)h(a)g(single)g(area)h(of)e(size)j(\\nsw)o
(ap",)74 216 y(starting)22 b(at)g(relativ)o(e)g(address)h(\\swplo".)41
b(Note)74 266 y(that)19 b(\\nsw)o(ap")f(and)h(\\swplo")f(are)h(initialised)e
(in)74 316 y(\\conf.c")d(\(lines)f(4697,)g(4698\);)-30 391
y Fi(1589:)21 b Fn(The)f(signi\014cance)g(of)f(this)h(and)g(the)g(next)g
(four)74 441 y(lines)14 b(will)e(b)q(e)j(discussed)h(shortly;)-30
516 y Fi(1599:)21 b Fn(The)10 b(design)f(of)g(UNIX)h(assumes)f(the)h
(existence)h(of)74 566 y(a)h(system)g(clo)q(c)o(k)g(whic)o(h)g(in)o(terrupts)
h(the)g(pro)q(cessor)74 616 y(at)h(line)f(frequency)i(\(i.e)f(50)f(Hz)i(or)f
(60)f(Hz\).)74 678 y(There)k(are)f(t)o(w)o(o)f(p)q(ossible)h(clo)q(c)o(k)g(t)
o(yp)q(es)g(a)o(v)n(ailable:)74 728 y(a)j(line)f(frequency)i(clo)q(c)o(k)f
(\(KW11-L\))g(whic)o(h)g(has)74 778 y(a)g(con)o(trol)h(register)g(on)f(the)h
(Unibus)g(at)f(address)74 828 y(777546,)g(or)g(a)g(programmabl)o(e,)f
(real-time)g(clo)q(c)o(k)74 878 y(\(KW11-P\))j(lo)q(cated)g(at)f(address)i
(777540)e(\(lines)74 928 y(1509,)13 b(1510\).)74 990 y(UNIX)k(do)q(es)h(not)e
(presume)h(whic)o(h)f(clo)q(c)o(k)h(will)e(b)q(e)74 1040 y(presen)o(t.)23
b(It)15 b(attempts)g(to)g(read)g(the)h(status)g(w)o(ord)74
1090 y(for)11 b(the)g(line)g(frequency)h(clo)q(c)o(k)f(\014rst.)18
b(If)10 b(successful,)74 1140 y(that)15 b(clo)q(c)o(k)f(is)h(initialised)e
(and)h(the)h(other)g(\(if)f(pre-)74 1189 y(sen)o(t\))j(remains)e(un)o(used.)
25 b(If)15 b(the)i(\014rst)g(attempt)e(is)74 1239 y(unsuccessful,)h(then)g
(the)f(other)g(clo)q(c)o(k)g(is)f(tried.)21 b(If)74 1289 y(b)q(oth)12
b(attempts)f(are)h(unsuccessful,)h(there)g(is)e(a)g(call)74
1339 y(on)j(\\panic")e(whic)o(h)i(e\013ectiv)o(ely)g(halts)g(the)g(system)74
1389 y(with)g(an)f(error)i(message)f(to)g(the)g(op)q(erator.)33
1461 y(Since)19 b(the)g(absence)i(of)d(a)g(clo)q(c)o(k)h(will)e(b)q(e)j
(indicated)-30 1511 y(b)o(y)12 b(a)g(bus)g(timeout)e(error,)j(it)e(is)h(con)o
(v)o(enien)o(t)g(to)g(mak)o(e)e(the)-30 1561 y(reference)j(via)c(\\fuiw)o
(ord",)g(preceded)j(b)o(y)e(the)g(setting)h(of)e(a)-30 1610
y(user)15 b(mo)q(de)e(segmen)o(tation)g(register)i(pair)f(\(1599,)e(1600\).)
-30 1683 y Fi(1607:)21 b Fn(Either)k(t)o(yp)q(e)g(of)e(clo)q(c)o(k)h(is)g
(initialised)f(b)o(y)h(the)74 1733 y(statemen)o(t)74 1795 y(*lks)14
b(=)g(0115;)74 1858 y(As)23 b(a)f(consequence)i(of)e(this)g(action,)i(the)f
(clo)q(c)o(k)74 1908 y(will)17 b(in)o(terrupt)j(the)f(pro)q(cessor)i(within)d
(the)h(next)74 1957 y(20)14 b(milliseconds.)k(This)d(in)o(terrupt)g(ma)o(y)d
(o)q(ccur)k(at)74 2007 y(an)o(y)10 b(time,)f(but)h(it)g(will)e(b)q(e)j(con)o
(v)o(enien)o(t)f(for)g(this)g(dis-)74 2057 y(cussion)i(to)e(assume)h(that)g
(no)g(in)o(terrupt)g(will)f(o)q(ccur)74 2107 y(b)q(efore)15
b(initialisation)c(is)j(complete;)-30 2182 y Fi(1613:)21 b
Fn(\\cinit")9 b(\(82l4\))g(initialises)f(the)i(p)q(o)q(ol)f(of)g(c)o
(haracter)74 2232 y(bu\013ers.)20 b(See)14 b(Chapter)h(23;)-30
2308 y Fi(1614:)21 b Fn(\\binit")e(\(5055\))h(initialises)g(the)h(p)q(o)q(ol)
f(of)g(large)74 2357 y(bu\013ers.)g(See)14 b(Chapter)h(17;)-30
2433 y Fi(1615:)21 b Fn(\\iinit")11 b(\(6922\))h(initialises)f(table)i(en)o
(tries)h(for)e(the)74 2483 y(ro)q(ot)i(device.)19 b(See)c(Chapter)f(Tw)o(en)o
(t)o(y)m(.)-30 2596 y Fg(6.4)56 b(Pro)r(cesses)-30 2672 y Fn(\\pro)q(cess")17
b(is)e(a)g(term)f(whic)o(h)h(has)h(o)q(ccurred)h(more)d(than)-30
2722 y(once)i(already)m(.)k(A)15 b(de\014nition)g(whic)o(h)f(will)g(suit)h
(our)g(pur-)-30 2772 y(p)q(oses)j(reasonably)f(w)o(ell)e(at)i(presen)o(t)h
(is)e(simply)f(\\a)h(pro-)-30 2822 y(gram)d(in)g(execution".)1072
17 y(Details)25 b(of)f(the)i(represen)o(tation)g(of)f(pro)q(cesses)j(in)1010
66 y(UNIX)19 b(will)d(b)q(e)j(discussed)h(in)e(the)h(next)g(c)o(hapter.)32
b(F)m(or)1010 116 y(no)o(w)9 b(w)o(e)g(just)h(note)g(that)f(eac)o(h)h(pro)q
(cess)h(in)o(v)o(olv)o(es)e(a)g(\\pro)q(c")1010 166 y(structure)18
b(from)c(the)j(arra)o(y)f(called)g(\\pro)q(c")g(and)g(a)f(\\p)q(er)1010
216 y(pro)q(cess)i(data)f(area")g(whic)o(h)f(includes)i(one)f(cop)o(y)f(of)g
(the)1010 266 y(structure)h(\\u".)1010 390 y Fg(6.5)55 b(Initialisation)17
b(of)i(pro)r(c[0])1010 469 y Fn(The)12 b(explicit)f(initialisation)e(of)j
(the)g(structure)i(\\pro)q(c[0]")1010 519 y(is)j(p)q(erformed)g(starting)g
(at)g(line)f(1589.)27 b(Only)17 b(four)g(ele-)1010 569 y(men)o(ts)d(are)h(c)o
(hanged)h(from)d(the)i(o)o(v)o(erall)f(initial)e(v)n(alue)j(of)1010
619 y(zero:)1010 716 y Fi(\(a\))20 b Fn(\\p)p 1137 716 13 2
v 15 w(stat")c(is)g(set)g(to)g(\\SR)o(UN")f(whic)o(h)h(implies)e(that)1114
766 y(pro)q(cess)h(0)f(is)g(\\ready)g(to)f(run";)1010 855 y
Fi(\(b\))19 b Fn(\\p)p 1140 855 V 15 w(\015ag")i(is)h(set)h(to)e(sho)o(w)h(b)
q(oth)g(\\SLO)o(AD")f(and)1114 905 y(\\SSYS".)13 b(The)h(former)e(implies)g
(that)i(the)g(pro)q(cess)1114 955 y(is)9 b(to)h(b)q(e)g(found)f(in)g(core)i
(\(it)e(has)h(not)g(b)q(een)g(sw)o(app)q(ed)1114 1005 y(out)19
b(on)o(to)g(the)i(disk\),)f(and)g(the)g(second,)i(that)d(it)1114
1055 y(should)13 b(nev)o(er)i(b)q(e)g(sw)o(app)q(ed)f(out;)1010
1144 y Fi(\(c\))20 b Fn(\\p)p 1135 1144 V 15 w(size")14 b(is)g(set)h(to)e
(\\USIZE";)1010 1233 y Fi(\(d\))19 b Fn(\\p)p 1140 1233 V 15
w(addr")g(is)g(set)g(to)g(the)h(con)o(ten)o(ts)g(of)e(the)i(k)o(ernel)1114
1283 y(segmen)o(tation)12 b(address)k(register)f(#6.)1072 1380
y(It)f(will)e(b)q(e)j(seen)g(that)f(pro)q(cess)i(#0)d(has)h(acquired)g(an)
1010 1430 y(area)h(of)f(\\USIZE")h(blo)q(c)o(ks)g(\(exactly)g(the)h(size)g
(of)e(a)g(\\p)q(er)1010 1480 y(pro)q(cess)f(data)f(area"\))g(whic)o(h)f(b)q
(egins)i(imm)o(ediately)c(after)1010 1529 y(the)21 b(o\016cial)d(end)j(\(\\)p
1349 1529 V 15 w(end"\))g(of)e(the)i(op)q(erating)f(system)1010
1579 y(data)13 b(area.)1072 1631 y(The)d(ordinal)f(n)o(um)o(b)q(er)g(of)g
(the)i(\014rst)f(blo)q(c)o(k)g(of)f(this)h(area)1010 1680 y(has)20
b(b)q(een)g(stored)h(for)e(future)i(reference)h(in)d(\\p)p
1803 1680 V 15 w(addr".)1010 1730 y(This)j(area,)j(whic)o(h)d(w)o(as)h
(cleared)g(to)f(zero)i(in)e(\\start")1010 1780 y(\(0661\),)13
b(con)o(tains)g(a)h(single)f(cop)o(y)h(of)f(the)i(user)g(structure)1010
1830 y(called)e(\\u".)1072 1881 y(On)i(line)f(1593,)f(the)i(address)h(of)d
(\\pro)q(c[0]")h(is)g(stored)1010 1931 y(in)j(\\u.u)p 1143
1931 V 15 w(pro)q(cp",)h(i.e.)30 b(the)18 b(\\pro)q(c")g(structure)i(and)d
(the)1010 1981 y(\\u")c(structure)j(are)f(m)o(utually)c(link)o(ed.)1010
2105 y Fg(6.6)55 b(The)19 b(story)f(con)n(tin)n(ues)h(...)1010
2185 y Fi(1627:)h Fn(\\newpro)q(c")13 b(\(1826\))f(will)f(b)q(e)i(discussed)h
(in)e(detail)1114 2234 y(in)h(the)i(next)f(c)o(hapter.)1114
2304 y(In)f(brief)h(this)g(initialises)e(a)h(second)i(\\pro)q(c")f(struc-)
1114 2354 y(ture)21 b(viz.)37 b(\\pro)q(c[1]",)20 b(and)g(allo)q(cates)g(a)g
(second)1114 2403 y(\\p)q(er)h(pro)q(cess)h(data)e(area")g(in)g(core.)38
b(This)20 b(is)g(a)1114 2453 y(cop)o(y)9 b(of)g(the)h(\\p)q(er)g(pro)q(cess)h
(data)e(area")g(for)g(pro)q(cess)1114 2503 y(#0,)j(exact)j(in)e(all)f(but)i
(one)g(resp)q(ect:)20 b(the)15 b(v)n(alue)e(of)1114 2553 y(\\u.u)p
1195 2553 V 14 w(pro)q(cp")g(in)f(the)h(second)h(area)f(is)f(\\&pro)q(c[1]".)
1114 2622 y(W)m(e)j(should)g(note)g(here)i(that)e(at)h(line)f(1889,)f(there)
1114 2672 y(is)21 b(a)g(call)g(on)g(\\sa)o(vu")g(\(0725\))f(whic)o(h)i(sa)o
(v)o(es)f(the)1114 2722 y(curren)o(t)j(v)n(alues)e(of)h(the)g(en)o(vironmen)o
(t)f(and)g(the)1114 2772 y(stac)o(k)c(p)q(oin)o(ters)g(in)f(\\u.u)p
1520 2772 V 14 w(rsa)o(v")h(b)q(efore)g(the)g(cop)o(y)1114
2822 y(is)13 b(made.)-30 2946 y(30)p eop
%%Page: 31 39
38 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)910
b(6)43 b(GETTING)14 b(ST)m(AR)m(TED)74 17 y Fn(Also)f(from)e(line)i(1918)e(w)
o(e)j(can)f(see)h(that)f(the)g(v)n(alue)74 66 y(returned)19
b(b)o(y)e(\\newpro)q(c")h(will)d(b)q(e)j(zero,)g(so)g(that)74
116 y(the)d(statemen)o(ts)f(on)g(lines)g(1628)f(to)h(1635)f(will)g(not)74
166 y(b)q(e)i(executed;)-30 249 y Fi(1637:)21 b Fn(A)c(call)g(is)g(made)e(to)
i(\\sc)o(hed")h(\(1940\))f(whic)o(h,)g(it)74 299 y(ma)o(y)10
b(b)q(e)j(observ)o(ed,)g(con)o(tains)f(an)g(in\014nite)f(lo)q(op,)h(so)74
349 y(that)i(it)g(nev)o(er)h(returns!)-30 466 y Fg(6.7)56 b(sc)n(hed)19
b(\(1940\))-30 542 y Fn(A)o(t)10 b(this)g(stage)g(w)o(e)f(are)h(only)f(in)o
(terested)i(in)e(what)h(happ)q(ens)-30 592 y(when)15 b(\\sc)o(hed")f(is)g(en)
o(tered)i(for)d(the)i(\014rst)f(time.)-30 684 y Fi(1958:)21
b Fn(\\spl6")13 b(is)h(an)f(assem)o(bler)h(routine)g(\(1292\))f(whic)o(h)74
733 y(sets)20 b(the)e(pro)q(cessor)i(priorit)o(y)d(lev)o(el)h(to)g(six.)30
b(\(Cf.)74 783 y(also)d(\\spl0",)i(\\spl4",)h(\\spl5")c(and)i(\\spl7")e(in)74
833 y(\\m40.s"\).)33 925 y(When)14 b(the)h(pro)q(cessor)h(is)e(at)g(lev)o(el)
g(six,)g(only)g(devices)-30 974 y(with)23 b(priorit)o(y)f(sev)o(en)h(can)g
(in)o(terrupt)h(it.)44 b(The)23 b(clo)q(c)o(k)-30 1024 y(whose)14
b(priorit)o(y)f(lev)o(el)g(is)g(six)g(is)g(th)o(us)g(inhibited)g(from)e(in-)
-30 1074 y(terrupting)h(the)g(pro)q(cessor)h(b)q(et)o(w)o(een)g(this)e(p)q
(oin)o(t)g(and)g(the)-30 1124 y(subsequen)o(t)16 b(call)d(on)h(\\spl0")f(at)h
(line)f(1976.)-30 1215 y Fi(1960:)21 b Fn(A)12 b(searc)o(h)h(is)f(made)f
(through)h(\\pro)q(c")g(whose)h(sta-)74 1265 y(tus)i(is)e(\\SR)o(UN")g(and)h
(whic)o(h)g(is)g(not)g(\\loaded".)33 1357 y(\(Pro)q(cesses)19
b(#0)d(and)g(1)h(ha)o(v)o(e)f(status)h(\\SR)o(UN")f(and)-30
1407 y(are)h(loaded.)24 b(All)15 b(remaining)f(2193:)21 b(pro)q(cesses,)e(ha)
o(v)o(e)d(a)-30 1456 y(status)j(of)e(zero,)i(whic)o(h)e(is)h(equiv)n(alen)o
(t)f(to)g(\\unde\014ned")-30 1506 y(or)d(\\NULL")g(\))g(.)-30
1598 y Fi(1966:)21 b Fn(The)d(searc)o(h)h(fails)e(\(\\n")g(is)h(still)f
({1\).)29 b(The)18 b(\015ag)74 1648 y(\\runout")j(is)g(made)f(non-zero,)j
(indicating)d(that)74 1697 y(there)e(are)f(no)f(pro)q(cesses)j(whic)o(h)e
(are)g(b)q(oth)f(ready)74 1747 y(to)e(run)g(and)g(\\sw)o(app)q(ed)g(out")g
(on)o(to)f(disk;)-30 1831 y Fi(1968:)21 b Fn(\\sleep")15 b(is)f(called)g
(\(to)h(w)o(ait)e(for)h(suc)o(h)i(an)e(ev)o(en)o(t\))74 1880
y(with)f(a)g(priorit)o(y)f(\\PSWP")h(\(==)h({100\))e(for)h(when)74
1930 y(it)g(w)o(ak)o(es)g(up,)g(whic)o(h)g(is)g(in)f(the)i(category)f(of)g
(\\v)o(ery)74 1980 y(urgen)o(t".)-30 2097 y Fg(6.8)56 b(sleep)18
b(\(2066\))-30 2173 y Fi(2070:)j Fn(\\PS")16 b(is)f(the)i(address)g(of)f(the)
g(pro)q(cessor)i(status)74 2223 y(w)o(ord.)30 b(The)19 b(pro)q(cessor)g
(status)g(is)f(stored)h(in)e(the)74 2273 y(register)e(\\s")f(\(0164,)f
(0175\);)-30 2356 y Fi(2071:)21 b Fn(\\rp")f(is)g(set)i(to)e(the)h(address)g
(of)f(the)h(en)o(try)g(in)74 2406 y(the)16 b(arra)o(y)g(\\pro)q(c")f(of)g
(the)h(curren)o(t)h(pro)q(cess)g(\(still)74 2456 y(\\pro)q(c[0]")c(at)h(this)
g(stage!\);)-30 2539 y Fi(2072:)21 b Fn(\\pri")h(is)g(negativ)o(e,)h(so)g
(the)g(\\else")f(branc)o(h)h(is)74 2589 y(tak)o(en,)18 b(setting)g(the)g
(status)g(of)f(the)h(curren)o(t)h(pro-)74 2639 y(cess)i(\(0\))f(to)f
(\\SSLEEP".)g(The)h(reason)g(for)f(\\go-)74 2689 y(ing)10 b(to)g(sleep")h
(and)f(the)h(\\a)o(w)o(ak)o(ening)e(priorit)o(y")g(are)74 2738
y(noted.)-30 2822 y Fi(2093:)21 b Fn(\\swtc)o(h")14 b(is)g(then)g(called.)
1010 17 y Fg(6.9)55 b(swtc)n(h)20 b(\(2178\))1010 94 y Fi(2184:)g
Fn(\\p")13 b(is)g(a)g(static)h(v)n(ariable)e(\(2180\),)g(whic)o(h)h(means)
1114 144 y(that)25 b(its)g(v)n(alue)f(is)h(initialised)e(to)i(zero)h
(\(1566\))1114 193 y(and)15 b(is)h(preserv)o(ed)i(b)q(et)o(w)o(een)f(calls.)
24 b(F)m(or)15 b(the)i(v)o(ery)1114 243 y(\014rst)i(call)g(on)f(\\swtc)o(h",)
j(\\p")d(is)h(set)h(to)f(p)q(oin)o(t)f(to)1114 293 y(\\pro)q(c[0]";)1010
377 y Fi(2189:)i Fn(\\sa)o(vu")10 b(is)g(called)f(to)h(sa)o(v)o(e)g(the)h
(stac)o(k)f(p)q(oin)o(ter)g(and)1114 427 y(the)16 b(en)o(vironmen)o(t)f(p)q
(oin)o(ter)g(for)h(the)g(curren)o(t)h(pro-)1114 477 y(cess)e(in)f(\\u.u)p
1327 477 13 2 v 14 w(rsa)o(v";)1010 561 y Fi(2193:)20 b Fn(\\retu")e(is)f
(called)h(to)f(reset)i(the)f(k)o(ernel)g(address)1114 611 y(register)h(for)e
(segmen)o(t)h(#6)f(to)h(the)h(v)n(alue)e(passed)1114 661 y(as)f(an)g(argumen)
o(t)g(\(this)h(causes)g(a)g(c)o(hange)f(in)g(the)1114 711 y(curren)o(t)h(pro)
q(cess!\),)g(and)f(to)f(reset)j(the)e(stac)o(k)g(and)1114 761
y(en)o(vironmen)o(t)9 b(p)q(oin)o(ters)j(to)e(v)n(alues)g(appropriate)h(to)
1114 810 y(the)16 b(revised)h(curren)o(t)h(pro)q(cess,)g(whose)e(execution)
1114 860 y(is)d(ab)q(out)h(to)g(b)q(e)g(resumed.)1072 953 y(The)19
b(com)o(bination)c(of)j(successiv)o(e)i(calls)e(on)g(\\sa)o(vu")1010
1003 y(and)24 b(\\retu")g(at)g(this)g(p)q(oin)o(t)g(constitutes)i(a)d
(so-called)1010 1052 y(\\coroutine)11 b(jump")e(\(Cf.)16 b(\\exc)o(hange)c
(jump")c(on)j(the)g(Cy-)1010 1102 y(b)q(er)16 b(or)g(\\Load)f(PSW")g(on)h
(the)g(/360)e(or)i(\\Mo)o(v)o(e)f(Stac)o(k")1010 1152 y(on)e(the)i(B6700\).)
1072 1202 y(This)i(time)f(ho)o(w)o(ev)o(er)i(the)g(coroutine)f(jump)f(is)h
(from)1010 1252 y(pro)q(cess)f(0)d(to)h(pro)q(cess)i(0)d(\(not)h(v)o(ery)g
(in)o(teresting!\).)1010 1345 y Fi(2201:)20 b Fn(The)c(set)h(of)e(pro)q
(cesses)j(is)e(searc)o(hed)h(to)f(\014nd)f(the)1114 1394 y(pro)q(cess)i
(whose)e(state)i(is)e(\\SR)o(UN")f(and)h(whic)o(h)g(is)1114
1444 y(loaded)e(and)h(for)f(whic)o(h)h(\\p)p 1554 1444 V 15
w(pri")f(is)h(a)g(maxim)n(um)o(.)1114 1511 y(The)22 b(searc)o(h)g(is)g
(successful)h(and)e(pro)q(cess)i(#1)e(is)1114 1561 y(found.)36
b(\(N.B.)20 b(The)h(state)g(of)f(pro)q(cess)i(#0)d(w)o(as)1114
1611 y(just)c(c)o(hanged)h(from)e(\\SR)o(UN")g(to)i(\\SSLEEP")g(in)1114
1661 y(\\sleep")c(so)h(it)f(no)g(longer)h(satis\014es)g(the)g(searc)o(h)h
(cri-)1114 1710 y(terion\);)1010 1795 y Fi(2218:)20 b Fn(Since)g(\\p")e(is)h
(not)f(\\NULL",)g(the)i(idle)e(lo)q(op)g(is)1114 1845 y(not)13
b(en)o(tered;)1010 1929 y Fi(2228:)20 b Fn(\\retu")i(\(0740\))f(causes)i(a)e
(coroutine)g(jump)f(to)1114 1979 y(pro)q(cess)g(#1)e(whic)o(h)h(b)q(ecomes)g
(the)h(curren)o(t)g(pro-)1114 2028 y(cess.)1114 2096 y(What)14
b(is)h(pro)q(cess)h(#1)e(?)21 b(It)15 b(is)g(a)f(cop)o(y)h(of)f(pro)q(cess)
1114 2145 y(#0,)i(made)f(at)i(a)f(previous)h(stage)h(of)e(the)h(latter's)1114
2195 y(existence.)1072 2288 y(This)f(call)f(on)h(\\retu")h(w)o(as)f(not)g
(preceded)i(b)o(y)e(a)g(call)1010 2338 y(on)11 b(\\sa)o(vu")g(b)q(ecause)j
(the)e(necessary)i(information)9 b(has)j(in)1010 2387 y(fact)i(b)q(een)h(sa)o
(v)o(ed)f(already)m(.)j(\(Where?\))1010 2480 y Fi(2229:)j Fn(\\sureg")14
b(is)g(a)f(routine)h(1738\))e(whic)o(h)i(copies)g(in)o(to)1114
2530 y(the)26 b(user)g(mo)q(de)e(segmen)o(tation)g(registers,)29
b(the)1114 2580 y(v)n(alues)23 b(appropriate)g(for)h(the)g(curren)o(t)h(pro)q
(cess.)1114 2629 y(These)18 b(ha)o(v)o(e)e(b)q(een)i(stored)g(earlier)f(in)g
(the)g(arra)o(ys)1114 2679 y(\\u.u)p 1195 2679 V 14 w(uisa")c(and)h(\\u.u)p
1489 2679 V 28 w(uisd".)1072 2772 y(The)g(v)o(ery)h(\014rst)f(call)f(on)h
(\\sureg")g(copies)h(zero)q(es)g(and)1010 2822 y(serv)o(es)g(no)f(real)g
(purp)q(ose.)1890 2946 y(31)p eop
%%Page: 32 40
39 bop -30 -144 a Fk(6)43 b(GETTING)15 b(ST)m(AR)m(TED)910
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(2240:)21
b Fn(The)d(\\SSW)-5 b(AP")17 b(\015ag)g(is)h(not)f(set,)i(so)e(that)h(this)74
66 y(enigmatic)f(\(2239\))i(section)g(can)h(b)q(e)f(ignored)g(for)74
116 y(no)o(w;)-30 202 y Fi(2247:)i Fn(Finally)11 b(\\swtc)o(h")i(returns)h
(with)f(a)f(v)n(alue)g(of)g(\\1".)74 251 y(But)j(where)g(do)q(es)f(the)h
(\\return")f(return)h(to?)j Fi(Not)74 301 y(to)e(\\sleep")e(!)33
395 y Fn(The)22 b(\\return")h(follo)o(ws)e(v)n(alues)h(set)h(b)o(y)f(the)h
(stac)o(k)-30 445 y(p)q(oin)o(ter)17 b(and)g(the)h(en)o(vironmen)o(t)d(p)q
(oin)o(ter.)27 b(These)18 b(\(just)-30 495 y(b)q(efore)23 b(the)e(return\))i
(ha)o(v)o(e)e(v)n(alues)g(equal)g(to)g(those)h(in)-30 544 y(force)f(when)f
(the)g(most)e(recen)o(t)k(\\sa)o(vu\(u.u)p 683 544 13 2 v 14
w(rsa)o(v\)")e(w)o(as)-30 594 y(p)q(erformed.)33 645 y(No)o(w)12
b(pro)q(cess)j(#1,)c(whic)o(h)i(is)f(only)g(just)h(starting)g(has)-30
694 y(nev)o(er)f(p)q(erformed)e(a)h(\\sa)o(vu",)f(but)h(v)n(alues)f(w)o(ere)i
(stored)f(in)-30 744 y(\\u.u)p 51 744 V 15 w(rsa)o(v")h(b)q(efore)h(the)g
(cop)o(y)g(of)f(pro)q(cess)i(#0)e(w)o(as)g(made)-30 794 y(b)o(y)h(\\newpro)q
(c",)f(whic)o(h)h(had)f(b)q(een)h(called)f(from)f(\\main".)33
844 y(Th)o(us)20 b(in)f(this)h(case,)h Fk(the)f(r)n(eturn)g(fr)n(om)f
(\\swtch")i(is)-30 894 y(made)d(to)g(\\main)l(",)h(with)e(a)g(value)h(of)g
(one.)27 b Fn(\(Lo)q(ok)17 b(o)o(v)o(er)-30 944 y(this)d(again,)f(to)g(b)q(e)
i(sure)g(y)o(ou)e(understand!\))-30 1063 y Fg(6.10)56 b(main)17
b(revisited)-30 1141 y Fn(The)12 b(story)g(so)f(far:)16 b(pro)q(cess)d(#0,)e
(ha)o(ving)f(created)j(a)e(cop)o(y)-30 1191 y(of)f(itself)g(in)g(the)h(form)e
(of)g(pro)q(cess)j(#1,)e(has)h(gone)f(to)g(sleep.)-30 1241
y(As)j(a)f(result)g(pro)q(cess)i(#1)e(has)g(b)q(ecome)g(the)g(curren)o(t)i
(pro-)-30 1291 y(cess)21 b(and)e(has)h(returned)h(to)e(\\main)e("with)i(a)g
(v)n(alue)f(of)-30 1340 y(one.)h(No)o(w)13 b(read)i(on)e(...)-30
1434 y Fi(1627:)21 b Fn(The)15 b(statemen)o(ts)g(in)f(\\main")e(whic)o(h)j
(are)g(condi-)74 1484 y(tional)e(on)h(\\newpro)q(c")g(are)g(no)o(w)g
(executed:)-30 1569 y Fi(1628:)21 b Fn(\\expand")h(\(2268\))f(\014nds)i(a)f
(new,)i(larger)f(area)74 1619 y(\(from)c(USIZE*32)i(to)g(\(USIZE+1\))g(*32)f
(w)o(ords\))74 1669 y(for)d(pro)q(cess)i(#1,)e(and)f(copies)i(the)g(original)
d(data)74 1719 y(area)f(in)o(to)f(it.)74 1786 y(In)j(this)g(case,)g(the)h
(original)d(user)i(data)g(area)g(con-)74 1836 y(sists)h(only)e(of)h(a)g(\\p)q
(er)g(pro)q(cess)i(data)e(area",)g(with)74 1886 y(zero)11 b(length)g(data)f
(and)g(stac)o(k)g(areas.)18 b(The)11 b(original)74 1936 y(area)j(is)g
(released;)-30 2021 y Fi(1629:)21 b Fn(\\estabur")k(is)e(used)i(to)f(set)h
(the)g(\\protot)o(yp)q(e")74 2071 y(segmen)o(tation)f(registers)i(whic)o(h)e
(are)h(stored)g(in)74 2121 y(\\u.u)p 155 2121 V 15 w(uisa")e(and)g(\\u.u)p
455 2121 V 15 w(uisd")g(for)h(later)f(use)i(b)o(y)74 2171 y(\\sureg".)36
b(\\estabur")20 b(calls)f(\\sureg")h(as)f(its)h(last)74 2220
y(action.)74 2288 y(The)14 b(parameters)f(for)g(\\estabur")h(are)f(the)h
(sizes)g(of)74 2338 y(the)g(text,)f(data)g(and)f(stac)o(k)i(areas)f(plus)g
(an)g(indica-)74 2388 y(tor)g(to)f(decide)h(whether)h(the)f(text)g(and)f
(data)g(areas)74 2437 y(should)i(b)q(e)h(in)f(separate)i(address)g(spaces.)21
b(\(Nev)o(er)74 2487 y(true)c(on)f(the)g(PDP11/40.\))24 b(The)16
b(sizes)h(are)f(all)f(in)74 2537 y(units)f(of)g(32)f(w)o(ords;)-30
2622 y Fi(1630:)21 b Fn(\\cop)o(y)o(out")i(\(1252\))g(is)g(an)g(assem)o(bler)
g(routine)74 2672 y(whic)o(h)13 b(copies)g(an)f(arra)o(y)h(in)f(k)o(ernel)h
(space)g(of)f(sp)q(ec-)74 2722 y(i\014ed)h(size)g(in)o(to)e(a)h(region)g(in)g
(user)h(space.)19 b(Here)13 b(the)74 2772 y(arra)o(y)j(\\ico)q(de")g(is)g
(copied)h(in)o(to)e(an)h(area)h(starting)74 2822 y(at)d(lo)q(cation)f(zero)i
(in)e(user)i(space;)1010 17 y Fi(1635:)20 b Fn(The)13 b(\\return")g(is)f(not)
g(sp)q(ecial.)18 b(F)m(rom)10 b(\\main")f(it)1114 66 y(go)q(es)j(to)f
(\\start")g(\(0670\))g(where)i(the)f(three)g(last)g(in-)1114
116 y(structions)g(ha)o(v)o(e)g(the)g(e\013ect)h(of)e(causing)g
Fk(exe)n(cution)1114 166 y(in)k(user)g(mo)n(de)h(of)f(the)h(instruction)f(at)
h(user)f(mo)n(de)1114 216 y(addr)n(ess)i(zer)n(o.)24 b Fn(i.e.)g(the)17
b(execution)f(of)g(a)g(cop)o(y)g(of)1114 266 y(the)g(\014rst)g(instruction)g
(in)f(\\ico)q(de".)22 b(The)16 b(instruc-)1114 316 y(tions)c(subsequen)o(tly)
h(executed)h(are)e(copies)h(also)f(of)1114 365 y(instructions)i(in)g(\\ico)q
(de".)1072 457 y(A)m(T)f(THIS)h(POINT,)g(THE)g(INITIALISA)m(TION)g(OF)1010
506 y(THE)g(SYSTEM)g(IS)g(COMPLETE.)1072 556 y(Pro)q(cess)22
b(#1)e(is)g(running)g(and)g(to)g(all)g(in)o(ten)o(ts)g(and)1010
606 y(purp)q(oses,)h(is)e(a)g(normal)d(pro)q(cess.)36 b(Its)19
b(initial)e(form)g(is)1010 656 y(\(almost\))12 b(that)h(whic)o(h)g(w)o(ould)g
(come)g(from)e(compilation,)1010 706 y(loading)f(and)h(execution)h(of)f(the)h
(simple,)e(but)i(non-trivial)1010 756 y(\\C")h(program:)1097
847 y Ff(char)21 b(*init)g("/etc/init";)1097 897 y(main)g(\()h(\))f({)1097
946 y(execl)g(\(init,)f(init,)h(0\);)1097 996 y(while)g(\(1\);)1097
1046 y(})1072 1137 y Fn(The)14 b(equiv)n(alen)o(t)g(assem)o(bler)f(program)f
(is)1250 1229 y Ff(sys)21 b(exec)1250 1279 y(init)1250 1328
y(initp)1250 1378 y(br)65 b(.)1097 1428 y(initp:)21 b(init)1250
1478 y(0)1097 1528 y(init:)43 b(</etc/init\\0>)1072 1619 y
Fn(If)17 b(the)g(system)g(call)f(on)h(\\exec")h(fails)d(\(e.g.)27
b(the)18 b(\014le)1010 1669 y(\\/etc/init")10 b(cannot)h(b)q(e)h(found\))e
(the)i(pro)q(cess)g(falls)e(in)o(to)g(a)1010 1719 y(tigh)o(t)i(lo)q(op,)f
(and)h(there)h(the)g(pro)q(cessor)h(will)d(sta)o(y)m(,)h(except)1010
1768 y(when)i(the)h(o)q(ccasional)e(clo)q(c)o(k)h(in)o(terrupt)h(o)q(ccurs.)
1072 1818 y(A)24 b(description)h(of)f(the)g(functions)g(p)q(erformed)g(b)o(y)
1010 1868 y(\\/etc/init")i(can)h(b)q(e)g(found)f(in)h(the)g(section)g(\\INIT)
1010 1918 y(\(VI)q(I)q(I\)")14 b(of)f(the)i(UPM.)-30 2946 y(32)p
eop
%%Page: 33 41
40 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1075
b(7)43 b(PR)o(OCESSES)-30 17 y Fj(7)70 b(Pro)r(cesses)-30 108
y Fn(The)10 b(previous)g(c)o(hapter)g(traced)g(the)g(dev)o(elopmen)o(ts)f
(whic)o(h)-30 157 y(o)q(ccur)26 b(after)f(\\the)g(op)q(erating)f(system)h
(has)f(b)q(een)i(re-)-30 207 y(b)q(o)q(oted",)19 b(and)e(in)g(so)h(doing)f
(in)o(tro)q(duced)h(a)f(n)o(um)o(b)q(er)g(of)-30 257 y(signi\014can)o(t)f
(features)g(of)f(the)h(pro)q(cess)i(concept.)24 b(One)16 b(of)-30
307 y(the)c(aims)d(of)i(this)g(c)o(hapter)h(is)f(to)f(go)h(bac)o(k)g(and)g
(re-explore)-30 357 y(some)i(of)h(the)g(same)f(ground)h(more)f(thoroughly)m
(.)33 406 y(There)f(are)g(a)f(n)o(um)o(b)q(er)f(of)h(serious)h(di\016culties)
f(in)g(pro-)-30 456 y(viding)22 b(a)h(generally)g(acceptable)h(de\014nition)f
(of)f(\\pro-)-30 506 y(cess".)34 b(These)20 b(are)g(akin)d(to)i(the)g
(di\016culties)g(faced)g(b)o(y)-30 556 y(the)f(philosopher)f(who)f(w)o(ould)g
(answ)o(er)i(\\what)e(is)h(life?")-30 606 y(W)m(e)e(will)f(b)q(e)i(in)f(go)q
(o)q(d)f(compan)o(y)g(if)g(w)o(e)i(brush)g(the)g(more)-30 656
y(subtle)f(p)q(oin)o(ts)f(ligh)o(tly)e(aside.)33 705 y(The)19
b(de\014nition)g(for)f(\\pro)q(cess")i(already)f(giv)o(en,)g(\\a)-30
755 y(program)10 b(in)h(execution",)h(do)q(es)f(reasonably)h(w)o(ell)e(in)h
(sug-)-30 805 y(gesting)18 b(what)f(is)g(in)o(tended.)29 b(Ho)o(w)o(ev)o(er)
17 b(it)g(do)q(es)h(not)g(\014t)-30 855 y(the)d(case)h(of)d(either)i(pro)q
(cess)h(#0)e(throughout)g(its)g(life)g(or)-30 905 y(pro)q(cess)h(#1)c(during)
h(its)h(\014rst)g(momen)o(ts.)i(All)d(other)h(pro-)-30 954
y(cesses)k(in)c(the)i(system)f(ho)o(w)o(ev)o(er)g(are)g(clearly)g(asso)q
(ciated)-30 1004 y(with)g(the)h(execution)f(of)f(some)g(program)g(\014le)h
(or)f(other.)33 1054 y(Pro)q(cesses)k(can)e(b)q(e)h(in)o(tro)q(duced)f(in)o
(to)g(discussions)g(of)-30 1104 y(op)q(erating)f(systems)g(at)g(t)o(w)o(o)f
(lev)o(els.)33 1154 y(A)o(t)18 b(the)i(upp)q(er)f(lev)o(el,)g(\\pro)q(cess")h
(is)f(an)f(imp)q(ortan)o(t)-30 1203 y(organising)e(concept)i(for)e
(describing)i(the)f(activit)o(y)f(of)g(a)-30 1253 y(computer)k(system)f(as)h
(a)f(whole.)35 b(It)19 b(is)h(often)f(exp)q(edi-)-30 1303 y(en)o(t)14
b(to)f(view)g(the)h(latter)f(as)g(the)h(com)o(bined)e(activit)o(y)g(of)h(a)
-30 1353 y(n)o(um)o(b)q(er)f(of)g(pro)q(cesses,)j(eac)o(h)f(asso)q(ciated)f
(with)f(a)h(partic-)-30 1403 y(ular)e(program)e(suc)o(h)i(as)g(the)h
(\\shell",)e(or)h(the)g(\\editor".)17 b(A)-30 1453 y(discussion)d(of)f(UNIX)h
(at)f(this)g(lev)o(el)g(is)g(giv)o(en)g(in)g(the)h(sec-)-30
1502 y(ond)h(half)f(of)g(Ritc)o(hie's)g(and)h(Thompson's)e(pap)q(er,)i(\\The)
-30 1552 y(UNIX)g(Time-sharing)d(System".)33 1602 y(A)o(t)k(this)h(lev)o(el)f
(the)i(pro)q(cesses)h(themselv)o(es)e(are)g(con-)-30 1652 y(sidered)12
b(to)f(b)q(e)h(the)f(activ)o(e)g(en)o(tities)g(in)g(the)g(system,)g(while)-30
1702 y(the)17 b(iden)o(tities)f(of)g(the)g(true)h(activ)o(e)f(elemen)o(ts,)g
(the)h(pro-)-30 1751 y(cessor)j(and)d(the)h(p)q(eripheral)g(devices,)h(are)f
(submerged:)-30 1801 y(the)24 b(pro)q(cesses)h(are)f(b)q(orn,)g(liv)o(e)f
(and)f(die;)27 b(they)c(exist)-30 1851 y(in)16 b(v)n(arying)f(n)o(um)o(b)q
(ers;)i(they)g(ma)o(y)d(acquire)i(and)g(release)-30 1901 y(resources;)26
b(they)21 b(ma)o(y)e(in)o(teract,)j(co)q(op)q(erate,)h(con\015ict,)-30
1951 y(share)15 b(resources;)h(etc.)33 2000 y(A)o(t)c(the)g(lo)o(w)o(er)g
(lev)o(el,)f(\\pro)q(cesses")j(are)e(inactiv)o(e)g(en)o(ti-)-30
2050 y(ties)f(whic)o(h)f(are)h(acted)g(on)f(b)o(y)g(activ)o(e)h(en)o(tities)g
(suc)o(h)g(as)f(the)-30 2100 y(pro)q(cessor.)21 b(By)14 b(allo)o(wing)e(the)j
(pro)q(cessor)h(to)e(switc)o(h)h(fre-)-30 2150 y(quen)o(tly)e(from)e(the)j
(execution)g(of)e(one)h(pro)q(cess)i(image)c(to)-30 2200 y(another,)i(the)f
(impression)f(can)i(b)q(e)f(created)i(that)e(eac)o(h)g(of)-30
2250 y(the)17 b(pro)q(cess)h(images)d(is)h(dev)o(eloping)f(con)o(tin)o
(uously)h(and)-30 2299 y(this)e(leads)g(to)g(the)h(upp)q(er)g(lev)o(el)e(in)o
(terpretation.)33 2349 y(Our)h(presen)o(t)i(concern)f(is)f(with)g(the)h(lo)o
(w)e(lev)o(el)h(in)o(ter-)-30 2399 y(pretation:)19 b(with)13
b(the)i(structure)h(of)d(the)h(pro)q(cess)i(image,)-30 2449
y(with)i(the)g(details)g(of)f(execution)h(and)g(with)f(the)h(means)-30
2499 y(for)c(switc)o(hing)g(the)g(pro)q(cessor)i(b)q(et)o(w)o(een)f(pro)q
(cesses.)33 2548 y(The)f(follo)o(wing)d(observ)n(ations)j(ma)o(y)e(b)q(e)i
(made)f(ab)q(out)-30 2598 y(pro)q(cesses)k(in)c(the)i(UNIX)f(con)o(text:)-30
2672 y Fi(\(a\))21 b Fn(the)13 b(existence)i(of)e(a)f(pro)q(cess)j(is)e
(implied)e(b)o(y)i(the)h(ex-)74 2722 y(istence)k(of)e(a)g(non-n)o(ull)f
(structure)k(in)d(the)h(\\pro)q(c")74 2772 y(arra)o(y)m(,)i(i.e.)31
b(a)18 b(\\pro)q(c")g(structure)j(for)d(whic)o(h)g(the)74 2822
y(elemen)o(t)c(\\p)p 274 2822 13 2 v 14 w(stat")g(is)g(non-n)o(ull;)1010
17 y Fi(\(b\))19 b Fn(for)f(eac)o(h)h(pro)q(cess)h(there)f(is)f(a)g(\\p)q(er)
g(pro)q(cess)i(data)1114 66 y(area")c(con)o(taining)g(a)h(cop)o(y)g(of)f(the)
h(\\user")h(struc-)1114 116 y(ture;)1010 200 y Fi(\(c\))i Fn(the)h(pro)q
(cessor)h(sp)q(ends)g(its)f(en)o(tire)g(life)e(executing)1114
249 y(one)11 b(pro)q(cess)h(or)f(another)g(\(except)h(when)f(it)g(is)f(rest-)
1114 299 y(ing)j(b)q(et)o(w)o(een)i(instructions\);)1010 382
y Fi(\(d\))k Fn(it)f(is)f(p)q(ossible)h(for)f(one)h(pro)q(cess)i(to)d(create)
i(or)f(de-)1114 432 y(stro)o(y)c(another)g(pro)q(cess;)1010
516 y Fi(\(e\))20 b Fn(a)12 b(pro)q(cess)j(ma)o(y)c(acquire)i(and)g(p)q
(ossess)h(resources)i(of)1114 565 y(v)n(arious)d(kinds.)1010
682 y Fg(7.1)55 b(The)19 b(Pro)r(cess)1010 759 y Fn(Ritc)o(hie)11
b(and)g(Thompson)f(in)g(their)i(pap)q(er)g(de\014ne)g(a)f(\\pro-)1010
808 y(cess")22 b(as)e(the)h(execution)g(of)f(an)g(\\image",)f(where)i(the)
1010 858 y(\\image")11 b(is)i(the)i(curren)o(t)g(state)f(of)f(a)g
(pseudo-computer,)1010 908 y(i.e.)20 b(an)15 b(abstract)g(data)g(structure,)i
(whic)o(h)d(ma)o(y)f(b)q(e)i(rep-)1010 958 y(resen)o(ted)h(in)d(either)i
(main)d(memory)f(or)j(on)g(disk.)1072 1008 y(The)i(pro)q(cess)h(image)c(in)o
(v)o(olv)o(es)h(t)o(w)o(o)h(or)g(three)h(ph)o(ysi-)1010 1058
y(cally)d(distinct)h(areas)g(of)g(memory:)1010 1149 y Fi(\(1\))20
b(the)k(\\pro)q(c")h(structure)p Fn(,)d(whic)o(h)g(is)g(con)o(tained)1114
1199 y(within)16 b(the)h(core)h(residen)o(t)g(\\pro)q(c")f(arra)o(y)g(and)f
(is)1114 1249 y(accessible)f(at)f(all)e(times;)1010 1332 y
Fi(\(2\))20 b(the)12 b(data)h(segmen)o(t)p Fn(,)c(whic)o(h)j(consists)g(of)f
(the)h(\\p)q(er)1114 1382 y(pro)q(cess)i(data)f(area",)g(com)o(bined)e(with)i
(a)f(segmen)o(t)1114 1432 y(con)o(taining)i(the)h(user)h(program)e(data,)g
(\(p)q(ossibly\))1114 1482 y(program)e(text,)i(and)g(stac)o(k;)1010
1565 y Fi(\(3\))20 b(the)e(text)g(segmen)o(t)p Fn(,)d(whic)o(h)i(is)g(not)g
(alw)o(a)o(ys)e(pre-)1114 1615 y(sen)o(t,)23 b(consists)f(of)e(a)h(segmen)o
(t)g(con)o(taining)f(only)1114 1664 y(pure)g(program)d(text)j(i.e.)33
b(re-en)o(tran)o(t)20 b(co)q(de)g(and)1114 1714 y(constan)o(t)14
b(data.)1072 1806 y(Man)o(y)d(programs)f(do)h(not)g(ha)o(v)o(e)g(a)g
(separate)h(text)g(seg-)1010 1856 y(men)o(t.)24 b(Where)17
b(one)g(is)f(de\014ned,)h(a)f(single)g(cop)o(y)h(will)d(b)q(e)1010
1905 y(shared)g(among)d(all)h(pro)q(cesses)k(whic)o(h)d(are)g(executions)i
(of)1010 1955 y(the)f(same)f(particular)h(program.)1010 2072
y Fg(7.2)55 b(The)19 b(pro)r(c)f(Structure)g(\(0358\))1010
2149 y Fn(This)j(structure,)j(whic)o(h)d(is)g(p)q(ermanen)o(tly)f(residen)o
(t)j(in)1010 2198 y(main)16 b(memory)m(,)f(con)o(tains)j(\014fteen)h(elemen)o
(ts,)g(of)e(whic)o(h)1010 2248 y(eigh)o(t)k(are)h(c)o(haracters,)j(six)c(are)
h(in)o(tegers,)h(and)f(one)f(a)1010 2298 y(p)q(oin)o(ter)16
b(to)f(an)h(in)o(teger.)23 b(Eac)o(h)16 b(elemen)o(t)f(represen)o(ts)k(in-)
1010 2348 y(formation)12 b(that)k(m)o(ust)e(b)q(e)i(accessible)g(at)f(an)o(y)
g(time,)e(es-)1010 2398 y(p)q(ecially)j(when)i(the)g(main)d(part)i(of)f(the)i
(pro)q(cess)h(image)1010 2447 y(has)14 b(b)q(een)h(sw)o(app)q(ed)f(out)g(to)g
(disk:)1072 2539 y Fl(\017)21 b Fn(\\p)p 1160 2539 V 14 w(stat")16
b(ma)o(y)e(tak)o(e)h(one)h(of)f(sev)o(en)i(v)n(alues)e(whic)o(h)1114
2589 y(de\014ne)21 b(sev)o(en)g(m)o(utually)c(exclusiv)o(e)k(states.)37
b(See)1114 2639 y(lines)13 b(0381)g(to)h(0387;)1072 2722 y
Fl(\017)21 b Fn(\\p)p 1160 2722 V 14 w(\015ag")f(is)g(an)g(amalgam)c(of)j
(six)h(one)g(bit)g(\015ags)1114 2772 y(whic)o(h)g(ma)o(y)e(b)q(e)j(set)g
(indep)q(enden)o(tly)m(.)38 b(See)21 b(lines)1114 2822 y(0391)12
b(to)i(0396;)1890 2946 y(33)p eop
%%Page: 34 42
41 bop -30 -144 a Fk(7)43 b(PR)o(OCESSES)1077 b(UNIX)14 b(6th)h(Edition)g
(Commentary)33 17 y Fl(\017)20 b Fn(\\p)p 120 17 13 2 v 15
w(addr")14 b(is)f(the)i(address)g(of)e(the)i(data)e(segmen)o(t:)121
122 y Fi({)21 b Fn(If)16 b(the)h(data)f(segmen)o(t)g(is)g(in)g(main)e(memory)
166 172 y(this)g(is)f(a)h(blo)q(c)o(k)f(n)o(um)o(b)q(er;)121
243 y Fi({)21 b Fn(otherwise,)15 b(if)g(the)g(data)g(segmen)o(t)f(has)i(b)q
(een)166 293 y(sw)o(app)q(ed)f(out,)g(this)g(is)g(a)f(disk)h(record)h(n)o
(um-)166 343 y(b)q(er;)33 448 y Fl(\017)k Fn(\\p)p 120 448
V 15 w(size")14 b(is)f(the)h(size)f(of)g(the)h(data)f(segmen)o(t,)f(mea-)74
498 y(sured)j(in)f(blo)q(c)o(ks;)33 592 y Fl(\017)20 b Fn(\\p)p
120 592 V 15 w(pri")d(is)g(the)h(curren)o(t)h(pro)q(cess)g(priorit)o(y)m(.)27
b(This)74 642 y(ma)o(y)16 b(b)q(e)i(recalculated)h(from)d(time)g(to)i(time)e
(as)i(a)74 692 y(function)c(of)f(\\p)p 330 692 V 15 w(nice",)g(\\p)p
506 692 V 15 w(cpu")h(and)g(\\p)p 745 692 V 15 w(time";)33
786 y Fl(\017)20 b Fn(\\p)p 120 786 V 15 w(pid",)9 b(\\p)p
279 786 V 15 w(ppid")g(are)g(n)o(um)o(b)q(ers)g(whic)o(h)g(uniquely)74
836 y(iden)o(tify)k(a)h(pro)q(cess)i(and)d(its)h(paren)o(t;)33
930 y Fl(\017)20 b Fn(\\p)p 120 930 V 15 w(sig",)d(\\p)p 278
930 V 15 w(uid",)g(\\p)p 445 930 V 15 w(tt)o(yp")g(are)h(in)o(v)o(olv)o(ed)e
(with)74 979 y(external)21 b(comm)o(unication)c(i.e.)37 b(with)21
b(messages)74 1029 y(or)11 b(\\signals")e(from)f(outside)j(the)g(pro)q
(cess's)h(normal)74 1079 y(domain;)33 1173 y Fl(\017)20 b Fn(\\p)p
120 1173 V 15 w(w)o(c)o(han")k(iden)o(ti\014es,)j(for)d(a)g(\\sleeping")g
(pro-)74 1223 y(cess)k(\(\\p)p 232 1223 V 15 w(stat")f(equals)f(either)h
(\\SSLEEP")g(or)74 1273 y(\\SW)-5 b(AIT"\),)13 b(the)i(reason)f(for)g
(sleeping;)33 1367 y Fl(\017)20 b Fn(\\p)p 120 1367 V 15 w(textp")14
b(is)f(either)h(n)o(ull)e(or)i(a)f(p)q(oin)o(ter)g(to)g(an)g(en-)74
1416 y(try)f(in)f(the)h(\\text")g(arra)o(y)f(\(4306\),)g(whic)o(h)h(con)o
(tains)74 1466 y(vital)h(statistics)i(regarding)e(the)i(text)f(segmen)o(t.)
-30 1597 y Fg(7.3)56 b(The)18 b(user)h(Structure)f(\(0413\))-30
1679 y Fn(One)d(cop)o(y)e(of)g(the)i(\\user")f(structure)h(is)f(an)f(essen)o
(tial)h(in-)-30 1729 y(gredien)o(t)k(of)f(eac)o(h)h(\\p)q(er)g(pro)q(cess)i
(data)d(area".)29 b(A)o(t)17 b(an)o(y)-30 1778 y(one)j(time)f(there)i(is)e
(exactly)h(one)g(cop)o(y)g(of)f(the)h(\\user")-30 1828 y(structure)e(whic)o
(h)e(is)g(accessible.)25 b(This)16 b(go)q(es)g(under)h(the)-30
1878 y(name)e(\\u")h(and)g(is)g(alw)o(a)o(ys)f(to)h(b)q(e)h(found)f(at)f(k)o
(ernel)i(ad-)-30 1928 y(dress)h(0140000)c(i.e.)23 b(at)16 b(the)h(b)q
(eginning)e(of)g(the)i(sev)o(en)o(th)-30 1978 y(page)d(of)g(the)g(k)o(ernel)g
(address)i(space.)33 2030 y(The)k(\\user")g(structure)i(has)e(more)f(elemen)o
(ts)h(than)-30 2080 y(can)j(b)q(e)g(con)o(v)o(enien)o(tly)f(or)h(usefully)f
(in)o(tro)q(duced)h(here.)-30 2130 y(The)f(commen)o(t)d(accompan)o(ying)g
(eac)o(h)i(declaration)g(on)-30 2180 y(Sheet)g(04)d(succinctly)j(suggests)f
(the)g(function)f(of)f(eac)o(h)-30 2230 y(elemen)o(t.)33 2282
y(F)m(or)13 b(the)i(momen)o(t)c(y)o(ou)i(should)h(notice:)-30
2384 y Fi(\(a\))21 b Fn(\\u)p 98 2384 V 14 w(rsa)o(v",)h(\\u)p
285 2384 V 15 w(qsa)o(v")d(,)j(\\u)p 498 2384 V 15 w(ssa)o(v")e(whic)o(h)g
(are)h(t)o(w)o(o)74 2434 y(w)o(ord)14 b(arra)o(ys)g(used)h(to)f(store)g(v)n
(alues)g(for)f(r5,)h(r6;)-30 2528 y Fi(\(b\))20 b Fn(\\u)p
101 2528 V 15 w(pro)q(cp")c(whic)o(h)f(giv)o(es)h(the)g(address)h(of)e(the)h
(cor-)74 2578 y(resp)q(onding)c(\\pro)q(c")g(structure)i(in)e(the)g(\\pro)q
(c")g(ar-)74 2628 y(ra)o(y;)-30 2722 y Fi(\(c\))21 b Fn(\\u)p
96 2722 V 14 w(uisa[16]",)i("u)p 348 2722 V 15 w(uisd[16]")e(whic)o(h)h
(store)i(proto-)74 2772 y(t)o(yp)q(es)f(for)f(the)g(page)g(address)h(and)f
(description)74 2822 y(registers;)1010 17 y Fi(\(d\))d Fn(\\u)p
1140 17 V 15 w(tsize",)k(\\u)p 1335 17 V 14 w(dsize",)g(\\u)p
1536 17 V 15 w(ssize")f(whic)o(h)e(are)h(the)1114 66 y(size)16
b(of)f(the)i(text)f(segmen)o(t)f(and)h(t)o(w)o(o)f(parameters)1114
116 y(de\014ning)k(the)g(size)h(of)f(the)g(data)g(segmen)o(t,)g(mea-)1114
166 y(sured)c(in)e(32)g(w)o(ord)h(blo)q(c)o(ks.)1010 254 y(The)g(remaining)e
(elemen)o(ts)i(are)g(concerned)i(with:)1072 343 y Fl(\017)21
b Fn(sa)o(ving)13 b(\015oating)g(p)q(oin)o(t)g(registers)i(\(not)f(for)g(the)
1114 393 y(PDP11/40\);)1072 474 y Fl(\017)21 b Fn(user)15 b(iden)o
(ti\014cation;)1072 556 y Fl(\017)21 b Fn(parameters)14 b(for)f(input/output)
h(op)q(erations;)1072 638 y Fl(\017)21 b Fn(\014le)13 b(access)j(con)o(trol;)
1072 720 y Fl(\017)21 b Fn(system)13 b(call)g(parameters;)1072
802 y Fl(\017)21 b Fn(accoun)o(ting)13 b(information.)1010
917 y Fg(7.4)55 b(The)19 b(P)n(er)g(Pro)r(cess)f(Data)h(Area)1010
994 y Fn(The)j(\\p)q(er)h(pro)q(cess)g(data)f(area")g(corresp)q(onds)i(to)d
(the)1010 1044 y(v)n(alid)16 b(part)h(\(lo)o(w)o(er)g(part\))h(of)e(the)i
(sev)o(en)o(th)h(page)e(of)f(the)1010 1094 y(k)o(ernel)j(address)g(space.)33
b(It)18 b(is)h(1024)e(b)o(ytes)i(long.)31 b(The)1010 1143 y(lo)o(w)o(er)14
b(289)g(b)o(ytes)h(are)g(o)q(ccupied)g(b)o(y)f(an)g(instance)i(of)d(the)1010
1193 y(\\user")g(structure,)i(lea)o(ving)d(367)g(w)o(ords)i(to)f(b)q(e)g
(used)h(as)f(a)1010 1243 y(k)o(ernel)f(mo)q(de)f(stac)o(k)h(area.)18
b(\(Ob)o(viously)11 b(there)i(will)e(b)q(e)h(as)1010 1293 y(man)o(y)g(k)o
(ernel)i(mo)q(de)f(stac)o(ks)i(as)f(there)h(are)f(pro)q(cesses.\))1072
1343 y(While)h(the)g(pro)q(cessor)j(is)d(in)g(k)o(ernel)g(mo)q(de,)f(the)i(v)
n(al-)1010 1392 y(ues)f(of)e(r5)i(and)f(r6,)f(the)i(en)o(vironmen)o(t)e(and)h
(stac)o(k)h(p)q(oin)o(t-)1010 1442 y(ers,)25 b(should)e(remain)f(within)g
(the)h(range)g(0140441)e(to)1010 1492 y(01437777.)15 b(T)m(ransition)10
b(b)q(ey)o(ond)h(the)h(upp)q(er)g(limit)c(w)o(ould)1010 1542
y(b)q(e)22 b(trapp)q(ed)g(as)f(a)g(segmen)o(tation)f(violation,)h(but)g(the)
1010 1592 y(lo)o(w)o(er)13 b(limit)d(is)k(protected)h(only)d(b)o(y)h(the)h
(in)o(tegrit)o(y)f(of)f(the)1010 1641 y(soft)o(w)o(are.)17
b(\(It)12 b(ma)o(y)e(b)q(e)i(noted)g(that)g(the)h(hardw)o(are)f(stac)o(k)1010
1691 y(limit)f(option)i(is)h(not)g(used)g(b)o(y)g(UNIX.\))1010
1807 y Fg(7.5)55 b(The)19 b(Segmen)n(ts)1010 1884 y Fn(The)h(data)f(segmen)o
(t)g(is)g(allo)q(cated)g(as)g(one)h(single)f(area)1010 1933
y(of)f(ph)o(ysical)h(memory)d(but)j(consists)h(of)f(three)h(distinct)1010
1983 y(parts:)1010 2072 y Fi(\(a\))g Fn(a)14 b(\\p)q(er)g(pro)q(cess)i(data)d
(area";)1010 2153 y Fi(\(b\))19 b Fn(a)12 b(data)g(area)g(for)g(the)g(user)i
(program.)h(This)d(ma)o(y)e(b)q(e)1114 2203 y(further)19 b(divided)f(in)o(to)
f(areas)i(for)f(program)f(text,)1114 2253 y(initialised)12
b(data)i(and)f(uninitialised)g(data;)1010 2335 y Fi(\(c\))20
b Fn(a)14 b(stac)o(k)g(for)f(the)i(user)g(program.)1072 2423
y(The)h(size)g(of)f(\(a\))g(is)g(alw)o(a)o(ys)g(\\USIZE")g(blo)q(c)o(ks.)23
b(The)1010 2473 y(sizes)10 b(of)f(\(b\))g(and)h(\(c\))g(are)f(giv)o(en)g(in)g
(blo)q(c)o(ks)g(b)o(y)g(\\u.u)p 1811 2473 V 15 w(dsize")1010
2523 y(and)16 b(\\u.u)p 1174 2523 V 14 w(ssize".)26 b(\(It)16
b(ma)o(y)e(b)q(e)j(noted)f(in)g(passing)g(that)1010 2573 y(the)f(latter)f(t)o
(w)o(o)g(ma)o(y)e(c)o(hange)j(during)f(the)h(life)e(of)h(a)g(pro-)1010
2622 y(cess.\))1072 2672 y(A)19 b(separate)h(text)f(segmen)o(t)g(con)o
(taining)e(only)h(pure)1010 2722 y(text)12 b(is)f(allo)q(cated)f(as)i(one)f
(single)g(area)g(of)g(ph)o(ysical)g(mem-)1010 2772 y(ory)m(.)29
b(The)18 b(in)o(ternal)f(structure)j(of)d(the)h(segmen)o(t)g(is)f(not)1010
2822 y(imp)q(ortan)o(t)12 b(here.)-30 2946 y(34)p eop
%%Page: 35 43
42 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1075
b(7)43 b(PR)o(OCESSES)-30 17 y Fg(7.6)56 b(Execution)17 b(of)i(an)g(Image)-30
94 y Fn(The)13 b(image)c(curren)o(tly)k(b)q(eing)f(executed)h(\(and)f(hence)h
(the)-30 144 y(iden)o(tit)o(y)d(of)g(the)g(curren)o(t)i(pro)q(cess\))g(is)e
(determined)g(b)o(y)g(the)-30 193 y(setting)16 b(of)f(the)g(sev)o(en)o(th)i
(k)o(ernel)e(segmen)o(tation)f(address)-30 243 y(register.)24
b(If)16 b(pro)q(cess)h(#i)d(is)i(the)g(curren)o(t)h(pro)q(cess,)g(then)-30
293 y(the)e(register)g(has)f(the)h(v)n(alue)e(\\pro)q(c[i].p)p
616 293 13 2 v 13 w(addr".)33 343 y(It)c(is)h(often)f(desirable)h(to)f
(distinguish)g(b)q(et)o(w)o(een)i(a)e(pro-)-30 393 y(cess)20
b(b)q(eing)d(executed)j(in)d(k)o(ernel)h(mo)q(de)e(and)h(the)i(same)-30
443 y(one)d(b)q(eing)g(executed)h(in)e(user)i(mo)q(de.)22 b(W)m(e)15
b(will)f(use)i(the)-30 493 y(terms)c(\\k)o(ernel)h(pro)q(cess)g(#i")e(and)h
(\\user)h(pro)q(cess)h(#i")d(to)-30 542 y(denote)16 b(\\pro)q(cess)g(#i)e
(executing)i(in)e(k)o(ernel)h(mo)q(de")f(and)-30 592 y(\\pro)q(cess)i(#i)d
(executing)i(in)e(user)i(mo)q(de")e(resp)q(ectiv)o(ely)m(.)33
642 y(If)c(w)o(e)h(c)o(hose)g(to)f(asso)q(ciate)i(pro)q(cesses)h(with)d
(particular)-30 692 y(execution)18 b(stac)o(ks)g(rather)g(than)f(with)f(an)h
(en)o(try)h(in)e(the)-30 742 y(\\pro)q(c")11 b(arra)o(y)m(,)f(then)i(w)o(e)e
(w)o(ould)g(consider)i(k)o(ernel)f(pro)q(cess)-30 792 y(#i)18
b(and)h(user)h(pro)q(cess)h(#i)c(to)i(b)q(e)g(separate)i(pro)q(cesses,)-30
842 y(rather)14 b(than)f(di\013eren)o(t)h(asp)q(ects)g(of)e(a)h(single)f(pro)
q(cess)j(#i.)-30 959 y Fg(7.7)56 b(Kernel)17 b(Mo)r(de)i(Execution)-30
1036 y Fn(The)i(sev)o(en)o(th)g(k)o(ernel)f(segmen)o(tation)e(address)k
(register)-30 1086 y(m)o(ust)11 b(b)q(e)h(set)h(appropriately)m(.)j(None)c
(of)g(the)g(other)g(k)o(ernel)-30 1136 y(segmen)o(tation)d(registers)j(is)d
(ev)o(er)i(disturb)q(ed)g(and)e(so)h(their)-30 1186 y(v)n(alues)17
b(are)h(assumed.)27 b(As)17 b(w)o(as)g(seen)i(earlier,)e(the)h(\014rst)-30
1236 y(six)12 b(k)o(ernel)g(pages)g(are)g(mapp)q(ed)e(to)i(the)g(\014rst)g
(six)f(pages)h(of)-30 1285 y(ph)o(ysical)k(memory)m(,)e(while)i(the)h(eigh)o
(th)f(is)g(mapp)q(ed)f(in)o(to)-30 1335 y(the)j(highest)g(page)f(of)f(ph)o
(ysical)h(memory)m(.)25 b(The)17 b(size)h(of)-30 1385 y(the)d(sev)o(en)o(th)g
(segmen)o(t)e(is)h(alw)o(a)o(ys)f(the)i(same.)33 1435 y(In)c(k)o(ernel)h(mo)q
(de)e(the)i(setting)g(of)f(the)h(user)g(mo)q(de)e(seg-)-30
1485 y(men)o(tation)17 b(registers)i(is)e(in)h(general)g(irrelev)n(an)o(t.)29
b(Ho)o(w-)-30 1535 y(ev)o(er)22 b(they)e(are)h(normally)c(set)22
b(correctly)f(for)f(the)h(user)-30 1584 y(pro)q(cess.)33 1635
y(The)16 b(en)o(vironmen)o(t)e(and)h(stac)o(k)h(p)q(oin)o(ters)g(p)q(oin)o(t)
f(in)o(to)-30 1684 y(the)e(k)o(ernel)e(stac)o(k)h(area)g(in)f(the)h(sev)o(en)
o(th)g(page,)g(ab)q(o)o(v)o(e)f(the)-30 1734 y(\\user")k(structure.)-30
1852 y Fg(7.8)56 b(User)18 b(Mo)r(de)h(Execution)-30 1929 y
Fn(Eac)o(h)f(activ)n(ation)f(of)f(a)i(user)g(pro)q(cess)i(is)d(preceded)j
(and)-30 1979 y(succeeded)25 b(b)o(y)d(an)g(activ)n(ation)f(of)h(the)h
(corresp)q(onding)-30 2029 y(k)o(ernel)10 b(pro)q(cess.)19
b(Accordingly)9 b(b)q(oth)g(the)h(user)h(mo)q(de)d(and)-30
2078 y(k)o(ernel)13 b(mo)q(de)e(registers)j(will)d(b)q(e)i(prop)q(erly)f(set)
h(whenev)o(er)-30 2128 y(a)h(pro)q(cess)i(image)c(is)h(b)q(eing)h(executed)i
(in)e(user)h(mo)q(de.)33 2178 y(The)h(en)o(vironmen)o(t)e(and)h(stac)o(k)h(p)
q(oin)o(ters)g(p)q(oin)o(t)f(in)o(to)-30 2228 y(the)h(user)g(stac)o(k)f
(area.)20 b(This)15 b(b)q(egins)g(as)g(the)g(upp)q(er)h(part)-30
2278 y(of)11 b(the)g(eigh)o(th)f(user)i(page,)f(but)g(ma)o(y)e(b)q(e)i
(extended)h(do)o(wn-)-30 2328 y(w)o(ards,)i(e.g.)19 b(to)14
b(o)q(ccup)o(y)h(the)g(whole)e(of)h(the)h(eigh)o(th)f(page)-30
2378 y(and)g(part)g(or)g(all)f(of)g(the)i(sev)o(en)o(th)f(page,)g(etc.)33
2428 y(Whereas)h(the)g(setting)f(of)g(the)g(k)o(ernel)h(segmen)o(tation)-30
2477 y(registers)g(is)e(fairly)f(trivial,)f(setting)j(the)f(user)h(segmen)o
(ta-)-30 2527 y(tion)g(registers)h(is)f(m)o(uc)o(h)f(less)h(so.)-30
2645 y Fg(7.9)56 b(An)19 b(Example)-30 2722 y Fn(Consider)f(a)e(program)f(on)
h(the)h(PDP11/40)f(whic)o(h)g(uses)-30 2772 y(1.7)f(pages)h(of)e(text,)i(3.3)
e(pages)i(of)f(data,)g(and)g(0.7)f(pages)-30 2822 y(of)f(stac)o(k)g(area.)18
b(\(Our)c(use)g(of)e(fractions)h(in)g(this)g(example)1010 17
y(is)g(admittedly)f(a)i(little)f(crude.\))19 b(The)c(set)f(of)g(virtual)e
(ad-)1010 66 y(dresses)k(w)o(ould)d(b)q(e)i(divided)e(as)h(sho)o(wn)g(in)f
(the)i(follo)o(wing)1010 116 y(diagram:)p 1311 253 170 2 v
1310 301 2 50 v 1336 286 a(888)e(s1)p 1480 301 V 57 w(Stac)o(k)p
1310 351 V 1336 336 a(888)g(s1)p 1480 351 V 57 w(area)p 1311
353 170 2 v 1310 401 2 50 v 1336 386 a(888)p 1480 401 V 1311
403 170 2 v 1310 451 2 50 v 1336 436 a(777)p 1480 451 V 1310
500 V 1336 486 a(777)p 1480 500 V 1310 550 V 1336 535 a(777)p
1480 550 V 1311 552 170 2 v 1310 600 2 50 v 1336 585 a(666)p
1480 600 V 1310 650 V 1336 635 a(666)p 1480 650 V 1311 652
170 2 v 1310 700 2 50 v 1336 685 a(666)g(d4)p 1480 700 V 1311
701 170 2 v 1310 750 2 50 v 1336 735 a(555)g(d3)p 1480 750
V 1310 799 V 1336 784 a(555)g(d3)p 1480 799 V 1310 849 V 1336
834 a(555)g(d3)p 1480 849 V 1311 851 170 2 v 1310 899 2 50
v 1336 884 a(444)g(d2)p 1480 899 V 50 w(Data)p 1310 949 V 1336
934 a(444)g(d2)p 1480 949 V 1310 999 V 1336 984 a(444)g(d2)p
1480 999 V 50 w(area)p 1311 1000 170 2 v 1310 1048 2 50 v 1336
1033 a(333)g(d1)p 1480 1048 V 1310 1098 V 1336 1083 a(333)g(d1)p
1480 1098 V 1310 1148 V 1336 1133 a(333)g(d1)p 1480 1148 V
1311 1150 170 2 v 1310 1198 2 50 v 1336 1183 a(222)p 1480 1198
V 1311 1200 170 2 v 1310 1248 2 50 v 1336 1233 a(222)g(t2)p
1480 1248 V 1310 1297 V 1336 1283 a(222)g(t2)p 1480 1297 V
57 w(T)m(ext)p 1311 1299 170 2 v 1310 1347 2 50 v 1336 1332
a(111)g(t1)p 1480 1347 V 1310 1397 V 1336 1382 a(111)g(t1)p
1480 1397 V 57 w(area)p 1310 1447 V 1336 1432 a(111)g(t1)p
1480 1447 V 1311 1449 170 2 v 1267 1554 a(Virtual)g(Address)j(Space)1072
1710 y(Tw)o(o)i(whole)h(pages)g(in)g(the)g(virtual)f(address)i(space)1010
1760 y(m)o(ust)11 b(b)q(e)h(allo)q(cated)f(to)h(the)g(text)h(segmen)o(t,)e
(ev)o(en)h(though)1010 1810 y(the)i(ph)o(ysical)g(area)g(required)h(is)e
(only)g(1.7)g(pages.)p 1323 1947 163 2 v 1323 1947 V 1322 1995
2 50 v 1348 1980 a(222)g(t2)p 1485 1995 V 1322 2044 V 1348
2030 a(222)g(t2)p 1485 2044 V 49 w(T)m(ext)p 1323 2046 163
2 v 1322 2094 2 50 v 1348 2079 a(111)g(t1)p 1485 2094 V 1322
2144 V 1348 2129 a(111)g(t1)p 1485 2144 V 49 w(area)p 1322
2194 V 1348 2179 a(111)g(t1)p 1485 2194 V 1323 2196 163 2 v
1345 2300 a(T)m(ext)h(Segmen)o(t)1072 2457 y(The)f(data)e(and)h(stac)o(k)h
(areas)g(require)g(the)f(dedication)1010 2506 y(of)h(four)g(and)h(one)f
(pages)h(of)f(virtual)g(address)i(space,)f(and)1010 2556 y(3.3)f(and)g(0.7)g
(pages)i(of)e(ph)o(ysical)g(memory)f(resp)q(ectiv)o(ely)m(.)1072
2622 y(The)17 b(whole)e(data)h(segmen)o(t)g(requires)h(four)f(and)g(one)1010
2672 y(eigh)o(th)d(pages)h(of)f(ph)o(ysical)g(memory)m(.)i(The)f(extra)g
(eigh)o(th)1010 2722 y(is)c(for)f(the)i(\\p)q(er)f(pro)q(cess)i(data)d(area")
h(whic)o(h)g(corresp)q(onds)1010 2772 y(\(from)15 b(time)g(to)i(time\))f(to)g
(the)i(sev)o(en)o(th)g(k)o(ernel)f(address)1010 2822 y(page.)1890
2946 y(35)p eop
%%Page: 36 44
43 bop -30 -144 a Fk(7)43 b(PR)o(OCESSES)1077 b(UNIX)14 b(6th)h(Edition)g
(Commentary)p 272 -23 170 2 v 271 25 2 50 v 297 10 a Fn(888)e(s1)p
441 25 V 56 w(Stac)o(k)p 271 75 V 297 60 a(888)g(s1)p 441 75
V 56 w(area)p 272 76 170 2 v 271 125 2 50 v 297 110 a(666)g(d4)p
441 125 V 272 126 170 2 v 271 174 2 50 v 297 159 a(555)g(d3)p
441 174 V 271 224 V 297 209 a(555)g(d3)p 441 224 V 271 274
V 297 259 a(555)g(d3)p 441 274 V 272 276 170 2 v 271 324 2
50 v 297 309 a(444)g(d2)p 441 324 V 49 w(Data)p 271 374 V 297
359 a(444)g(d2)p 441 374 V 271 423 V 297 409 a(444)g(d2)p 441
423 V 49 w(area)p 272 425 170 2 v 271 473 2 50 v 297 458 a(333)g(d1)p
441 473 V 271 523 V 297 508 a(333)g(d1)p 441 523 V 271 573
V 297 558 a(333)g(d1)p 441 573 V 272 575 170 2 v 271 623 2
50 v 325 608 a(pp)q(da)p 441 623 V 272 624 170 2 v 303 682
a(Data)g(Segmen)o(t)-30 775 y(Note)j(the)g(order)f(of)g(the)h(comp)q(onen)o
(ts)e(of)h(the)h(data)e(seg-)-30 825 y(men)o(t,)d(and)h(that)g(there)h(is)f
(no)f(em)o(b)q(edded)h(un)o(used)h(space.)33 875 y(The)j(user)h(mo)q(de)e
(segmen)o(tation)f(need)j(to)f(b)q(e)g(set)h(to)-30 925 y(re\015ect)f(the)f
(v)n(alues)f(in)g(the)g(follo)o(wing)e(table,)h(where)j(\\t",)-30
975 y(\\d")g(denote)h(the)g(blo)q(c)o(k)f(n)o(um)o(b)q(ers)f(of)h(b)q
(eginning)g(of)f(the)-30 1025 y(text)g(and)f(data)f(segmen)o(ts)h(resp)q
(ectiv)o(ely:)58 1098 y Fi(P)o(age)49 b(Address)f(Size)h(Commen)o(t)p
33 1115 851 2 v 58 1150 a Fn(1)129 b(t+0)149 b(1.0)79 b(read)14
b(only)58 1200 y(2)129 b(t+128)107 b(0.7)79 b(read)14 b(only)58
1249 y(3)129 b(d+16)121 b(1.0)58 1299 y(4)129 b(d+144)100 b(1.0)58
1349 y(5)129 b(d+272)100 b(1.0)58 1399 y(6)129 b(d+400)100
b(0.3)58 1449 y(7)129 b(?)198 b(0.0)79 b(not)13 b(used)58 1498
y(8)129 b(d+400)100 b(0.7)79 b(gro)o(ws)13 b(do)o(wn)o(w)o(ard)33
1573 y(Note)23 b(the)g(setting)g(of)f(the)h(eigh)o(th)g(address)h(regis-)-30
1623 y(ter.)40 b(The)21 b(address)g(protot)o(yp)q(es)h(stored)g(in)e(the)h
(arra)o(y)-30 1672 y(\\u.u)p 51 1672 13 2 v 15 w(uisa")16 b(are)g(obtained)h
(b)o(y)f(setting)h(\\t")f(and)g(\\d")g(to)-30 1722 y(zero.)-30
1841 y Fg(7.10)56 b(Setting)21 b(the)h(Segmen)n(tation)e(Reg-)126
1899 y(isters)-30 1977 y Fn(Protot)o(yp)q(es)e(for)e(the)g(user)i(segmen)o
(tation)d(registers)i(are)-30 2027 y(set)c(up)e(b)o(y)g(\\estabur")h(whic)o
(h)f(is)g(called)g(when)g(a)g(program)-30 2077 y(is)20 b(\014rst)g(launc)o
(hed)f(in)o(to)f(execution,)j(and)e(again)f(when-)-30 2126
y(ev)o(er)g(a)e(signi\014can)o(t)f(c)o(hange)i(in)f(memory)e(allo)q(cation)g
(re-)-30 2176 y(quires)j(it.)25 b(The)17 b(protot)o(yp)q(es)h(are)e(stored)i
(in)e(the)h(arra)o(ys)-30 2226 y(\\u.u)p 51 2226 V 15 w(uisa",)c(\\u.u)p
263 2226 V 14 w(uisd".)33 2276 y(Whenev)o(er)f(pro)q(cess)h(#i)d(is)h(ab)q
(out)g(to)g(b)q(e)h(reactiv)n(ated,)-30 2326 y(the)h(pro)q(cedure)h(\\sureg")
e(is)g(called)g(to)g(cop)o(y)g(the)g(the)h(pro-)-30 2376 y(tot)o(yp)q(es)g
(in)o(to)e(the)h(appropriate)g(registers.)19 b(The)12 b(descrip-)-30
2426 y(tion)18 b(registers)i(are)f(copied)f(directly)m(,)h(but)g(the)f
(address)-30 2476 y(registers)f(m)o(ust)e(b)q(e)h(adjusted)g(to)f(re\015ect)i
(the)g(actual)e(lo-)-30 2525 y(cation)f(in)f(ph)o(ysical)h(memory)d(of)i(the)
i(area)f(used.)-30 2644 y Fg(7.11)56 b(estabur)19 b(\(1650\))-30
2722 y Fi(1654:)i Fn(V)m(arious)9 b(c)o(hec)o(ks)h(on)f(consistency)i(are)f
(p)q(erformed,)74 2772 y(to)h(ensure)h(that)f(the)h(requested)h(sizes)f(for)e
(the)i(text,)74 2822 y(data)i(and)g(stac)o(k)g(are)g(reasonable.)1114
17 y(Note)25 b(that)h(a)f(non-zero)h(v)n(alue)e(for)h(\\sep")h(im-)1114
66 y(plies)12 b(separate)i(mappings)d(for)h(the)h(text)g(area)g(\(\\i")1114
116 y(space\))h(and)f(the)g(data)g(area)g(\(\\d")f(space\).)19
b(This)13 b(is)1114 166 y(nev)o(er)h(p)q(ossible)h(on)e(the)i(PDP11/40;)1010
246 y Fi(1664:)20 b Fn(\\a")11 b(de\014nes)i(the)f(address)h(of)e(a)g(segmen)
o(t)g(relativ)o(e)1114 296 y(to)k(an)h(arbitrary)g(base)h(of)e(zero.)25
b(\\ap")16 b(and)f(\\dp")1114 346 y(p)q(oin)o(t)9 b(to)h(the)h(set)g(of)f
(protot)o(yp)q(e)g(segmen)o(tation)f(ad-)1114 396 y(dress)15
b(and)f(descriptor)h(registers)g(resp)q(ectiv)o(ely)m(.)1072
480 y(The)e(\014rst)g(eigh)o(t)f(of)f(eac)o(h)i(of)f(these)h(sets)h(are)e(in)
o(tended)1010 530 y(to)i(refer)h(to)e(\\i")g(space,)i(and)1010
615 y Fi(1667:)20 b Fn(\\n)o(t")11 b(measures)g(the)h(n)o(um)o(b)q(er)e(of)h
(32)f(w)o(ord)h(blo)q(c)o(ks)1114 665 y(needed)17 b(for)f(the)h(text)g
(segmen)o(t.)25 b(If)16 b(\\n)o(t")f(is)h(non-)1114 714 y(zero,)d(one)f(or)h
(more)e(pages)i(m)o(ust)e(b)q(e)i(allo)q(cated)f(for)1114 764
y(this)i(purp)q(ose.)1072 849 y(Where)h(more)e(than)i(one)f(page)g(is)g(allo)
q(cated,)g(all)f(but)1010 899 y(the)f(last)f(will)g(consist)h(of)f(128)g(blo)
q(c)o(ks)g(\(4096)g(w)o(ords\),)h(and)1010 948 y(will)j(b)q(e)i(read)h(only)m
(,)d(and)i(will)e(ha)o(v)o(e)h(relativ)o(e)h(addresses)1010
998 y(starting)c(at)g(zero)i(and)e(increasing)g(successiv)o(ely)i(b)o(y)e
(128.)1010 1083 y Fi(1672:)20 b Fn(If)c(some)f(fraction)h(of)f(a)h(page)f(of)
h(text)g(is)g(still)f(to)1114 1133 y(b)q(e)h(assigned,)h(allo)q(cate)e(the)i
(appropriate)f(part)g(of)1114 1182 y(the)e(next)h(page;)1010
1263 y Fi(1677:)20 b Fn(if)g(\\i")f(and)i(\\d")f(spaces)i(are)f(b)q(eing)f
(used)h(sep-)1114 1312 y(arately)m(,)d(mark)f(the)i(segmen)o(tation)e
(registers)j(for)1114 1362 y(the)14 b(remaining)e(\\i")h(pages)h(as)g(n)o
(ull;)1010 1443 y Fi(1682:)20 b Fn(\\a")13 b(is)h(reset)i(b)q(ecause)f(all)e
(remaining)f(addresses)1114 1492 y(refer)i(to)f(the)h(data)f(area)g(\(not)g
(the)h(text)g(area\))f(and)1114 1542 y(are)e(relativ)o(e)h(to)f(the)h(b)q
(eginning)f(of)g(this)g(area.)18 b(The)1114 1592 y(\014rst)13
b(\\USIZE")g(blo)q(c)o(ks)g(of)f(this)h(area)g(are)g(reserv)o(ed)1114
1642 y(for)g(the)i(\\p)q(er)f(pro)q(cess)i(data)d(area";)1010
1722 y Fi(1703:)20 b Fn(The)d(stac)o(k)f(area)g(is)f(allo)q(cated)h(from)e
(the)i(top)g(of)1114 1772 y(the)11 b(address)i(space)f(to)o(w)o(ards)f(the)g
(lo)o(w)o(er)g(addresses)1114 1822 y(\(\\do)o(wn)o(w)o(ards"\);)1010
1902 y Fi(1711:)20 b Fn(If)d(a)g(partial)g(page)g(m)o(ust)g(b)q(e)h(allo)q
(cated)e(for)h(the)1114 1952 y(stac)o(k)i(area,)g(it)f(is)g(the)h(high)f
(address)i(art)f(of)e(the)1114 2002 y(page)12 b(whic)o(h)g(is)g(v)n(alid.)k
(\(F)m(or)11 b(text)i(and)f(data)g(areas,)1114 2052 y(whic)o(h)h(gro)o(w)f
(\\up)o(w)o(ards",)h(it)g(is)g(the)h(lo)o(w)o(er)e(part)i(of)1114
2101 y(a)i(partial)f(page)h(whic)o(h)g(is)h(v)n(alid.\))24
b(This)16 b(requires)1114 2151 y(an)k(extra)g(bit)g(in)g(the)g(descriptor,)j
(hence)f(\\ED")1114 2201 y(\(\\expansion)13 b(do)o(wn)o(w)o(ards"\);)1010
2281 y Fi(1714:)20 b Fn(If)14 b(separate)g(\\i")f(and)g(\\d")g(spaces)i(are)f
(not)g(used,)1114 2331 y(only)j(the)i(\014rst)g(eigh)o(t)g(of)e(the)i
(sixteen)h(protot)o(yp)q(e)1114 2381 y(register)12 b(pairs)f(will)f(ha)o(v)o
(e)h(b)q(een)h(initialised)e(b)o(y)h(this)1114 2431 y(p)q(oin)o(t.)16
b(In)9 b(this)h(case,)g(the)g(second)h(eigh)o(t)e(are)h(copied)1114
2481 y(from)i(the)i(\014rst)h(eigh)o(t.)1010 2596 y Fg(7.12)56
b(sureg)18 b(\(1739\))1010 2672 y Fn(This)12 b(routine)h(is)g(called)f(b)o(y)
h(\\estabur")g(\(1724\),)f(\\swtc)o(h")1010 2722 y(\(2229\))f(and)i
(\\expand")f(\(2295\),)f(to)h(cop)o(y)h(the)g(protot)o(yp)q(e)1010
2772 y(segmen)o(tation)8 b(registers)j(in)o(to)e(the)h(actual)f(hardw)o(are)h
(seg-)1010 2822 y(men)o(tation)i(registers.)-30 2946 y(36)p
eop
%%Page: 37 45
44 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1075
b(7)43 b(PR)o(OCESSES)-30 17 y Fi(1743:)21 b Fn(Get)13 b(the)h(base)g
(address)g(for)f(the)h(data)f(area)g(from)74 66 y(the)i(appropriate)f(elemen)
o(t)f(of)g(the)i(\\pro)q(c")f(arra)o(y;)-30 156 y Fi(1744:)21
b Fn(The)g(protot)o(yp)q(e)h(address)g(registers)g(\(of)f(whic)o(h)74
205 y(there)g(are)e(only)f(eigh)o(t)h(for)g(the)g(PDP11/40\))f(are)74
255 y(mo)q(di\014ed)12 b(b)o(y)g(the)i(addition)d(of)i(\\a")f(and)g(stored)i
(in)74 305 y(the)h(hardw)o(are)f(segmen)o(tation)f(address)i(registers;)-30
394 y Fi(1752:)21 b Fn(T)m(est)e(if)f(a)g(separate)h(text)g(area)g(has)g(b)q
(een)g(allo-)74 444 y(cated,)d(and)f(if)f(so,)h(reset)h(\\a")f(to)g(the)g
(relativ)o(e)g(ad-)74 494 y(dress)g(of)d(the)i(text)f(area)g(to)g(the)h(data)
e(area.)18 b(\(Note)74 544 y(this)h(v)n(alue)g(ma)o(y)e(b)q(e)i(negativ)o(e!)
33 b(F)m(ortunately)19 b(at)74 593 y(this)c(p)q(oin)o(t,)f(addresses)k(are)d
(in)f(terms)h(of)f(32)h(w)o(ord)74 643 y(blo)q(c)o(ks.\);)-30
732 y Fi(1754:)21 b Fn(The)15 b(pattern)g(of)f(co)q(de)i(no)o(w)e(follo)o(w)o
(ed)f(is)h(similar)74 782 y(to)g(the)g(b)q(eginning)g(of)f(the)i(routine,)e
(except)i(...)-30 871 y Fi(1762:)21 b Fn(a)e(rather)g(obscure)i(piece)f(of)e
(co)q(de)i(adjusts)f(the)74 921 y(setting)i(of)f(the)h(address)h(register)g
(for)e(segmen)o(ts)74 971 y(whic)o(h)c(are)g(not)g(\\writable")g(i.e.)23
b(whic)o(h)16 b(presum-)74 1021 y(ably)d(are)i(text)f(segmen)o(ts.)33
1118 y(The)19 b(co)q(de)h(in)e(\\estabur")i(and)f(\\sureg")g(sho)o(ws)h(ev-)
-30 1168 y(idence)f(of)f(ha)o(ving)f(b)q(een)i(dev)o(elop)q(ed)g(in)e(sev)o
(eral)i(stages)-30 1218 y(and)14 b(is)g(not)g(as)g(elegan)o(t)g(as)f(could)h
(b)q(e)h(desired.)-30 1342 y Fg(7.13)56 b(newpro)r(c)18 b(\(1826\))-30
1421 y Fn(It)h(is)g(no)o(w)f(time)f(to)i(tak)o(e)g(a)f(go)q(o)q(d)g(lo)q(ok)g
(at)g(the)i(pro)q(ce-)-30 1471 y(dure)14 b(whic)o(h)e(creates)j(new)e(pro)q
(cesses)i(as)e(\(almost)e(exact\))-30 1521 y(replicas)k(of)e(their)h
(creators.)-30 1618 y Fi(1841:)21 b Fn(\\mpid")7 b(is)i(an)g(in)o(teger)h
(whic)o(h)f(is)g(stepp)q(ed)i(through)74 1668 y(the)j(v)n(alues)e(0)h(to)f
(32767.)17 b(As)c(eac)o(h)g(new)g(pro)q(cess)i(is)74 1718 y(created,)g(a)e
(new)h(v)n(alue)f(for)h(\\mpid")d(is)j(created)h(to)74 1768
y(pro)o(vide)21 b(a)f(unique)h(distinguishing)e(n)o(um)o(b)q(er)h(for)74
1818 y(the)h(pro)q(cess.)38 b(Since)21 b(the)g(cycle)f(of)g(v)n(alues)g(ma)o
(y)74 1867 y(ev)o(en)o(tually)e(rep)q(eat,)i(a)f(c)o(hec)o(k)g(is)f(made)g
(that)g(the)74 1917 y(n)o(um)o(b)q(er)13 b(is)g(not)g(still)g(in)g(use;)g(if)
g(so)g(a)g(new)h(v)n(alue)f(is)74 1967 y(tried;)-30 2056 y
Fi(1846:)21 b Fn(A)h(searc)o(h)g(is)g(made)e(through)i(the)g(\\pro)q(c")g
(ar-)74 2106 y(ra)o(y)16 b(for)f(a)h(n)o(ull)e(\\pro)q(c")i(structure)i
(\(indicated)e(b)o(y)74 2156 y(\\p)p 120 2156 13 2 v 15 w(stat")e(ha)o(ving)f
(a)g(n)o(ull)g(v)n(alue\);)-30 2245 y Fi(1860:)21 b Fn(A)o(t)15
b(this)h(p)q(oin)o(t,)f(the)h(address)g(of)f(the)h(new)g(en)o(try)74
2295 y(in)d(the)h(\\pro)q(c")f(arra)o(y)g(is)g(stored)h(as)f(b)q(oth)g(\\p")g
(and)74 2345 y(\\rpp",)e(and)g(the)g(address)h(of)e(\\pro)q(c")h(en)o(try)h
(for)e(the)74 2394 y(curren)o(t)22 b(pro)q(cess)g(is)e(stored)h(b)q(oth)g(as)
f(\\up")g(and)74 2444 y(\\rip";)-30 2533 y Fi(1861:)h Fn(The)12
b(attributes)h(of)e(the)i(new)f(pro)q(cess)h(are)g(stored)74
2583 y(in)k(the)g(new)h(\\pro)q(c")f(en)o(try)m(.)27 b(Man)o(y)17
b(of)f(these)i(are)74 2633 y(copied)c(from)f(the)h(curren)o(t)h(pro)q(cess;)
-30 2722 y Fi(1876:)21 b Fn(The)f(new)f(pro)q(cess)i(inherits)f(the)g(op)q
(en)g(\014les)f(of)74 2772 y(its)c(paren)o(t.)21 b(Incremen)o(t)15
b(the)h(reference)h(coun)o(t)e(for)74 2822 y(eac)o(h)g(of)e(these;)1010
17 y Fi(1879:)20 b Fn(If)11 b(there)h(is)e(a)h(separate)h(text)f(segmen)o(t)f
(incremen)o(t)1114 66 y(the)17 b(asso)q(ciated)h(reference)h(coun)o(ts.)28
b(Notice)17 b(that)1114 116 y(\\rip",)11 b(\\rpp")h(are)h(used)g(for)f(temp)q
(orary)g(reference)1114 166 y(here;)1010 249 y Fi(1883:)20
b Fn(Incremen)o(t)f(the)g(reference)i(coun)o(t)d(for)g(the)h(par-)1114
299 y(en)o(t's)14 b(curren)o(t)h(directory;)1010 382 y Fi(1889:)20
b Fn(Sa)o(v)o(e)c(the)h(curren)o(t)g(v)n(alues)f(of)g(the)g(en)o(vironmen)o
(t)1114 432 y(and)11 b(stac)o(k)g(p)q(oin)o(ters)h(in)e(\\u.u)p
1578 432 V 15 w(rsa)o(v".)17 b(\\sa)o(vu")10 b(is)h(an)1114
481 y(assem)o(bler)i(routine)h(de\014ned)h(at)f(line)f(0725;)1010
564 y Fi(1890:)20 b Fn(Restore)13 b(the)f(v)n(alues)f(of)g(\\rip")f(and)i
(\\rpp".)17 b(T)m(em-)1114 614 y(p)q(orarily)10 b(c)o(hange)h(the)g(v)n(alue)
g(of)f(\\u.u)p 1700 614 V 14 w(pro)q(cp")i(from)1114 664 y(the)17
b(v)n(alue)f(appropriate)h(to)g(the)g(curren)o(t)h(pro)q(cess)1114
714 y(to)13 b(the)i(v)n(alue)e(appropriate)h(to)g(the)g(new)h(pro)q(cess;)
1010 797 y Fi(1896:)20 b Fn(T)m(ry)10 b(to)g(\014nd)g(an)g(area)g(in)g(main)e
(memory)g(in)h(whic)o(h)1114 847 y(to)k(create)j(the)e(new)h(data)e(segmen)o
(t;)1010 930 y Fi(1902:)20 b Fn(If)13 b(there)h(is)f(no)g(suitable)g(area)g
(in)g(main)d(memory)m(,)1114 979 y(the)17 b(new)h(cop)o(y)f(will)f(ha)o(v)o
(e)h(to)g(b)q(e)h(made)e(on)h(disk.)1114 1029 y(The)f(next)g(section)h(of)e
(co)q(de)h(should)g(b)q(e)g(analysed)1114 1079 y(carefully)i(b)q(ecause)i(of)
e(the)h(inconsistency)h(in)o(tro-)1114 1129 y(duced)15 b(at)e(line)h(1891)f
(i.e.)1114 1179 y(u.u)p 1174 1179 V 14 w(pro)q(cp-)p Fh(>)p
Fn(p)p 1359 1179 V 16 w(addr)h(!=)g(*k)n(a6)1010 1262 y Fi(1903:)20
b Fn(Mark)12 b(the)g(curren)o(t)g(pro)q(cess)i(as)d(\\SIDL")g(to)g(head)1114
1311 y(o\013)16 b(temp)q(orarily)f(an)o(y)h(further)h(attempt)f(to)g(sw)o(ap)
1114 1361 y(it)d(out)h(\(i.e.)k(initiated)13 b(b)o(y)g(\\sc)o(hed")i
(\(1940\)\);)1010 1444 y Fi(1904:)20 b Fn(Mak)o(e)g(the)f(new)h(\\pro)q(c")f
(en)o(try)h(consisten)o(t,)i(i.e)1114 1494 y(set)14 b(rpp-)p
Fh(>)p Fn(p)p 1311 1494 V 16 w(addr)g(=)g(*k)n(a6;)1010 1577
y Fi(1905:)20 b Fn(Sa)o(v)o(e)c(the)h(curren)o(t)g(v)n(alues)f(of)g(the)g(en)
o(vironmen)o(t)1114 1627 y(and)d(stac)o(k)i(p)q(oin)o(ters)f(in)g(\\u.u)p
1590 1627 V 14 w(ssa)o(v";)1010 1710 y Fi(1906:)20 b Fn(Call)d(\\xsw)o(ap")g
(\(4368\))f(to)i(cop)o(y)f(the)h(data)g(seg-)1114 1760 y(men)o(t)g(in)o(to)g
(the)h(disk)g(sw)o(ap)g(area.)33 b(Because)20 b(the)1114 1809
y(second)e(parameter)f(is)h(zero,)g(the)g(main)e(memory)1114
1859 y(area)e(will)e(not)i(b)q(e)g(released;)1010 1942 y Fi(1907:)20
b Fn(Mark)14 b(the)h(new)f(pro)q(cess)i(as)e(\\sw)o(app)q(ed)g(out";)1010
2025 y Fi(1908:)20 b Fn(Return)k(the)f(curren)o(t)i(pro)q(cess)f(to)f(its)g
(normal)1114 2075 y(state;)1010 2158 y Fi(1913:)d Fn(There)f(w)o(as)e(ro)q
(om)f(in)h(main)e(memory)m(,)g(so)i(store)1114 2208 y(the)12
b(address)i(of)d(the)i(new)g(\\pro)q(c")f(en)o(try)h(and)f(cop)o(y)1114
2258 y(the)i(data)g(segmen)o(t)f(a)h(blo)q(c)o(k)f(at)h(a)g(time;)1010
2341 y Fi(1917:)20 b Fn(Restore)k(the)f(curren)o(t)i(pro)q(cess')f(\\p)q(er)f
(pro)q(cess)1114 2390 y(data)13 b(area")h(to)g(its)g(previous)g(state;)1010
2473 y Fi(1918:)20 b Fn(Return)15 b(with)e(a)h(v)n(alue)f(of)g(zero.)1072
2564 y(Ob)o(viously)21 b(\\newpro)q(c")h(on)f(its)g(o)o(wn)g(is)g(not)g
(su\016-)1010 2614 y(cien)o(t)f(to)g(pro)q(duce)h(an)e(in)o(teresting)i(and)e
(v)n(aried)h(set)h(of)1010 2664 y(pro)q(cesses.)35 b(The)19
b(pro)q(cedure)i(\\exec")f(\(3020\))e(whic)o(h)g(is)1010 2714
y(discussed)23 b(in)e(Chapter)h(Tw)o(elv)o(e)f(pro)o(vides)h(the)f(neces-)
1010 2764 y(sary)14 b(additional)f(facilit)o(y:)k(the)e(means)f(for)g(a)g
(pro)q(cess)i(to)1010 2814 y(c)o(hange)e(its)g(c)o(haracter,)h(to)e(b)q(e)i
(reincarnated.)1890 2946 y(37)p eop
%%Page: 38 46
45 bop -30 -144 a Fk(8)43 b(PR)o(OCESS)16 b(MANA)o(GEMENT)797
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(8)70 b(Pro)r(cess)22
b(Managemen)n(t)-30 120 y Fn(Pro)q(cess)15 b(managemen)o(t)c(is)i(concerned)i
(with)d(the)i(sharing)-30 169 y(of)d(the)h(pro)q(cessor)i(and)d(the)h(main)d
(memory)g(amongst)h(the)-30 219 y(v)n(arious)h(pro)q(cesses,)j(whic)o(h)d
(can)g(b)q(e)h(seen)h(as)e(comp)q(etitors)-30 269 y(for)j(these)h(resources.)
33 325 y(Decisions)e(to)g(reallo)q(cate)g(resources)j(are)d(made)f(from)-30
375 y(time)h(to)g(time,)f(either)j(on)e(the)h(initiativ)o(e)f(of)g(the)h(pro)
q(cess)-30 425 y(whic)o(h)g(holds)f(the)i(resource,)g(of)e(for)g(some)g
(other)i(reason.)-30 575 y Fg(8.1)56 b(Pro)r(cess)18 b(Switc)n(hing)-30
664 y Fn(An)e(activ)o(e)f(pro)q(cess)h(ma)o(y)d(susp)q(end)k(itself)e(i.e)f
(relinquish)-30 714 y(the)e(pro)q(cessor,)i(b)o(y)d(calling)f(\\swtc)o(h")h
(\(2178\))g(whic)o(h)g(calls)-30 764 y(\\retu")17 b(\(0740\).)23
b(This)16 b(ma)o(y)d(b)q(e)k(done)f(for)f(example)g(if)g(a)-30
813 y(pro)q(cess)20 b(has)d(reac)o(hed)i(a)e(p)q(oin)o(t)g(b)q(ey)o(ond)g
(whic)o(h)h(it)f(can-)-30 863 y(not)c(pro)q(ceed)h(immediately)l(.)h(The)e
(pro)q(cess)h(calls)e(\\sleep")-30 913 y(\(2066\))i(whic)o(h)f(calls)h
(\\swtc)o(h".)33 969 y(Alternativ)o(ely)e(a)h(k)o(ernel)h(pro)q(cess)h(whic)o
(h)d(is)h(ready)h(to)-30 1019 y(rev)o(ert)h(to)f(user)g(mo)q(de)f(will)f
(test)j(the)f(v)n(ariable)e(\\runrun")-30 1069 y(and)g(if)e(this)i(is)f
(non-zero,)h(implying)c(that)k(a)f(pro)q(cess)i(with)-30 1119
y(a)g(higher)f(precedence)k(is)c(ready)h(to)f(run,)h(the)g(k)o(ernel)g(pro-)
-30 1168 y(cess)j(will)c(call)h(\\swtc)o(h".)33 1225 y(\\swtc)o(h")d(searc)o
(hes)i(the)e(\\pro)q(c")g(table,)g(for)f(en)o(tries)i(for)-30
1275 y(whic)o(h)k(\\p)p 136 1275 13 2 v 15 w(stat")g(equals)g(\\SR)o(UN")g
(and)g(the)g(\\SLO)o(AD")-30 1324 y(bit)f(is)f(set)h(in)f(\\p)p
234 1324 V 15 w(\015ag".)k(F)m(rom)12 b(these)j(it)e(selects)i(the)f(pro-)-30
1374 y(cess)19 b(for)d(whic)o(h)h(the)g(v)n(alue)f(of)g(\\p)p
525 1374 V 15 w(pri")g(is)h(a)f(minim)o(um)n(,)-30 1424 y(and)e(transfers)h
(con)o(trol)f(to)g(it.)33 1480 y(V)m(alues)e(for)g(\\p)p 271
1480 V 14 w(pri")g(are)h(recalculated)g(for)f(eac)o(h)h(pro-)-30
1530 y(cess)g(from)d(time)g(to)h(time)f(b)o(y)h(use)h(of)e(the)i(pro)q
(cedure)h(\\set-)-30 1580 y(pri")g(\(2156\).)18 b(Ob)o(viously)12
b(the)i(algorithm)d(used)j(b)o(y)f(\\set-)-30 1630 y(pri")19
b(has)g(a)g(signi\014can)o(t)f(in\015uence.)35 b(A)19 b(pro)q(cess)i(whic)o
(h)-30 1680 y(has)16 b(called)f(\\sleep")g(and)g(susp)q(ended)i(itself)e(ma)o
(y)e(b)q(e)j(re-)-30 1729 y(turned)f(to)e(the)i(\\ready)e(to)h(run")f(state)i
(b)o(y)e(another)h(pro-)-30 1779 y(cess.)19 b(This)10 b(often)h(o)q(ccurs)h
(during)e(the)h(handling)e(of)h(in)o(ter-)-30 1829 y(rupts)k(when)f(the)g
(pro)q(cess)h(handling)e(the)h(in)o(terrupt)g(calls)-30 1879
y(\\setrun")19 b(\(2134\))f(either)h(directly)f(or)g(indirectly)g(via)f(a)-30
1929 y(call)d(on)f(\\w)o(ak)o(eup")g(\(2113\).)-30 2079 y Fg(8.2)56
b(In)n(terrupts)-30 2168 y Fn(It)17 b(should)f(b)q(e)h(noted)g(that)g(a)f
(hardw)o(are)h(in)o(terrupt)g(\(see)-30 2217 y(Chapter)23 b(Nine\))f(do)q(es)
g(not)f(directly)h(cause)h(a)e(call)g(on)-30 2267 y(\\swtc)o(h")g(or)g(its)f
(equiv)n(alen)o(t.)37 b(A)20 b(hardw)o(are)h(in)o(terrupt)-30
2317 y(will)14 b(cause)i(a)f(user)h(pro)q(cess)h(to)e(rev)o(ert)h(to)f(a)g(k)
o(ernel)h(pro-)-30 2367 y(cess,)j(whic)o(h)e(as)g(just)g(noted,)h(ma)o(y)d
(call)h(\\swtc)o(h")h(as)g(an)-30 2417 y(alternativ)o(e)f(to)h(rev)o(erting)f
(to)g(user)i(mo)q(de)d(after)h(the)h(in-)-30 2466 y(terrupt)f(handling)c(is)i
(complete.)33 2523 y(If)e(a)h(k)o(ernel)h(pro)q(cess)h(is)e(in)o(terrupted,)h
(then)g(after)f(the)-30 2573 y(in)o(terrupt)k(has)g(b)q(een)g(handled,)g(the)
f(k)o(ernel)h(pro)q(cess)h(re-)-30 2622 y(sumes)f(where)h(it)e(had)g(left)h
(o\013)f(regardless.)28 b(This)16 b(p)q(oin)o(t)-30 2672 y(is)j(imp)q(ortan)o
(t)d(for)i(understanding)h(ho)o(w)f(UNIX)h(a)o(v)o(oids)-30
2722 y(man)o(y)e(of)h(the)i(pitfalls)d(asso)q(ciated)i(with)g(\\critical)f
(sec-)-30 2772 y(tions")g(of)g(co)q(de,)i(whic)o(h)e(are)h(discussed)h(at)e
(the)h(end)g(of)-30 2822 y(this)14 b(c)o(hapter.)1010 17 y
Fg(8.3)55 b(Program)18 b(Sw)n(apping)1010 104 y Fn(In)f(general)h(there)h
(will)d(b)q(e)i(insu\016cien)o(t)g(main)e(memory)1010 153 y(for)k(all)f(the)h
(pro)q(cess)i(images)d(at)h(once,)i(and)e(the)g(data)1010 203
y(segmen)o(ts)10 b(for)g(some)f(of)h(these)h(will)e(ha)o(v)o(e)h(to)g(b)q(e)h
(\\sw)o(app)q(ed)1010 253 y(out")f(i.e.)16 b(written)c(to)e(disk)g(in)h(a)f
(sp)q(ecial)h(area)f(designated)1010 303 y(as)k(the)g(sw)o(ap)g(area.)1072
358 y(While)g(on)g(disk)g(the)i(pro)q(cess)g(images)d(are)i(relativ)o(ely)
1010 408 y(inaccessible)f(and)f(certainly)h(unexecutable.)19
b(The)13 b(set)i(of)1010 458 y(pro)q(cess)i(images)c(in)i(main)e(memory)f(m)o
(ust)i(therefore)i(b)q(e)1010 508 y(c)o(hanged)g(regularly)f(b)o(y)g(sw)o
(apping)g(images)e(in)i(and)h(out.)1010 557 y(Most)11 b(decisions)h
(regarding)f(sw)o(apping)g(are)g(made)f(b)o(y)h(the)1010 607
y(pro)q(cedure)i(\\sc)o(hed")e(\(1940\))f(whic)o(h)h(is)f(considered)i(in)f
(de-)1010 657 y(tail)i(in)g(Chapter)i(F)m(ourteen.)1072 712
y(\\sc)o(hed")21 b(is)e(executed)j(b)o(y)d(pro)q(cess)j(#0,)e(whic)o(h)g(af-)
1010 762 y(ter)14 b(completing)d(its)i(initial)e(tasks,)i(sp)q(ends)i(its)e
(time)f(in)g(a)1010 812 y(double)k(role:)24 b(op)q(enly)17
b(as)g(the)g(\\sc)o(heduler")h(i.e.)26 b(a)16 b(nor-)1010 862
y(mal)9 b(k)o(ernel)j(pro)q(cess;)i(and)d(surreptitiously)h(as)g(the)g(in)o
(ter-)1010 912 y(mediate)k(pro)q(cess)k(of)c(\\swtc)o(h")i(\(discussed)h(in)e
(Chapter)1010 962 y(Sev)o(en\).)28 b(Since)17 b(the)g(pro)q(cedure)i(\\sc)o
(hed")f(nev)o(er)f(termi-)1010 1011 y(nates,)g(k)o(ernel)g(pro)q(cess)h(#0)e
(nev)o(er)h(completes)f(its)g(task,)1010 1061 y(and)f(so)h(the)g(question)f
(of)g(a)g(user)i(pro)q(cess)g(#0)e(do)q(es)h(not)1010 1111
y(arise.)1010 1257 y Fg(8.4)55 b(Jobs)1010 1344 y Fn(There)17
b(is)g(no)f(concept)i(of)e(\\job")f(in)h(UNIX,)h(at)f(least)h(in)1010
1393 y(the)d(sense)i(in)d(whic)o(h)g(this)h(term)f(is)h(understo)q(o)q(d)h
(in)e(more)1010 1443 y(con)o(v)o(en)o(tional,)f(batc)o(h)i(pro)q(cessing)h
(orien)o(ted)g(systems.)1072 1499 y(An)o(y)g(pro)q(cess)h(ma)o(y)d(\\fork")h
(a)g(new)h(cop)o(y)g(of)f(itself)g(at)1010 1548 y(an)o(y)g(time,)f(essen)o
(tially)h(without)g(dela)o(y)m(,)f(and)h(hence)i(cre-)1010
1598 y(ate)d(the)g(equiv)n(alen)o(t)f(of)g(a)g(new)h(job.)k(Hence)d(job)e(sc)
o(hedul-)1010 1648 y(ing,)h(job)g(classes,)i(etc.)k(are)14
b(non-ev)o(en)o(ts)h(here.)1010 1794 y Fg(8.5)55 b(Assem)n(bler)18
b(Pro)r(cedures)1010 1881 y Fn(The)i(next)h(three)g(pro)q(cedures)i(are)d
(written)h(in)f(assem-)1010 1930 y(bler)13 b(and)f(run)h(with)f(the)h(pro)q
(cessor)h(priorit)o(y)e(lev)o(el)g(set)h(to)1010 1980 y(sev)o(en.)18
b(These)13 b(pro)q(cedures)h(do)e(not)g(observ)o(e)h(the)f(normal)1010
2030 y(pro)q(cedure)k(en)o(try)f(con)o(v)o(en)o(tions)f(so)h(that)f(r5)g(and)
h(r6,)e(the)1010 2080 y(en)o(vironmen)o(t)h(and)h(stac)o(k)h(p)q(oin)o(ters,)
g(are)g(not)f(disturb)q(ed)1010 2130 y(during)e(pro)q(cedure)j(en)o(try)f
(and)e(exit.)1072 2185 y(As)k(has)g(already)f(b)q(een)i(noted,)f(\\sa)o(vu")f
(and)h(\\retu")1010 2235 y(can)i(com)o(bine)f(to)h(pro)q(duce)i(the)e
(e\013ect)i(of)e(a)g(coroutine)1010 2285 y(jump.)c(The)d(third)g(pro)q
(cedure,)h(\\aretu,")f(when)g(follo)o(w)o(ed)1010 2334 y(b)o(y)19
b(a)g(\\return")h(statemen)o(t)g(pro)q(duces)g(the)h(e\013ect)g(of)d(a)1010
2384 y(non-lo)q(cal)13 b(\\goto".)1010 2530 y Fg(8.6)55 b(sa)n(vu)20
b(\(0725\))1010 2617 y Fn(This)10 b(pro)q(cedure)i(is)e(called)g(b)o(y)g
(\\newpro)q(c")h(\(1889,)e(1905\),)1010 2667 y(\\swtc)o(h")24
b(\(2189,)h(2281\),)h(\\expand")d(\(2284\),)j(\\trapl")1010
2716 y(\(2846\))13 b(and)h(\\xsw)o(ap")f(\(4476,4477\).)1072
2772 y(The)j(v)n(alues)e(of)h(r5)g(and)g(r6)g(are)g(stored)h(in)f(the)g(arra)
o(y)1010 2822 y(whose)f(address)h(is)f(passed)h(as)f(a)g(parameter.)-30
2946 y(38)p eop
%%Page: 39 47
46 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)797
b(8)43 b(PR)o(OCESS)15 b(MANA)o(GEMENT)-30 17 y Fg(8.7)56 b(retu)18
b(\(0740\))-30 97 y Fn(This)h(pro)q(cedure)i(is)d(called)h(b)o(y)f(\\swtc)o
(h")h(\(2193,)g(2228\))-30 147 y(and)14 b(\\expand")g(\(2294\).)33
198 y(It)21 b(resets)j(the)e(sev)o(en)o(th)g(k)o(ernel)g(segmen)o(tation)e
(ad-)-30 248 y(dress)f(register,)f(and)f(then)h(resets)g(r6)f(and)g(r5)g
(from)e(the)-30 298 y(newly)i(accessible)g(cop)o(y)f(of)g(\\u.u)p
511 298 13 2 v 14 w(rsa)o(v")g(\(whic)o(h)h(it)f(ma)o(y)-30
348 y(b)q(e)f(noted,)f(is)g(at)f(the)i(b)q(eginning)e(of)g(\\u"\).)-30
474 y Fg(8.8)56 b(aretu)18 b(\(0734\))-30 554 y Fn(This)25
b(pro)q(cedure)i(is)e(called)g(b)o(y)f(\\sleep")i(\(2106\))e(and)-30
604 y(\\swtc)o(h")15 b(\(2242\).)33 656 y(It)f(reloads)h(r6)f(and)g(r5)g
(from)f(the)i(address)g(passed)h(as)-30 706 y(a)e(parameter.)-30
832 y Fg(8.9)56 b(swtc)n(h)20 b(\(2178\))-30 912 y Fn(\\swtc)o(h")f(is)g
(called)f(b)o(y)h(\\trap")f(\(0770,)h(0791\),)f(\\sleep")-30
962 y(\(2084,)9 b(2093\),)g(\\expand")g(\(2287\),)g(\\exit")g(\(3256\),)g
(\\stop")-30 1012 y(\(4027\))14 b(and)f(\\xallo)q(c")g(\(4480\).)33
1063 y(This)f(pro)q(cedure)i(is)d(unique)h(in)g(that)g(its)g(execution)h(is)
-30 1113 y(in)i(three)h(phases)g(whic)o(h)e(in)h(general)g(in)o(v)o(olv)o(e)e
(three)j(sep-)-30 1163 y(arate)f(k)o(ernel)f(pro)q(cesses.)22
b(The)14 b(\014rst)h(and)f(third)g(of)f(these)-30 1213 y(pro)q(cesses)h(will)
c(b)q(e)h(called)g(the)g(\\retiring")g(and)g(the)g(\\aris-)-30
1262 y(ing")18 b(pro)q(cesses)i(resp)q(ectiv)o(ely)m(.)32 b(Pro)q(cess)20
b(#0)d(is)h(alw)o(a)o(ys)-30 1312 y(the)f(in)o(termediate)f(pro)q(cess;)i(it)
e(ma)o(y)f(b)q(e)h(the)h(\\retiring")-30 1362 y(or)d(the)h(\\arising")d(pro)q
(cess)k(as)e(w)o(ell.)33 1414 y(Note)c(that)g(the)g(only)g(v)n(ariables)f
(used)h(b)o(y)g(\\swtc)o(h")g(are)-30 1464 y(either)i(registers,)h(or)e
(global)e(or)i(static)g(\(stored)h(globally\).)-30 1563 y Fi(2184:)21
b Fn(The)i(static)g(structure)i(p)q(oin)o(ter,)f(\\p",)g(de\014nes)74
1612 y(a)g(starting)g(p)q(oin)o(t)f(for)h(searc)o(hing)g(through)g(the)74
1662 y(\\pro)q(c")e(arra)o(y)g(to)f(lo)q(cate)h(the)h(next)f(pro)q(cess)i(to)
74 1712 y(activ)n(ate.)33 b(Its)19 b(use)h(reduces)h(the)e(bias)g(sho)o(wn)g
(to)74 1762 y(pro)q(cesses)j(en)o(tered)f(early)e(in)f(the)i(\\pro)q(c")f
(arra)o(y)m(.)74 1812 y(If)e(\\p")g(is)h(n)o(ull,)f(set)h(its)g(v)n(alue)f
(to)g(the)h(b)q(eginning)74 1861 y(of)e(the)i(\\pro)q(c")f(arra)o(y)m(.)26
b(This)17 b(should)g(only)f(o)q(ccur)74 1911 y(up)q(on)e(the)h(v)o(ery)f
(\014rst)h(call)e(on)g(\\swtc)o(h";)-30 2002 y Fi(2189:)21
b Fn(A)f(call)f(on)g(\\sa)o(vu")g(\(0725\))g(sa)o(v)o(es)h(the)g(curren)o(t)
74 2052 y(v)n(alues)14 b(of)g(the)h(en)o(vironmen)o(t)f(and)g(stac)o(k)h(p)q
(oin)o(ters)74 2101 y(\(r5)f(and)g(r6\);)-30 2192 y Fi(2193:)21
b Fn(\\retu")f(\(0740\))f(resets)j(r5)d(and)h(r6,)g(and,)h(most)74
2242 y(imp)q(ortan)o(tly)m(,)9 b(resets)k(the)f(k)o(ernel)g(address)h
(register)74 2292 y(6)h(to)g(address)h(the)f(\\sc)o(heduler's")h(data)f
(segmen)o(t;)-30 2382 y Fi(2195:)21 b Fn(Phase)15 b(Tw)o(o)e(b)q(egins:)74
2453 y(The)18 b(co)q(de)h(from)d(this)h(line)h(to)f(line)g(2224)g(is)g(only)
74 2502 y(ev)o(er)j(executed)h(b)o(y)e(k)o(ernel)h(pro)q(cess)h(#0.)33
b(There)74 2552 y(are)16 b(t)o(w)o(o)f(nested)i(lo)q(ops,)e(from)f(whic)o(h)h
(there)i(is)e(no)74 2602 y(exit)f(un)o(til)f(a)h(runnable)g(pro)q(cess)i(can)
e(b)q(e)g(found.)74 2672 y(A)o(t)k(slac)o(k)f(p)q(erio)q(ds,)i(the)f(pro)q
(cessor)h(sp)q(ends)g(most)74 2722 y(of)13 b(its)h(time)e(executing)j(line)e
(2220.)k(It)d(is)f(only)g(dis-)74 2772 y(turb)q(ed)j(thence)g(b)o(y)f(an)f
(in)o(terrupt)h(\(e.g.)20 b(from)13 b(the)74 2822 y(clo)q(c)o(k\);)1010
17 y Fi(2196:)20 b Fn(The)g(\015ag)f(\\runrun")h(is)f(reset.)37
b(\(It)19 b(is)h(used)g(to)1114 66 y(indicate)f(that)g(a)g(higher)g(priorit)o
(y)f(pro)q(cess)j(than)1114 116 y(the)16 b(curren)o(t)g(pro)q(cess)i(is)d
(ready)h(to)f(run.)23 b(\\swtc)o(h")1114 166 y(is)15 b(ab)q(out)h(to)f(lo)q
(ok)g(for)g(the)h(highest)g(priorit)o(y)f(pro-)1114 216 y(cess.\);)1010
302 y Fi(2224:)20 b Fn(The)11 b(priorit)o(y)e(of)h(the)h(\\arising")e(pro)q
(cess)j(is)e(noted)1114 352 y(in)15 b(\\curpri")g(\(a)h(global)e(v)n
(ariable\))g(for)i(future)g(ref-)1114 402 y(erence)g(and)d(comparison;)1010
489 y Fi(2228:)20 b Fn(Another)15 b(call)e(on)g(\\retu")h(resets)i(r5,)d(r6)h
(and)f(the)1114 538 y(sev)o(en)o(th)18 b(k)o(ernel)f(address)h(register)g(to)
f(v)n(alues)f(ap-)1114 588 y(propriate)e(for)f(the)i(\\arising")d(pro)q
(cess;)1010 675 y Fi(2229:)20 b Fn(Phase)15 b(Three)g(b)q(egins:)1114
743 y(\\sureg")c(\(1739\))f(resets)k(the)d(user)i(mo)q(de)d(hardw)o(are)1114
793 y(segmen)o(tation)f(registers)k(using)d(the)i(stored)f(proto-)1114
843 y(t)o(yp)q(es)j(for)g(the)g(arising)g(pro)q(cess;)1010
929 y Fi(2230:)20 b Fn(The)d(commen)o(t)e(whic)o(h)i(b)q(egins)g(here)h(is)e
(not)h(en-)1114 979 y(couraging.)g(W)m(e)c(will)f(return)j(to)e(this)h(p)q
(oin)o(t)f(again)1114 1029 y(to)o(w)o(ards)g(the)i(end)f(of)g(this)g(c)o
(hapter;)1010 1115 y Fi(2247:)20 b Fn(If)15 b(y)o(ou)g(c)o(hec)o(k,)i(y)o(ou)
e(will)f(\014nd)h(that)h(none)g(of)e(the)1114 1165 y(pro)q(cedures)h(whic)o
(h)d(call)g(\\swtc)o(h")h(directly)h(exam-)1114 1215 y(ines)g(the)g(v)n(alue)
g(returned)h(here.)1114 1283 y(Only)23 b(the)g(pro)q(cedures)j(whic)o(h)d
(call)f(\\newpro)q(c")1114 1333 y(whic)o(h)14 b(are)h(in)o(terested)h(in)e
(this)g(v)n(alue,)g(b)q(ecause)i(of)1114 1383 y(the)e(w)o(a)o(y)f(the)i(c)o
(hild)e(pro)q(cess)j(is)e(\014rst)g(activ)n(ated!)1010 1504
y Fg(8.10)56 b(setpri)17 b(\(2156\))1010 1582 y Fi(2161:)j
Fn(Pro)q(cess)12 b(priorities)d(are)g(calculated)h(according)f(to)1114
1632 y(the)14 b(form)o(ula)1114 1744 y(priorit)o(y)f(=)h(min\(127,)1395
1794 y(\(time)f(used)i(+)f(PUSER)g(+)g(p)p 1873 1794 V 15 w(nice\)\))1114
1956 y(where)1114 2042 y Fi(\(1\))19 b Fn(time)12 b(used)h(=)g(accum)o
(ulated)f(cen)o(tral)h(pro)q(ces-)1205 2092 y(sor)18 b(time)e(\(usually)h
(since)i(the)f(pro)q(cess)h(w)o(as)1205 2142 y(last)10 b(sw)o(app)q(ed)i
(in\),)e(measured)h(in)f(clo)q(c)o(k)h(tic)o(ks)1205 2192 y(divided)20
b(b)o(y)h(16)f(i.e.)38 b(thirds)21 b(of)f(a)g(second.)1205
2242 y(\(More)15 b(on)e(this)h(later)h(when)f(w)o(e)g(discuss)h(the)1205
2292 y(clo)q(c)o(k)f(in)o(terrupt.\);)1114 2360 y Fi(\(2\))19
b Fn(PUSER)14 b(==)h(100;)1114 2428 y Fi(\(3\))k Fn(\\p)p 1241
2428 V 15 w(nice")c(is)g(a)g(parameter)f(used)i(to)f(bias)f(the)1205
2478 y(pro)q(cess)k(priorit)o(y)m(.)25 b(It)16 b(is)h(normally)c(p)q(ositiv)o
(e)1205 2528 y(and)f(hence)i(reduces)g(the)f(pro)q(cess's)h(e\013ectiv)o(e)
1205 2577 y(precedence.)1072 2672 y(Note)28 b(the)g(somewhat)e(confusing)h
(con)o(v)o(en)o(tion)h(in)1010 2722 y(UNIX)19 b(that)h(the)f(lo)o(w)o(er)g
(the)h(priorit)o(y)m(,)f(the)g(higher)g(the)1010 2772 y(precedence.)i(Th)o
(us)15 b(a)e(priorit)o(y)h(of)f({10)g(b)q(eats)i(a)f(priorit)o(y)1010
2822 y(of)f(100)g(ev)o(ery)i(time.)1890 2946 y(39)p eop
%%Page: 40 48
47 bop -30 -144 a Fk(8)43 b(PR)o(OCESS)16 b(MANA)o(GEMENT)797
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(2165:)21
b Fn(Set)28 b(the)g(resc)o(heduling)h(\015ag)e(if)f(the)i(pro)q(cess,)74
66 y(whose)13 b(priorit)o(y)e(has)h(just)g(b)q(een)h(recalculated,)g(has)74
116 y(less)i(precedence)i(than)d(the)g(curren)o(t)i(pro)q(cess.)33
226 y(The)e(sense)i(of)e(the)h(test)g(on)f(line)g(2165)f(is)h(surprising,)-30
276 y(esp)q(ecially)h(when)h(it)e(is)h(compared)f(with)h(line)f(2141.)20
b(W)m(e)-30 326 y(lea)o(v)o(e)15 b(it)f(to)g(the)h(reader)h(to)f(satisfy)f
(himself)f(that)h(this)h(is)-30 376 y(not)f(an)f(error.)19
b(\(Hin)o(t:)f(lo)q(ok)12 b(at)h(the)h(parameters)g(for)f(the)-30
426 y(calls)h(on)g(\\setpri".\))-30 567 y Fg(8.11)56 b(sleep)18
b(\(2066\))-30 652 y Fn(This)g(pro)q(cedure)i(is)e(called)g(\(from)e(nearly)i
(30)g(di\013eren)o(t)-30 702 y(places)g(in)e(the)h(co)q(de\))h(when)f(a)g(k)o
(ernel)g(pro)q(cess)i(c)o(ho)q(oses)-30 751 y(to)14 b(susp)q(end)i(itself.)h
(There)e(are)g(t)o(w)o(o)e(parameters:)33 861 y Fl(\017)20
b Fn(the)15 b(reason)f(for)g(sleeping;)33 963 y Fl(\017)20
b Fn(a)9 b(priorit)o(y)g(with)g(whic)o(h)g(the)h(pro)q(cess)i(will)c(run)h
(after)74 1013 y(b)q(eing)14 b(a)o(w)o(ak)o(ened.)33 1123 y(If)d(this)i
(priorit)o(y)e(is)h(negativ)o(e)g(the)h(pro)q(cess)h(cannot)e(b)q(e)-30
1173 y(aroused)k(from)e(its)h(sleep)h(b)o(y)f(the)h(arriv)n(al)e(of)h(a)g
(\\signal".)-30 1223 y(\\signals")e(are)i(discussed)g(in)f(Chapter)g
(Thirteen.)-30 1333 y Fi(2070:)21 b Fn(The)12 b(curren)o(t)g(pro)q(cessor)h
(status)f(is)g(sa)o(v)o(ed)f(to)g(pre-)74 1382 y(serv)o(e)h(the)f(incoming)d
(pro)q(cessor)13 b(priorit)o(y)d(and)g(pre-)74 1432 y(vious)k(mo)q(de)f
(information;)-30 1534 y Fi(2072:)21 b Fn(If)10 b(the)i(priorit)o(y)e(is)h
(non-negativ)o(e,)g(a)f(test)i(is)f(made)74 1584 y(for)j(\\w)o(aiting)e
(signals";)-30 1685 y Fi(2075:)21 b Fn(A)12 b(small)e(critical)i(section)h(b)
q(egins)g(here,)g(wherein)74 1735 y(the)h(pro)q(cess)h(status)f(is)f(c)o
(hanged)h(and)f(the)g(param-)74 1785 y(eters)20 b(are)e(stored)h(in)f
(generally)g(accessible)h(lo)q(ca-)74 1835 y(tions)14 b(\(viz.)k(within)13
b(the)i(arra)o(y)e(\\pro)q(c"\).)74 1911 y(This)24 b(co)q(de)h(is)e(critical)
h(b)q(ecause)h(the)f(same)f(in-)74 1960 y(formation)j(\014elds)j(ma)o(y)e(b)q
(e)i(in)o(terrogated)g(and)74 2010 y(c)o(hanged)24 b(b)o(y)g(\\w)o(ak)o(eup")
f(\(2113\))g(whic)o(h)g(is)h(fre-)74 2060 y(quen)o(tly)14 b(called)g(b)o(y)f
(in)o(terrupt)i(handlers;)-30 2162 y Fi(2080:)21 b Fn(When)k(\\runin")f(is)h
(non-zero,)j(the)d(sc)o(heduler)74 2212 y(\(pro)q(cess)17 b(#0\))c(is)i(w)o
(aiting)d(to)j(sw)o(ap)f(another)h(pro-)74 2261 y(cess)h(in)o(to)d(main)f
(memory;)-30 2363 y Fi(2084:)21 b Fn(The)f(call)g(on)f(\\swtc)o(h")i
(represen)o(ts)h(a)e(dela)o(y)f(of)74 2413 y(unkno)o(wn)e(exten)o(t)g(during)
g(whic)o(h)f(a)h(relev)n(an)o(t)g(ex-)74 2463 y(ternal)i(ev)o(en)o(t)g(ma)o
(y)d(ha)o(v)o(e)i(o)q(ccurred.)33 b(Hence)20 b(the)74 2513
y(second)13 b(test)g(on)f(\\issig")f(\(2085\))g(is)h(not)f(irrelev)n(an)o(t;)
-30 2614 y Fi(2087:)21 b Fn(F)m(or)j(negativ)o(e)g(priorit)o(y)g(\\sleeps",)j
(where)e(the)74 2664 y(pro)q(cess)20 b(t)o(ypically)d(w)o(aits)h(for)g
(freeing)g(of)g(system)74 2714 y(table)i(space,)i(the)f(o)q(ccurrence)h(of)e
(a)f(\\signal")g(is)74 2764 y(not)13 b(allo)o(w)o(ed)f(to)h(de\015ect)i(the)e
(course)i(of)d(the)i(activ-)74 2814 y(it)o(y)m(.)1010 17 y
Fg(8.12)56 b(w)n(ak)n(eup)19 b(\(2113\))1010 93 y Fn(This)k(pro)q(cedure)h
(complemen)o(ts)d(\\sleep".)45 b(It)23 b(simply)1010 143 y(searc)o(hes)f(the)
f(set)h(of)e(all)f(pro)q(cesses,)24 b(lo)q(oking)19 b(for)i(an)o(y)1010
193 y(pro)q(cesses)13 b(whic)o(h)d(are)g(\\sleeping")g(for)g(a)g(sp)q
(eci\014ed)h(reason)1010 243 y(\(giv)o(en)16 b(as)g(the)h(parameter)f(\\c)o
(han"\),)g(and)g(reactiv)n(ating)1010 293 y(these)f(individually)c(b)o(y)j(a)
g(call)f(on)g(\\setrun".)1010 406 y Fg(8.13)56 b(setrun)18
b(\(2134\))1010 483 y Fi(2140:)i Fn(The)f(pro)q(cess)h(status)e(is)g(set)h
(to)f(\\SR)o(UN".)f(The)1114 533 y(pro)q(cess)23 b(will)d(no)o(w)h(b)q(e)h
(considered)h(b)o(y)f(\\swtc)o(h")1114 583 y(and)k(\\sc)o(hed")g(as)g(a)g
(candidate)h(for)e(execution)1114 632 y(again;)1010 710 y Fi(2141:)20
b Fn(If)j(the)g(aroused)h(pro)q(cess)g(is)f(more)f(imp)q(ortan)o(t)1114
760 y(\(lo)o(w)o(er)10 b(priorit)o(y!\))16 b(than)11 b(the)h(curren)o(t)g
(pro)q(cess,)g(the)1114 810 y(resc)o(heduling)g(\015ag,)f(\\runrun")g(is)g
(set)i(for)d(later)i(ref-)1114 859 y(erence;)1010 937 y Fi(2143:)20
b Fn(If)15 b(\\sc)o(hed")h(is)g(sleeping,)f(w)o(aiting)f(for)h(a)g(pro)q
(cess)1114 987 y(to)10 b(\\sw)o(ap)f(in",)h(and)g(if)f(the)i(newly)f(aroused)
g(pro)q(cess)1114 1037 y(is)j(on)h(disk,)f(w)o(ak)o(e)h(up)g(\\sc)o(hed".)
1072 1114 y(Since)26 b(it)f(turns)h(out)g(that)f(\\sc)o(hed")h(is)g(the)g
(only)1010 1164 y(pro)q(cedure)21 b(whic)o(h)d(calls)h(sleep)h(with)e(\\c)o
(han")h(equal)f(to)1010 1214 y(\\&runout",)e(line)f(2145)g(could)g(b)q(e)i
(replaced)g(b)o(y)e(the)i(re-)1010 1264 y(cursiv)o(e)e(call)1075
1341 y Ff(setrun\(&proc[0]\);)1010 1419 y Fn(or)f(b)q(etter)h(still,)e(b)o(y)
g(just)1075 1496 y Ff(rp)22 b(=)f(&proc[0];)1075 1546 y(goto)g(sr;)1010
1624 y Fn(where)12 b(\\sr")g(is)f(a)g(lab)q(el)f(to)h(b)q(e)h(inserted)h(at)e
(the)h(b)q(eginning)1010 1673 y(of)h(line)h(2139.)1010 1787
y Fg(8.14)56 b(expand)18 b(\(2268\))1010 1864 y Fn(The)i(commen)o(t)d(at)i
(the)h(b)q(eginning)e(of)h(this)g(pro)q(cedure)1010 1914 y(\(2251\))e(sa)o
(ys)i(most)e(of)h(what)g(needs)i(to)e(b)q(e)h(said)f(ab)q(out)1010
1964 y(the)11 b(pro)q(cedure,)i(except)g(for)d(the)i(question)f(of)f(\\sw)o
(apping)1010 2013 y(out")j(when)i(not)f(enough)g(core)g(is)g(a)o(v)n
(ailable.)1072 2063 y(Note)k(that)f(\\expand")g(tak)o(es)g(no)g(particular)g
(notice)1010 2113 y(of)c(the)i(con)o(ten)o(ts)g(of)e(the)h(user)h(data)f
(area)g(or)g(stac)o(k)g(area.)1010 2191 y Fi(2277:)20 b Fn(If)g(the)g
(expansion)g(is)g(actually)f(a)g(con)o(traction,)1114 2240
y(then)12 b(trim)e(o\013)h(the)h(excess)h(from)d(the)i(high)f(address)1114
2290 y(end;)1010 2368 y Fi(2281:)20 b Fn(\\sa)o(vu")j(stores)i(the)g(v)n
(alues)e(of)g(r5)g(and)h(r6)g(in)1114 2417 y(\\u.u)p 1195 2417
13 2 v 14 w(rsa)o(v";)1010 2495 y Fi(2283:)c Fn(If)13 b(su\016cien)o(t)g
(main)d(memory)g(is)j(not)f(a)o(v)n(ailable)f(...)1010 2573
y Fi(2284:)20 b Fn(The)c(en)o(vironmen)o(t)f(p)q(oin)o(ter)h(and)f(stac)o(k)h
(p)q(oin)o(ter)1114 2622 y(are)j(recorded)i(again)d(in)g(\\u.u)p
1612 2622 V 15 w(ssa)o(v".)33 b(But)20 b(note)1114 2672 y(that)d(since)h(no)f
(new)h(pro)q(cedures)i(ha)o(v)o(e)d(b)q(een)i(en-)1114 2722
y(tered,)i(and)e(since)g(there)i(has)e(b)q(een)h(no)f(cum)o(ula-)1114
2772 y(tiv)o(e)12 b(stac)o(k)g(gro)o(wth,)g(the)h(v)n(alues)f(recorded)i(are)
e(the)1114 2822 y(same)h(as)h(at)f(line)h(2281;)-30 2946 y(40)p
eop
%%Page: 41 49
48 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)797
b(8)43 b(PR)o(OCESS)15 b(MANA)o(GEMENT)-30 17 y Fi(2285:)21
b Fn(\\xsw)o(ap")9 b(\(4368\))h(copies)h(the)f(core)h(image)d(for)i(the)74
66 y(pro)q(cess)21 b(designated)f(b)o(y)e(its)h(\014rst)h(parameter)f(to)74
116 y(disk.)74 182 y(Since)i(the)g(second)g(parameter)e(is)h(non-zero)h(the)
74 232 y(main)12 b(memory)f(area)j(o)q(ccupied)g(b)o(y)g(the)g(data)f(seg-)74
282 y(men)o(t)e(is)h(returned)i(to)d(the)i(list)e(of)g(a)o(v)n(ailable)f
(space.)74 348 y(Ho)o(w)o(ev)o(er)i(the)g(computation)e(con)o(tin)o(ues)i
(using)f(the)74 397 y(same)g(area)i(in)e(main)f(memory)g(un)o(til)h(the)i
(next)f(call)74 447 y(on)i(\\retu")g(\(2193\))f(in)h(\\swtc)o(h".)33
536 y(Note)k(also)e(that)i(the)g(call)e(on)i(\\sa)o(vu")f(at)g(line)g(2189)
-30 585 y(in)k(\\swtc)o(h")h(stores)h(new)f(v)n(alues)f(in)g(\\u.u)p
679 585 13 2 v 14 w(rsa)o(v")g(after)-30 635 y(the)13 b(disk)e(image)f(has)i
(b)q(een)h(made)d(\(and)i(therefore)h(serv)o(es)-30 685 y(no)h(useful)g(purp)
q(ose)i(since)e(the)h(core)g(image)d(has)i(already)-30 735
y(b)q(een)h(o\016cially)d(\\abandoned"\);)-30 823 y Fi(2286:)21
b Fn(The)g(\\SSW)-5 b(AP")20 b(\015ag)f(is)h(set)h(in)f(the)h(pro)q(cess's)74
873 y(pro)q(c)11 b(arra)o(y)g(elemen)o(t.)16 b(\(This)11 b(is)f(not)h(sw)o
(app)q(ed)g(out,)74 923 y(so)j(the)h(e\013ect)g(is)f(not)g(lost\);)-30
1005 y Fi(2287:)21 b Fn(\\swtc)o(h")14 b(is)f(called,)g(and)g(the)h(pro)q
(cess,)h(still)e(run-)74 1055 y(ning)22 b(in)f(its)h(old)g(area)g(susp)q
(ends)i(itself.)42 b(Since)74 1104 y(the)16 b(call)e(on)h(\\xsw)o(ap")f(will)
g(ha)o(v)o(e)g(resulted)j(in)d(the)74 1154 y(\\SLO)o(AD")f(\015ag)g(b)q(eing)
h(switc)o(hed)g(o\013,)f(there)i(is)e(no)74 1204 y(w)o(a)o(y)i(that)g(\\swtc)
o(h")g(will)f(c)o(ho)q(ose)i(the)g(pro)q(cess)h(for)74 1254
y(immediate)11 b(reactiv)n(ation.)33 1342 y(Only)i(after)g(the)h(disk)g
(image)d(has)j(b)q(een)g(copied)g(bac)o(k)-30 1392 y(in)o(to)g(core)h(again)e
(can)i(the)f(pro)q(cess)i(b)q(e)f(activ)n(ated)f(again.)-30
1442 y(The)20 b(\\return")f(executed)i(b)o(y)e(\\swtc)o(h")g(is)f(a)h(return)
h(to)-30 1492 y(the)15 b(pro)q(cedure)h(whic)o(h)e(called)f(\\expand".)-30
1607 y Fg(8.15)56 b(swtc)n(h)20 b(revisited)-30 1684 y Fn(What)12
b(happ)q(ens)h(to)e(the)i(pro)q(cess)h(when)e(it)f(is)h(reactiv)n(ated)-30
1734 y(i.e.)18 b(it)13 b(b)q(ecomes)i(the)f(\\arising")f(pro)q(cess)i(in)f
(\\swtc)o(h"?)-30 1822 y Fi(2228:)21 b Fn(The)15 b(stac)o(k)g(and)f(en)o
(vironmen)o(t)f(p)q(oin)o(ters)i(are)g(re-)74 1872 y(stored)k(from)d(\\u.u)p
386 1872 V 14 w(rsa)o(v")h(\(Note)i(that)e(a)g(p)q(oin)o(ter)74
1922 y(to)f(\\u")g(is)g(also)f(a)h(p)q(oin)o(ter)g(to)g(\\u.u)p
653 1922 V 14 w(rsa)o(v")g(\(0415\))74 1972 y(but)e(...)-30
2054 y Fi(2240:)21 b Fn(If)16 b(the)h(core)g(image)d(w)o(as)j(sw)o(app)q(ed)g
(out)f(e.g.)25 b(b)o(y)74 2103 y(\\expand")14 b(...)-30 2185
y Fi(2242:)21 b Fn(No)e(reliance)h(is)g(placed)f(on)h(the)g(v)n(alues)f(of)g
(the)74 2235 y(stac)o(k)13 b(and)f(en)o(vironmen)o(t)f(p)q(oin)o(ters,)i(and)
f(they)h(are)74 2285 y(reset)33 2373 y(The)e(question)f(is)g(if)g(the)h(v)n
(alues)f(stored)h(in)f(\\u.u)p 784 2373 V 15 w(ssa)o(v")-30
2423 y(at)27 b(line)f(2284)g(are)i(the)f(same)f(as)h(v)n(alues)f(stored)i(in)
-30 2473 y(\\u.u)p 51 2473 V 15 w(rsa)o(v")13 b(at)g(line)f(2281,)g(ho)o(w)h
(did)g(they)g(get)h(to)f(b)q(e)h(dif-)-30 2523 y(feren)o(t?)33
2573 y(Presumably)f(this)i(is)f(what)g(\\y)o(ou)g(are)g(not)h(exp)q(ected)-30
2622 y(to)25 b(understand")h(\(line)e(2238\))g(...)50 b(clearly)24
b(\\xsw)o(ap")-30 2672 y(should)17 b(b)q(e)h(in)o(v)o(estigated)f(...)26
b(the)18 b(trail)e(\014nally)g(ends)i(at)-30 2722 y(Chapter)e(Fifteen)e(...)
19 b(in)14 b(the)h(mean)o(time)d(y)o(ou)i(ma)o(y)f(wish)-30
2772 y(to)h(in)o(v)o(estigate)f(for)h(y)o(ourself)f(so)h(that)g(y)o(ou)f(ma)o
(y)e(join)i(the)-30 2822 y(\\2238")g(club)h(that)g(m)o(uc)o(h)e(so)q(oner.)
1010 17 y Fg(8.16)56 b(Critical)17 b(Sections)1010 93 y Fn(If)12
b(t)o(w)o(o)g(or)h(more)e(pro)q(cesses)k(op)q(erate)f(on)e(the)h(same)f(set)i
(of)1010 143 y(data,)i(then)h(the)g(com)o(bined)e(output)i(of)e(the)i(set)g
(of)f(pro-)1010 193 y(cesses)i(ma)o(y)13 b(dep)q(end)k(on)f(the)g(relativ)o
(e)f(sync)o(hronisation)1010 243 y(of)e(the)i(v)n(arious)e(pro)q(cesses.)1072
293 y(This)20 b(is)g(usually)f(considered)i(to)f(b)q(e)h(highly)e(unde-)1010
342 y(sirable)f(and)h(to)g(b)q(e)g(a)o(v)o(oided)f(at)g(all)g(costs.)33
b(The)20 b(solu-)1010 392 y(tion)12 b(is)h(usually)e(to)i(de\014ne)h
(\\critical)e(sections")h(\(it)g(is)f(the)1010 442 y(programmer's)j(resp)q
(onsibilit)o(y)h(to)h(recognise)i(these\))g(in)1010 492 y(the)f(co)q(de)h
(whic)o(h)e(is)h(executed)i(b)o(y)d(eac)o(h)h(pro)q(cess.)32
b(The)1010 542 y(programmer)12 b(m)o(ust)h(then)h(ensure)i(that)e(at)g(an)o
(y)g(time)e(no)1010 591 y(more)18 b(than)i(pro)q(cess)i(is)d(executing)h(a)g
(section)g(of)f(co)q(de)1010 641 y(whic)o(h)14 b(is)g(critical)f(with)h(resp)
q(ect)i(to)e(a)g(part1cular)g(set)h(of)1010 691 y(data.)1072
741 y(In)h(UNIX)g(user)h(pro)q(cesses)i(do)c(not)h(share)h(data)e(and)1010
791 y(so)21 b(do)f(not)h(con\015ict)g(in)f(this)h(w)o(a)o(y)m(.)37
b(Kernel)21 b(pro)q(cesses)1010 840 y(ho)o(w)o(ev)o(er)14 b(ha)o(v)o(e)g
(shared)h(access)h(to)d(v)n(arious)h(system)f(data)1010 890
y(and)h(can)g(con\015ict.)1072 940 y(In)i(UNIX)g(an)f(in)o(terrupt)i(do)q(es)
f(not)g(cause)g(a)g(c)o(hange)1010 990 y(in)11 b(pro)q(cess)j(as)e(a)g
(direct)h(side)g(e\013ect.)19 b(Only)11 b(where)j(k)o(ernel)1010
1040 y(pro)q(cesses)i(ma)o(y)11 b(susp)q(end)k(themselv)o(es)e(in)g(the)h
(middle)e(of)1010 1090 y(a)f(critical)g(section)i(b)o(y)e(an)g(explicit)g
(call)g(on)g(\\sleep",)h(do)q(es)1010 1139 y(an)h(explicit)g(lo)q(c)o(k)f(v)n
(ariable)h(whic)o(h)g(ma)o(y)e(b)q(e)j(observ)o(ed)g(b)o(y)1010
1189 y(a)g(group)h(of)f(pro)q(cesses\))j(need)f(to)e(b)q(e)i(in)o(tro)q
(duced.)21 b(Ev)o(en)1010 1239 y(then)14 b(the)g(actions)f(of)g(testing)h
(and)f(setting)h(the)g(lo)q(c)o(ks)f(do)1010 1289 y(not)h(usually)f(ha)o(v)o
(e)g(to)h(b)q(e)h(made)d(inseparable.)1072 1339 y(Some)17 b(critical)g
(sections)i(of)e(co)q(de)h(are)h(executed)g(b)o(y)1010 1388
y(in)o(terrupt)j(handlers.)42 b(T)m(o)20 b(protect)j(other)f(sections)h(of)
1010 1438 y(co)q(de)18 b(whose)g(outcome)e(ma)o(y)g(b)q(e)i(a\013ected)g(b)o
(y)f(the)h(han-)1010 1488 y(dling)12 b(of)h(certain)h(in)o(terrupts,)g(the)g
(pro)q(cessor)h(priorit)o(y)d(is)1010 1538 y(raised)17 b(temp)q(orarily)f
(high)g(enough)h(b)q(efore)h(the)f(critical)1010 1588 y(section)12
b(is)g(en)o(tered)h(to)f(dela)o(y)f(suc)o(h)i(in)o(terrupts)g(un)o(til)e(it)g
(is)1010 1637 y(safe,)k(when)h(the)g(pro)q(cessor)i(priorit)o(y)c(is)i
(reduced)h(again.)1010 1687 y(There)d(are)g(of)f(course)h(a)f(n)o(um)o(b)q
(er)g(of)g(con)o(v)o(en)o(tions)g(whic)o(h)1010 1737 y(in)o(terrupt)k
(handling)d(co)q(de)j(should)f(observ)o(e,)h(as)f(will)e(b)q(e)1010
1787 y(discussed)h(later)f(in)g(Chapter)g(Nine.)1072 1837 y(In)20
b(passing)g(it)g(ma)o(y)e(b)q(e)j(noted)f(that)h(the)f(strategy)1010
1887 y(adopted)e(b)o(y)f(UNIX)i(w)o(orks)e(only)g(for)h(a)f(single)h(pro)q
(ces-)1010 1936 y(sor)c(system)f(and)h(w)o(ould)e(b)q(e)j(totally)d
(inappropriate)h(in)g(a)1010 1986 y(m)o(ultipro)q(cessor)g(system.)1890
2946 y(41)p eop
%%Page: 42 50
49 bop -30 -144 a Fk(9)43 b(HARD)o(W)m(ARE)16 b(INTERR)o(UPTS)f(AND)g(TRAPS)
515 b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(Section)22
b(Tw)n(o)-30 108 y Fe(Section)16 b(Tw)o(o)e(is)g(concerned)j(with)e(traps,)f
(ha)o(rdw)o(a)o(re)i(inter-)-30 157 y(rupts)f(and)g(soft)o(w)o(a)o(re)f
(interrupts.)33 207 y(T)m(raps)19 b(and)h(ha)o(rdw)o(a)o(re)h(interrupts)g
(intro)q(duce)h(sudden)-30 257 y(switches)16 b(into)d(the)i(CPU's)d(no)o
(rmal)h(instruction)i(execution)-30 307 y(sequence)q(.)39 b(This)20
b(p)o(rovides)h(a)f(mechanism)f(fo)o(r)g(handling)-30 357 y(sp)q(ecial)c
(conditions)f(which)h(o)q(ccur)g(outside)f(the)h(CPU's)c(im-)-30
407 y(mediate)j(control.)33 456 y(Use)22 b(is)f(made)h(of)g(this)g(facilit)o
(y)g(as)g(pa)o(rt)g(of)g(another)-30 506 y(mechanism)17 b(called)h(the)f
(\\system)f(call",)h(whereb)o(y)i(a)e(user)-30 556 y(p)o(rogram)d(ma)o(y)f
(execute)j(a)e(\\trap")g(instruction)i(to)e(cause)h(a)-30 606
y(trap)e(delib)q(erately)h(and)f(so)e(obtain)h(the)h(op)q(erating)g(system's)
-30 656 y(attention)i(and)g(assistance.)33 706 y(The)j(soft)o(w)o(a)o(re)f
(interrupt)j(\(o)o(r)d(\\signal"\))g(is)g(a)h(mecha-)-30 755
y(nism)f(fo)o(r)f(communication)h(b)q(et)o(w)o(een)j(p)o(ro)q(cesses,)f(pa)o
(rticu-)-30 805 y(la)o(rly)14 b(when)i(there)f(is)f(\\bad)g(news".)-30
943 y Fj(9)70 b(Hardw)n(are)16 b(In)n(terrupts)f(and)h(T)-6
b(raps)-30 1034 y Fn(In)20 b(the)h(PDP11)e(computer,)i(as)f(in)g(man)o(y)e
(other)i(com-)-30 1083 y(puters,)h(there)e(is)g(an)f(\\in)o(terrupt")g(mec)o
(hanism,)f(whic)o(h)-30 1133 y(allo)o(ws)f(the)h(con)o(trollers)g(of)f(p)q
(eripheral)h(devices)h(\(whic)o(h)-30 1183 y(are)g(devices)g(external)f(to)f
(the)i(CPU\))f(to)g(in)o(terrupt)g(the)-30 1233 y(CPU)f(at)f(appropriate)g
(times,)f(with)g(requests)k(for)c(op)q(er-)-30 1283 y(ating)g(system)f
(service.)33 1333 y(The)d(same)g(mec)o(hanism)e(has)i(b)q(een)i(usefully)e
(and)g(con-)-30 1382 y(v)o(enien)o(tly)i(applied)g(to)g(\\traps")g(whic)o(h)g
(are)g(ev)o(en)o(ts)i(in)o(ter-)-30 1432 y(nal)e(to)h(the)g(CPU,)f(whic)o(h)h
(relate)g(to)g(hardw)o(are)g(and)f(soft-)-30 1482 y(w)o(are)18
b(errors,)i(and)d(to)g(requests)j(for)d(service)i(from)d(user)-30
1532 y(programs.)-30 1648 y Fg(9.1)56 b(Hardw)n(are)19 b(In)n(terrupts)-30
1725 y Fn(The)12 b(e\013ect)h(of)e(an)g(in)o(terrupt)h(is)f(to)g(div)o(ert)g
(the)h(CPU)f(from)-30 1775 y(whatev)o(er)k(it)e(w)o(as)h(doing)f(and)g(to)h
(redirect)h(it)e(to)h(execute)-30 1825 y(another)h(program.)33
1874 y(During)e(a)h(hardw)o(are)g(in)o(terrupt:)33 1966 y Fl(\017)20
b Fn(The)d(CPU)g(sa)o(v)o(es)h(the)f(curren)o(t)h(pro)q(cessor)h(status)74
2016 y(w)o(ord)k(\(PS\))g(and)g(the)h(curren)o(t)g(program)d(coun)o(t)74
2066 y(\(PC\))15 b(in)e(its)h(in)o(ternal)f(registers;)33 2149
y Fl(\017)20 b Fn(the)f(PC)g(and)f(PS)g(are)h(then)g(reloaded)g(from)d(t)o(w)
o(o)74 2199 y(consecutiv)o(e)i(w)o(ords)e(lo)q(cated)h(in)f(the)h(lo)o(w)e
(area)h(of)74 2248 y(main)k(memory)m(.)38 b(The)22 b(address)h(of)e(the)h
(\014rst)g(of)74 2298 y(these)15 b(t)o(w)o(o)f(w)o(ords)g(is)f(kno)o(wn)h(as)
g(the)g(\\)p Fi(v)o(ector)h(lo-)74 2348 y(cation)p Fn(")d(of)i(the)g(in)o
(terrupt;)33 2431 y Fl(\017)20 b Fn(\014nally)j(the)i(original)e(PC)h(and)h
(PS)f(v)n(alues)g(are)74 2481 y(stored)11 b(in)o(to)e(the)h(newly)f(curren)o
(t)i(stac)o(k.)18 b(\(Whether)74 2531 y(this)12 b(is)f(the)i(k)o(ernel)f(or)g
(user)g(stac)o(k)g(dep)q(ends)i(on)d(the)74 2581 y(new)k(v)n(alue)e(of)g(the)
i(PS.\))33 2672 y(Di\013eren)o(t)i(p)q(eripheral)f(devices)i(ma)o(y)c(ha)o(v)
o(e)i(di\013eren)o(t)-30 2722 y(v)o(ector)i(lo)q(cations.)28
b(The)17 b(actual)g(v)o(ector)h(lo)q(cation)e(for)h(a)-30 2772
y(particular)12 b(device)g(is)g(determined)g(b)o(y)f(hard)h(wiring,)f(and)-30
2822 y(can)h(only)e(b)q(e)i(c)o(hanged)f(with)g(di\016cult)o(y)m(.)16
b(Moreo)o(v)o(er)11 b(there)1010 17 y(are)i(w)o(ell)e(en)o(trenc)o(hed)k(con)
o(v)o(en)o(tions)d(for)g(c)o(ho)q(osing)g(v)o(ector)1010 66
y(lo)q(cations)h(for)h(the)g(v)n(arious)f(devices.)1072 116
y(Th)o(us)j(after)g(the)h(in)o(terrupt)g(has)f(o)q(ccurred,)h(b)q(ecause)1010
166 y(the)j(PC)f(has)g(b)q(een)h(reloaded,)h(the)e(source)i(of)d(instruc-)
1010 216 y(tions)13 b(executed)i(b)o(y)e(the)h(CPU)g(has)f(b)q(een)h(c)o
(hanged.)19 b(The)1010 266 y(new)d(source)i(should)d(b)q(e)i(a)f(pro)q
(cedure)i(asso)q(ciated)e(with)1010 316 y(the)j(p)q(eripheral)h(device)g(con)
o(troller)f(whic)o(h)f(caused)i(the)1010 365 y(in)o(terrupt.)1072
415 y(Also)f(since)h(the)f(PS)h(has)f(also)f(b)q(een)i(c)o(hanged,)g(the)1010
465 y(pro)q(cessor)e(mo)q(de)d(ma)o(y)g(ha)o(v)o(e)h(c)o(hanged.)26
b(In)16 b(UNIX,)g(the)1010 515 y(initial)d(mo)q(de)g(ma)o(y)g(b)q(e)j(either)
f(\\user")h(or)e(\\k)o(ernel",)h(but)1010 565 y(after)20 b(the)h(in)o
(terrupt,)g(the)g(mo)q(de)e(is)h(alw)o(a)o(ys)f(\\k)o(ernel".)1010
614 y(Recall)13 b(also)g(that)h(a)g(c)o(hange)g(in)f(mo)q(de)g(implies:)1010
697 y Fi(\(a\))20 b Fn(a)15 b(c)o(hange)h(in)f(memory)d(mappings.)21
b(\(Note)16 b(that)f(to)1114 747 y(a)o(v)o(oid)g(an)o(y)i(confusion,)g(v)o
(ector)h(lo)q(cations)e(are)i(al-)1114 797 y(w)o(a)o(ys)13
b(in)o(terpreted)j(as)e(k)o(ernel)g(mo)q(de)f(addresses.\);)1010
876 y Fi(\(b\))19 b Fn(a)g(c)o(hange)g(in)g(stac)o(k)g(p)q(oin)o(ters.)34
b(\(Recall)18 b(that)h(the)1114 926 y(stac)o(k)10 b(p)q(oin)o(ter,)h(SP)g(or)
f(r6,)h(is)f(the)h(only)e(sp)q(ecial)i(reg-)1114 976 y(ister)k(whic)o(h)g(is)
f(replicated)h(for)g(eac)o(h)g(mo)q(de.)k(This)1114 1026 y(implies)d(that)i
(after)g(a)f(mo)q(de)g(c)o(hange,)i(the)g(stac)o(k)1114 1075
y(p)q(oin)o(ter)d(v)n(alue)f(will)f(ha)o(v)o(e)i(c)o(hanged)g(ev)o(en)g
(though)1114 1125 y(it)d(has)h(not)g(b)q(een)h(reloaded!\))1010
1240 y Fg(9.2)55 b(The)19 b(In)n(terrupt)f(V)-5 b(ector)1010
1316 y Fn(F)m(or)16 b(our)g(sample)g(system,)g(the)h(represen)o(tativ)o(e)i
(p)q(eriph-)1010 1366 y(eral)g(devices)i(c)o(hosen)g(are)f(listed)g(in)f(T)m
(able)g(9.1,)g(along)1010 1416 y(with)12 b(their)h(con)o(v)o(en)o(tional)f
(hardw)o(are)h(de\014ned)h(v)o(ector)f(lo-)1010 1466 y(cations)h(and)f
(priorities.)1035 1588 y Fi(v)o(ector)85 b(p)q(eripheral)165
b(in)o(terru)o(pt)50 b(pro)q(cess)1035 1637 y(lo)q(cation)e(device)266
b(priorit)o(y)62 b(priorit)o(y)p 1010 1654 1046 2 v 1035 1689
a Fn(060)152 b(telet)o(yp)q(e)15 b(input)211 b(4)203 b(4)1035
1739 y(064)152 b(telet)o(yp)q(e)15 b(output)186 b(4)203 b(4)1035
1788 y(070)152 b(pap)q(er)14 b(tap)q(e)h(input)159 b(4)203
b(4)1035 1838 y(074)152 b(pap)q(er)14 b(tap)q(e)h(output)134
b(4)203 b(4)1035 1888 y(100)152 b(line)13 b(clo)q(c)o(k)297
b(6)203 b(6)1035 1938 y(104)152 b(programma)o(ble)203 b(6)g(6)1250
1988 y(clo)q(c)o(k)1035 2038 y(200)152 b(line)13 b(prin)o(ter)265
b(4)203 b(4)1035 2087 y(220)152 b(RK)13 b(disk)h(driv)o(e)213
b(5)203 b(5)1039 2199 y Fi(T)l(able)15 b(9.1)h(In)o(terrupt)d(V)l(ector)i(Lo)
q(cations)f(and)1373 2249 y(Prioriti)o(es)1010 2364 y Fg(9.3)55
b(In)n(terrupt)19 b(Handlers)1010 2440 y Fn(Within)8 b(this)h(selection)h(of)
f(UNIX)h(source)g(co)q(de,)h(there)g(are)1010 2490 y(sev)o(en)22
b(pro)q(cedures)i(kno)o(wn)c(as)i(\\in)o(terrupt)f(handlers",)1010
2540 y(i.e.)c(whic)o(h)12 b(are)g(executed)i(as)f(the)f(result)h(of,)f(and)g
(only)f(as)1010 2590 y(the)j(result)h(of,)e(in)o(terrupts:)1075
2672 y Ff(clock)43 b(\(3725\))f(pcrint)21 b(\(8719\))1075 2722
y(rkintr)g(\(5451\))42 b(pcpint)21 b(\(8739\))1075 2772 y(klxint)g(\(8070\))
42 b(lpint)h(\(8976\))1075 2822 y(klrint)21 b(\(8078\))-30
2946 y Fn(42)p eop
%%Page: 43 51
50 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)514
b(9)43 b(HARD)o(W)m(ARE)16 b(INTERR)o(UPTS)f(AND)g(TRAPS)-30
17 y Fn(\\clo)q(c)o(k")i(will)f(b)q(e)i(examined)e(in)h(detail)g(in)g
(Chapter)h(11.)-30 66 y(The)j(others)g(are)g(discussed)h(with)e(the)g(co)q
(de)h(for)f(their)-30 116 y(asso)q(ciated)15 b(devices.)-30
253 y Fg(9.4)56 b(Priorities)-30 337 y Fn(An)22 b(in)o(terrupt)f(do)q(es)h
(not)f(necessarily)h(o)q(ccur)g(immedi-)-30 386 y(ately)e(the)h(p)q
(eripheral)g(device)g(con)o(troller)f(requests)j(it,)-30 436
y(but)18 b(only)f(when)i(the)f(CPU)g(is)g(ready)g(to)f(accept)i(it.)30
b(It)-30 486 y(is)16 b(usually)g(desirable)g(that)h(a)e(request)j(for)e(a)g
(lo)o(w)f(prior-)-30 536 y(it)o(y)k(service)i(should)e(not)g(b)q(e)h(allo)o
(w)o(ed)e(to)h(in)o(terrupt)h(an)-30 586 y(activit)o(y)14 b(with)f(a)h
(higher)g(priorit)o(y)m(.)33 639 y(Bits)c(7)f(to)g(5)g(of)g(the)h(PS)g
(determine)g(the)g(pro)q(cessor)h(pri-)-30 689 y(orit)o(y)j(at)g(one)g(of)g
(eigh)o(t)f(lev)o(els)h(\(lab)q(elled)g(zero)h(to)f(sev)o(en\).)-30
739 y(Eac)o(h)g(in)o(terrupt)h(also)e(has)g(an)h(asso)q(ciated)g(priorit)o(y)
f(lev)o(el)-30 789 y(determined)j(b)o(y)f(hardw)o(are)h(wiring.)22
b(An)16 b(in)o(terrupt)g(will)-30 839 y(b)q(e)23 b(inhibited)f(as)g(long)f
(as)i(the)f(pro)q(cessor)i(priorit)o(y)e(is)-30 888 y(greater)15
b(than)f(or)g(equal)g(to)f(the)i(in)o(terrupt)g(priorit)o(y)m(.)33
942 y(After)c(the)g(in)o(terrupt)h(the)f(pro)q(cessor)i(priorit)o(y)d(will)f
(b)q(e)-30 992 y(determined)16 b(from)e(the)i(PS)g(stored)h(in)e(the)h(v)o
(ector)g(lo)q(ca-)-30 1042 y(tion)g(and)f(this)h(do)q(es)g(not)g(ha)o(v)o(e)f
(to)h(b)q(e)g(the)h(same)d(as)i(the)-30 1091 y(in)o(terrupt)c(priorit)o(y)m
(.)k(Whereas)d(the)e(in)o(terrupt)h(priorit)o(y)f(is)-30 1141
y(determined)17 b(b)o(y)f(hardw)o(are,)h(it)g(is)f(p)q(ossible)h(for)f(the)h
(op-)-30 1191 y(erating)c(system)f(to)h(c)o(hange)g(the)g(con)o(ten)o(ts)h
(of)e(the)h(v)o(ector)-30 1241 y(lo)q(cation)g(at)h(an)o(y)g(time.)33
1295 y(As)j(a)f(matter)f(of)h(curiosit)o(y)m(,)g(it)g(ma)o(y)f(b)q(e)i(noted)
g(that)-30 1344 y(the)11 b(PDP11)e(hardw)o(are)h(restricts)i(the)e(p)q
(ossible)g(in)o(terrupt)-30 1394 y(priorities)15 b(to)g(4,)g(5,)g(6)f(and)h
(7)g(i.e.)21 b(lev)o(els)15 b(1,)g(2)g(and)f(3)h(are)-30 1444
y(not)f(supp)q(orted)h(b)o(y)f(the)h(Unibus.)-30 1581 y Fg(9.5)56
b(In)n(terrupt)18 b(Priorities)-30 1664 y Fn(In)e(UNIX,)f(in)o(terrupt)g
(handling)f(routines)i(are)g(initiated)-30 1714 y(at)e(the)h(same)e(priorit)o
(y)g(as)h(the)g(in)o(terrupt)h(priorit)o(y)m(.)33 1768 y(This)f(means)g(that)
h(during)f(the)i(handling)d(of)h(the)h(in-)-30 1818 y(terrupt,)24
b(a)d(second)h(in)o(terrupt)f(from)e(a)i(device)h(of)e(the)-30
1867 y(same)f(priorit)o(y)f(class)i(will)e(b)q(e)i(dela)o(y)o(ed)f(un)o(til)f
(the)i(pro-)-30 1917 y(cessor)f(priorit)o(y)e(is)g(reduced,)i(either)f(b)o(y)
f(the)h(execution)-30 1967 y(of)d(one)g(of)f(the)i(\\spl")e(pro)q(cedures,)j
(whic)o(h)e(are)g(in)o(tended)-30 2017 y(for)20 b(just)f(this)h(purp)q(ose)g
(\(see)h(lines)f(1293)e(to)h(1315\),)h(or)-30 2067 y(b)o(y)e(reloading)e(the)
j(pro)q(cessor)g(status)f(w)o(ord)g(e.g.)29 b(up)q(on)-30 2117
y(returning)15 b(from)d(the)j(in)o(terrupt.)33 2170 y(During)f(in)o(terrupt)i
(handling,)d(the)i(pro)q(cessor)i(prior-)-30 2220 y(it)o(y)j(ma)o(y)f(b)q(e)i
(raised)g(temp)q(orarily)d(to)j(protect)g(the)g(in-)-30 2270
y(tegrit)o(y)f(of)e(certain)i(op)q(erations.)35 b(F)m(or)19
b(instance,)i(c)o(har-)-30 2320 y(acter)30 b(orien)o(ted)f(devices)h(suc)o(h)
f(as)g(the)g(pap)q(er)g(tap)q(e)-30 2369 y(reader/punc)o(h)18
b(or)f(the)g(line)f(prin)o(ter)h(in)o(terrupt)g(at)f(lev)o(el)-30
2419 y(four.)34 b(Their)19 b(in)o(terrupt)h(handlers)g(call)e(\\getc")h
(\(0930\))-30 2469 y(or)13 b(\\putc")f(\(0967\),)f(whic)o(h)h(raise)h(the)f
(pro)q(cessor)i(priorit)o(y)-30 2519 y(temp)q(orarily)e(to)h(lev)o(el)g
(\014v)o(e,)g(while)g(the)h(c)o(haracter)h(bu\013er)-30 2569
y(queues)h(are)e(manipulated.)33 2622 y(The)k(in)o(terrupt)h(handler)f(for)g
(the)g(console)h(telet)o(yp)q(e)-30 2672 y(mak)o(es)d(use)h(of)f(a)g
(\\timeout")f(facilit)o(y)m(.)23 b(This)17 b(in)o(v)o(olv)o(es)e(a)-30
2722 y(queue)20 b(whic)o(h)e(is)g(also)g(manipulated)f(b)o(y)h(the)h(clo)q(c)
o(k)f(in-)-30 2772 y(terrupt)i(handler,)g(whic)o(h)e(runs)h(at)g(lev)o(el)f
(six.)31 b(T)m(o)18 b(pre-)-30 2822 y(v)o(en)o(t)13 b(p)q(ossible)f(in)o
(terference,)j(the)d(\\timeout")f(pro)q(cedure)1010 17 y(\(3835\))23
b(runs)i(at)e(lev)o(el)h(sev)o(en)h(\(the)g(highest)f(p)q(ossible)1010
66 y(lev)o(el\).)1072 120 y(Usually)13 b(it)h(do)q(es)h(not)f(mak)o(e)f
(sense)j(to)e(run)g(an)g(in)o(ter-)1010 170 y(rupt)g(handler)g(at)f(a)h(pro)q
(cessor)h(priorit)o(y)e(lo)o(w)o(er)h(than)f(the)1010 220 y(in)o(terrupt)20
b(priorit)o(y)m(,)f(for)g(this)g(w)o(ould)g(then)h(risk)f(a)g(sec-)1010
269 y(ond)11 b(in)o(terrupt)i(of)e(the)i(same)e(t)o(yp)q(e,)h(ev)o(en)g(from)
f(the)h(same)1010 319 y(device,)18 b(b)q(efore)g(completion)d(of)i(the)h(pro)
q(cessing)g(of)e(the)1010 369 y(\014rst)j(in)o(terrupt.)31
b(This)18 b(lik)o(ely)f(to)h(b)q(e)h(at)f(b)q(est)h(incon)o(v)o(e-)1010
419 y(nien)o(t)e(and)h(at)f(w)o(orst)h(disastrous.)29 b(Ho)o(w)o(ev)o(er)18
b(the)g(clo)q(c)o(k)1010 469 y(in)o(terrupt)d(handler,)g(whic)o(h)f(once)h(p)
q(er)h(second)g(has)e(a)h(lot)1010 518 y(of)e(extra)h(w)o(ork)g(to)g(do,)f
(do)q(es)i(exactly)f(this.)1010 654 y Fg(9.6)55 b(Rules)18
b(for)h(In)n(terrupt)f(Handlers)1010 737 y Fn(As)f(discussed)g(ab)q(o)o(v)o
(e,)f(in)o(terrupt)h(handlers)g(need)g(to)f(b)q(e)1010 787
y(careful)11 b(ab)q(out)f(the)h(manipulation)d(of)i(the)h(pro)q(cessor)h
(pri-)1010 837 y(orit)o(y)j(to)h(a)o(v)o(oid)f(allo)o(wing)e(other)k(in)o
(terrupts)g(to)e(happ)q(en)1010 887 y(\\to)q(o)h(so)q(on".)27
b(Lik)o(ewise)17 b(care)h(needs)h(to)d(b)q(e)i(tak)o(en)f(that)1010
937 y(the)11 b(other)g(in)o(terrupts)h(are)f(not)g(dela)o(y)o(ed)f(excessiv)o
(ely)m(,)i(lest)1010 987 y(the)j(p)q(erformance)g(of)f(the)h(whole)g(system)f
(b)q(e)i(degraded.)1010 1036 y(It)f(is)f(imp)q(ortan)o(t)g(to)g(note)h(that)g
(when)h(an)e(in)o(terrupt)i(o)q(c-)1010 1086 y(curs,)d(the)h(pro)q(cess)h
(whic)o(h)d(is)h(curren)o(tly)h(activ)o(e)e(will)g(v)o(ery)1010
1136 y(lik)o(ely)h(not)i(b)q(e)g(the)h(pro)q(cess)g(whic)o(h)f(is)g(in)o
(terested)h(in)e(the)1010 1186 y(o)q(ccurrence.)21 b(Consider)14
b(the)g(follo)o(wing)e(scenario:)1072 1239 y(User)18 b(pro)q(cess)h(#m)14
b(is)j(activ)o(e)g(and)f(initiates)h(an)f(i/o)1010 1289 y(op)q(eration.)h(It)
12 b(executes)i(a)e(trap)g(instruction)g(and)g(trans-)1010
1339 y(fers)18 b(to)g(k)o(ernel)g(mo)q(de.)29 b(Kernel)19 b(pro)q(cess)h(#m)c
(initiates)1010 1389 y(the)11 b(required)g(op)q(eration)f(and)g(then)g(calls)
g(\\sleep")g(to)g(sus-)1010 1439 y(p)q(end)k(itself)g(to)g(a)o(w)o(ait)e
(completion)h(of)g(the)h(op)q(eration)g(...)1072 1492 y(Some)e(time)g(later,)
g(when)i(some)e(other)h(pro)q(cess,)i(user)1010 1542 y(pro)q(cess)c(#n)f(sa)o
(y)m(,)f(is)h(activ)o(e,)g(the)g(op)q(eration)g(is)g(completed)1010
1592 y(and)h(an)h(in)o(terrupt)g(o)q(ccurs.)19 b(Pro)q(cess)14
b(#n)d(rev)o(erts)i(to)f(k)o(er-)1010 1641 y(nel)20 b(mo)q(de,)h(and)g(k)o
(ernel)g(pro)q(cess)h(#n)e(deals)h(with)f(the)1010 1691 y(in)o(terrupt,)e(ev)
o(en)h(though)e(it)g(ma)o(y)e(ha)o(v)o(e)j(no)f(in)o(terest)i(in)1010
1741 y(or)14 b(prior)f(kno)o(wledge)h(of)f(the)i(op)q(eration.)1072
1795 y(Usually)i(k)o(ernel)h(pro)q(cess)h(#n)f(will)e(include)h(w)o(aking)
1010 1844 y(pro)q(cess)j(#m)d(as)h(part)h(of)f(its)g(activit)o(y)m(.)31
b(This)18 b(will)f(not)1010 1894 y(alw)o(a)o(ys)c(b)q(e)h(the)h(case)g
(though,)e(e.g.)k(where)e(an)f(error)h(has)1010 1944 y(o)q(ccurred)h(and)d
(the)i(op)q(eration)f(is)f(retried.)1072 1997 y(Clearly)m(,)18
b(the)h(in)o(terrupt)g(handler)f(for)g(a)g(p)q(eripheral)1010
2047 y(device)i(should)e(not)h(made)f(references)k(to)d(the)h(curren)o(t)1010
2097 y(\\u")13 b(structure)j(for)d(this)h(is)g(not)g(lik)o(ely)e(to)i(b)q(e)g
(the)g(appro-)1010 2147 y(priate)i(\\u")g(structure.)28 b(\(The)17
b(appropriate)g(\\u")f(struc-)1010 2197 y(ture)i(could)f(quite)h(p)q(ossibly)
f(b)q(e)h(inaccessible,)g(if)f(it)g(has)1010 2247 y(b)q(een)e(temp)q(orarily)
d(sw)o(app)q(ed)j(out)e(to)h(the)h(disk.\))1072 2300 y(Lik)o(ewise)j(the)h
(in)o(terrupt)g(handler)g(should)f(not)g(call)1010 2350 y(\\sleep")23
b(b)q(ecause)h(the)f(pro)q(cess)i(th)o(us)e(susp)q(ended)i(will)1010
2400 y(most)13 b(lik)o(ely)f(b)q(e)j(some)e(inno)q(cen)o(t)h(pro)q(cess.)1010
2535 y Fg(9.7)55 b(T)-5 b(raps)1010 2619 y Fn(\\T)m(raps")9
b(are)i(lik)o(e)e(\\in)o(terrupts")i(in)f(that)g(they)g(are)h(ev)o(en)o(ts)
1010 2668 y(whic)o(h)18 b(are)i(handled)e(b)o(y)h(the)g(same)f(hardw)o(are)h
(mec)o(ha-)1010 2718 y(nism,)12 b(and)h(hence)j(b)o(y)d(similar)f(soft)o(w)o
(are)i(mec)o(hanisms.)1072 2772 y(\\T)m(raps")e(are)g(unlik)o(e)g(\\in)o
(terrupts")h(in)f(that)g(they)h(o)q(c-)1010 2822 y(cur)21 b(as)g(the)g
(result)h(of)e(ev)o(en)o(ts)i(in)o(ternal)e(to)h(the)g(CPU,)1890
2946 y(43)p eop
%%Page: 44 52
51 bop -30 -144 a Fk(9)43 b(HARD)o(W)m(ARE)16 b(INTERR)o(UPTS)f(AND)g(TRAPS)
515 b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fn(rather)j(than)f
(externally)m(.)26 b(\(In)17 b(other)h(systems)f(the)g(ter-)-30
66 y(minology)c(\\in)o(ternal)j(in)o(terrupt")g(and)g(\\external)h(in)o(ter-)
-30 116 y(rupt")h(is)f(used)h(to)g(dra)o(w)f(this)g(distinction)g(more)f
(force-)-30 166 y(fully)m(.\))i(T)m(raps)c(ma)o(y)e(o)q(ccur)j(unexp)q
(ectedly)h(as)e(the)h(result)-30 216 y(of)j(hardw)o(are)g(or)g(p)q(o)o(w)o
(er)g(failures,)g(or)g(predictably)g(and)-30 266 y(repro)q(ducibly)m(,)13
b(e.g.)18 b(as)13 b(the)h(result)g(of)e(executing)i(an)f(ille-)-30
316 y(gal)g(instruction)i(or)e(a)h(\\trap")g(instruction.)33
365 y(\\T)m(raps")g(are)h(alw)o(a)o(ys)e(recognised)j(b)o(y)f(the)g(CPU)g
(im-)-30 415 y(mediately)m(.)j(They)c(cannot)h(b)q(e)g(dela)o(y)o(ed)f(in)g
(the)h(w)o(a)o(y)f(lo)o(w)-30 465 y(priorit)o(y)d(in)o(terrupts)h(ma)o(y)c(b)
q(e.)18 b(If)10 b(y)o(ou)h(lik)o(e,)f(\\traps")h(ha)o(v)o(e)-30
515 y(an)j(\\in)o(terrupt)h(priorit)o(y")d(of)i(eigh)o(t.)33
565 y(\\T)m(rap")27 b(instructions)h(ma)o(y)e(b)q(e)i(delib)q(erately)g(in-)
-30 614 y(serted)12 b(in)e(user)i(mo)q(de)d(programs)g(to)h(catc)o(h)h(the)g
(atten)o(tion)-30 664 y(of)k(the)h(op)q(erating)f(system)g(with)g(a)g
(request)i(to)f(p)q(erform)-30 714 y(a)d(sp)q(eci\014ed)i(service.)20
b(This)13 b(mec)o(hanism)e(is)i(used)h(as)g(part)-30 764 y(of)g(the)g
(facilit)o(y)e(kno)o(wn)i(as)g(\\system)f(calls".)33 814 y(Lik)o(e)h(in)o
(terrupts,)i(traps)g(result)g(in)e(the)i(reloading)e(of)-30
863 y(the)f(PC)f(and)g(PS)g(from)e(a)i(v)o(ector)h(lo)q(cation,)e(and)g(the)i
(sa)o(v-)-30 913 y(ing)i(of)f(the)h(old)g(v)n(alues)f(of)h(the)g(PC)g(and)g
(PS)g(in)g(the)g(cur-)-30 963 y(ren)o(t)j(stac)o(k.)26 b(T)m(able)15
b(9.2)h(lists)g(the)h(v)o(ector)g(lo)q(cations)f(for)-30 1013
y(the)f(v)n(arious)e(\\trap")h(t)o(yp)q(es.)-5 1136 y Fi(v)o(ector)85
b(trap)15 b(t)o(yp)q(e)317 b(pro)q(cess)-5 1186 y(lo)q(cation)559
b(priorit)n(y)p -30 1202 934 2 v -5 1237 a Fn(004)152 b(bus)15
b(timeout)361 b(7)-5 1287 y(010)152 b(illegal)12 b(instruction)264
b(7)-5 1337 y(014)152 b(bpt-trace)415 b(7)-5 1387 y(020)152
b(iot)531 b(7)-5 1437 y(024)152 b(p)q(o)o(w)o(er)14 b(failure)344
b(7)-5 1486 y(030)152 b(em)o(ulator)13 b(trap)h(instruction)119
b(7)-5 1536 y(034)152 b(trap)14 b(instruction)294 b(7)-5 1586
y(114)152 b(11/10)13 b(parit)o(y)353 b(7)-5 1636 y(240)152
b(programmed)12 b(in)o(terrupt)175 b(7)-5 1686 y(244)152 b(\015oating)13
b(p)q(oin)o(t)h(error)234 b(7)-5 1736 y(250)152 b(segmen)o(tation)13
b(violation)167 b(7)48 1848 y Fi(T)l(able)15 b(9.2)h(T)l(rap)f(V)l(ector)h
(Lo)q(cations)e(and)334 1898 y(Prioriti)o(es)33 1982 y Fn(The)19
b(con)o(ten)o(ts)i(of)d(T)m(ables)h(9.1)g(and)g(9.2)f(should)h(b)q(e)-30
2032 y(compared)h(with)g(the)h(\014le)g(\\lo)o(w.s")e(on)h(Sheet)h(05.)37
b(As)-30 2082 y(noted)15 b(earlier,)e(this)h(\014le)g(is)f(generated)i(at)f
(eac)o(h)g(installa-)-30 2132 y(tion)e(\(along)f(with)h(the)h(\014le)f
(\\conf.c")g(\(sheet)i(46\)\),)e(as)g(the)-30 2182 y(pro)q(duct)17
b(of)f(the)g(utilit)o(y)f(program)f(\\mk)o(conf)s(",)g(so)i(as)g(to)-30
2232 y(re\015ect)g(the)f(actual)e(set)i(of)e(p)q(eripherals)i(installed.)-30
2346 y Fg(9.8)56 b(Assem)n(bly)17 b(Language)i(`trap')-30 2423
y Fn(F)m(rom)c(\\lo)o(w.s")g(it)g(app)q(ears)i(that)g(traps)f(and)h(in)o
(terrupts)-30 2473 y(are)i(handled)g(separately)g(b)o(y)f(the)h(soft)o(w)o
(are.)31 b(Ho)o(w)o(ev)o(er)-30 2523 y(closer)20 b(examination)15
b(rev)o(eals)k(that)g(\\call")e(and)h(\\trap")-30 2573 y(are)d(di\013eren)o
(t)g(en)o(try)f(p)q(oin)o(ts)g(to)g(a)f(single)h(co)q(de)h(sequence)-30
2622 y(in)g(the)h(\014le)g(\\m40.s")c(\(see)17 b(lines)e(0755,)f(0776\).)22
b(This)15 b(se-)-30 2672 y(quence)h(is)d(examined)g(in)h(detail)f(in)g(the)i
(next)f(c)o(hapter.)33 2722 y(During)g(the)i(execution)g(of)f(this)g
(sequence,)i(a)e(call)g(is)-30 2772 y(made)10 b(on)g(a)g(\\C")g(language)g
(pro)q(cedure)i(to)e(carry)h(out)g(fur-)-30 2822 y(ther)i(sp)q(eci\014c)g
(pro)q(cessing.)18 b(In)12 b(the)g(case)g(of)f(an)g(in)o(terrupt,)1010
17 y(the)k(\\C")e(pro)q(cedure)j(is)e(the)h(in)o(terrupt)f(handler)h(sp)q
(eci\014c)1010 66 y(to)f(the)g(particular)g(device)g(con)o(troller.)1072
116 y(In)h(the)h(case)h(of)e(a)g(trap,)g(the)h(\\C")f(pro)q(cedure)i(is)e
(an-)1010 166 y(other)d(pro)q(cedure)h(called)e(\\trap")g(\(y)o(es,)h(the)f
(w)o(ord)g(\\trap")1010 216 y(is)19 b(de\014nitely)h(o)o(v)o(erw)o(ork)o
(ed!\),)h(whic)o(h)e(in)g(the)i(case)f(pro-)1010 266 y(cess)d(of)e(a)g
(system)g(error)i(will)d(most)g(lik)o(ely)g(call)h(priorit)o(y)1010
316 y(\\panic")f(and)g(in)g(the)h(case)g(of)f(a)g(\\system)g(call",)f(will)g
(in-)1010 365 y(v)o(ok)o(e)h(\(indirectly)g(via)f(\\trapl"\(2841\)\))f(the)j
(appropriate)1010 415 y(system)f(call)f(pro)q(cedure.)1010
531 y Fg(9.9)55 b(Return)1010 608 y Fn(Up)q(on)12 b(completion)f(of)h(the)h
(handling)e(of)h(an)g(in)o(terrupt)h(or)1010 658 y(trap)h(the)h(co)q(de)g
(follo)o(ws)e(a)h(common)e(path)i(ending)g(in)g(an)1010 708
y(\\rtt")f(instruction)h(\(0805\).)k(This)13 b(reloads)h(b)q(oth)g(the)g(PC)
1010 757 y(and)c(PS)h(from)e(the)j(curren)o(t)g(stac)o(k,)f(i.e.)17
b(the)11 b(k)o(ernel)g(stac)o(k,)1010 807 y(in)k(order)g(to)g(restore)i(the)f
(pro)q(cessor)h(en)o(vironmen)o(t)d(that)1010 857 y(existed)h(b)q(efore)f
(the)h(in)o(terrupt)f(or)g(trap.)-30 2946 y(44)p eop
%%Page: 45 53
52 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)551
b(10)43 b(THE)14 b(ASSEMBLER)j(\\TRAP")e(R)o(OUTINE)-30 17
y Fj(10)70 b(The)15 b(Assem)n(bl)o(er)d(\\T)-6 b(rap")17 b(Rou-)108
91 y(tine)-30 182 y Fn(The)h(principal)f(purp)q(ose)h(of)f(this)g(c)o(hapter)
i(is)e(to)g(exam-)-30 232 y(ine)12 b(the)h(assem)o(bly)e(language)g(co)q(de)h
(in)g(\\m40.s")d(whic)o(h)j(is)-30 282 y(in)o(v)o(olv)o(ed)h(in)g(the)i
(handling)e(of)g(in)o(terrupts)i(and)f(traps.)33 332 y(This)d(co)q(de)i(is)f
(found)f(b)q(et)o(w)o(een)i(lines)f(0750)f(and)g(0805,)-30
382 y(and)j(has)g(t)o(w)o(o)f(en)o(try)h(p)q(oin)o(ts,)f(\\trap")h(\(0755\))e
(and)i(\\call")-30 431 y(\(0766\).)41 b(There)23 b(are)f(sev)o(eral)g
(di\013eren)o(t)h(and)f(relev)n(an)o(t)-30 481 y(paths)e(through)f(this)g(co)
q(de)h(and)f(w)o(e)g(shall)f(trace)j(some)-30 531 y(examples)13
b(of)h(these.)-30 647 y Fg(10.1)56 b(Sources)14 b(of)h(T)-5
b(raps)15 b(and)g(In)n(terrupts)-30 724 y Fn(The)25 b(discussion)f(in)g
(Section)g(One)h(in)o(tro)q(duced)f(three)-30 773 y(places)17
b(where)g(the)f(o)q(ccurrence)j(of)c(a)g(trap)h(or)g(in)o(terrupt)-30
823 y(w)o(as)e(exp)q(ected:)-30 913 y Fi(\(a\))21 b Fn(\\main")12
b(\(1564\))i(calls)g(\\fuib)o(yte")h(rep)q(eatedly)h(un)o(til)74
963 y(a)f(negativ)o(e)h(v)n(alue)f(is)g(returned.)24 b(This)16
b(will)e(o)q(ccur)74 1013 y(after)g(a)f(\\bus)h(timeout)e(error")j(has)e(b)q
(een)i(encoun-)74 1063 y(tered)j(with)e(a)g(subsequen)o(t)i(trap)f(to)f(v)o
(ector)h(lo)q(ca-)74 1113 y(tion)d(4)f(\(line)h(0512\);)-30
1195 y Fi(\(b\))20 b Fn(The)12 b(clo)q(c)o(k)g(has)h(b)q(een)g(set)g(running)
e(and)h(will)f(gener-)74 1245 y(ate)17 b(an)f(in)o(terrupt)h(ev)o(ery)f(clo)q
(c)o(k)h(tic)o(k)f(i.e.)24 b(16.7)15 b(or)74 1295 y(20)f(milli)o(seconds;)-30
1377 y Fi(\(c\))21 b Fn(Pro)q(cess)h(#1)d(is)h(ab)q(out)f(to)h(execute)i(a)e
(\\trap")f(in-)74 1427 y(struction)12 b(as)g(part)g(of)e(the)i(system)g(call)
e(on)h(\\exec".)-30 1543 y Fg(10.2)56 b(fuib)n(yte)18 b(\(0814\),)g(fuiw)n
(ord)i(\(0844\))-30 1620 y Fn(\\main")15 b(uses)j(b)q(oth)g(\\fuib)o(yte")e
(and)h(\\fuiw)o(ord".)26 b(Since)-30 1670 y(the)19 b(former)d(is)h(more)g
(complicated)f(in)h(a)h(non-essen)o(tial)-30 1719 y(w)o(a)o(y)m(,)d(w)o(e)h
(lea)o(v)o(e)f(it)g(to)g(the)i(reader,)f(and)g(concen)o(trate)h(on)-30
1769 y(the)e(latter.)33 1819 y(\\fuiw)o(ord")i(is)i(called)f(\(1602\))g(when)
h(the)g(system)g(is)-30 1869 y(running)e(in)g(k)o(ernel)h(mo)q(de)e(with)g
(one)i(argumen)o(t)e(whic)o(h)-30 1919 y(is)c(an)f(address)i(in)e(user)i
(address)g(space.)18 b(The)12 b(function)f(of)-30 1969 y(the)k(routine)g(is)f
(to)g(fetc)o(h)h(the)g(v)n(alue)f(of)f(the)i(corresp)q(ond-)-30
2018 y(ing)j(w)o(ord)g(and)g(to)g(return)h(it)f(as)g(a)g(result)g(\(left)g
(in)g(r0\).)-30 2068 y(Ho)o(w)o(ev)o(er)h(if)f(an)g(error)i(o)q(ccurs,)g(the)
g(v)n(alue)d({1)h(is)h(to)f(b)q(e)-30 2118 y(returned.)33 2168
y(Note)f(that)f(with)g(\\fuiw)o(ord",)g(there)i(is)e(an)g(am)o(bigu-)-30
2218 y(it)o(y)k(whic)o(h)f(do)q(es)i(not)f(o)q(ccur)h(with)e(\\fuib)o(yte",)h
(namely)-30 2267 y(a)e(returned)i(v)n(alue)d(of)h({1)f(ma)o(y)f(not)i
(necessarily)h(b)q(e)g(an)-30 2317 y(error)j(indication)d(but)i(the)g(actual)
f(v)n(alue)g(in)g(the)h(user)-30 2367 y(space.)e(Con)o(vince)12
b(y)o(ourself)h(that)f(for)g(the)h(w)o(a)o(y)f(it)g(is)g(used)-30
2417 y(in)i(\\main",)d(this)j(do)q(es)g(not)g(matter.)33 2467
y(Also)19 b(the)h(co)q(de)g(do)q(es)h(not)e(distinguish)g(b)q(et)o(w)o(een)i
(a)-30 2516 y(\\bus)15 b(timeout)d(error")j(and)e(a)h(\\segmen)o(tation)e
(error".)33 2566 y(The)i(routine)g(pro)q(ceeds)i(as)e(follo)o(ws:)-30
2656 y Fi(0846:)21 b Fn(The)14 b(argumen)o(t)f(is)h(mo)o(v)o(ed)e(to)i(r1;)
-30 2739 y Fi(0848:)21 b Fn(\\gw)o(ord")13 b(is)h(called;)-30
2822 y Fi(0852:)21 b Fn(The)14 b(curren)o(t)i(PS)e(is)g(stored)g(on)g(the)h
(stac)o(k;)1010 17 y Fi(0853:)20 b Fn(The)e(priorit)o(y)d(lev)o(el)i(is)f
(raised)i(to)e(7)h(\(to)f(disable)1114 66 y(in)o(terrupts\);)1010
160 y Fi(0854:)k Fn(The)c(con)o(ten)o(ts)g(of)f(the)h(lo)q(cation)f(nofault)f
(\(1466\))1114 210 y(are)g(sa)o(v)o(ed)g(in)f(the)i(stac)o(k;)1010
303 y Fi(0855:)20 b Fn(\\nofault")13 b(is)g(loaded)h(with)f(address)i(of)f
(the)g(rou-)1114 353 y(tine)g(\\err";)1010 447 y Fi(0856:)20
b Fn(An)f(\\mfpi")c(instruction)k(is)f(used)h(to)f(fetc)o(h)g(the)1114
496 y(w)o(ord)13 b(from)f(user)j(space.)1072 598 y Fi(If)h(nothing)e(go)q(es)
i(wrong)e Fn(this)g(v)n(alue)g(will)f(left)h(on)1010 648 y(the)g(k)o(ernel)h
(stac)o(k.)1010 750 y Fi(0857:)20 b Fn(The)f(v)n(alue)f(is)h(transferred)h
(from)d(the)i(stac)o(k)g(to)1114 800 y(r0;)1010 893 y Fi(0876:)h
Fn(The)13 b(previous)f(v)n(alues)f(of)h(\\nofault")e(and)i(PS)g(are)1114
943 y(restored;)1072 1045 y Fi(No)o(w)24 b(supp)q(ose)e(something)f(do)q(es)i
(go)h(wrong)1010 1095 y Fn(with)c(the)i(\\mfpi")c(instruction,)k(and)f(a)f
(bus)i(time-out)1010 1145 y(do)q(es)14 b(o)q(ccur.)1010 1246
y Fi(0856:)20 b Fn(The)14 b(\\mfpi")c(instruction)k(will)e(b)q(e)h(ab)q
(orted.)19 b(PC)1114 1296 y(will)13 b(p)q(oin)o(t)i(to)g(the)h(next)f
(instruction)h(\(0857\))e(and)1114 1346 y(a)f(trap)h(via)f(v)o(ector)i(lo)q
(cation)e(4)h(will)e(o)q(ccur;)1010 1440 y Fi(0512:)20 b Fn(The)d(new)g(PC)f
(will)f(ha)o(v)o(e)h(the)h(v)n(alue)f(of)g(\\trap".)1114 1489
y(The)e(new)g(PS)g(will)f(indicate:)1114 1561 y(presen)o(t)i(mo)q(de)e(=)h(k)
o(ernel)g(mo)q(de)1114 1633 y(previous)g(mo)q(de)f(=)h(k)o(ernel)g(mo)q(de)
1114 1704 y(priorit)o(y)f(=)h(7;)1010 1798 y Fi(0756:)20 b
Fn(The)12 b(next)g(instruction)g(executed)i(is)d(the)h(\014rst)h(in-)1114
1848 y(struction)20 b(of)f(\\trap".)36 b(This)19 b(sa)o(v)o(es)h(the)h(pro)q
(ces-)1114 1898 y(sor)11 b(status)h(w)o(ord)f(t)o(w)o(o)g(w)o(ords)g(b)q(ey)o
(ond)h(the)g(curren)o(t)1114 1947 y(\\top)h(of)g(stac)o(k".)19
b(\(This)14 b(is)f(not)h(relev)n(an)o(t)g(here.\);)1010 2041
y Fi(0757:)20 b Fn(\\nofault")14 b(con)o(tains)g(the)i(address)g(of)e(\\err")
h(and)1114 2091 y(is)e(non-zero;)1010 2184 y Fi(0765:)20 b
Fn(Mo)o(ving)f(1)g(to)g(SR0)g(reinitialises)g(the)i(memory)1114
2234 y(managemen)o(t)11 b(unit;)1010 2328 y Fi(0766:)20 b Fn(The)26
b(con)o(ten)o(ts)g(of)f(\\nofault")f(are)i(mo)o(v)o(ed)d(on)1114
2377 y(top)c(of)f(the)i(stac)o(k,)g Fi(o)o(v)o(erwriting)c
Fn(the)k(previous)1114 2427 y(con)o(ten)o(ts,)27 b(whic)o(h)c(w)o(as)h(the)g
(return)h(address)h(in)1114 2477 y(\\gw)o(ord";)1010 2571 y
Fi(0767:)20 b Fn(The)11 b(\\rtt")g(returns,)h(not)e(to)h(\\gw)o(ord")e(but)i
(to)f(the)1114 2620 y(\014rst)k(w)o(ord)g(of)f(\\err";)1010
2714 y Fi(0880:)20 b Fn(\\err")g(restores)h(\\nofault")c(and)i(PS,)g(skips)g
(the)1114 2764 y(return)e(to)f(\\fuiw)o(ord",)f(places)h({1)g(in)f(r0,)i(and)
f(re-)1114 2814 y(turns)e(directly)h(to)e(the)i(calling)d(routine.)1890
2946 y(45)p eop
%%Page: 46 54
53 bop -30 -144 a Fk(10)43 b(THE)15 b(ASSEMBLER)h(\\TRAP")g(R)o(OUTINE)551
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fg(10.3)56
b(In)n(terrupts)-30 93 y Fn(Supp)q(ose)15 b(the)g(clo)q(c)o(k)f(has)g(in)o
(terrupted)h(the)f(pro)q(cessor.)33 143 y(Both)i(clo)q(c)o(k)g(v)o(ector)g
(lo)q(cations,)f(100)g(and)h(104,)f(ha)o(v)o(e)-30 193 y(the)i(same)e
(information.)21 b(PC)16 b(is)g(set)h(to)f(the)g(address)h(of)-30
243 y(the)c(lo)q(cation)d(lab)q(elled)h(\\kwlp")f(\(0568\))h(and)g(PS)h(is)f
(set)i(to)-30 293 y(sho)o(w:)33 343 y(presen)o(t)i(mo)q(de)e(=)h(k)o(ernel)h
(mo)q(de)33 392 y(previous)f(mo)q(de)f(=)h(k)o(ernel)g(or)g(user)h(mo)q(de)33
442 y(priorit)o(y)e(=)h(6)-30 492 y(Note.)19 b(The)13 b(PS)h(will)e(con)o
(tain)h(the)g(true)i(previous)e(mo)q(de,)-30 542 y(regardless)20
b(of)e(the)g(v)n(alue)g(pic)o(k)o(ed)g(up)h(from)d(the)j(v)o(ector)-30
592 y(lo)q(cation.)-30 683 y Fi(0570:)i Fn(The)11 b(v)o(ector)g(lo)q(cation)e
(con)o(tains)i(a)f(new)h(PC)f(v)n(alue)74 733 y(whic)o(h)i(is)g(the)g
(address)i(of)d(the)h(statemen)o(t)g(lab)q(elled)74 783 y(\\kwlp".)21
b(This)15 b(instruction)h(is)f(a)g(subroutine)g(call)74 833
y(on)f(\\call")f(via)g(r0.)74 899 y(After)18 b(the)g(execution)f(of)g(this)g
(instruction,)h(r0)f(is)74 949 y(left)h(with)f(the)h(address)h(of)e(the)h(co)
q(de)g(w)o(ord)f(after)74 999 y(the)j(instruction)g(whic)o(h)f(con)o(tains)g
(\\)p 682 999 13 2 v 15 w(clo)q(c)o(k",)h(i.e.)74 1049 y(r0)j(con)o(tains)f
Fi(the)j(address)f(of)h(the)g(address)74 1099 y Fn(of)d(the)h(\\clo)q(c)o(k")
f(routine)h(in)f(the)h(\014le)f(\\clo)q(c)o(k.c")74 1149 y(\(3725\).)-30
1265 y Fg(10.4)56 b(call)18 b(\(0776\))-30 1342 y Fi(0777:)j
Fn(Cop)o(y)13 b(PS)i(on)o(to)e(the)h(stac)o(k;)-30 1425 y Fi(0779:)21
b Fn(Cop)o(y)13 b(r1)h(on)o(to)g(the)g(stac)o(k;)-30 1508 y
Fi(0780:)21 b Fn(Cop)o(y)14 b(the)h(stac)o(k)g(p)q(oin)o(ter)g(for)f(the)h
(previous)g(ad-)74 1558 y(dress)h(space)g(on)o(to)f(the)g(stac)o(k.)21
b(\(This)15 b(is)f(only)g(sig-)74 1608 y(ni\014can)o(t)e(if)g(the)h(previous)
f(mo)q(de)g(w)o(as)g(user)h(mo)q(de\).)74 1675 y(This)g(represen)o(ts)j(a)e
Fi(sp)q(ecial)f(case)h Fn(of)e(the)i(\\mfpi")74 1724 y(instruction.)j(See)11
b(the)g(\\PDP11)e(Pro)q(cessor)j(Hand-)74 1774 y(b)q(o)q(ok",)h(page)h(6-20;)
-30 1858 y Fi(781:)21 b Fn(Cop)o(y)11 b(the)i(cop)o(y)e(of)h(PS)g(on)o(to)f
(the)h(stac)o(k)h(and)e(mask)74 1907 y(out)k(all)g(but)g(the)h(lo)o(w)o(er)f
(\014v)o(e)g(bits.)23 b(The)16 b(resulting)74 1957 y(v)n(alue)11
b(designates)h(the)f(cause)i(of)d(the)i(in)o(terrupt)g(\(or)74
2007 y(trap\).)18 b(The)c(original)d(v)n(alue)i(of)g(the)g(PS)h(had)f(to)g(b)
q(e)74 2057 y(captured)i(quic)o(kly;)-30 2140 y Fi(0783:)21
b Fn(T)m(est)14 b(if)f(the)i(previous)f(mo)q(de)f(is)h(k)o(ernel)g(or)g
(user.)74 2207 y Fi(If)g(the)g(previous)e(mo)q(de)h(is)h(k)o(ernel)e(mo)q(de)
g Fn(the)74 2256 y(branc)o(h)f(is)f(tak)o(en)g(\(0784\).)16
b(PS)11 b(is)f(c)o(hanged)h(to)f(sho)o(w)74 2306 y(the)15 b(previous)f(mo)q
(de)f(as)h(user)h(mo)q(de)e(\(0798\);)-30 2390 y Fi(0799:)21
b Fn(The)g(sp)q(ecialised)g(in)o(terrupt)f(handling)f(routine)74
2439 y(p)q(oin)o(ted)f(to)f(b)o(y)g(r0)h(is)f(en)o(tered.)30
b(\(In)18 b(this)g(case)g(it)74 2489 y(is)g(the)g(routine)g(\\clo)q(c)o(k",)g
(whic)o(h)f(is)h(discussed)h(in)74 2539 y(detail)14 b(in)f(the)h(next)h(c)o
(hapter.\))-30 2622 y Fi(0800:)21 b Fn(When)11 b(the)h(\\clo)q(c)o(k")f
(routine)h(\(or)f(some)f(other)i(in-)74 2672 y(terrupt)g(handler\))f
(returns,)h(the)f(top)g(t)o(w)o(o)f(w)o(ords)g(of)74 2722 y(the)17
b(stac)o(k)f(are)g(deleted.)24 b(These)17 b(are)f(the)h(mask)o(ed)74
2772 y(cop)o(y)23 b(of)e(the)i(PS)g(and)f(the)h(cop)o(y)g(of)e(the)i(stac)o
(k)74 2822 y(p)q(oin)o(ter;)1010 17 y Fi(0802:)d Fn(r1)14 b(is)g(restored)i
(from)c(the)i(stac)o(k;)1010 100 y Fi(0803:)20 b Fn(Delete)15
b(the)f(cop)o(y)g(of)g(PS)g(from)e(the)i(stac)o(k;)1010 184
y Fi(0804:)20 b Fn(Restore)15 b(the)g(v)n(alue)e(of)g(r0)h(from)e(the)j(stac)
o(k;)1010 267 y Fi(0805:)20 b Fn(Finally)15 b(the)h(\\rtt")h(instruction)f
(returns)i(to)d(the)1114 317 y(\\k)o(ernel")e(mo)q(de)g(routine)h(that)g(w)o
(as)g(in)o(terrupted;)1114 384 y Fi(If)e(the)g(previous)e(mo)q(de)i(w)o(as)h
(user)e(mo)q(de)g Fn(it)f(is)1114 433 y(not)16 b(certain)i(that)f(the)g(in)o
(terrupted)h(routine)g(will)1114 483 y(b)q(e)c(resumed)g(immediately;)1010
567 y Fi(0788:)20 b Fn(After)i(the)g(sp)q(ecialised)g(in)o(terrupt)g(routine)
f(\(in)1114 617 y(this)c(case)i(\\clo)q(c)o(k"\))e(returns,)j(a)d(c)o(hec)o
(k)h(\(\\runrun)1114 666 y Fh(>)d Fn(0"\))f(is)g(made)g(to)g(see)i(if)e(an)o
(y)g(pro)q(cess)j(of)d(higher)1114 716 y(priorit)o(y)h(than)h(the)h(curren)o
(t)h(pro)q(cess)g(is)f(ready)f(to)1114 766 y(run.)34 b(If)19
b(the)h(decision)f(is)g(to)g(allo)o(w)f(the)i(curren)o(t)1114
816 y(pro)q(cess)15 b(to)d(con)o(tin)o(ue,)h(then)h(it)f(is)g(imp)q(ortan)o
(t)e(that)1114 866 y(it)f(b)q(e)h(not)g(in)o(terrupted)g(as)g(it)f(restores)j
(its)e(registers)1114 915 y(prior)k(to)h(the)g(\\return)h(from)d(in)o
(terrupt")i(instruc-)1114 965 y(tion.)g(Hence)d(b)q(efore)g(the)f(test,)h
(the)f(pro)q(cessor)h(pri-)1114 1015 y(orit)o(y)c(is)i(raised)g(to)f(sev)o
(en)h(\(line)f(0787\),)g(th)o(us)h(ensur-)1114 1065 y(ing)16
b(that)g(no)h(more)f(in)o(terrupts)h(o)q(ccur)h(un)o(til)e(user)1114
1115 y(mo)q(de)9 b(is)i(resumed.)17 b(\(Another)12 b(in)o(terrupt)g(ma)o(y)d
(o)q(c-)1114 1164 y(cur)14 b(immediately)d(thereafter,)k(ho)o(w)o(ev)o(er.\))
1072 1256 y(If)h(\\runrun)g Fh(>)g Fn(0",)g(then)g(another,)h(higher)f
(priorit)o(y)m(,)1010 1306 y(pro)q(cess)j(is)d(w)o(aiting.)26
b(The)18 b(pro)q(cessor)g(priorit)o(y)f(is)f(reset)1010 1356
y(to)h(0,)h(allo)o(wing)d(an)o(y)j(p)q(ending)f(in)o(terrupt)i(to)e(b)q(e)h
(tak)o(en.)1010 1406 y(A)i(call)g(is)g(then)h(made)e(to)h(\\swtc)o(h")h
(\(2178\),)g(to)f(allo)o(w)1010 1456 y(the)e(higher)f(priorit)o(y)f(pro)q
(cess)j(to)e(pro)q(ceed.)29 b(When)17 b(the)1010 1505 y(pro)q(cess)k(returns)
g(from)c(\\swtc)o(h",)k(the)f(program)d(lo)q(ops)1010 1555
y(bac)o(k)d(to)f(rep)q(eat)j(the)e(test.)1072 1605 y(The)20
b(ab)q(o)o(v)o(e)f(discussion)h(ob)o(viously)e(extends)i(to)f(all)1010
1655 y(in)o(terrupts.)g(The)14 b(only)f(part)h(whic)o(h)f(relates)i(sp)q
(eci\014cally)1010 1705 y(to)f(the)i(clo)q(c)o(k)f(in)o(terrupt)g(is)g(the)g
(call)f(on)h(the)g(sp)q(ecialised)1010 1755 y(routine)f(\\clo)q(c)o(k".)1010
1871 y Fg(10.5)56 b(User)18 b(Program)g(T)-5 b(raps)1010 1948
y Fn(The)19 b(\\system)f(call")g(mec)o(hanism)e(whic)o(h)j(enables)g(user)
1010 1998 y(mo)q(de)12 b(programs)h(to)g(call)g(on)g(the)i(op)q(erating)e
(system)g(for)1010 2048 y(assistance,)g(in)o(v)o(olv)o(es)f(the)h(execution)g
(b)o(y)f(the)h(user)g(mo)q(de)1010 2098 y(program)18 b(of)h(one)h(of)f(256)g
(v)o(ersions)h(of)f(the)h(\\trap")g(in-)1010 2147 y(struction.)32
b(\(The)19 b(\\v)o(ersion")f(is)g(the)h(v)n(alue)f(of)g(the)h(lo)o(w)1010
2197 y(order)14 b(b)o(yte)h(of)e(the)h(instruction)h(w)o(ord.\))1010
2289 y Fi(0518:)20 b Fn(Execution)e(of)e(the)h(trap)g(instruction)g(in)f(a)h
(user)1114 2339 y(mo)q(de)8 b(program)g(causes)i(a)f(trap)h(to)f(o)q(ccur)h
(to)f(v)o(ector)1114 2389 y(lo)q(cation)i(34)h(whic)o(h)h(causes)h(the)f(PC)g
(to)f(b)q(e)h(loaded)1114 2439 y(with)f(the)h(v)n(alue)e(of)h(the)h(lab)q(el)
f(\\trap")g(\(lines)h(0512,)1114 2488 y(0755\).)k(A)d(new)g(PS)g(is)g(set)h
(whic)o(h)f(indicates)1114 2555 y(presen)o(t)h(mo)q(de)e(=)h(k)o(ernel)g(mo)q
(de)1114 2622 y(previous)g(mo)q(de)f(=)h(user)h(mo)q(de)1114
2688 y(priorit)o(y)e(=)h(7)1010 2772 y Fi(0756:)20 b Fn(The)12
b(next)g(instruction)g(executed)i(is)d(the)h(\014rst)h(in-)1114
2822 y(struction)i(of)f(\\trap".)21 b(This)14 b(sa)o(v)o(es)i(the)f(pro)q
(cessor)-30 2946 y(46)p eop
%%Page: 47 55
54 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)551
b(10)43 b(THE)14 b(ASSEMBLER)j(\\TRAP")e(R)o(OUTINE)74 17 y
Fn(status)20 b(w)o(ord)g(in)e(the)i(stac)o(k)g(t)o(w)o(o)f(w)o(ords)g(b)q(ey)
o(ond)74 66 y(the)c(curren)o(t)g(\\top)f(of)f(stac)o(k".)74
139 y(It)d(is)f(imp)q(ortan)o(t)f(to)i(sa)o(v)o(e)f(the)i(PS)f(as)f(so)q(on)h
(as)g(p)q(ossi-)74 188 y(ble,)h(b)q(efore)h(it)e(can)h(b)q(e)g(c)o(hanged,)h
(since)f(it)g(con)o(tains)74 238 y(information)f(de\014ning)i(the)h(t)o(yp)q
(e)g(of)f(trap)g(that)h(o)q(c-)74 288 y(curred.)23 b(The)16
b(somewhat)e(uncon)o(v)o(en)o(tional)g(desti-)74 338 y(nation)i(of)h(the)g
(\\mo)o(v)o(e")e(is)i(to)g(pro)o(vide)g(compati-)74 388 y(bilit)o(y)12
b(with)g(the)i(handling)e(of)g(in)o(terrupts,)i(so)f(that)74
438 y(the)i(same)e(co)q(de)h(can)h(b)q(e)f(used)h(further)g(on;)-30
532 y Fi(0757:)21 b Fn(\\nofault")15 b(will)h(b)q(e)h(zero)h(so)f(the)h
(branc)o(h)f(is)g(not)74 582 y(tak)o(en;)-30 676 y Fi(0759:)k
Fn(The)h(memory)c(managemen)o(t)h(status)j(registers)74 726
y(are)e(stored)g(just)f(in)f(case)i(they)g(will)d(b)q(e)j(needed,)74
776 y(and)g(the)h(memory)d(managemen)o(t)f(unit)j(is)g(reini-)74
826 y(tialised;)-30 920 y Fi(0762:)h Fn(A)16 b(subroutine)h(en)o(try)g(is)g
(made)e(to)h(\\call")f(using)74 970 y(r0.)37 b(\(This)21 b(neatly)f(stores)h
(the)g(old)f(v)n(alue)f(of)h(r0)74 1020 y(in)d(the)g(stac)o(k,)h(but)g(not)e
(a)h(return)h(address.)29 b(The)74 1070 y(new)14 b(v)n(alue)e(is)h(the)g
(address)i(of)d(the)h(address)i(of)d(the)74 1120 y(routine)19
b(to)f(b)q(e)h(en)o(tered)h(next)f(\(in)f(this)h(case)g(the)74
1169 y(\\trap")14 b(routine)g(in)f(the)i(\014le)f(\\trap.c")f(\(2693\)\);)-30
1264 y Fi(0772:)21 b Fn(The)12 b(stac)o(k)g(p)q(oin)o(ter)f(is)h(adjusted)g
(to)f(p)q(oin)o(t)g(to)g(the)74 1314 y(lo)q(cation)18 b(whic)o(h)h(already)f
(con)o(tains)h(the)h(cop)o(y)e(of)74 1363 y(PS;)-30 1458 y
Fi(0773:)j Fn(The)14 b(CPU)g(priorit)o(y)g(is)f(set)i(to)f(zero;)74
1530 y Fi(F)l(rom)k(here)f(the)h(same)g(path)f(as)h(for)g(an)g(in-)74
1580 y(terrupt)c(is)h(follo)o(w)o(ed.)-30 1711 y Fg(10.6)56
b(The)18 b(Kernel)g(Stac)n(k)-30 1793 y Fn(The)f(state)g(of)f(the)g(k)o
(ernel)h(stac)o(k)f(at)g(the)h(time)e(that)h(the)-30 1843 y(\\trap")g(pro)q
(cedure)j(\(\\C")d(v)o(ersion\))g(or)h(one)f(of)g(the)h(sp)q(e-)-30
1893 y(cialised)k(in)o(terrupt)g(handling)e(routines)i(is)f(en)o(tered,)k(is)
-30 1943 y(sho)o(wn)14 b(in)g(Figure)g(10.1.)p 336 2102 2 50
v 374 2087 a(....)p 455 2102 V 59 w Fi(Previous)g(top)h(of)g(stac)o(k)p
-30 2104 997 2 v -5 2139 a Fn(\(rps)72 b(2\))49 b(7)p 336 2154
2 50 v 132 w(ps)p 455 2154 V 65 w(old)13 b(PS)-5 2189 y(\(r7)90
b(1\))49 b(6)p 336 2204 V 130 w(p)q(c)p 455 2204 V 64 w(old)13
b(PC)h(\(r7\))-5 2239 y(\(r0)90 b(0\))49 b(5)14 b({)p Fh(>)p
336 2253 V 66 w Fn(r0)p 455 2253 V 66 w(old)f(r0)224 2288 y(4)p
336 2303 V 120 w(nps)p 455 2303 V 54 w(new)h(PS)h(after)f(trap)-5
2338 y(\(r1)69 b({2\))49 b(3)p 336 2353 V 133 w(r1)p 455 2353
V 66 w(old)13 b(r1)-5 2388 y(\(r6)69 b({3\))49 b(2)p 336 2403
V 132 w(sp)p 455 2403 V 65 w(old)13 b(SP)h(for)g(previous)g(mo)q(de)224
2438 y(1)p 336 2453 V 120 w(dev)p 455 2453 V 53 w(mask)o(ed)f(new)h(PS)224
2488 y(0)g({)p Fh(>)p 336 2503 V 55 w Fn(tp)q(c)p 455 2503
V 56 w(return)h(address)g(in)f(\\call")p -30 2504 997 2 v -5
2539 a(\(r5)85 b({6)49 b({1)p 336 2554 2 50 v 96 w(\(r5\))p
455 2554 V 50 w(old)13 b(r5)-5 2589 y(\(r4)85 b({7)49 b({2)p
336 2604 V 96 w(\(r4\))p 455 2604 V 50 w(old)13 b(r4)-5 2639
y(\(r3)85 b({8)49 b({3)p 336 2654 V 96 w(\(r3\))p 455 2654
V 50 w(old)13 b(r3)-5 2689 y(\(r2)85 b({9)49 b({4)p 336 2703
V 96 w(\(r2\))p 455 2703 V 50 w(old)13 b(r2)329 2822 y(Figure)h(10.1)1072
17 y(Columns)e(\(2\))i(and)g(\(3\))g(giv)o(e)f(the)i(p)q(ositions)e(of)h
(stac)o(k)1010 66 y(w)o(ords)j(relativ)o(e)g(to)f(the)i(p)q(ositions)e(in)h
(the)g(stac)o(k)g(of)f(the)1010 116 y(w)o(ords)e(lab)q(elled)f(\\r0")h(and)f
(\\tp)q(c")i(resp)q(ectiv)o(ely)m(.)1072 166 y(Columns)9 b(\(1\))i(and)g
(\(2\))g(de\014ne)h(\(or)f(explain\))f(the)i(con-)1010 216
y(ten)o(ts)j(of)e(the)h(\014le)g(\\reg.h")g(\(Sheet)h(26\).)1072
266 y(\\dev",)d(\\sp",)g(\\r1",)g(\\nps")g(\\r0",)g(\\p)q(c")g(and)g(\\ps")h
(in)1010 316 y(that)g(order)h(are)f(the)h(names)e(of)g(the)i(parameters)f
(used)h(in)1010 365 y(the)d(declaration)g(of)f(the)i(pro)q(cedures)h(\\trap")
e(\(2693\))f(and)1010 415 y(\\clo)q(c)o(k")j(\(3725\).)1072
465 y(Note)h(that)g(just)h(b)q(efore)f(en)o(try)h(to)f(\\trap")f(\(\\C")h(v)o
(er-)1010 515 y(sion\))h(or)h(the)g(other)g(in)o(terrupt)h(handling)d
(routines,)i(the)1010 565 y(v)n(alues)h(for)g(the)h(registers)g(r2,)g(r3,)g
(r4)f(and)g(r5)g(ha)o(v)o(e)g(not)1010 614 y(y)o(et)c(b)q(een)g(sa)o(v)o(ed)g
(in)f(the)h(stac)o(k.)18 b(This)12 b(is)g(p)q(erformed)g(b)o(y)g(a)1010
664 y(call)e(on)h(\\csv")h(\(lg20\))e(whic)o(h)h(is)g(automatically)d
(included)1010 714 y(b)o(y)j(the)i(\\C")e(compiler)f(at)i(the)h(b)q(eginning)
e(of)g(ev)o(ery)h(com-)1010 764 y(piled)k(pro)q(cedure.)30
b(The)17 b(form)f(of)g(the)i(call)e(on)h(\\csv")g(is)1010 814
y(equiv)n(alen)o(t)c(to)h(the)g(assem)o(bler)g(instruction)1075
905 y Ff(jsr)21 b(r5,csv)1072 996 y Fn(This)16 b(sa)o(v)o(es)g(the)g(curren)o
(t)h(v)n(alue)e(of)g(r5)h(on)f(the)i(stac)o(k)1010 1046 y(and)e(replaces)i
(it)e(b)o(y)g(the)h(address)h(of)d(the)i(next)g(instruc-)1010
1096 y(tion)d(in)h(the)g(\\C")f(pro)q(cedure.)1010 1187 y Fi(1421:)20
b Fn(This)14 b(v)n(alue)f(of)h(r5)f(is)h(copied)g(in)o(to)g(r0;)1010
1270 y Fi(1422:)20 b Fn(the)25 b(curren)o(t)h(v)n(alue)e(of)f(the)i(stac)o(k)
g(p)q(oin)o(ter)f(is)1114 1320 y(copied)14 b(in)o(to)f(r5.)1072
1411 y(Note)21 b(that)g(at)g(this)g(p)q(oin)o(t,)g(r5)g(p)q(oin)o(ts)g(to)f
(a)h(stac)o(k)1010 1461 y(lo)q(cation)15 b(con)o(taining)g(the)h(previous)g
(v)n(alue)g(of)f(r5)h(i.e.)23 b(it)1010 1511 y(p)q(oin)o(ts)15
b(to)g(the)h(b)q(eginning)e(of)h(a)g(c)o(hain)g(of)f(p)q(oin)o(ters,)i(one)
1010 1561 y(p)q(er)g(pro)q(cedure,)i(whic)o(h)e(\\thread")f(the)i(stac)o(k.)
23 b(When)16 b(a)1010 1611 y(\\C")h(pro)q(cedure)j(exits,)f(it)e(actually)g
(returns)j(to)d(\\cret")1010 1660 y(\(1430\))d(where)j(the)f(v)n(alue)e(of)h
(r5)g(is)g(used)h(to)g(restore)g(the)1010 1710 y(stac)o(k)j(and)f(r2,)i(r3)e
(and)h(r4)f(to)h(their)g(earlier)g(condition)1010 1760 y(\(i.e.)e(as)12
b(they)h(w)o(ere)g(imm)o(ediately)c(prior)j(to)g(en)o(tering)g(the)1010
1810 y(pro)q(cedure\).)31 b(F)m(or)18 b(this)g(reason)g(r5)g(is)f(often)h
(called)f(the)1010 1860 y Fi(en)o(vironmen)n(t)c(p)q(oin)o(ter)p
Fn(.)1890 2946 y(47)p eop
%%Page: 48 56
55 bop -30 -144 a Fk(11)43 b(CLOCK)14 b(INTERR)o(UPTS)860 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fj(11)70 b(Clo)r(c)n(k)22
b(In)n(terrupts)-30 108 y Fn(The)g(pro)q(cedure)i(\\clo)q(c)o(k")d(\(3725\))g
(handles)h(in)o(terrupts)-30 158 y(from)h(either)i(the)g(line)f(frequency)h
(time)e(clo)q(c)o(k)h(\(t)o(yp)q(e)-30 208 y(KW11-L,)13 b(in)o(terrupt)i(v)o
(ector)g(address)h(100\))d(or)h(the)h(pro-)-30 258 y(grammable)k(real-time)h
(clo)q(c)o(k)h(\(t)o(yp)q(e)i(KW11-P)m(,)d(in)o(ter-)-30 308
y(rupt)15 b(v)o(ector)f(address)i(104\).)33 358 y(UNIX)d(requires)i(that)e
(at)g(least)h(one)f(of)g(these)i(should)-30 408 y(b)q(e)d(a)o(v)n(ailable.)j
(\(If)10 b(b)q(oth)h(are)h(presen)o(t,)g(only)e(the)i(line)e(time)-30
458 y(clo)q(c)o(k)k(is)g(used.\))33 508 y(Whic)o(hev)o(er)19
b(clo)q(c)o(k)f(is)g(used,)i(in)o(terrupts)f(are)g(gener-)-30
558 y(ated)i(at)f(line)g(frequency)h(\(i.e.)36 b(with)20 b(a)g(50)g(Hz)g(p)q
(o)o(w)o(er)-30 608 y(supply)m(,)13 b(ev)o(ery)i(20)e(milliseconds\).)j(The)e
(clo)q(c)o(k)g(in)o(terrupt)-30 657 y(priorit)o(y)j(lev)o(el)f(is)h(six,)g
(higher)g(than)g(for)g(an)o(y)g(other)g(p)q(e-)-30 707 y(ripheral)c(device)h
(on)e(our)h(t)o(ypical)f(system,)g(so)h(that)f(there)-30 757
y(will)i(usually)h(b)q(e)h(v)o(ery)f(little)g(dela)o(y)f(in)h(the)h
(initiation)d(of)-30 807 y(\\clo)q(c)o(k")18 b(once)h(the)g(in)o(terrupt)g
(has)f(b)q(een)i(requested)g(b)o(y)-30 857 y(the)15 b(clo)q(c)o(k)f(con)o
(troller.)-30 975 y Fg(11.1)56 b(clo)r(c)n(k)18 b(\(3725\))-30
1053 y Fn(The)12 b(function)e(of)g(\\clo)q(c)o(k")h(is)f(one)h(of)f(general)h
(housek)o(eep-)-30 1103 y(ing:)33 1196 y Fl(\017)20 b Fn(the)k(displa)o(y)d
(register)j(is)f(up)q(dated)h(\(PDP11/45)74 1246 y(and)14 b(11/70)f(only\);)
33 1331 y Fl(\017)20 b Fn(v)n(arious)13 b(accoun)o(ting)h(v)n(alues)f(suc)o
(h)i(as)f(the)g(time)e(of)74 1381 y(da)o(y)m(,)19 b(accum)o(ulated)f(pro)q
(cessing)i(times)d(and)i(exe-)74 1431 y(cution)14 b(pro\014les)g(are)h(main)o
(tained;)33 1516 y Fl(\017)20 b Fn(pro)q(cesses)14 b(sleeping)e(for)f(a)g
(\014xed)h(time)e(in)o(terv)n(al)g(are)74 1565 y(a)o(w)o(ak)o(ened)k(as)g(p)q
(er)h(sc)o(hedule;)33 1650 y Fl(\017)20 b Fn(core)h(sw)o(apping)e(activit)o
(y)g(is)h(initiated)f(once)i(p)q(er)74 1700 y(second.)33 1794
y(\\clo)q(c)o(k")15 b(breaks)i(most)e(of)g(the)i(rules)g(for)e(p)q(eripheral)
-30 1843 y(device)j(handlers:)24 b(it)17 b(do)q(es)g(reference)j(the)d
(curren)o(t)h(\\u")-30 1893 y(structure,)c(and)c(it)h(also)f(runs)h(at)g(a)f
(lo)o(w)g(priorit)o(y)g(for)h(some)-30 1943 y(of)i(the)h(time.)i(It)d
(abbreviates)h(its)f(activit)o(y)f(if)h(a)f(previous)-30 1993
y(execution)j(has)f(not)g(y)o(et)g(completed.)-30 2086 y Fi(3740:)21
b Fn(\\displa)o(y")12 b(is)i(a)g(no-op)f(on)h(the)g(PDP11/40;)-30
2171 y Fi(3743:)21 b Fn(The)g(arra)o(y)g(\\callout")f(\(0265\))g(is)h(an)g
(arra)o(y)f(of)74 2221 y(\\NCALL")g(\(0143\))f(structures)j(of)d(t)o(yp)q(e)h
(\\callo")74 2271 y(\(0260\).)k(The)17 b(\\callo")d(structure)k(con)o(tains)e
(three)74 2321 y(elemen)o(ts:)22 b(an)16 b(incremen)o(tal)f(time,)g(an)h
(argumen)o(t)74 2370 y(and)10 b(the)h(address)h(of)d(a)h(function.)16
b(When)11 b(the)g(func-)74 2420 y(tion)j(elemen)o(t)f(is)h(not)g(n)o(ull,)e
(the)j(function)e(is)h(to)g(b)q(e)74 2470 y(executed)k(with)d(the)i(supplied)
e(argumen)o(t)g(after)h(a)74 2520 y(sp)q(eci\014ed)g(time.)74
2587 y(\(F)m(or)f(the)g(systems)h(under)f(study)m(,)g(the)h(only)e(func-)74
2637 y(tion)22 b(ev)o(er)i(executed)h(in)d(this)h(w)o(a)o(y)f(is)h
(\\ttrstrt")74 2687 y(\(8486\),)13 b(handler.)18 b(\(See)d(Chapter)g
(25.\)\);)-30 2772 y Fi(3748:)21 b Fn(If)f(the)h(\014rst)g(elemen)o(t)e(of)h
(the)h(list)f(is)g(n)o(ull,)g(the)74 2822 y(whole)14 b(list)f(is)h(n)o(ull;)
1010 17 y Fi(3750:)20 b Fn(The)14 b(\\callout")e(list)i(is)f(arranged)h(in)f
(the)h(desired)1114 66 y(order)i(of)e(execution.)23 b(The)16
b(time)d(recorded)k(is)e(the)1114 116 y(n)o(um)o(b)q(er)d(of)h(clo)q(c)o(k)h
(tic)o(ks)f(b)q(et)o(w)o(een)i(ev)o(en)o(ts.)k(Unless)1114
166 y(the)12 b(\014rst)g(time)f(\(the)h(time)e(b)q(efore)j(the)f(next)g(ev)o
(en)o(t\))1114 216 y(is)d(already)h(zero,)h(\(meaning)d(that)i(the)h
(execution)f(is)1114 266 y(already)h(due\))h(this)f(time)g(should)g(b)q(e)h
(decremen)o(ted)1114 316 y(b)o(y)h(one.)1114 383 y(If)f(this)h(time)e(has)i
(already)f(b)q(een)i(coun)o(ted)f(to)g(zero,)1114 433 y(decremen)o(t)k(the)g
(next)h(time)d(unless)i(it)g(is)f(already)1114 482 y(zero)i(also,)g(etc.)30
b(i.e.)f(decremen)o(t)19 b(the)f(\014rst)g(non-)1114 532 y(zero)f(time)f(in)g
(the)h(list.)26 b(All)16 b(the)h(leading)f(en)o(tries)1114
582 y(with)21 b(zero)h(times)f(represen)o(t)i(op)q(erations)f(whic)o(h)1114
632 y(are)12 b(already)g(due.)18 b(\(The)12 b(op)q(erations)h(are)f(actually)
1114 682 y(carried)i(out)g(a)g(little)f(later.\);)1010 766
y Fi(3759:)20 b Fn(Examine)8 b(the)i(previous)g(pro)q(cessor)h(status)g(w)o
(ord,)1114 816 y(and)17 b(if)f(the)i(priorit)o(y)f(w)o(as)g(non-zero,)i(b)o
(ypass)e(the)1114 866 y(next)c(section,)g(whic)o(h)f(executes)j(those)e(op)q
(erations)1114 916 y(whic)o(h)g(are)i(due;)1010 1000 y Fi(3766:)20
b Fn(Reduce)c(the)f(pro)q(cessor)i(priorit)o(y)d(to)g(\014v)o(e)h(\(other)
1114 1050 y(lev)o(el)e(six)h(in)o(terrupts)h(ma)o(y)d(no)o(w)h(o)q(ccur\);)
1010 1135 y Fi(3767:)20 b Fn(Searc)o(h)15 b(the)f(\\callout")f(arra)o(y)g(lo)
q(oking)f(for)i(op)q(er-)1114 1184 y(ations)f(whic)o(h)h(are)g(due)h(and)e
(execute)j(them;)1010 1269 y Fi(3773:)k Fn(Mo)o(v)o(e)g(the)h(en)o(tries)g
(for)e(op)q(erations)i(whic)o(h)f(are)1114 1319 y(still)9 b(not)h(y)o(et)g
(due,)h(to)f(the)g(b)q(eginning)g(of)f(the)i(arra)o(y;)1010
1403 y Fi(3787:)20 b Fn(The)f(co)q(de)g(from)e(here)i(un)o(til)e(line)h(3797)
f(is)h(exe-)1114 1453 y(cuted,)13 b(whatev)o(er)h(the)f(previous)h(pro)q
(cessor)g(prior-)1114 1503 y(it)o(y)m(,)e(at)i(either)g(priorit)o(y)g(lev)o
(el)f(\014v)o(e)h(or)g(six;)1010 1587 y Fi(3788:)20 b Fn(If)12
b(the)h(previous)f(mo)q(de)g(w)o(as)g(\\user)h(mo)q(de",)d(then)1114
1637 y(incremen)o(t)h(the)h(user)g(time)e(coun)o(ter,)i(and)f(if)g(an)g(ex-)
1114 1687 y(ecution)i(pro\014le)g(is)f(b)q(eing)h(accum)o(ulated,)f(call)g
(\\in-)1114 1737 y(cup)q(c")g(\(a895\))f(to)g(mak)o(e)f(an)h(en)o(try)i(in)e
(a)g(histogram)1114 1787 y(for)i(the)i(user)g(mo)q(de)d(program)h(coun)o(ter)
i(\(PC\).)1114 1854 y(\\incup)q(c")e(is)h(written)g(in)f(assem)o(bler,)g
(presumably)1114 1904 y(for)h(e\016ciency)i(and)f(con)o(v)o(enience.)22
b(A)15 b(description)1114 1954 y(of)h(what)g(it)g(do)q(es)h(ma)o(y)e(b)q(e)i
(found)f(in)g(the)h(section)1114 2003 y(\\PR)o(OFIL\(I)q(I\)")c(of)g(the)h
(UPM.)f(See)h(also)f(the)h(pro-)1114 2053 y(cedure)h(\\pro\014l")e(\(3667\);)
1010 2138 y Fi(3792:)20 b Fn(If)12 b(the)h(previous)g(mo)q(de)e(w)o(as)i(not)
f(user)h(mo)q(de,)f(in-)1114 2188 y(cremen)o(t)i(the)h(system)f(\(k)o
(ernel\))h(time)e(coun)o(ter)i(for)1114 2237 y(the)f(pro)q(cess.)1072
2330 y(The)e(co)q(de)g(just)g(describ)q(ed)h(p)q(erforms)e(the)h(basic)f
(time)1010 2380 y(accoun)o(ting)21 b(for)h(the)g(system.)41
b(Ev)o(ery)22 b(clo)q(c)o(k)g(tic)o(k)g(re-)1010 2430 y(sults)17
b(in)g(the)h(incremen)o(ting)e(of)g(either)i(\\u.u)p 1740 2430
13 2 v 15 w(utime")d(or)1010 2480 y(\\u.u)p 1091 2480 V 14
w(stime")20 b(for)g(some)f(pro)q(cess.)40 b(Both)21 b(\\u.u)p
1794 2480 V 15 w(utime")1010 2529 y(and)h(\\u.u)p 1180 2529
V 14 w(stime")f(are)h(initialised)f(to)h(zero)g(in)g(\\fork")1010
2579 y(\(3322\).)43 b(Their)22 b(v)n(alues)h(are)f(in)o(terrogated)h(in)f
(\\w)o(ait")1010 2629 y(\(3270\).)17 b(The)e(v)n(alues)e(will)g(go)g(negativ)
o(e)h(after)g(32K)g(tic)o(ks)1010 2679 y(\(ab)q(out)g(10)f(hours\)!)1010
2772 y Fi(3795:)20 b Fn(\\p)p 1185 2772 V 15 w(cpu")c(is)f(used)h(in)f
(determining)f(pro)q(cess)j(pri-)1114 2822 y(orities.)g(It)12
b(is)g(a)g(c)o(haracter)i(v)n(alue)d(whic)o(h)h(is)g(alw)o(a)o(ys)-30
2946 y(48)p eop
%%Page: 49 57
56 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)859
b(11)43 b(CLOCK)14 b(INTERR)o(UPTS)74 17 y Fn(in)o(terpreted)21
b(as)e(a)g(p)q(ositiv)o(e)g(in)o(teger)g(\(0)g(to)g(255\).)74
66 y(When)f(it)f(is)h(mo)o(v)o(ed)e(to)h(a)h(sp)q(ecial)g(register,)h(sign)74
116 y(extension)12 b(o)q(ccurs)h(so)f(that)f(255,)g(for)g(instance,)h(b)q(e-)
74 166 y(comes)i(lik)o(e)f({1.)19 b(Adding)13 b(one)i(then)g(lea)o(v)o(es)f
(a)g(zero)74 216 y(result.)35 b(In)19 b(this)g(case)i(the)e(v)n(alue)g(is)g
(reduced)i(to)74 266 y({1)c(again,)f(and)i(stored)g(as)f(255)g(unsigned.)28
b(Note)74 316 y(that)14 b(in)f(the)h(other)f(places)h(where)h(\\p)p
678 316 13 2 v 15 w(cpu")e(is)h(ref-)74 365 y(erenced)21 b(\(2161,)d(3814\),)
g(the)h(top)g(eigh)o(t)f(bits)g(are)74 415 y(mask)o(ed)j(o\013)h(after)g(the)
g(v)n(alue)f(has)h(b)q(een)h(trans-)74 465 y(ferred)15 b(to)f(a)g(sp)q(ecial)
g(register;)-30 550 y Fi(3797:)21 b Fn(Incremen)o(t)f(\\lb)q(olt")f(and)h(if)
f(it)h(exceeds)i(\\HZ",)74 600 y(i.e.)c(a)13 b(second)i(or)f(more)f(has)h
(elapsed)h(...)-30 684 y Fi(3798:)21 b Fn(Then)f(pro)o(vided)g(the)g(pro)q
(cessor)h(w)o(as)f(not)f(pre-)74 734 y(viously)g(running)h(at)g(a)g(nonzero)h
(priorit)o(y)m(,)f(do)g(a)74 784 y(whole)14 b(lot)f(of)g(housek)o(eeping;)-30
869 y Fi(3800:)21 b Fn(Decremen)o(t)14 b(\\lb)q(olt")f(b)o(y)g(\\HZ";)-30
954 y Fi(3801:)21 b Fn(Incremen)o(t)14 b(the)h(time)d(of)h(da)o(y)h(accum)o
(ulator;)-30 1038 y Fi(3803:)21 b Fn(The)26 b(ev)o(en)o(ts)h(whic)o(h)f
(follo)o(w)e(ma)o(y)g(tak)o(e)i(some)74 1088 y(time,)10 b(but)i(they)f(ma)o
(y)f(reasonably)h(b)q(e)g(in)o(terrupted)74 1138 y(to)i(service)i(other)f(p)q
(eripherals.)k(So)13 b(the)h(pro)q(cessor)74 1188 y(priorit)o(y)e(is)g(dropp)
q(ed)h(b)q(elo)o(w)f(all)f(the)i(device)g(prior-)74 1238 y(it)o(y)h(lev)o
(els)f(i.e.)18 b(b)q(elo)o(w)c Fi(four)p Fn(.)74 1305 y(Ho)o(w)o(ev)o(er)g
(there)h(is)f(no)o(w)f(a)g(p)q(ossibilit)o(y)f(of)h(another)74
1355 y(clo)q(c)o(k)20 b(in)o(terrupt)g(b)q(efore)g(this)f(activ)n(ation)f(of)
h(the)74 1405 y(\\clo)q(c)o(k")g(pro)q(cedure)h(is)f(completed.)32
b(By)19 b(setting)74 1454 y(the)e(pro)q(cessor)i(priorit)o(y)d(to)g
Fi(one)g Fn(rather)h(than)g(to)74 1504 y Fi(zero)p Fn(,)e(a)h(second)g(activ)
n(ation)f(of)g(\\clo)q(c)o(k")g(will)f(not)74 1554 y(attempt)c(to)h(execute)h
(the)g(co)q(de)f(from)e(line)h(3804)g(on)74 1604 y(also.)17
b(Note)c(ho)o(w)o(ev)o(er)f(that)g(to)g(the)h(hardw)o(are,)f(pri-)74
1654 y(orit)o(y)j(one)g(is)g(functionally)f(the)i(same)e(as)h(priorit)o(y)74
1703 y(zero;)-30 1788 y Fi(3804:)21 b Fn(If)f(the)h(curren)o(t)g(time)e
(\(measured)h(in)g(seconds\))74 1838 y(is)e(equal)f(to)h(the)g(v)n(alue)f
(stored)i(in)e(\\tout",)h(w)o(ak)o(e)74 1888 y(all)g(pro)q(cesses)k(whic)o(h)
d(ha)o(v)o(e)g(elected)i(to)e(susp)q(end)74 1938 y(themselv)o(es)11
b(for)f(a)g(p)q(erio)q(d)g(of)g(time)f(via)g(the)i(\\sleep")74
1987 y(system)23 b(call)f(i.e.)45 b(via)22 b(the)i(pro)q(cedure)g(\\sslep")74
2037 y(\(5979\).)33 2130 y(\\tout")10 b(stores)j(the)f(time)d(at)i(whic)o(h)g
(the)h(next)g(pro)q(cess)-30 2180 y(is)k(to)g(b)q(e)g(a)o(w)o(ak)o(ened.)24
b(If)15 b(there)j(is)d(more)g(than)h(one)g(suc)o(h)-30 2230
y(pro)q(cess,)i(then)f(the)f(remainder,)f(whic)o(h)h(will)e(ha)o(v)o(e)i(b)q
(een)-30 2280 y(disturb)q(ed,)j(m)o(ust)d(reset)j(\\tout")d(b)q(et)o(w)o(een)
j(them.)27 b(This)-30 2330 y(mec)o(hanism,)17 b(while)i(quite)f(e\013ectiv)o
(e,)j(will)c(not)i(b)q(e)g(e\016-)-30 2379 y(cien)o(t)c(if)e(the)i(n)o(um)o
(b)q(er)e(of)g(suc)o(h)i(pro)q(cesses)i(ev)o(er)d(b)q(ecomes)-30
2429 y(large.)33 2479 y(In)20 b(this)h(situation,)g(a)f(mec)o(hanism)f
(similar)f(to)i(the)-30 2529 y(\\callout")e(arra)o(y)h(\(see)h(3767\))e(w)o
(ould)g(need)i(to)e(b)q(e)i(pro-)-30 2579 y(vided.)i(\(In)16
b(fact,)f(ho)o(w)g(di\016cult)f(w)o(ould)h(it)f(b)q(e)i(to)f(merge)-30
2629 y(the)d(t)o(w)o(o)e(mec)o(hanisms?)15 b(What)10 b(w)o(ould)g(b)q(e)h
(the)h(disadv)n(an-)-30 2679 y(tages)j(??\);)-30 2772 y Fi(3806:)21
b Fn(When)13 b(the)g(last)g(t)o(w)o(o)f(bits)h(of)f(\\time[1]")e(are)j(zero)
74 2822 y(i.e.)28 b(ev)o(ery)18 b(four)f(seconds,)j(reset)f(the)f(sc)o
(heduling)1114 17 y(\015ag)e(\\runrun")i(and)f(w)o(ak)o(e)g(up)g(ev)o
(erything)h(w)o(ait-)1114 66 y(ing)12 b(for)g(a)h(\\ligh)o(tning)e(b)q(olt".)
17 b(\(\\lb)q(olt")11 b(represen)o(ts)1114 116 y(a)f(general)g(ev)o(en)o(t)h
(whic)o(h)g(is)f(caused)i(ev)o(ery)f(four)f(sec-)1114 166 y(onds,)15
b(to)h(initiate)e(miscellaneous)h(housek)o(eeping.)1114 216
y(It)f(is)f(used)i(b)o(y)f(\\p)q(cop)q(en")g(\(8648\).\);)1010
299 y Fi(3810:)20 b Fn(F)m(or)14 b(all)e(curren)o(tly)j(de\014ned)g(pro)q
(cesses:)1114 365 y(incremen)o(t)f(\\p)p 1353 365 V 14 w(time")f(up)h(to)g(a)
g(maxim)n(um)c(of)k(127)1114 415 y(\(it)f(is)h(only)f(a)h(c)o(haracter)h(v)n
(ariable\);)1114 482 y(decremen)o(t)26 b(\\p)p 1371 482 V 15
w(cpu")g(b)o(y)f(\\SCHMA)o(G")g(\(3707\))1114 531 y(but)e(do)f(not)h(allo)o
(w)e(it)h(to)h(go)f(negativ)o(e.)45 b(Note)1114 581 y(that)16
b(as)h(discussed)i(earlier)e(\(line)f(3795\))g(\\p)p 1833 581
V 15 w(cpu")1114 631 y(is)e(treated)h(as)f(a)g(p)q(ositiv)o(e)g(in)o(teger)h
(in)e(the)i(range)f(0)1114 681 y(to)f(255;)1114 747 y(if)i(the)i(pro)q
(cessor)h(priorit)o(y)e(is)g(curren)o(tly)i(set)f(at)f(a)1114
797 y(depressed)g(v)n(alue,)d(recalculate)h(it.)1072 888 y(Note)21
b(that)f(\\p)p 1321 888 V 15 w(cpu")g(en)o(ters)i(in)o(to)d(the)i
(calculation)1010 938 y(of)f(pro)q(cess)j(priorities,)e(\\p)p
1457 938 V 15 w(pri",)h(b)o(y)e(\\setpri")h(\(2156\).)1010
988 y(\\p)p 1056 988 V 15 w(pri")26 b(is)h(used)h(b)o(y)f(\\swtc)o(h")g
(\(2209\))g(in)f(c)o(ho)q(osing)1010 1038 y(whic)o(h)13 b(pro)q(cess,)i(from)
c(among)g(those)j(whic)o(h)g(are)f(in)g(core)1010 1088 y(\(\\SLO)o(AD"\))20
b(and)f(ready)i(to)f(run)g(\(\\SR)o(UN"\),)f(should)1010 1137
y(next)14 b(receiv)o(e)h(the)g(CPU's)f(atten)o(tion.)1072 1187
y(\\p)p 1118 1187 V 15 w(time")i(is)h(used)h(to)f(measure)h(ho)o(w)f(long)f
(\(in)h(sec-)1010 1237 y(onds\))d(a)f(pro)q(cess)i(has)f(b)q(een)h(either)f
(in)f(core)i(or)e(sw)o(app)q(ed)1010 1287 y(out)j(to)g(disk.)24
b(\\p)p 1294 1287 V 15 w(time")15 b(is)h(set)h(to)f(zero)h(b)o(y)e(\\newpro)q
(c")1010 1337 y(\(1869\),)f(b)o(y)h(\\sc)o(hed")h(\(2047\))e(and)h(b)o(y)g
(\\xsw)o(ap")f(\(4386\).)1010 1387 y(It)21 b(is)g(used)h(b)o(y)f(\\sc)o(hed")
h(\(1962,)g(2009\))e(to)h(determine)1010 1436 y(whic)o(h)14
b(pro)q(cesses)i(to)e(sw)o(ap)g(in)f(or)h(out.)1010 1528 y
Fi(3820:)20 b Fn(If)28 b(the)h(sc)o(heduler)h(is)f(w)o(aiting)e(to)h
(rearrange)1114 1577 y(things,)14 b(w)o(ak)o(e)g(it)h(up.)20
b(Th)o(us)15 b(the)h(normal)c(rate)j(for)1114 1627 y(sc)o(heduling)f
(decisions)g(is)g(once)g(p)q(er)h(second;)1010 1710 y Fi(3824:)20
b Fn(If)h(the)h(previous)f(mo)q(de)f(b)q(efore)i(the)f(in)o(terrupt)1114
1760 y(w)o(as)12 b(\\user)h(mo)q(de",)e(store)j(the)f(address)h(of)e(\\r0")g
(in)1114 1810 y(a)k(standard)h(place,)f(and)h(if)e(a)h(\\signal")f(has)i(b)q
(een)1114 1860 y(receiv)o(ed)c(for)e(the)h(pro)q(cess,)i(call)d(\\psig")f
(\(4043\))h(for)1114 1910 y(the)j(appropriate)g(action.)1010
2026 y Fg(11.2)56 b(timeout)16 b(\(3845\))1010 2102 y Fn(This)24
b(pro)q(cedure)j(mak)o(es)c(new)i(en)o(tries)g(in)f(the)h(\\call-)1010
2152 y(out")19 b(arra)o(y)m(.)33 b(In)19 b(this)h(system)f(it)f(is)h(only)g
(called)g(from)1010 2202 y(the)14 b(routine)f(\\ttstart")h(\(8505\),)e
(passing)h(the)h(pro)q(cedure)1010 2252 y(\\ttrstrt")e(\(3486\).)k(Note)c
(that)f(\\ttrstrt")h(calls)e(\\ttstart",)1010 2302 y(whic)o(h)16
b(ma)o(y)e(call)i(\\timeout",)f(for)h(a)g(thoroughly)f(inces-)1010
2351 y(tuous)f(relationship!)1072 2401 y(Note)g(also)f(that)g(most)f(of)h
(\\timeout")e(runs)j(at)f(prior-)1010 2451 y(it)o(y)g(lev)o(el)h(sev)o(en,)g
(to)g(a)o(v)o(oid)e(clo)q(c)o(k)i(in)o(terrupts.)1890 2946
y(49)p eop
%%Page: 50 58
57 bop -30 -144 a Fk(12)43 b(TRAPS)16 b(AND)e(SYSTEM)i(CALLS)711
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(12)70 b(T)-6
b(raps)24 b(and)g(System)c(Calls)-30 110 y Fn(This)14 b(c)o(hapter)g(is)g
(concerned)h(with)e(the)h(w)o(a)o(y)f(the)h(system)-30 159
y(handles)g(traps)f(in)g(general)g(and)g(system)g(calls)g(in)g(partic-)-30
209 y(ular.)33 260 y(There)19 b(are)f(quite)g(a)g(n)o(um)o(b)q(er)f(of)g
(conditions)h(whic)o(h)-30 310 y(can)f(cause)h(the)f(pro)q(cessor)h(to)f
(\\trap".)25 b(Man)o(y)16 b(of)g(these)-30 360 y(are)d(quite)g(clearly)f
(error)i(conditions,)e(suc)o(h)h(as)f(hardw)o(are)-30 410 y(or)i(p)q(o)o(w)o
(er)g(failures,)f(and)h(UNIX)g(do)q(es)g(not)g(attempt)f(an)o(y)-30
459 y(sophisticated)i(reco)o(v)o(ery)g(pro)q(cedures)h(for)e(these.)33
510 y(The)g(initial)e(fo)q(cus)i(for)g(our)g(atten)o(tion)g(is)f(the)i
(princi-)-30 560 y(pal)f(pro)q(cedure)h(in)f(the)g(\014le)g(\\trap.c".)-30
682 y Fg(12.1)56 b(trap)19 b(\(2693\))-30 761 y Fn(The)j(w)o(a)o(y)f(that)h
(this)g(pro)q(cedure)h(is)e(in)o(v)o(ok)o(ed)g(w)o(as)h(ex-)-30
810 y(plored)15 b(in)f(Chapter)i(T)m(en.)k(The)15 b(assem)o(bler)f(\\trap")h
(rou-)-30 860 y(tine)j(carries)g(out)f(certain)h(fundamen)o(tal)d(housek)o
(eeping)-30 910 y(tasks)25 b(to)f(set)h(up)f(the)g(k)o(ernel)h(stac)o(k,)h
(so)e(that)g(when)-30 960 y(this)18 b(pro)q(cedure)h(is)e(called,)h(ev)o
(erything)g(app)q(ears)g(to)f(b)q(e)-30 1010 y(k)o(osher.)33
1061 y(The)e(\\trap")f(pro)q(cedure)j(can)d(op)q(erate)i(as)f(though)f(it)-30
1110 y(had)k(b)q(een)h(called)e(b)o(y)h(another)g(\\C")f(pro)q(cedure)j(in)d
(the)-30 1160 y(normal)12 b(w)o(a)o(y)h(with)h(sev)o(en)h(parameters)193
1257 y(dev,)f(sp,)g(rl,)f(nps,)h(r0,)f(p)q(c,)h(ps.)33 1353
y(\(There)k(is)g(a)f(sp)q(ecial)g(consideration)h(whic)o(h)f(should)-30
1402 y(b)q(e)d(men)o(tioned)e(here)i(in)e(passing.)18 b(Normally)10
b(all)h(param-)-30 1452 y(eters)j(passed)e(to)f(\\C")g(pro)q(cedures)j(are)e
(passed)h(b)o(y)e(v)n(alue.)-30 1502 y(If)h(the)h(pro)q(cedure)h(subsequen)o
(tly)f(c)o(hanges)g(the)g(v)n(alues)e(of)-30 1552 y(the)k(parameters,)f(this)
g(will)f(not)h(a\013ect)h(the)f(calling)f(pro-)-30 1602 y(cedure)j(directly)m
(.)33 1652 y(Ho)o(w)o(ev)o(er)26 b(if)f(\\trap")g(or)h(the)g(in)o(terrupt)g
(handlers)-30 1702 y(c)o(hange)14 b(the)f(v)n(alues)g(of)g(their)g
(parameters,)g(the)h(new)f(v)n(al-)-30 1752 y(ues)k(will)d(b)q(e)j(pic)o(k)o
(ed)f(up)f(and)h(re\015ected)i(bac)o(k)e(when)g(the)-30 1802
y(\\previous)e(mo)q(de")f(registers)i(are)g(restored.\))33
1853 y(The)i(v)n(alue)f(of)g(\\dev")g(w)o(as)h(obtained)f(b)o(y)h(capturing)
-30 1903 y(the)d(v)n(alue)f(of)f(the)i(pro)q(cessor)g(status)g(w)o(ord)f
(immediately)-30 1952 y(after)e(the)h(trap)f(and)f(masking)f(out)h(all)g(but)
h(the)g(lo)o(w)o(er)f(\014v)o(e)-30 2002 y(bits.)20 b(Immediately)12
b(b)q(efore)j(this,)f(the)i(pro)q(cessor)g(status)-30 2052
y(w)o(ord)c(had)f(b)q(een)i(set)g(using)e(the)h(protot)o(yp)q(e)g(con)o
(tained)g(in)-30 2102 y(the)j(appropriate)f(v)o(ector)h(lo)q(cation.)33
2153 y(Th)o(us)h(if)g(the)h(second)g(w)o(ord)g(of)e(the)i(v)o(ector)h(lo)q
(cation)-30 2203 y(w)o(as)i(\\br7+n;")j(\(e.g.)36 b(line)20
b(0516\))f(then)h(the)h(v)n(alue)e(of)-30 2252 y(\\dev")14
b(will)f(b)q(e)h(n.)-30 2348 y Fi(2698:)21 b Fn(\\sa)o(vfp")9
b(sa)o(v)o(es)i(the)f(\015oating)g(p)q(oin)o(t)f(registers)j(\(for)74
2398 y(the)j(PDP11/40,)d(this)i(is)g(a)f(no-op!\);)-30 2485
y Fi(2700:)21 b Fn(If)h(the)g(previous)g(mo)q(de)f(is)h(\\user)h(mo)q(de',)f
(the)74 2535 y(v)n(alue)14 b(of)g(\\dev")h(is)g(mo)q(di\014ed)e(b)o(y)h(the)i
(addition)d(of)74 2585 y(the)i(o)q(ctal)e(v)n(alue)h(020)f(\(2662\);)-30
2672 y Fi(2701:)21 b Fn(The)11 b(stac)o(k)f(address)i(where)f(r0)g(is)f
(stored)h(is)f(noted)74 2722 y(in)24 b(\\u.u)p 214 2722 13
2 v 14 w(ar0")g(for)g(future)g(reference.)52 b(\(Subse-)74
2772 y(quen)o(tly)13 b(the)g(v)n(arious)e(register)j(v)n(alues)e(can)g(b)q(e)
i(ref-)74 2822 y(erenced)i(as)e(\\u.u)p 356 2822 V 15 w(ar0[Rn]".\);)1010
17 y Fi(2702:)20 b Fn(There)c(is)e(no)o(w)f(a)h(m)o(ulti-w)o(a)o(y)d(\\switc)
o(h")j(dep)q(end-)1114 66 y(ing)f(on)g(the)i(v)n(alue)e(of)g(\\dev".)1072
154 y(A)o(t)f(this)h(p)q(oin)o(t)e(w)o(e)i(can)f(observ)o(e)h(that)g(UNIX)f
(divides)1010 204 y(traps)f(in)o(to)f(three)j(classes,)f(dep)q(ending)f(on)g
(the)g(prior)g(pro-)1010 253 y(cessor)k(mo)q(de)e(and)h(the)g(source)i(of)d
(the)h(trap:)1010 341 y Fi(\(a\))20 b Fn(k)o(ernel)14 b(mo)q(de;)1010
422 y Fi(\(b\))19 b Fn(user)c(mo)q(de,)e(not)g(due)i(to)f(a)f(\\trap")h
(instruction;)1010 504 y Fi(\(c\))20 b Fn(user)15 b(mo)q(de,)d(due)j(to)e(a)h
(\\trap")g(instruction.)1010 619 y Fg(12.2)56 b(Kernel)17 b(Mo)r(de)h(T)-5
b(raps)1010 696 y Fn(The)11 b(trap)h(is)f(unexp)q(ected)i(and)e(with)g(one)g
(exception,)h(the)1010 746 y(reaction)19 b(is)g(to)f(\\panic".)32
b(The)20 b(co)q(de)f(executed)i(is)d(the)1010 795 y(\\default")13
b(of)g(the)i(\\switc)o(h")e(statemen)o(t:)1010 883 y Fi(2716:)20
b Fn(Prin)o(t:)1163 972 y Fl(\017)h Fn(the)e(curren)o(t)h(v)n(alue)d(of)h
(the)h(sev)o(en)o(th)h(k)o(ernel)1205 1021 y(segmen)o(t)h(address)i(register)
f(\(i.e.)40 b(the)22 b(ad-)1205 1071 y(dress)j(of)f(the)g(curren)o(t)i(p)q
(er)f(pro)q(cess)g(data)1205 1121 y(area\);)1163 1186 y Fl(\017)c
Fn(the)14 b(address)h(of)e(\\ps")h(\(whic)o(h)g(is)f(in)g(the)i(k)o(er-)1205
1236 y(nel)f(stac)o(k\);)g(and)1163 1300 y Fl(\017)21 b Fn(the)14
b(trap)g(t)o(yp)q(e)h(n)o(um)o(b)q(er;)1010 1389 y Fi(2719:)20
b Fn(\\panic",)13 b(with)h(no)f(return.)1072 1477 y(Floating)f(p)q(oin)o(t)h
(op)q(erations)g(are)h(only)f(used)h(b)o(y)f(pro-)1010 1527
y(grams,)c(and)i(not)f(b)o(y)g(the)h(op)q(erating)g(system.)16
b(Since)11 b(suc)o(h)1010 1576 y(op)q(erations)f(on)g(the)h(PDP11/45)e(and)h
(11/70)f(are)h(handled)1010 1626 y(async)o(hronously)m(,)15
b(it)h(is)g(p)q(ossible)g(that)g(when)g(a)g(\015oating)1010
1676 y(p)q(oin)o(t)e(exception)h(o)q(ccurs,)g(the)g(pro)q(cessor)h(ma)o(y)c
(ha)o(v)o(e)i(al-)1010 1726 y(ready)i(switc)o(hed)g(to)f(k)o(ernel)h(mo)q(de)
e(to)i(handle)f(an)g(in)o(ter-)1010 1776 y(rupt.)1072 1825
y(Th)o(us)23 b(a)g(k)o(ernel)h(mo)q(de)e(\015oating)g(p)q(oin)o(t)g
(exception)1010 1875 y(trap)17 b(can)g(b)q(e)h(exp)q(ected)h(o)q(ccasionally)
d(and)h(is)f(the)i(con-)1010 1925 y(cern)d(of)e(the)i(curren)o(t)g(user)g
(program.)1010 2012 y Fi(2793:)20 b Fn(Call)c(\\psignal")f(\(3963\))i(to)f
(set)i(a)f(\015ag)f(to)h(sho)o(w)1114 2062 y(that)d(a)f(\015oating)g(p)q(oin)
o(t)g(exception)i(has)f(o)q(ccurred;)1010 2144 y Fi(2794:)20
b Fn(Return.)1072 2231 y(This)e(raises)h(an)f(in)o(teresting)h(question:)27
b(\\Wh)o(y)18 b(are)1010 2281 y(the)f(k)o(ernel)g(mo)q(de)f(and)h(user)g(mo)q
(de)f(\015oating)g(p)q(oin)o(t)g(ex-)1010 2331 y(ceptions)f(handled)e(sligh)o
(tly)g(diferen)o(tly?")1010 2446 y Fg(12.3)56 b(User)18 b(Mo)r(de)g(T)-5
b(raps)1010 2523 y Fn(Consider)11 b(\014rst)h(of)f(all)f(a)g(trap)i(whic)o(h)
f(is)g(not)g(generated)h(as)1010 2573 y(the)j(result)h(of)e(the)i(execution)g
(of)e(a)h(\\trap)f(instruction".)1010 2622 y(This)h(is)h(regarded)h(as)e(a)h
(probable)f(error)i(for)e(whic)o(h)g(the)1010 2672 y(op)q(erating)9
b(system)h(mak)o(es)f(no)g(pro)o(vision)g(apart)g(from)f(the)1010
2722 y(p)q(ossibilit)o(y)k(of)g(a)h(\\core)h(dump".)i(Ho)o(w)o(ev)o(er)e(the)
f(use)h(pro-)1010 2772 y(gram)j(itself)h(ma)o(y)f(ha)o(v)o(e)i(an)o
(ticipated)f(it)h(and)f(pro)o(vided)1010 2822 y(for)13 b(it.)-30
2946 y(50)p eop
%%Page: 51 59
58 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)711
b(12)43 b(TRAPS)15 b(AND)g(SYSTEM)g(CALLS)33 17 y Fn(The)26
b(w)o(a)o(y)f(this)h(pro)o(vision)f(is)h(made)f(and)h(imple-)-30
66 y(men)o(ted)15 b(is)g(the)h(sub)r(ject)g(of)f(the)g(next)h(c)o(hapter.)22
b(A)o(t)16 b(this)-30 116 y(stage,)e(the)h(principal)e(requiremen)o(t)h(is)g
(to)f(\\signal")g(that)-30 166 y(the)i(trap)f(has)g(o)q(ccurred.)-30
249 y Fi(2721:)21 b Fn(A)11 b(bus)h(error)g(has)g(o)q(ccurred)h(while)e(the)h
(system)f(is)74 299 y(in)h(user)i(mo)q(de.)i(Set)d(\\i")f(to)g(the)h(v)n
(alue)f(\\SIGBUS")74 349 y(\(0123\);)-30 428 y Fi(2723:)21
b Fn(The)k(\\break")f(causes)i(a)e(branc)o(h)g(out)g(of)g(the)74
478 y(\\switc)o(h")14 b(statemen)o(t)g(to)g(line)f(2818;)-30
558 y Fi(2733:)21 b Fn(Apart)c(from)d(the)j(one)f(sp)q(ecial)h(case)g(noted,)
g(the)74 608 y(treatmen)o(t)i(of)e(illegal)g(instructions)i(is)f(the)i(same)
74 657 y(at)14 b(this)g(lev)o(el)f(as)h(for)g(bus)g(errors;)-30
737 y Fi(2739:)-30 817 y(2743:)-30 896 y(2747:)-30 976 y(2796:)21
b Fn(Cf.)d(the)c(commen)o(t)e(for)h(line)h(2721.)33 1059 y(Note)g(that)g
(cases)h(\\4+USER")f(\(p)q(o)o(w)o(er)g(fail\))e(and)-30 1109
y(\\7+USER")e(\(programmed)d(in)o(terrupt\))j(are)g(handled)g(b)o(y)-30
1158 y(the)15 b(\\default")e(case)i(\(line)e(2715\).)-30 1241
y Fi(2810:)21 b Fn(This)15 b(represen)o(ts)i(a)d(case)i(where)g(op)q(erating)
e(sys-)74 1291 y(tem)g(assistance)i(is)f(required)h(to)e(extend)i(the)g(user)
74 1341 y(mo)q(de)d(stac)o(k)h(area.)74 1406 y(The)26 b(assem)o(bler)g
(routine)g(\\bac)o(kup")f(\(1012\))g(is)74 1456 y(used)h(to)f(reconstruct)i
(the)e(situation)g(that)g(ex-)74 1505 y(isted)15 b(b)q(efore)g(execution)g
(of)f(the)h(instruction)g(that)74 1555 y(caused)g(the)g(trap.)74
1620 y(\\gro)o(w")d(\(4136\))h(is)g(used)h(to)f(do)f(the)i(actual)f(exten-)74
1670 y(sion.)33 1753 y(The)18 b(pro)q(cedure)i(\\bac)o(kup")e(is)g
(non-trivial)f(and)h(its)-30 1802 y(comprehension)h(in)o(v)o(olv)o(es)g(a)g
(careful)g(consideration)g(of)-30 1852 y(v)n(arious)d(asp)q(ects)i(of)e(the)g
(PDP11)g(arc)o(hitecture.)27 b(It)17 b(has)-30 1902 y(b)q(een)22
b(left)d(for)h(the)g(in)o(terested)i(reader)f(to)f(pursue)h(pri-)-30
1952 y(v)n(ately)m(.)33 2002 y(As)13 b(noted)h(for)f(the)h(PDP11/40,)e(\\bac)
o(kup")g(ma)o(y)g(not)-30 2051 y(alw)o(a)o(ys)g(succeed)i(b)q(ecause)g(the)f
(pro)q(cessor)h(do)q(es)f(not)g(sa)o(v)o(e)-30 2101 y(enough)h(information)d
(to)j(resolv)o(e)h(all)d(p)q(ossibilities.)-30 2184 y Fi(218:)21
b Fn(Call)i(\\psignal")f(\(3963\))i(to)g(set)h(the)f(appropri-)74
2234 y(ate)f(\\signal".)40 b(\(Note)23 b(that)f(this)g(statemen)o(t)g(is)74
2284 y(only)12 b(reac)o(hed)i(from)c(those)j(cases)h(of)e(the)h(\\switc)o(h")
74 2334 y(whic)o(h)h(included)g(a)g(\\break")f(statemen)o(t.\);)-30
2413 y Fi(2821:)21 b Fn(\\issig")13 b(c)o(hec)o(ks)j(if)e(a)g(\\signal")f
(has)h(b)q(een)i(sen)o(t)f(to)74 2463 y(the)g(user)g(program,)d(either)j
(just)g(no)o(w)e(or)i(at)f(some)74 2513 y(earlier)e(time)e(and)h(has)g(not)g
(y)o(et)h(b)q(een)g(attended)g(to;)-30 2593 y Fi(2822:)21 b
Fn(\\psig")27 b(p)q(erforms)h(the)h(appropriate)f(actions.)74
2642 y(\(Both)15 b(\\issig")f(and)g(\\psig")g(are)h(discussed)h(in)e(de-)74
2692 y(tail)f(in)g(the)i(next)f(c)o(hapter.\);)-30 2772 y Fi(2823:)21
b Fn(Recalculate)13 b(the)h(priorit)o(y)e(for)h(the)g(curren)o(t)i(pro-)74
2822 y(cess.)1010 17 y Fg(12.4)56 b(System)16 b(Calls)1010
93 y Fn(User)11 b(mo)q(de)e(programs)g(use)i(\\trap")f(instructions)h(as)f
(part)1010 143 y(of)19 b(the)h(\\system)f(call")f(mec)o(hanism)f(to)i(call)g
(up)q(on)g(the)1010 193 y(op)q(erating)14 b(system)f(for)h(assistance.)1072
243 y(Since)h(there)g(are)g(man)o(y)d(p)q(ossible)j(\\v)o(ersions")f(of)f
(the)1010 293 y(\\trap")f(instruction,)h(the)g(t)o(yp)q(e)f(of)g(assistance)i
(requested)1010 342 y(can)e(b)q(e)g(and)f(is)g(enco)q(ded)i(as)f(part)f(of)g
(the)h(\\trap")f(instruc-)1010 392 y(tion.)1072 442 y(P)o(arameters)i(whic)o
(h)f(are)h(part)g(of)f(a)h(system)f(call)g(ma)o(y)1010 492
y(b)q(e)i(passed)h(from)d(the)i(user)h(program)d(in)h(di\013eren)o(t)i(w)o(a)
o(ys:)1010 568 y Fi(\(a\))20 b Fn(via)13 b(the)h(sp)q(ecial)h(register)g(r0;)
1010 644 y Fi(\(b\))k Fn(as)i(a)f(set)h(of)f(w)o(ords)g(em)o(b)q(edded)h(in)f
(the)h(program)1114 694 y(string)14 b(follo)o(wing)d(the)j(\\trap")g
(instruction;)1010 771 y Fi(\(c\))20 b Fn(as)d(a)g(set)h(of)e(w)o(ords)i(in)e
(the)i(program's)e(data)g(area.)1114 821 y(\(This)e(is)f(the)i(\\indirect")f
(call.\))1072 897 y(Indirect)20 b(calls)e(ha)o(v)o(e)h(a)f(higher)h(o)o(v)o
(erhead)g(than)g(di-)1010 946 y(rect)h(system)e(calls.)31 b(Indirect)20
b(calls)e(are)h(needed)h(when)1010 996 y(the)c(parameters)f(are)h(data)f(dep)
q(enden)o(t)j(and)d(cannot)g(b)q(e)1010 1046 y(determined)f(at)f(compile)g
(time.)1072 1096 y(Indirect)f(calls)f(ma)o(y)e(sometimes)h(b)q(e)i(a)o(v)o
(oided)e(if)h(there)1010 1146 y(is)22 b(only)f(one)i(data)f(dep)q(enden)o(t)i
(parameter,)f(whic)o(h)f(is)1010 1195 y(passed)12 b(via)e(r0.)17
b(In)11 b(c)o(ho)q(osing)g(whic)o(h)g(parameters)g(should)1010
1245 y(b)q(e)g(passed)h(via)d(r0,)i(the)g(system)f(designers)i(ha)o(v)o(e)e
(presum-)1010 1295 y(ably)h(b)q(een)h(guided)f(b)o(y)h(their)f(o)o(wn)h(exp)q
(erience,)h(since)f(the)1010 1345 y(pattern)21 b(do)q(esn't)g(satisfy)g(the)g
(la)o(w)e(of)h(least)h(astonish-)1010 1395 y(men)o(t.)1072
1444 y(The)d(\\C")e(compiler)g(do)q(es)i(not)f(giv)o(e)g(sp)q(ecial)h(recog-)
1010 1494 y(nition)25 b(to)h(system)h(calls,)h(but)f(treats)g(them)f(in)f
(the)1010 1544 y(same)18 b(w)o(a)o(y)g(as)h(other)g(pro)q(cedures.)36
b(When)19 b(the)g(loader)1010 1594 y(comes)c(to)g(resolv)o(e)h(undetermined)g
(references,)i(it)d(satis-)1010 1644 y(\014es)k(these)h(with)e(library)f
(routines)i(whic)o(h)g(con)o(tain)e(the)1010 1694 y(actual)c(\\trap")h
(instructions.)1010 1769 y Fi(2752:)20 b Fn(The)15 b(error)f(indicators)g
(are)h(reset;)1010 1846 y Fi(2754:)20 b Fn(The)12 b(user)h(mo)q(de)d
(instruction)i(whic)o(h)g(caused)g(the)1114 1896 y(trap)j(is)g(retriev)o(ed)h
(and)f(all)f(but)h(the)h(least)f(signi\014-)1114 1946 y(can)o(t)10
b(six)f(bits)h(are)g(mask)o(ed)f(o\013.)17 b(The)10 b(result)g(is)g(used)1114
1996 y(to)g(select)h(an)f(en)o(try)h(from)d(the)j(arra)o(y)f(of)f
(structures,)1114 2045 y(\\sysen)o(t".)18 b(The)13 b(address)h(of)e(the)h
(selected)h(en)o(try)f(is)1114 2095 y(stored)h(in)g(\\callp";)1010
2172 y Fi(2755:)20 b Fn(The)d(\\zero)q(eth")g(system)e(call)g(is)h(the)g
(\\indirect")1114 2222 y(system)d(call,)f(in)g(whic)o(h)h(the)h(parameter)f
(passed)h(is)1114 2272 y(actually)c(the)j(address)g(in)e(the)h(user)h
(program)d(data)1114 2321 y(space)15 b(of)e(a)g(system)h(call)f(parameter)h
(sequence.)1072 2397 y(Note)21 b(the)g(separate)h(uses)g(of)d(\\fu)o(w)o
(ord")h(and)g(\\fui-)1010 2447 y(w)o(ord".)j(The)16 b(distinction)g(b)q(et)o
(w)o(een)h(these)g(is)f(unimp)q(or-)1010 2497 y(tan)o(t)h(on)g(the)g
(PDP11/40,)g(but)g(is)g(most)f(imp)q(ortan)o(t)f(on)1010 2547
y(mac)o(hines)c(with)g(separate)i(\\i")d(and)i(\\d")f(address)i(spaces;)1010
2622 y Fi(2760:)20 b Fn(\\i=077")g(sim)o(ulates)g(a)i(call)e(on)h(the)i(v)o
(ery)e(last)1114 2672 y(system)14 b(call)h(\(2975\),)f(whic)o(h)h(results)h
(in)e(a)h(call)f(on)1114 2722 y(\\nosys")e(\(2855\),)f(whic)o(h)h(results)h
(in)f(an)g(error)h(con-)1114 2772 y(dition)f(whic)o(h)i(will)e(usually)g(b)q
(e)i(fatal)f(for)g(the)h(user)1114 2822 y(mo)q(de)e(program;)1890
2946 y(51)p eop
%%Page: 52 60
59 bop -30 -144 a Fk(12)43 b(TRAPS)16 b(AND)e(SYSTEM)i(CALLS)711
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(2762:)-30
101 y(2765:)21 b Fn(The)c(n)o(um)o(b)q(er)f(of)g(argumen)o(ts)g(sp)q
(eci\014ed)j(in)d(\\sy-)74 150 y(sen)o(t")k(is)e(the)i(actual)e(n)o(um)o(b)q
(er)h(pro)o(vided)f(b)o(y)h(the)74 200 y(user)k(programmer,)f(or)g(that)g(n)o
(um)o(b)q(er)g(less)g(one)74 250 y(if)e(one)g(argumen)o(t)f(is)i(transferred)
h(via)d(r0.)37 b(The)74 300 y(argumen)o(ts)26 b(are)i(copied)f(from)e(the)j
(user)g(data)74 350 y(or)18 b(instruction)h(area)f(in)o(to)g(the)h(\014v)o(e)
f(elemen)o(t)g(ar-)74 399 y(ra)o(y)f(\\u.u)p 230 399 13 2 v
14 w(arg".)27 b(\(F)m(rom)15 b(\\sysen)o(t")i(\(Sheet)i(29\))d(it)74
449 y(w)o(ould)21 b(seem)g(that)h(four)f(elemen)o(ts)g(w)o(ould)g(ha)o(v)o(e)
74 499 y(b)q(een)c(su\016cien)o(t)f(for)f(\\u)p 461 499 V 15
w(area[)g(]")f({)i(is)f(this)g(an)h(al-)74 549 y(lo)o(w)o(ance)e(for)f
(future)i(in\015ation?\);)-30 633 y Fi(2770:)21 b Fn(The)10
b(v)n(alue)f(of)h(the)g(\014rst)h(argumen)o(t)e(is)g(copied)h(in)o(to)74
683 y(\\u.u)p 155 683 V 15 w(dirp",)g(whic)o(h)g(seems)h(to)f(function)g
(mainly)e(as)74 732 y(a)14 b(con)o(v)o(enien)o(t)g(temp)q(orary)f(storage)i
(lo)q(cation;)-30 816 y Fi(2771:)21 b Fn(\\trapl")13 b(is)h(called)g(with)f
(the)i(address)g(of)f(the)g(de-)74 866 y(sired)j(system)e(routine.)23
b(Note)17 b(the)f(commen)o(t)d(b)q(e-)74 916 y(ginning)g(on)g(line)h(2828;)
-30 1000 y Fi(2776:)21 b Fn(When)12 b(an)g(error)h(o)q(ccurs,)h(the)e
(\\c-bit")g(in)g(the)g(old)74 1050 y(pro)q(cessor)22 b(status)f(w)o(ord)f(is)
g(set)h(\(see)g(line)f(2658\))74 1099 y(and)14 b(the)g(error)h(n)o(um)o(b)q
(er)e(is)h(returned)i(via)d(r0.)-30 1217 y Fg(12.5)56 b(System)17
b(Call)h(Handlers)-30 1294 y Fn(The)d(full)d(set)j(of)e(system)g(calls)g(ma)o
(y)f(b)q(e)i(review)o(ed)h(in)e(the)-30 1344 y(\014le)22 b(\\sysen)o(t.c")g
(on)g(Sheet)g(29,)h(but)f(more)e(relev)n(an)o(tly)m(,)-30 1393
y(these)i(are)f(discussed)h(in)d(full)g(detail)h(in)f(Section)i(I)q(I)f(of)
-30 1443 y(the)15 b(UPM.)33 1493 y(The)j(pro)q(cedures)i(whic)o(h)e(handle)g
(the)g(system)g(calls)-30 1543 y(are)28 b(found)f(mostly)e(in)i(the)h
(\014les)f(\\sysl.c",)j(sys2.c\\,)-30 1593 y(sys3.c")14 b(and)g(\\sys4.c".)33
1643 y(Tw)o(o)k(imp)q(ortan)o(t)f(\\trivial")f(pro)q(cedures)21
b(are)e(\\n)o(ull-)-30 1693 y(sys")c(\(2855\))e(and)h(\\nosys")f(\(2864\))h
(whic)o(h)f(are)i(found)e(in)-30 1743 y(the)i(\014le)f(\\trap.c".)-30
1860 y Fg(12.6)56 b(The)18 b(File)g(`sysl.c')-30 1937 y Fn(This)k(\014le)f
(con)o(tains)h(the)g(pro)q(cedures)h(for)e(\014v)o(e)h(system)-30
1987 y(calls,)e(of)e(whic)o(h)h(three)h(will)d(b)q(e)i(considered)i(no)o(w,)e
(and)-30 2037 y(t)o(w)o(o)i(\(\\rexit")f(and)h(\\w)o(ait"\))e(will)g(b)q(e)i
(deferred)i(to)d(the)-30 2086 y(next)15 b(c)o(hapter.)33 2136
y(The)d(\014rst)g(pro)q(cedure)i(in)d(this)h(\014le,)f(and)h(also)f(the)h
(\014rst)-30 2186 y(system)i(call)f(w)o(e)h(ha)o(v)o(e)g(encoun)o(tered,)h
(is)f(\\exec".)-30 2304 y Fg(12.7)56 b(exec)17 b(\(3020\))-30
2381 y Fn(This)i(system)g(call,)f(#11,)h(c)o(hanges)g(a)g(pro)q(cess)h
(execut-)-30 2431 y(ing)c(one)g(program)f(in)o(to)h(a)f(pro)q(cess)j
(executing)f(a)f(di\013er-)-30 2480 y(en)o(t)c(program.)k(See)d(Section)f
(\\EXEC\(I)q(I\)")g(of)f(the)h(UPM.)-30 2530 y(This)k(is)f(the)h(longest)f
(and)g(one)h(of)e(the)i(most)e(imp)q(ortan)o(t)-30 2580 y(system)g(calls.)-30
2672 y Fi(3034:)21 b Fn(\\namei")d(\(6618\))h(\(whic)o(h)i(is)f(discussed)i
(in)d(de-)74 2722 y(tail)h(in)g(Chapter)h(19\))g(con)o(v)o(erts)g(the)h
(\014rst)f(argu-)74 2772 y(men)o(t)12 b(\(whic)o(h)g(is)g(a)g(p)q(oin)o(ter)h
(to)f(a)g(c)o(haracter)i(string)74 2822 y(de\014ning)j(the)h(name)e(of)g(the)
h(new)h(program\))d(in)o(to)1114 17 y(an)g(\\ino)q(de")f(reference.)25
b(\(\\ino)q(des")15 b(are)h(essen)o(tial)1114 66 y(parts)e(of)f(the)i(\014le)
f(referencing)h(mec)o(hanism.\);)1010 149 y Fi(3037:)20 b Fn(W)m(ait)12
b(if)h(the)g(n)o(um)o(b)q(er)g(of)g(\\exec"s)h(curren)o(tly)g(un-)1114
199 y(der)e(w)o(a)o(y)g(is)g(to)q(o)f(large)h(\(See)h(the)g(commen)o(t)d(on)i
(line)1114 249 y(3011.\);)1010 332 y Fi(3040:)20 b Fn(\\getblk\(NODEV\)")d
(results)g(in)f(the)h(allo)q(cation)1114 382 y(of)d(a)g(512)g(b)o(yte)h
(bu\013er)g(from)e(the)i(p)q(o)q(ol)f(of)g(bu\013ers.)1114
432 y(This)21 b(bu\013er)i(is)e(used)i(temp)q(orarily)d(to)h(store)i(in)1114
481 y(core,)d(that)f(information)d(whic)o(h)i(is)h(curren)o(tly)h(in)1114
531 y(the)g(user)g(data)f(area,)i(and)e(whic)o(h)g(is)g(needed)i(to)1114
581 y(start)14 b(the)g(new)f(program.)k(Note)d(that)f(the)h(second)1114
631 y(argumen)o(t)e(in)h(\\u.u)p 1428 631 V 15 w(arg")g(is)g(a)h(p)q(oin)o
(ter)f(to)h(this)g(in-)1114 681 y(formation;)1010 764 y Fi(3041:)20
b Fn(\\access")c(returns)g(a)e(non-zero)h(result)g(if)e(the)i(\014le)1114
813 y(is)i(not)g(executable.)29 b(The)17 b(second)h(condition)f(ex-)1114
863 y(amines)i(whether)k(the)e(\014le)g(is)g(a)g(directory)g(or)g(a)1114
913 y(sp)q(ecial)14 b(c)o(haracter)h(\014le.)j(\(It)c(w)o(ould)g(seem)f(that)
h(b)o(y)1114 963 y(making)i(this)j(test)h(earlier,)f(e.g.)33
b(just)19 b(after)g(line)1114 1013 y(3036,)c(the)h(e\016ciency)h(of)e(the)i
(co)q(de)g(could)f(b)q(e)g(im-)1114 1062 y(pro)o(v)o(ed.\);)1010
1145 y Fi(3052:)k Fn(Cop)o(y)h(the)i(set)f(of)f(argumen)o(ts)g(from)f(the)i
(user)1114 1195 y(space)15 b(in)o(to)e(the)h(temp)q(orary)f(bu\013er;)1010
1278 y Fi(3064:)20 b Fn(If)c(the)h(argumen)o(t)e(string)h(is)g(to)q(o)g
(large)g(to)g(\014t)h(in)1114 1328 y(the)d(bu\013er,)h(tak)o(e)e(an)h(error)h
(exit;)1010 1411 y Fi(3071:)20 b Fn(If)13 b(the)g(n)o(um)o(b)q(er)f(of)g(c)o
(haracters)i(in)e(the)h(argumen)o(t)1114 1461 y(string)h(is)f(o)q(dd,)h(add)f
(an)h(extra,)g(n)o(ull)f(c)o(haracter;)1010 1544 y Fi(3090:)20
b Fn(The)15 b(\014rst)g(four)e(w)o(ords)h(\(8)g(b)o(ytes\))h(of)f(the)g
(named)1114 1593 y(\014le)j(are)g(read)g(in)o(to)g(\\u.u)p
1520 1593 V 14 w(arg".)27 b(The)17 b(in)o(terpreta-)1114 1643
y(tion)g(of)g(these)i(w)o(ords)f(is)f(indicated)h(in)f(the)h(com-)1114
1693 y(men)o(t)13 b(b)q(eginning)h(on)g(line)g(3076)g(and,)g(more)f(fully)m
(,)1114 1743 y(in)g(the)i(section)f(\\A.OUT\(V\)")g(of)f(the)i(UPM.)1114
1809 y(Note)i(the)h(setting)g(of)f(\\u.u)p 1564 1809 V 14 w(base",)h(\\u.u)p
1786 1809 V 14 w(coun)o(t",)1114 1859 y(\\u.u)p 1195 1859 V
14 w(o\013set")i(and)f(\\u.u)p 1510 1859 V 14 w(seg\015g")g(preparatory)h(to)
1114 1909 y(the)14 b(read)g(op)q(eration;)1010 1992 y Fi(3095:)20
b Fn(If)d(the)h(text)g(segmen)o(t)f(is)g(not)g(to)g(b)q(e)h(protected,)1114
2042 y(add)e(the)i(text)f(area)g(size)h(to)f(the)g(data)g(area)g(size,)1114
2091 y(and)c(set)i(the)g(former)d(to)i(zero;)1010 2174 y Fi(3105:)20
b Fn(Chec)o(k)h(whether)h(the)f(program)e(has)i(a)f(\\pure")1114
2224 y(text)g(area,)h(but)f(the)g(program)e(\014le)i(has)f(already)1114
2274 y(b)q(een)11 b(op)q(ened)h(b)o(y)f(some)f(other)h(program)e(as)i(a)f
(data)1114 2324 y(\014le.)18 b(If)13 b(so,)h(tak)o(e)g(the)g(error)h(exit;)
1010 2407 y Fi(3127:)20 b Fn(When)c(this)g(p)q(oin)o(t)e(is)i(reac)o(hed,)g
(the)h(decision)e(to)1114 2456 y(execute)22 b(the)f(new)g(program)e(is)h
(irrev)o(o)q(cable)h(i.e.)1114 2506 y(there)d(is)f(no)g(longer)g(the)g(opp)q
(ortunit)o(y)g(to)g(return)1114 2556 y(to)11 b(the)i(original)d(program)g
(with)i(an)f(error)i(\015ag)f(set;)1010 2639 y Fi(3129:)20
b Fn(\\expand")12 b(here)g(actually)f(implies)e(a)i(ma)r(jor)f(con-)1114
2689 y(traction,)i(to)h(the)h(\\p)q(er)g(pro)q(cess)h(data")d(area)h(only;)
1010 2772 y Fi(3130:)20 b Fn(\\xallo)q(c")f(tak)o(es)h(care)h(of)e(allo)q
(cating)f(\(if)h(neces-)1114 2822 y(sary\))14 b(and)g(linking)e(to)i(the)g
(text)h(area;)-30 2946 y(52)p eop
%%Page: 53 61
60 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)711
b(12)43 b(TRAPS)15 b(AND)g(SYSTEM)g(CALLS)-30 17 y Fi(3158:)21
b Fn(The)14 b(information)d(stored)k(in)e(the)i(bu\013er)g(area)f(is)74
66 y(copied)g(in)o(to)g(the)g(stac)o(k)h(in)e(the)i(user)g(data)e(area)h(of)
74 116 y(the)h(new)f(program;)-30 197 y Fi(3186:)21 b Fn(The)13
b(lo)q(cations)e(in)h(the)h(k)o(ernel)g(stac)o(k)f(whic)o(h)h(con-)74
247 y(tain)d(copies)h(of)f(the)h(\\previous")f(v)n(alues)h(of)e(the)i(reg-)74
297 y(isters)k(in)e(user)h(mo)q(de)f(are)h(set)g(to)f(zero,)h(except)h(for)74
347 y(r6,)20 b(the)g(stac)o(k)f(p)q(oin)o(ter,)h(whic)o(h)f(w)o(as)g(set)h
(at)f(line)74 397 y(3155;)-30 478 y Fi(3194:)i Fn(Decremen)o(t)c(the)h
(reference)i(coun)o(t)d(for)g(the)h(\\in-)74 527 y(o)q(de")c(structure;)-30
608 y Fi(3195:)21 b Fn(Release)14 b(the)h(temp)q(orary)e(bu\013er;)-30
689 y Fi(3196:)21 b Fn(W)m(ak)o(e)c(up)g(an)o(y)g(other)h(pro)q(cess)i(w)o
(aiting)c(at)h(line)74 739 y(3037.)-30 855 y Fg(12.8)56 b(fork)18
b(\(3322\))-30 931 y Fn(A)h(call)f(on)h(\\exec")h(is)e(frequen)o(tly)h
(preceded)i(b)o(y)e(a)f(call)-30 981 y(on)e(\\fork".)22 b(Most)16
b(of)f(the)h(w)o(ork)f(for)g(\\fork")g(is)g(done)h(b)o(y)-30
1031 y(\\newpro)q(c")j(\(1826\),)f(but)h(b)q(efore)g(the)g(latter)f(is)g
(called,)-30 1081 y(\\fork")g(mak)o(es)g(an)h(indep)q(enden)o(t)h(searc)o(h)g
(for)e(a)h(slot)f(in)-30 1131 y(the)c(\\pro)q(c")f(arra)o(y)m(,)f(and)h
(remem)o(b)q(ers)g(the)g(place)g(as)g(\\p2")-30 1180 y(\(3327\).)33
1230 y(\\newpro)q(c")23 b(also)e(searc)o(hes)j(\\pro)q(c")f(but)f(indep)q
(en-)-30 1280 y(den)o(tly)m(.)48 b(Presumably)23 b(it)h(alw)o(a)o(ys)f(lo)q
(cates)h(the)h(same)-30 1330 y(empt)o(y)17 b(slot)g(as)g(\\fork",)g(since)h
(it)f(do)q(es)h(not)g(rep)q(ort)g(the)-30 1380 y(v)n(alue)j(bac)o(k.)39
b(\(Wh)o(y)20 b(is)h(there)i(no)d(confusion)h(on)g(this)-30
1429 y(p)q(oin)o(t?\))-30 1516 y Fi(3335:)g Fn(F)m(or)9 b(the)h(new)g(pro)q
(cess,)h(\\fork")e(returns)h(the)g(v)n(alue)74 1566 y(of)i(the)i(paren)o(t's)
f(pro)q(cess)h(iden)o(ti\014cation,)e(and)h(ini-)74 1615 y(tialises)h(v)n
(arious)f(accoun)o(ting)h(parameters;)-30 1696 y Fi(3344:)21
b Fn(F)m(or)d(the)i(paren)o(t)f(pro)q(cess,)j(\\fork")c(returns)i(the)74
1746 y(v)n(alue)12 b(of)f(the)i(c)o(hild's)f(pro)q(cess)h(iden)o
(ti\014cation,)f(and)74 1796 y Fi(skips)g Fn(the)i(user)g(mo)q(de)e(program)f
(coun)o(ter)k(b)o(y)d(one)74 1846 y(w)o(ord.)-30 1932 y(Note)i(that)g(the)g
(v)n(alues)g(\014nally)e(returned)j(to)f(a)f(\\C")g(pro-)-30
1982 y(gram)e(are)h(sligh)o(tly)f(di\013eren)o(t)i(from)d(the)i(ab)q(o)o(v)o
(e.)18 b(Refer)12 b(to)-30 2032 y(the)j(section)g(F)o(ORK\(I)q(I\))f(of)f
(the)i(UPM.)-30 2147 y Fg(12.9)56 b(sbreak)18 b(\(3354\))-30
2224 y Fn(This)d(pro)q(cedure)i(implem)o(en)o(ts)c(system)h(call)g(#17)g
(whic)o(h)-30 2274 y(is)19 b(describ)q(ed)i(in)e(the)h(Section)f(\\BREAK)g
(\(I)q(I\)")h(of)e(the)-30 2323 y(UPM.)e(The)g(commen)o(t)e(at)i(the)g(head)g
(of)f(the)i(pro)q(cedure)-30 2373 y(has)23 b(confused)g(more)e(than)i(one)f
(reader:)36 b(clearly)22 b(the)-30 2423 y(iden)o(ti\014er)d(\\break")g(is)g
(used)g(in)f(\\C")g(programs)g(\(lea)o(v)o(e)-30 2473 y(an)d(enclosing)g
(program)e(lo)q(op\))h(in)g(an)h(en)o(tirely)g(di\013eren)o(t)-30
2523 y(w)o(a)o(y)d(from)e(that)h(in)o(tended)i(here)g(\(c)o(hange)f(the)g
(size)h(of)e(the)-30 2573 y(program)i(data)g(area\).)33 2622
y(\\sbreak")18 b(has)g(clear)h(similarities)c(with)j(the)h(pro)q(ce-)-30
2672 y(dure)c(\\gro)o(w")e(\(4136\))g(but)i(unlik)o(e)e(the)h(latter,)g(it)g
(is)f(only)-30 2722 y(in)o(v)o(ok)o(ed)g(explicitly)g(and)g(ma)o(y)f(in)h
(fact)g(cause)i(a)e(con)o(trac-)-30 2772 y(tion)j(of)g(the)h(data)f(area)g
(as)h(w)o(ell)e(as)i(an)f(expansion)g(\(de-)-30 2822 y(p)q(ending)e(on)g(the)
h(new)f(desired)h(size\).)1010 17 y Fi(3364:)20 b Fn(Calculate)14
b(the)h(new)f(size)h(for)f(the)g(data)g(area)g(\(in)1114 66
y(32)f(w)o(ord)h(blo)q(c)o(ks\);)1010 149 y Fi(3371:)20 b Fn(Chec)o(k)f(that)
e(the)i(new)f(size)g(is)g(consisten)o(t)g(with)1114 199 y(the)c(memory)e
(segmen)o(tation)g(constrain)o(ts;)1010 282 y Fi(3376:)20 b
Fn(The)c(area)g(is)f(shrinking.)23 b(Cop)o(y)15 b(the)h(stac)o(k)g(area)1114
332 y(do)o(wn)j(in)o(to)h(the)h(former)e(data)g(area.)37 b(Call)19
b(\\ex-)1114 382 y(pand")13 b(to)h(trim)e(o\013)i(the)h(excess;)1010
465 y Fi(3386:)20 b Fn(Call)i(\\expand")g(to)g(increase)i(the)f(total)f
(area.)1114 515 y(Cop)o(y)10 b(the)h(stac)o(k)g(area)g(up)g(in)o(to)f(the)h
(new)g(part,)g(and)1114 565 y(clear)j(the)h(areas)g(whic)o(h)f(w)o(ere)h
(formerly)d(o)q(ccupied)1114 614 y(b)o(y)h(the)i(stac)o(k.)1072
706 y(The)21 b(follo)o(wing)e(pro)q(cedures)k(whic)o(h)e(are)g(also)f(con-)
1010 756 y(tained)14 b(in)f(\\sysl.c")h(are)g(describ)q(ed)i(in)d(Chapter)i
(13:)1053 847 y Ff(rexit)21 b(\(3205\))108 b(wait)21 b(\(3270\))1053
897 y(exit)43 b(\(3219\))1010 1013 y Fg(12.10)56 b(The)18 b(Files)g(`sys2.c')
f(and)i(`sys3.c')1010 1090 y Fn(\\sys2.c")h(and)g(\\sys3.c")g(are)h(mainly)c
(concerned)22 b(with)1010 1139 y(the)e(\014le)g(system)g(and)f(input/output,)
i(and)f(they)g(ha)o(v)o(e)1010 1189 y(b)q(een)12 b(relegated)g(to)f(Section)h
(F)m(our)f(of)g(the)g(op)q(erating)h(sys-)1010 1239 y(tem)h(source)i(co)q
(de.)1010 1355 y Fg(12.11)56 b(The)18 b(File)f(`sys4.c')1010
1432 y Fn(All)j(the)h(pro)q(cedures)i(in)e(this)f(\014le)h(implemen)o(t)d
(system)1010 1482 y(calls.)38 b(The)21 b(follo)o(wing)e(pro)q(cedures)k(are)e
(describ)q(ed)i(in)1010 1531 y(Chapter)14 b(13:)1097 1623 y
Ff(ssig)21 b(\(3614\))108 b(kill)21 b(\(3630\))1072 1714 y
Fn(The)k(follo)o(wing)c(pro)q(cedures)27 b(are)e(straigh)o(tforw)o(ard)1010
1764 y(and)20 b(ha)o(v)o(e)g(b)q(een)i(left)e(for)g(the)h(am)o(usemen)o(t)d
(and)i(edi\014-)1010 1814 y(cation)13 b(of)h(the)g(reader:)1097
1905 y Ff(getswit)20 b(\(3413\))h(sync)g(\(3486\))1097 1955
y(gtime)g(\(3420\))64 b(getgid)20 b(\(3472\))1097 2005 y(stime)h(\(3428\))64
b(getpid)20 b(\(3480\))1097 2054 y(setuid)h(\(3439\))42 b(nice)21
b(\(3493\))1097 2104 y(getuid)g(\(3452\))42 b(times)21 b(\(3656\))1097
2154 y(setgid)g(\(3460\))42 b(profil)20 b(\(3667\))1072 2245
y Fn(The)f(follo)o(wing)c(pro)q(cedures)21 b(whic)o(h)d(are)g(concerned)1010
2295 y(with)13 b(\014le)h(systems,)g(are)g(describ)q(ed)i(later:)1097
2387 y Ff(unlink)21 b(\(3510\))64 b(chown)20 b(\(3575\))1097
2436 y(chdir)h(\(3538\))86 b(smdate)20 b(\(3595\))1097 2486
y(chmod)h(\(3560\))1890 2946 y Fn(53)p eop
%%Page: 54 62
61 bop -30 -144 a Fk(13)43 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)769
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(13)70 b(Soft)n(w)n(are)23
b(In)n(terrupts)-30 112 y Fn(The)13 b(principal)e(concern)j(of)e(this)g(c)o
(hapter)h(is)f(the)h(con)o(ten)o(t)-30 162 y(of)18 b(the)h(\014le)f
(\\sig.c",)f(whic)o(h)h(app)q(ears)h(on)f(Sheets)h(39)f(to)-30
212 y(42.)29 b(This)18 b(\014le)f(in)o(tro)q(duces)i(a)f(facilit)o(y)e(for)h
(comm)o(unica-)-30 262 y(tion)i(b)q(et)o(w)o(een)i(pro)q(cesses.)38
b(In)19 b(particular)g(it)g(pro)o(vides)-30 312 y(for)h(the)h(course)g(of)f
(one)g(\\user)h(mo)q(de")e(pro)q(cess)j(to)e(b)q(e)-30 361
y(in)o(terrupted,)h(div)o(erted)d(or)h(terminated)e(b)o(y)h(the)h(action)-30
411 y(of)f(another)h(pro)q(cess)h(or)e(as)h(the)g(result)g(of)e(an)h(error)i
(or)-30 461 y(op)q(erator)15 b(action.)33 513 y(In)e(this)f(discussion)i(the)
f(term)g(\\soft)o(w)o(are)f(in)o(terrupt")-30 563 y(has)f(b)q(een)h(delib)q
(erately)f(used)h(in)f(place)g(of)f(the)h(term)f(\\sig-)-30
613 y(nal".)18 b(This)c(latter)h(has)f(b)q(een)h(esc)o(hew)o(ed)h(b)q(ecause)
g(it)e(has)-30 663 y(obtained)20 b(connotations)f(in)g(the)i(UNIX)f(milieu)d
(whic)o(h)-30 713 y(are)e(rather)g(di\013eren)o(t)g(from)d(the)i(usage)h(of)e
(ordinary)h(En-)-30 762 y(glish.)33 815 y(UNIX)h(recognises)g(20)f
(\(\\NSIG",)g(line)g(0113\))f(di\013er-)-30 865 y(en)o(t)19
b(t)o(yp)q(es)g(of)f(soft)o(w)o(are)g(in)o(terrupts,)i(of)e(whic)o(h)g(\(as)g
(the)-30 914 y(reader)i(ma)o(y)c(disco)o(v)o(er)i(for)g(himself)e(b)o(y)i(p)q
(erusal)h(of)e(the)-30 964 y(the)h(Section)g(\\SIGNAL)f(\(I)q(I\)")g(of)g
(the)h(UPM\))g(thirteen)-30 1014 y(ha)o(v)o(e)h(standard)g(names)f(and)h
(asso)q(ciations.)32 b(In)o(terrupt)-30 1064 y(t)o(yp)q(e)15
b(#0)e(is)h(in)o(terpreted)h(as)f(\\no)g(in)o(terrupt".)33
1116 y(Within)d(the)i(\\p)q(er)g(pro)q(cess)h(data)e(area")g(of)g(eac)o(h)h
(pro-)-30 1166 y(cess)24 b(is)d(an)g(arra)o(y)m(,)h(\\u.u)p
383 1166 13 2 v 15 w(signal",)f(of)g(\\NSIG")g(w)o(ords.)-30
1216 y(Eac)o(h)e(w)o(ord)e(corresp)q(onds)j(to)d(a)h(di\013eren)o(t)h(soft)o
(w)o(are)e(in-)-30 1266 y(terrupt)k(t)o(yp)q(e)e(and)g(de\014nes)h(the)g
(action)e(whic)o(h)h(should)-30 1315 y(b)q(e)13 b(tak)o(en)f(if)e(the)j(pro)q
(cess)g(encoun)o(ters)h(that)e(kind)f(of)g(soft-)-30 1365 y(w)o(are)k(in)o
(terrupt:)-5 1508 y(u)p 20 1508 V 15 w(signal[n])109 b(when)15
b(in)o(terrupt)f(#n)g(o)q(ccurs)p -30 1525 976 2 v -5 1560
a(zero)226 b(the)15 b(pro)q(cess)h(will)c(terminate)h(itself;)-5
1659 y(o)q(dd)h(non-zero)63 b(the)15 b(soft)o(w)o(are)f(in)o(terrupt)g(is)g
(ignored;)-5 1759 y(ev)o(en)h(non-zero)50 b(the)15 b(v)n(alue)e(is)h(tak)o
(en)g(as)g(the)g(address)294 1809 y(in)g(user)h(space)g(of)e(a)h(pro)q
(cedure)h(whic)o(h)294 1859 y(whic)o(h)f(should)g(b)q(e)g(executed)294
1908 y(forth)o(with.)33 2010 y(In)o(terrupt)24 b(t)o(yp)q(e)f(#9)f
(\(\\SIGKILL"\))g(is)h(esp)q(ecially)-30 2060 y(distinguished)10
b(b)q(ecause)h(UNIX)e(ensures)j(that)d(\\u.u)p 792 2060 13
2 v 14 w(signal[9]")-30 2110 y(remains)17 b(zero)h(un)o(til)e(the)i(v)o(ery)g
(end)g(of)e(a)h(pro)q(cess's)j(ex-)-30 2160 y(istence,)e(so)e(that)f(if)g(a)h
(pro)q(cess)i(is)d(ev)o(er)i(in)o(terrupted)g(for)-30 2210
y(that)d(reason,)g(it)g(will)e(alw)o(a)o(ys)h(terminate)g(itself.)-30
2339 y Fg(13.1)56 b(An)n(ticipation)-30 2421 y Fn(Eac)o(h)15
b(pro)q(cess)g(can)f(set)h(the)g(con)o(ten)o(ts)g(of)e(the)i(arra)o(y)-30
2470 y(\\u.u)p 51 2470 V 15 w(signal[)8 b(]")h(\(with)h(the)g(exception)h(of)
e(\\u.u)p 711 2470 V 14 w(signal[9]")-30 2520 y(as)19 b(just)f(noted\))g(in)g
(an)o(ticipation)f(of)g(future)i(in)o(terrupts)-30 2570 y(so)e(that)g(the)h
(appropriate)f(action)f(is)h(tak)o(en.)27 b(The)18 b(user)-30
2620 y(programmer)c(do)q(es)i(this)g(via)f(the)h(\\signal")e(system)h(call)
-30 2670 y(\(see)h(\\SIGNAL)d(\(I)q(I\)")h(of)f(the)i(UPM\).)33
2722 y(Th)o(us)h(if)g(for)f(example)g(the)i(programmer)d(wishes)j(to)-30
2772 y(ignore)c(soft)o(w)o(are)g(in)o(terrupts)i(of)d(t)o(yp)q(e)i(#2)e
(\(whic)o(h)h(result)-30 2822 y(if)e(the)h(user)h(hits)f(the)g(\\delete")g(k)
o(ey)f(on)h(his)f(terminal\),)f(he)1010 17 y(should)17 b(set)g(\\u.u)p
1293 17 V 15 w(signal[2]")d(to)j(one)g(b)o(y)g(executing)g(the)1010
66 y(system)d(call)1342 159 y(\\signal)f(\(2,1\);")1010 251
y(from)f(his)i(\\C")f(program.)1010 368 y Fg(13.2)56 b(Causation)1010
445 y Fn(An)18 b(in)o(terrupt)h(is)f(\\caused")h(for)f(a)g(pro)q(cess)i
(quite)f(sim-)1010 495 y(ply)g(b)o(y)h(setting)g(the)g(v)n(alue)g(of)f(\\p)p
1582 495 V 15 w(sig")g(\(0363\))g(in)g(the)1010 545 y(pro)q(cess's)e(\\pro)q
(c")f(en)o(try)m(,)g(to)f(the)h(t)o(yp)q(e)g(n)o(um)o(b)q(er)f(appro-)1010
595 y(priate)g(to)h(the)g(in)o(terrupt)g(\(i.e.)23 b(a)15 b(v)n(alue)g(in)g
(the)h(range)f(1)1010 644 y(to)f(\\NSIG"{1\).)1072 694 y(\\p)p
1118 694 V 15 w(sig")g(is)g(alw)o(a)o(ys)f(directly)i(accessible,)g(ev)o(en)h
(when)1010 744 y(the)c(a\013ected)i(pro)q(cess)f(and)f(its)g(\\p)q(er)g(pro)q
(cess)i(data)d(area")1010 794 y(ha)o(v)o(e)21 b(b)q(een)i(sw)o(app)q(ed)f
(out)g(to)f(disk.)41 b(Ob)o(viously)21 b(this)1010 844 y(mec)o(hanism)c(only)
j(allo)o(ws)e(one)j(in)o(terrupt)f(p)q(er)h(pro)q(cess)1010
894 y(to)15 b(b)q(e)g(outstanding)g(at)g(an)o(y)f(one)h(time.)20
b(The)c(outstand-)1010 943 y(ing)i(in)o(terrupt)h(will)e(alw)o(a)o(ys)h(b)q
(e)h(the)g(most)e(recen)o(t)j(one,)1010 993 y(unless)15 b(one)g(of)e(the)i
(in)o(terrupts)h(w)o(as)e(of)g(t)o(yp)q(e)h(#9,)e(whic)o(h)1010
1043 y(alw)o(a)o(ys)g(prev)n(ails.)1010 1160 y Fg(13.3)56 b(E\013ect)1010
1237 y Fn(The)14 b(e\013ect)h(of)d(a)h(soft)o(w)o(are)h(in)o(terrupt)g(nev)o
(er)g(tak)o(es)g(place)1010 1287 y(immedia)o(tely)m(.)26 b(It)18
b(ma)o(y)e(o)q(ccur)i(after)g(only)f(some)g(sligh)o(t)1010
1337 y(dela)o(y)h(if)g(the)h(a\013ected)h(pro)q(cess)h(is)d(curren)o(tly)i
(running,)1010 1387 y(or)12 b(p)q(ossibly)g(after)g(a)g(considerable)g(dela)o
(y)g(if)f(the)i(a\013ected)1010 1437 y(pro)q(cess)j(is)d(susp)q(ended)j(and)e
(has)g(b)q(een)h(sw)o(app)q(ed)g(out.)1072 1487 y(The)i(action)g(dictated)g
(b)o(y)g(the)h(in)o(terrupt)f(is)g(alw)o(a)o(ys)1010 1536 y(in\015icted)10
b(on)g(the)g(a\013ected)i(pro)q(cess)g(b)o(y)d Fi(itself)p
Fn(,)f(and)i(hence)1010 1586 y(can)k(only)f(o)q(ccur)i(when)f(the)h
(a\013ected)g(pro)q(cess)h(is)e(activ)o(e.)1072 1636 y(Where)21
b(the)g(e\013ect)h(is)f(to)f(execute)i(a)e(user)i(de\014ned)1010
1686 y(pro)q(cedure,)28 b(the)e(k)o(ernel)f(mo)q(de)e(pro)q(cess)k(adjusts)d
(the)1010 1736 y(user)15 b(mo)q(de)f(stac)o(k)g(to)g(mak)o(e)f(it)h(app)q
(ear)h(that)f(the)h(pro)q(ce-)1010 1786 y(dure)c(had)g(b)q(een)g(en)o(tered)h
(and)f(imm)o(ediately)d(in)o(terrupted)1010 1835 y(\(hardw)o(are)15
b(st)o(yle\))g(b)q(efore)g(executing)h(the)f(\014rst)g(instruc-)1010
1885 y(tion.)i(The)c(system)f(then)h(returns)h(from)d(k)o(ernel)i(mo)q(de)e
(to)1010 1935 y(user)18 b(mo)q(de)e(in)h(the)g(usual)g(manner.)27
b(The)17 b(result)h(of)e(all)1010 1985 y(this)h(is)h(that)f(the)h(next)g
(user)h(mo)q(de)d(instruction)i(whic)o(h)1010 2035 y(is)12
b(executed)i(is)f(the)g(\014rst)g(instruction)g(of)e(the)i(designated)1010
2084 y(pro)q(cedure.)1010 2202 y Fg(13.4)56 b(T)-5 b(racing)1010
2279 y Fn(The)10 b(soft)o(w)o(are)h(in)o(terrupt)g(facilit)o(y)d(has)i(b)q
(een)i(extended)f(to)1010 2328 y(pro)o(vide)j(a)h(p)q(o)o(w)o(erful)f(but)h
(somewhat)f(ine\016cien)o(t)h(mec)o(h-)1010 2378 y(anism)g(whereb)o(y)j(a)f
(paren)o(t)h(pro)q(cess)h(ma)o(y)c(monitor)g(the)1010 2428
y(progress)g(of)e(one)h(or)g(more)f(c)o(hild)g(pro)q(cesses.)1010
2545 y Fg(13.5)56 b(Pro)r(cedures)1010 2622 y Fn(Since)14 b(the)g(in)o
(terrelationships)g(of)f(the)h(pro)q(cedures)i(asso-)1010 2672
y(ciated)g(with)f(soft)o(w)o(are)g(in)o(terrupts)i(are)f(somewhat)e(con-)1010
2722 y(fusing)c(at)h(\014rst)h(sigh)o(t,)e(it)h(is)g(w)o(orth)o(while)f(in)o
(tro)q(ducing)g(the)1010 2772 y(pro)q(cedures)j(brie\015y)f(b)q(efore)g
(plunging)e(in)h(with)g(b)q(oth)g(feet)1010 2822 y(....)-30
2946 y(54)p eop
%%Page: 55 63
62 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)769
b(13)42 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)-30 17 y Fg(13.6)56
b(A.)19 b(An)n(ticipation)-30 97 y Fn(\\ssig")j(\(3614\))f(implemen)o(ts)f
(system)h(call)g(#48)g(\(\\sig-)-30 147 y(nal"\))c(to)f(set)i(the)f(v)n(alue)
g(in)f(one)h(elemen)o(t)f(of)h(the)g(arra)o(y)-30 196 y(\\u.u)p
51 196 13 2 v 15 w(signal".)-30 323 y Fg(13.7)56 b(B.)18 b(Causation)-30
403 y Fn(\\kill")d(\(3630\))g(implemen)o(ts)f(system)i(call)g(#37)f(\(kill\))
g(to)-30 453 y(cause)i(a)f(sp)q(eci\014ed)h(in)o(terrupt)f(to)g(a)g(pro)q
(cess)h(de\014ned)g(b)o(y)-30 503 y(its)d(pro)q(cess)i(iden)o(tifying)c(n)o
(um)o(b)q(er.)33 554 y(\\signal")c(\(3949\))h(causes)i(a)f(sp)q(eci\014ed)h
(in)o(terrupt)f(to)g(b)q(e)-30 604 y(caused)16 b(for)e(all)f(pro)q(cesses)k
(con)o(trolled)e(and/or)f(initiated)-30 654 y(from)f(a)g(sp)q(eci\014ed)j
(terminal.)33 706 y(\\psignal")f(\(3963\))i(is)g(called)g(b)o(y)f(\\kill")f
(\(3649\))i(and)-30 756 y(\\signal")8 b(\(3955\))h(\(also)g(\\trap")f
(\(2793,)h(2818\))g(and)g(\\pip)q(e")-30 805 y(\(7828\)\))14
b(to)f(do)h(the)h(actual)e(setting)h(of)g(\\p)p 650 805 V 15
w(sig".)-30 932 y Fg(13.8)56 b(C.)19 b(E\013ect)-30 1012 y
Fn(\\issig")e(\(3991\))f(is)h(called)g(b)o(y)g(\\sleep")h(\()f(2085\),)g
(\\trap")-30 1062 y(\(2821\))12 b(and)g(\\clo)q(c)o(k")f(\(3826\))g(to)h
(enquire)h(whether)g(there)-30 1111 y(is)j(an)f(outstanding)g(non-ignorable)f
(soft)o(w)o(are)h(in)o(terrupt)-30 1161 y(for)f(the)g(activ)o(e)g(pro)q(cess)
i(just)e(w)o(aiting)f(to)g(happ)q(en.)33 1213 y(\\psig")g(\(4043\))g(is)g
(called)h(whenev)o(er)h(\\issig")e(returns)-30 1263 y(a)19
b(non-zero)g(result)h(\(except)g(in)e(\\sleep")h(where)h(things)-30
1313 y(are)15 b(a)e(little)g(more)g(complex\))f(to)i(implemen)o(t)d(the)j
(action)-30 1362 y(triggered)h(b)o(y)f(the)g(in)o(terrupt.)33
1414 y(\\core")f(\(4094\))f(is)h(called)g(b)o(y)g(\\psig")f(if)g(a)h(core)h
(dump)-30 1464 y(is)g(indicated)g(for)g(a)f(terminating)f(pro)q(cess.)33
1516 y(\\gro)o(w")g(\(4136\))g(is)h(called)f(b)o(y)h(\\psig")f(to)h(enlarge)g
(the)-30 1566 y(user)i(mo)q(de)e(stac)o(k)i(area)f(if)f(necessary)m(.)33
1617 y(\\exit")22 b(\(3219\))g(terminates)h(the)h(curren)o(tly)g(activ)o(e)
-30 1667 y(pro)q(cess.)-30 1793 y Fg(13.9)56 b(D.)18 b(T)-5
b(racing)-30 1874 y Fn(\\ptrace")23 b(\(4164\))e(implemen)o(ts)e(the)k
(\\ptrace")f(system)-30 1923 y(call)14 b(#26.)33 1975 y(\\stop")k(\(4016\))g
(is)g(called)g(b)o(y)g(\\issig")f(\(3999\))h(for)g(a)-30 2025
y(pro)q(cess)c(whic)o(h)e(is)g(b)q(eing)g(traced)i(to)e(allo)o(w)e(the)j(sup)
q(ervis-)-30 2075 y(ing)h(paren)o(t)g(to)g(ha)o(v)o(e)g(a)f(\\lo)q(ok-see".)
33 2127 y(\\pro)q(cxm)o(t")21 b(\(4204\))h(is)g(a)h(pro)q(cedure)h(called)e
(from)-30 2176 y(\\stop")13 b(\(4028\))g(whereb)o(y)h(the)f(c)o(hild)g
(carries)h(out)f(certain)-30 2226 y(op)q(erations)k(related)g(to)f(tracing,)g
(at)h(the)f(b)q(ehest)i(of)e(the)-30 2276 y(paren)o(t.)-30
2402 y Fg(13.10)56 b(ssig)19 b(\(3614\))-30 2483 y Fn(This)26
b(pro)q(cedure)h(implemen)o(ts)d(the)i(\\signal")e(system)-30
2532 y(call.)-30 2631 y Fi(3619:)d Fn(If)15 b(the)i(in)o(terrupt)g(reason)f
(is)g(out)g(of)f(range)h(or)g(is)74 2681 y(equal)e(to)g(\\SIGKILL")f(\(9\),)g
(tak)o(e)h(an)g(error)g(exit;)-30 2772 y Fi(3623:)21 b Fn(Capture)e(the)f
(initial)f(v)n(alue)g(in)h(\\u.u)p 711 2772 V 14 w(signal[a]")74
2822 y(for)c(return)h(as)f(the)g(result)h(of)e(the)i(system)e(call;)1010
17 y Fi(3624:)20 b Fn(Set)g(the)g(elemen)o(t)f(of)g(\\u.u)p
1586 17 V 14 w(signal")f(to)i(the)g(de-)1114 66 y(sired)14
b(v)n(alue)f(...)1010 160 y Fi(3625:)20 b Fn(If)25 b(an)g(in)o(terrupt)h(for)
f(the)h(curren)o(t)g(reason)g(is)1114 210 y(p)q(ending,)17
b(cancel)h(it.)28 b(\(It)18 b(is)f(not)g(clear)h(wh)o(y)f(this)1114
260 y(step)k(should)g(b)q(e)g(necessary)i(or)e(ev)o(en)g(desirable.)1114
310 y(An)o(y)13 b(suggestions??\))1010 440 y Fg(13.11)56 b(kill)16
b(\(3630\))1010 522 y Fn(This)j(pro)q(cedure)h(implemen)o(ts)d(the)i(\\kill")
e(system)i(call)1010 572 y(to)g(cause)h(a)e(sp)q(eci\014ed)j(t)o(yp)q(e)e(of)
g(soft)o(w)o(are)f(in)o(terrupt)i(to)1010 622 y(another)14
b(designated)h(pro)q(cess.)1010 724 y Fi(3637:)20 b Fn(If)14
b(\\a")f(is)h(non-zero,)h(it)e(is)h(the)h(pro)q(cess)h(iden)o(tify-)1114
774 y(ing)d(n)o(um)o(b)q(er)g(of)h(a)f(pro)q(cess)j(to)e(b)q(e)h(in)o
(terrupted.)k(If)1114 824 y(\\a")9 b(is)h(zero,)h(then)g(all)e(pro)q(cesses)k
(originating)8 b(from)1114 873 y(the)15 b(same)g(terminal)e(as)i(the)h
(curren)o(t)h(pro)q(cess)g(are)1114 923 y(to)c(b)q(e)i(in)o(terrupted;)1010
1017 y Fi(3639:)20 b Fn(Consider)e(eac)o(h)g(en)o(try)g(in)e(the)i(\\pro)q
(c")f(table)h(in)1114 1067 y(turn)c(and)h(reject)g(it)f(if:)k(it)c(is)g(the)h
(curren)o(t)h(pro)q(cess)1114 1117 y(\(3640\);)9 b(it)h(is)f(not)h(the)g
(designated)g(pro)q(cess)h(\(3642\);)1114 1167 y(no)f(particular)h(pro)q
(cess)h(w)o(as)f(designated)g(\(\\a")g(==)1114 1216 y(0\))16
b(but)g(it)g(do)q(es)h(not)f(ha)o(v)o(e)f(the)i(same)e(con)o(trolling)1114
1266 y(terminal)i(or)j(it)f(is)g(one)h(of)f(the)h(t)o(w)o(o)f(initial)e(pro-)
1114 1316 y(cesses)d(\(3644\);)d(the)i(user)f(is)g(not)g(the)g(\\sup)q(er)h
(user")1114 1366 y(and)g(the)i(user)g(iden)o(tities)f(do)f(not)h(matc)o(h)f
(\(3646\);)1010 1460 y Fi(3649:)20 b Fn(F)m(or)26 b(an)o(y)f(pro)q(cess)i
(that)f(surviv)o(es)g(the)g(ab)q(o)o(v)o(e)1114 1509 y(tests,)14
b(call)g(\\psignal")e(to)i(c)o(hange)g(\\p)p 1715 1509 V 15
w(sig".)1010 1640 y Fg(13.12)56 b(signal)18 b(\(3949\))1010
1722 y Fn(F)m(or)12 b(ev)o(ery)g(pro)q(cess,)i(if)d(it)h(is)g(con)o(trolled)g
(b)o(y)g(the)h(sp)q(eci\014ed)1010 1772 y(terminal)f(\(denoted)j(b)o(y)f
(\\tp"\),)f(hit)g(it)h(with)f(\\psignal".)1010 1902 y Fg(13.13)56
b(psignal)18 b(\(3963\))1010 1984 y Fi(3966:)i Fn(Reject)14
b(the)g(call)e(if)g(\\sig")g(is)h(to)q(o)f(large)h(\(but)g(wh)o(y)1114
2034 y(not)18 b(if)f(negativ)o(e??)31 b(\\kill")16 b(do)q(es)j(not)g(c)o(hec)
o(k)g(this)1114 2084 y(parameter)11 b(b)q(efore)i(passing)f(it)f(to)h
(\\psignal".)k(Ad-)1114 2133 y(mittedly)8 b(the)i(\\kill")d(command)g(could)i
(only)g(result)1114 2183 y(in)k(a)h(p)q(ositiv)o(e)f(v)n(alue)g(for)h(\\sig")
f(...\);)1010 2277 y Fi(3971:)20 b Fn(If)f(the)g(curren)o(t)h(v)n(alue)e(of)g
(\\p)p 1621 2277 V 15 w(sig")g(is)g(NOT)h(set)1114 2327 y(to)14
b(\\SIGKILL",)g(then)i(o)o(v)o(erwrite)f(it)g(\(i.e.)21 b(once)15
b(a)1114 2377 y(pro)q(cess)g(has)e(b)q(een)h(\\killed)e(outrigh)o(t")h(there)
h(is)f(no)1114 2426 y(w)o(a)o(y)g(to)h(reviv)o(e)g(it.\);)1010
2520 y Fi(3973:)20 b Fn(Seems)f(to)f(b)q(e)h(an)f(error)h(here)h(...)30
b(for)18 b(\\p)p 1828 2520 V 15 w(stat")1114 2570 y(read)h(\\p)p
1257 2570 V 15 w(pri")f(...)31 b(impro)o(v)o(e)17 b(the)i(priorit)o(y)f(of)g
(the)1114 2620 y(pro)q(cess)d(if)e(it)h(is)g(not)f(to)q(o)h(go)q(o)q(d;)1010
2714 y Fi(3975:)20 b Fn(If)i(the)h(pro)q(cess)h(is)e(w)o(aiting)f(for)h(a)g
(non-k)o(ernel)1114 2764 y(ev)o(en)o(t)14 b(i.e.)k(it)13 b(called)h(\\sleep")
g(\(2066\))g(with)f(a)h(p)q(os-)1114 2814 y(itiv)o(e)f(priorit)o(y)m(,)f
(then)j(set)f(it)g(running)g(again.)1890 2946 y(55)p eop
%%Page: 56 64
63 bop -30 -144 a Fk(13)43 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)769
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fg(13.14)56
b(issig)18 b(\(3991\))-30 93 y Fi(3997:)j Fn(If)13 b(\\p)p
187 93 13 2 v 15 w(sig")g(is)h(non-zero,)g(then)h(...)-30 173
y Fi(3998:)21 b Fn(If)15 b(the)i(\\tracing")e(\015ag)g(is)h(on,)g(call)f
(\\stop")g(\(this)74 223 y(topic)f(will)e(b)q(e)j(resumed)f(later\);)-30
303 y Fi(4000:)21 b Fn(Return)14 b(a)f(zero)i(v)n(alue)e(if)g(\\p)p
554 303 V 14 w(sig")g(is)h(zero.)19 b(\(This)74 353 y(apparen)o(tly)k
(redundan)o(t)h(test)h(is)e(necessary)i(b)q(e-)74 403 y(cause)19
b(\\stop")e(ma)o(y)f(reset)j(\\p)p 567 403 V 15 w(sig")e(as)h(a)f(side)h(ef-)
74 453 y(fect.\);)74 518 y(4003.)35 b(If)20 b(the)g(v)n(alue)f(in)h(the)g
(corresp)q(onding)h(el-)74 567 y(emen)o(t)c(of)g(\\u.u)p 333
567 V 15 w(signal")f(is)h(ev)o(en)i(\(ma)o(y)c(b)q(e)k(zero\))74
617 y(return)c(a)f(non-zero)g(v)n(alue;)-30 697 y Fi(4006:)21
b Fn(Otherwise)15 b(return)g(a)f(zero)h(v)n(alue.)33 781 y(The)j(commen)o(t)e
(regarding)i(the)h(frequency)g(of)e(calls)-30 831 y(on)c(\\issig")e(whic)o(h)
i(o)q(ccurs)h(on)e(lines)h(3983)e(to)i(3985)e(needs)-30 881
y(some)k(clari\014cation.)21 b(A)o(t)15 b(least)g(one)h(call)e(on)h(\\issig")
f(is)h(a)-30 931 y(part)j(of)f(ev)o(ery)h(execution)h(of)e(\\trap")g(but)h
(only)f(of)f(one)-30 980 y(in)o(terrupt)g(routine)f(\(\\clo)q(c)o(k",)g(whic)
o(h)g(calls)f(\\issig")g(only)-30 1030 y(once)i(p)q(er)g(second\).)23
b(In)15 b(cases)i(where)f(\\pri")e(is)h(p)q(ositiv)o(e,)-30
1080 y(\\sleep")j(\(2073,)f(2085\))g(calls)g(\\issig")g(b)q(efore)h(and)f
(after)-30 1130 y(calling)c(\\swtc)o(h".)-30 1245 y Fg(13.15)56
b(psig)19 b(\(4043\))-30 1321 y Fn(This)14 b(pro)q(cedure)i(is)e(only)g
(called)f(if)h(\\u.u)p 629 1321 V 14 w(signal[n]")e(w)o(as)-30
1371 y(found)g(b)o(y)f(\\issig")f(to)i(ha)o(v)o(e)f(an)g(ev)o(en)h(v)n(alue.)
17 b(If)11 b(this)g(v)n(alue)-30 1421 y(is)18 b(found)g(\(4051\))f(to)h(b)q
(e)g(non-zero,)i(it)d(is)h(tak)o(en)g(as)g(the)-30 1471 y(address)i(of)e(a)h
(user)g(mo)q(de)f(function)g(whic)o(h)h(has)g(to)f(b)q(e)-30
1521 y(executed.)-30 1605 y Fi(4054:)j Fn(Reset)16 b(\\u.u)p
296 1605 V 14 w(signal[n]")c(except)17 b(the)e(case)h(where)74
1654 y(the)11 b(in)o(terrupt)h(for)e(an)h(illegal)d(instruction)j(or)g(trace)
74 1704 y(trap;)-30 1784 y Fi(4055:)21 b Fn(Calculate)h(the)g(user)h(space)g
(addresses)i(of)c(the)74 1834 y(lo)o(w)o(er)c(of)f(t)o(w)o(o)h(w)o(ords)g
(whic)o(h)g(are)h(to)f(b)q(e)g(inserted)74 1884 y(in)o(to)c(the)i(user)g(mo)q
(de)e(stac)o(k)h(...)-30 1964 y Fi(4056:)21 b Fn(Call)12 b(\\gro)o(w")h(to)g
(c)o(hec)o(k)i(the)f(curren)o(t)h(user)g(mo)q(de)74 2014 y(stac)o(k)i(size,)h
(and)f(to)g(extend)g(it)g(\(do)o(wn)o(w)o(ards!\))27 b(if)74
2064 y(necessary;)-30 2144 y Fi(4057:)21 b Fn(Put)14 b(the)f(v)n(alues)g(of)g
(the)h(pro)q(cessor)h(status)f(regis-)74 2194 y(ter)g(and)f(the)h(program)d
(coun)o(ter)k(whic)o(h)e(w)o(ere)h(cap-)74 2243 y(tured)k(at)e(the)h(time)e
(of)h(the)i(\\trap")e(or)g(hardw)o(are)74 2293 y(in)o(terrupt)g(\(in)f(the)h
(case)g(of)f(a)g(\\clo)q(c)o(k")g(in)o(terrupt\))74 2343 y(in)o(to)f(the)i
(user)g(stac)o(k,)f(and)g(up)q(date)g(the)h(\\remem-)74 2393
y(b)q(ered")f(v)n(alues)e(of)g(r6,)g(r7)h(and)f(the)h(pro)q(cessor)i(sta-)74
2443 y(tus)h(w)o(ord.)23 b(Up)q(on)16 b(returning)g(to)g(user)h(mo)q(de,)e
(ex-)74 2492 y(ecution)20 b(will)d(resume)i(at)g(the)g(b)q(eginning)g(of)f
(the)74 2542 y(designated)g(pro)q(cedure.)31 b(When)18 b(this)g(pro)q(cedure)
74 2592 y(returns,)k(the)f(pro)q(cedure)g(whic)o(h)f(w)o(as)f(originally)74
2642 y(in)o(terrupted)c(will)e(b)q(e)h(resumed;)-30 2722 y
Fi(4066:)21 b Fn(If)14 b(\\u.u)p 223 2722 V 14 w(signal[n]")f(is)h(zero,)h
(then)g(for)f(the)h(in)o(ter-)74 2772 y(rupt)k(t)o(yp)q(es)g(listed,)f
(generate)i(a)e(core)g(image)f(via)74 2822 y(the)e(pro)q(cedure)h(\\core";)
1010 17 y Fi(4079:)k Fn(Store)h(a)g(v)n(alue)e(in)h(\\u.u)p
1545 17 V 15 w(arg[0]")f(comp)q(osed)h(of)1114 66 y(the)d(lo)o(w)g(order)g(b)
o(yte)h(of)e(the)i(remem)o(b)q(ered)f(v)n(alue)1114 116 y(of)12
b(r0,)h(and)g(of)f(\\n",)g(whic)o(h)h(records)i(the)e(in)o(terrupt)1114
166 y(t)o(yp)q(e)k(and)g(whether)h(a)e(core)i(image)d(w)o(as)i(success-)1114
216 y(fully)12 b(created;)1010 296 y Fi(4080:)20 b Fn(Call)c(\\exit")g(for)g
(the)i(pro)q(cess)g(to)f(terminate)f(it-)1114 346 y(self.)1010
461 y Fg(13.16)56 b(core)18 b(\(4094\))1010 537 y Fn(This)e(pro)q(cedure)i
(copies)f(the)g(sw)o(appable)f(program)e(im-)1010 587 y(age)19
b(in)o(to)g(a)g(\014le)g(called)g(\\core")h(in)e(the)i(user's)h(curren)o(t)
1010 637 y(directory)m(.)d(A)c(detailed)f(explanation)g(of)g(this)g(pro)q
(cedure)1010 687 y(m)o(ust)f(w)o(ait)h(un)o(til)g(the)h(material)e(of)h
(Sections)h(Three)h(and)1010 737 y(F)m(our,)20 b(whic)o(h)g(deal)f(with)g
(input/output)h(and)f(\014le)h(sys-)1010 787 y(tems,)13 b(ha)o(v)o(e)g(b)q
(een)i(co)o(v)o(ered.)1010 901 y Fg(13.17)56 b(gro)n(w)19 b(\(4136\))1010
978 y Fn(The)c(parameter,)f(\\sp",)g(of)g(this)g(pro)q(cedure)j(de\014nes)e
(the)1010 1028 y(address)h(of)e(a)h(w)o(ord)g(whic)o(h)g(should)f(b)q(e)i
(included)f(in)f(the)1010 1078 y(user)h(mo)q(de)e(stac)o(k.)1010
1162 y Fi(4141:)20 b Fn(If)11 b(the)h(stac)o(k)f(already)g(extends)h(far)f
(enough,)g(sim-)1114 1212 y(ply)i(return)i(with)f(a)f(zero)i(v)n(alue.)1114
1277 y(Note)d(that)f(this)h(test)g(relies)g(on)g(the)g(idiosyncrasies)1114
1326 y(of)h(2's)g(complemen)o(t)f(arithmetic,)g(and)i(if)f(b)q(oth)1424
1426 y Ff(|)p Fn(sp)p Ff(|)h Fh(>)e Fn(2)1586 1411 y Fd(15)1114
1525 y Fn(and)1337 1624 y Ff(|)p Fn(u.u)p 1419 1624 V 14 w(size)j
Fl(\003)p Fn(64)p Ff(|)e Fh(>)f Fn(2)1673 1609 y Fd(15)1114
1724 y Fn(the)g(decision)f(to)g(extend)i(the)f(stac)o(k)g(ma)o(y)d(b)q(e)j
(tak)o(en)1114 1773 y(wrongly)h(at)g(this)h(juncture;)1010
1853 y Fi(4143:)20 b Fn(Calculate)11 b(the)h(stac)o(k)f(size)h(incremen)o(t)f
(needed)h(to)1114 1903 y(include)e(the)i(new)f(stac)o(k)g(p)q(oin)o(t)f(plus)
g(a)h(20*32)e(w)o(ord)1114 1953 y(margin;)1010 2033 y Fi(4144:)20
b Fn(Chec)o(k)14 b(that)f(this)h(v)n(alue)e(is)h(in)g(fact)g(p)q(ositiv)o(e)g
(\(i.e.)1114 2083 y(w)o(e)k(are)g(not)g(dealing)f(with)g(a)h(failure)f(of)g
(the)i(test)1114 2133 y(on)13 b(line)h(4141.\);)1010 2213 y
Fi(4146:)20 b Fn(Chec)o(k)27 b(that)e(the)h(new)g(stac)o(k)g(size)h(do)q(es)f
(not)1114 2263 y(con\015ict)17 b(with)g(the)h(memory)d(segmen)o(tation)h
(con-)1114 2313 y(strain)o(ts)24 b(\(\\estabur")g(sets)g(\\u.u)p
1659 2313 V 15 w(error")g(if)f(they)1114 2362 y(do\))16 b(and)h(reset)h(the)g
(segmen)o(tation)d(register)j(pro-)1114 2412 y(tot)o(yp)q(es;)1010
2492 y Fi(4148:)i Fn(Get)j(a)f(new,)i(enlarged)e(data)g(area,)i(cop)o(y)e
(the)1114 2542 y(stac)o(k)15 b(segmen)o(ts)f(\(32)g(w)o(ords)h(at)g(a)f
(time\))g(in)o(to)f(the)1114 2592 y(high)h(end)h(of)f(the)i(new)f(data)g
(area,)g(and)f(clear)h(the)1114 2642 y(segmen)o(ts)c(whic)o(h)h(no)o(w)g(b)q
(ecome)f(the)i(stac)o(k)f(expan-)1114 2692 y(sion;)1010 2772
y Fi(4156:)20 b Fn(Up)q(date)h(the)g(stac)o(k)f(size,)i(\\u.u)p
1662 2772 V 14 w(ssize")f(and)f(re-)1114 2822 y(turn)14 b(a)g(\\successful")h
(result.)-30 2946 y(56)p eop
%%Page: 57 65
64 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)769
b(13)42 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)-30 17 y Fg(13.18)56
b(exit)17 b(\(3219\))-30 93 y Fn(This)12 b(pro)q(cedure)i(is)e(called)g(when)
h(a)e(pro)q(cess)j(is)e(to)g(termi-)-30 143 y(nate)j(itself.)-30
220 y Fi(3224:)21 b Fn(Reset)15 b(the)f(\\tracing")g(\015ag;)-30
297 y Fi(3225:)21 b Fn(Set)11 b(all)f(of)f(the)j(v)n(alues)e(in)g(the)h(arra)
o(y)g(\\u.u)p 755 297 13 2 v 14 w(signal")74 347 y(\(including)17
b(\\u.u)p 355 347 V 15 w(signal[SIGKILL]"\))e(to)j(one)h(so)74
397 y(that)f(no)g(future)h(execution)g(of)e(\\issig")g(will)g(ev)o(er)74
447 y(b)q(e)e(follo)o(w)o(ed)d(b)o(y)i(execution)g(of)g(\\psig";)-30
524 y Fi(3227:)21 b Fn(Call)8 b(\\close")i(\(6643\))f(to)h(close)g(all)e(the)
j(\014les)f(whic)o(h)74 574 y(the)21 b(pro)q(cess)i(has)d(op)q(en.)38
b(\(F)m(or)21 b(the)g(most)e(part,)74 623 y(\\closing")13 b(simply)f(in)o(v)o
(olv)o(es)h(decremen)o(ting)h(a)g(ref-)74 673 y(erence)i(coun)o(t.\);)-30
750 y Fi(3232:)21 b Fn(Reduce)d(the)g(reference)i(coun)o(t)d(for)g(the)h
(curren)o(t)74 800 y(directory;)-30 877 y Fi(3233:)j Fn(Sev)o(er)12
b(the)g(pro)q(cess's)h(connection)f(with)e(an)o(y)h(text)74
927 y(segmen)o(t;)-30 1005 y Fi(3234:)21 b Fn(A)14 b(place)g(is)g(needed)h
(to)f(store)h(\\p)q(er)g(pro)q(cess")g(in-)74 1054 y(formation)9
b(un)o(til)h(the)h(paren)o(t)h(pro)q(cess)h(can)e(lo)q(ok)f(at)74
1104 y(it.)27 b(A)16 b(blo)q(c)o(k)h(\(256)f(w)o(ords\))h(in)f(the)i(sw)o(ap)
e(area)h(of)74 1154 y(the)e(disk)e(is)h(a)g(con)o(v)o(enien)o(t)g(place;)-30
1231 y Fi(3237:)21 b Fn(Find)14 b(a)f(suitable)h(bu\013er)h(\(256)e(w)o
(ords\))h(and)g(...)-30 1308 y Fi(3238:)21 b Fn(Cop)o(y)d(the)h
Fi(lo)o(w)o(er)h(half)d Fn(of)g(the)j(\\u")e(structure)74 1358
y(in)o(to)13 b(the)i(bu\013er)g(area;)-30 1435 y Fi(3239:)21
b Fn(W)m(rite)13 b(the)i(bu\013er)g(in)o(to)e(the)h(sw)o(ap)g(area;)-30
1513 y Fi(3241:)21 b Fn(En)o(ter)e(the)g(core)h(space)f(o)q(ccupied)h(b)o(y)e
(the)h(pro-)74 1562 y(cess)14 b(in)o(to)e(the)h(free)h(list.)j(\(This)12
b(space)i(is)e(of)g(course)74 1612 y(still)i(in)g(use,)i(but)f(the)g(use)h
(will)d(terminate)h(b)q(efore)74 1662 y(an)o(y)e(other)h(pro)q(cess)i(gets)e
(to)f(dip)g(in)o(to)g(the)h(free)g(list)74 1712 y(again.)33
b(This)20 b(could)f(not)g(b)q(e)h(done)g(an)o(y)e(so)q(oner,)74
1762 y(b)q(ecause,)g(as)e(will)f(b)q(e)i(seen)g(later,)f(b)q(oth)g(\\getblk")
74 1812 y(and)i(\\b)o(write")f(can)h(call)f(\\sleep",)h(during)g(whic)o(h)74
1861 y(all)d(sorts)j(of)e(things)g(migh)o(t)e(happ)q(en.)27
b(In)16 b(view)g(of)74 1911 y(all)h(this,)i(it)f(migh)o(t)e(b)q(e)j
(reasonable)g(if)e(the)i(state-)74 1961 y(men)o(t)328 2051
y(expand)14 b(\(USIZE\);)74 2142 y(w)o(ere)h(inserted)g(after)f(line)g
(3226.\);)-30 2219 y Fi(3243:)21 b Fn(Set)e(the)g(pro)q(cess)h(state)g(to)e
(\\zom)o(bie")f(\(i.e.)31 b(\\a)74 2269 y(corpse)15 b(said)f(to)g(b)q(e)g
(reviv)o(ed)g(b)o(y)g(witc)o(hcraft")74 2319 y(\(O.E.D.\)\);)-30
2396 y Fi(3245:)21 b Fn(The)14 b(remaining)e(co)q(de)i(searc)o(hes)i(the)e
(\\pro)q(c")g(ar-)74 2446 y(ra)o(y)g(to)g(\014nd)h(the)g(paren)o(t)g(pro)q
(cess)h(and)e(to)g(w)o(ak)o(e)g(it)74 2496 y(up,)d(to)f(mak)o(e)f(an)o(y)g(c)
o(hildren)i(\\w)o(ards)f(of)g(the)h(state",)74 2546 y(and,)h(if)f(they)i(ha)o
(v)o(e)e(\\stopp)q(ed")i(for)f(tracing,)f(to)h(re-)74 2595
y(lease)g(them.)k(Finally)9 b(the)j(co)q(de)g(includes)f(\(for)g(this)74
2645 y(pro)q(cess\))16 b(a)e(last)f(call)g(on)h(\\swtc)o(h".)33
2722 y(Before)19 b(going)f(on)g(to)h(consider)g(tracing,)g(there)h(are)-30
2772 y(t)o(w)o(o)28 b(routines)g(whic)o(h)g(are)h(closely)e(asso)q(ciated)i
(with)-30 2822 y(\\exit",)13 b(whic)o(h)g(can)h(b)q(e)g(con)o(v)o(enien)o
(tly)f(disp)q(osed)i(of)e(no)o(w.)1010 17 y Fg(13.19)56 b(rexit)17
b(\(3205\))1010 95 y Fn(This)e(pro)q(cedure)i(implem)o(en)o(ts)c(the)j
(\\exit")e(system)h(call,)1010 145 y(#1.)h(It)9 b(simply)f(salv)n(ages)h(the)
h(lo)o(w)f(order)h(b)o(yte)g(of)f(the)h(user)1010 195 y(supplied)23
b(parameter)g(and)g(sa)o(v)o(es)g(it)g(in)g(\\u.u)p 1785 195
V 14 w(arg[0]".)1010 245 y(whic)o(h)16 b(is)g(in)f(the)i(lo)o(w)o(er)f(half)f
(of)g(the)i(\\u")f(structure)i(i.e.)1010 295 y(the)i(part)f(that)h(is)f
(written)h(to)f(the)h(\\sw)o(ap)f(area")g(as)g(a)1010 344 y(\\zom)o(bie".)
1010 466 y Fg(13.20)56 b(w)n(ait)19 b(\(3270\))1010 545 y Fn(F)m(or)c(ev)o
(ery)h(call)f(on)g(\\exit",)f(there)j(should)e(b)q(e)h(a)f(matc)o(h-)1010
595 y(ing)h(call)g(on)h(\\w)o(ait")e(b)o(y)i(an)g(anxious)f(paren)o(t)h(or)g
(ances-)1010 645 y(tor.)h(The)13 b(principal)f(function)h(of)g(the)g(latter)h
(pro)q(cedure,)1010 694 y(whic)o(h)e(implemen)o(ts)e(the)k(\\w)o(ait")d
(system)h(call,)g(is)g(for)g(the)1010 744 y(paren)o(t)f(or)f(ancestor)h(to)g
(\014nd)f(and)g(disp)q(ose)h(of)f(a)g(\\zom)o(bie")1010 794
y(c)o(hild.)1072 845 y(\\w)o(ait")g(also)g(has)h(a)g(secondary)h(function,)f
(to)f(lo)q(ok)g(for)1010 895 y(c)o(hildren)i(whic)o(h)f(ha)o(v)o(e)h(\\stopp)
q(ed")g(for)f(tracing)h(\(whic)o(h)f(is)1010 945 y(the)j(next)h(ma)r(jor)d
(topic\).)1010 1040 y Fi(3277:)20 b Fn(Searc)o(h)g(the)g(whole)f(\\pro)q(c")g
(arra)o(y)g(lo)q(oking)e(for)1114 1090 y(c)o(hild)e(pro)q(cesses.)27
b(\(If)16 b(none)g(exist,)g(tak)o(e)g(an)g(error)1114 1140
y(exit)d(\(line)h(3317\)\);)1010 1227 y Fi(3280:)20 b Fn(If)14
b(the)g(c)o(hild)g(is)f(a)h(\\zom)o(bie":)1163 1324 y Fl(\017)21
b Fn(sa)o(v)o(e)13 b(the)g(c)o(hild's)e(pro)q(cess)k(iden)o(tifying)c(n)o
(um-)1205 1374 y(b)q(er,)j(to)g(rep)q(ort)h(bac)o(k)f(to)f(the)i(paren)o(t;)
1163 1442 y Fl(\017)21 b Fn(read)15 b(the)g(256)f(w)o(ord)g(record)h(bac)o(k)
g(from)d(the)1205 1492 y(disk)23 b(sw)o(ap)h(area,)h(and)e(release)i(the)f
(sw)o(ap)1205 1542 y(space;)1163 1611 y Fl(\017)d Fn(reinitialise)13
b(the)h(\\pro)q(c")g(arra)o(y)g(en)o(try;)1163 1679 y Fl(\017)21
b Fn(accum)o(ulate)g(the)h(v)n(arious)e(accoun)o(ting)i(en-)1205
1729 y(tries;)1205 1788 y(sa)o(v)o(e)17 b(the)g(\\u)p 1417
1788 V 15 w(arg[0]")e(v)n(alue)h(also)g(to)h(rep)q(ort)1205
1838 y(bac)o(k)d(to)g(the)g(paren)o(t;)1010 1935 y Fi(3300:)20
b Fn(Is)11 b(the)g(c)o(hild)f(in)g(a)g(\\stopp)q(ed")g(state?)18
b(\(If)10 b(so,)h(w)o(ait)1114 1985 y(for)i(the)i(discussion)f(on)g
(tracing\);)1010 2072 y Fi(3313:)20 b Fn(If)12 b(one)h(or)f(more)f(c)o
(hildren)i(w)o(ere)g(found)f(but)h(none)1114 2122 y(w)o(ere)25
b(\\zom)o(bies")e(or)h(\\stopp)q(ed",)j(\\sleep")d(and)1114
2172 y(then)14 b(lo)q(ok)f(again.)1010 2294 y Fg(13.21)56 b(T)-5
b(racing)1010 2372 y Fn(The)14 b(tracing)f(facilities)f(are)i(pro)o(vided)f
(through)g(a)g(mo)q(di-)1010 2422 y(\014cation)h(and)g(extension)h(of)f(the)h
(soft)o(w)o(are)g(in)o(terrupt)g(fa-)1010 2472 y(cilities.)31
b(Brie\015y)m(,)19 b(if)e(a)h(paren)o(t)h(pro)q(cess)h(is)e(tracing)g(the)
1010 2522 y(progress)e(of)e(c)o(hild)g(pro)q(cess,)i(ev)o(ery)f(time)e(the)i
(c)o(hild)f(pro-)1010 2571 y(cess)d(encoun)o(ters)g(a)e(soft)o(w)o(are)h(in)o
(terrupt,)g(the)g(paren)o(t)g(pro-)1010 2621 y(cess)j(is)f(giv)o(en)g(the)g
(opp)q(ortunit)o(y)g(to)g(in)o(terv)o(ene)h(as)f(part)g(of)1010
2671 y(the)i(total)f(resp)q(onse)j(to)e(the)h(in)o(terrupt.)1072
2722 y(The)j(paren)o(t's)h(in)o(terv)o(en)o(tion)e(ma)o(y)f(in)o(v)o(olv)o(e)
h(in)o(terro-)1010 2772 y(gation)c(of)h(v)n(alues)g(within)g(the)h(c)o(hild)f
(pro)q(cess's)i(data)e(ar-)1010 2822 y(eas,)f(including)e(the)j(\\p)q(er)f
(pro)q(cess)h(data)e(area".)18 b(Sub)r(ject)1890 2946 y(57)p
eop
%%Page: 58 66
65 bop -30 -144 a Fk(13)43 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)769
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fn(to)g(certain)g(constrain)o
(ts,)f(the)h(paren)o(t)g(pro)q(cess)h(ma)o(y)c(also)-30 66
y(c)o(hange)j(v)n(alues)e(within)g(these)j(data)d(areas.)33
121 y(The)d(source)h(of)e(the)i(soft)o(w)o(are)f(in)o(terrupts)h(ma)o(y)d(b)q
(e)i(the)-30 171 y(paren)o(t)18 b(pro)q(cess,)i(the)e(user)g(himself)e
(\(e.g.)28 b(b)o(y)17 b(en)o(tering)-30 220 y(\\kill")10 b(commands)f(or)i
(\\delete"s)i(through)e(his)g(terminal\))-30 270 y(or)h(the)h(c)o(hild)e(pro)
q(cess)i(itself)f(\(e.g.)17 b(instructions)12 b(or)g(other)-30
320 y(maladies\).)33 374 y(The)19 b(comm)o(unication)d(b)q(et)o(w)o(een)21
b(c)o(hild)d(and)h(paren)o(t)-30 424 y(pro)q(cesses)e(is)d(a)f(kind)h(of)f
(ritual)g(dance:)-30 534 y Fi(\(1\))20 b Fn(the)c(c)o(hild)e(exp)q(eriences)k
(a)d(soft)o(w)o(are)g(in)o(terrupt)h(and)74 584 y(\\stops";)-30
685 y Fi(\(2\))k Fn(the)27 b(w)o(aiting)e(paren)o(t)h(disco)o(v)o(ers)h(the)g
(\\stopp)q(ed")74 735 y(c)o(hild)17 b(\(line)g(3301\),)g(and)g(reviv)o(es.)29
b(Subsequen)o(tly)74 785 y(...)-30 886 y Fi(\(3\))20 b Fn(the)h(paren)o(t)f
(ma)o(y)e(execute)j(the)g(\\ptrace")f(system)74 936 y(call)15
b(whic)o(h)h(has)g(the)g(e\013ect)h(of)e(lea)o(ving)g(a)g(request)74
986 y(message)c(in)g(the)h(system)e(de\014ned)j(structure)g(\\ip)q(c")74
1035 y(\(3939\))g(for)h(the)g(c)o(hild)g(pro)q(cess;)-30 1137
y Fi(\(4\))20 b Fn(the)14 b(paren)o(t)f(then)g(go)q(es)h(to)e(\\sleep")i
(while)e(the)h(c)o(hild)74 1187 y(\\w)o(ak)o(es)h(up";)-30
1288 y Fi(\(5\))20 b Fn(the)d(c)o(hild)e(reads)i(the)g(message)f(in)f(\\ip)q
(c")h(and)g(acts)74 1338 y(up)q(on)c(it)e(\(e.g)i(cop)o(ying)e(one)i(of)e
(its)i(o)o(wn)e(v)n(alues)h(in)o(to)74 1387 y(\\ip)q(c.ip)p
198 1387 13 2 v 14 w(data"\);)-30 1489 y Fi(\(6\))20 b Fn(the)14
b(c)o(hild)e(then)h(go)q(es)h(to)e(\\sleep")h(while)g(the)g(paren)o(t)74
1539 y(\\w)o(ak)o(es)h(up";)-30 1640 y Fi(\(7\))20 b Fn(the)e(paren)o(t)g
(insp)q(ects)h(the)g(result,)f(as)g(recorded)h(in)74 1690 y(\\ip)q(c",)13
b(of)h(the)g(op)q(eration;)-30 1791 y Fi(\(8\))20 b Fn(steps)c(\(3\))e(to)g
(\(7\))g(ma)o(y)e(b)q(e)i(rep)q(eated)i(sev)o(eral)f(times)74
1841 y(in)f(succession.)33 1950 y(Finally)g(the)j(paren)o(t)g(ma)o(y)e(allo)o
(w)g(the)i(c)o(hild)e(to)i(con-)-30 2000 y(tin)o(ue)j(its)f(normal)e
(execution,)j(p)q(ossibly)f(without)g(ev)o(er)-30 2050 y(kno)o(wing)13
b(that)h(a)g(soft)o(w)o(are)g(in)o(terrupt)g(had)g(o)q(ccurred.)33
2104 y(A)h(discussion)g(of)f(the)i(tracing)f(facilit)o(y)e(is)i(con)o(tained)
-30 2154 y(in)d(the)h(Section)g(\\PTRA)o(CE)f(\(I)q(I\)")h(of)e(the)i(UPM.)g
(T)m(o)e(the)-30 2204 y(list)19 b(of)f(functional)g(limitations)e(noted)k(in)
e(the)i(\\Bugs")-30 2254 y(paragraph,)15 b(w)o(e)g(can)g(add)g(the)g(follo)o
(wing)e(commen)o(ts)g(on)-30 2304 y(e\016ciency:)33 2413 y
Fl(\017)20 b Fn(There)13 b(should)e(b)q(e)h(a)g(mec)o(hanism)d(for)i
(transferring)74 2463 y(large)j(blo)q(c)o(ks)h(\(e.g.)k(up)14
b(to)h(256)e(w)o(ords)i(at)f(a)g(time\))74 2513 y(of)19 b(information)d(from)
h(the)j(c)o(hild)f(to)f(the)i(paren)o(t)74 2563 y(\(though)d(not)g
(necessarily)i(in)d(the)i(rev)o(erse)h(direc-)74 2613 y(tion\);)33
2714 y Fl(\017)h Fn(There)12 b(should)e(b)q(e)i(a)e(prop)q(er)i(coroutine)f
(pro)q(cedure)74 2764 y(\(analogous)e(to)h(\\swtc)o(h"\))h(to)f(allo)o(w)f
(rapid)h(transfer)74 2814 y(of)k(con)o(trol)f(b)q(et)o(w)o(een)i(c)o(hild)f
(and)f(paren)o(t.)1010 17 y Fg(13.22)56 b(stop)18 b(\(4016\))1010
94 y Fn(This)9 b(pro)q(cedure)j(is)d(called)g(b)o(y)h(\\issig")e(\(3999\))h
(if)g(the)h(trac-)1010 144 y(ing)j(\015ag)g(\(\\STR)o(C",)g(0395\))g(is)h
(set.)1010 237 y Fi(4022:)20 b Fn(If)12 b(y)o(our)h(paren)o(t)f(is)h(pro)q
(cess)h(1)e(\(i.e.)17 b(\\/etc/init"\),)1114 287 y(then)d(call)f(\\exit")h
(\(line)f(4032\);)1010 372 y Fi(4023:)20 b Fn(Otherwise)13
b(lo)q(ok)c(through)i(\\pro)q(c")g(for)g(y)o(our)f(par-)1114
422 y(en)o(t)24 b(...)49 b(w)o(ak)o(e)24 b(him)e(up)j(...)48
b(declare)25 b(y)o(ourself)1114 472 y(\\stopp)q(ed")12 b(and)f(...)16
b(call)11 b(\\swtc)o(h")g(\(Note)h(do)g(NOT)1114 522 y(call)h(\\sleep".)18
b(Wh)o(y?\);)1010 607 y Fi(4028:)i Fn(If)14 b(the)i(tracing)e(\015ag)g(has)h
(b)q(een)g(reset,)h(or)e(the)i(re-)1114 657 y(sult)i(of)f(the)h(pro)q(cedure)
i(\\pro)q(cxm)o(t")d(is)g(true,)j(re-)1114 706 y(turn)14 b(to)g(\\issig";)
1010 791 y Fi(4029:)20 b Fn(Otherwise)c(start)e(again.)1010
910 y Fg(13.23)56 b(w)n(ait)19 b(\(3270\))f(\(con)n(tin)n(ued\))1010
988 y Fi(3301:)i Fn(If)14 b(the)g(c)o(hild)g(pro)q(cess)h(has)f(\\stopp)q
(ed")h(and)f(...)1010 1073 y Fi(3302:)20 b Fn(If)g(the)h(\\SWTED")e(\015ag)h
(is)g(not)h(set)g(\(i.e.)36 b(the)1114 1123 y(paren)o(t)14
b(hasn't)g(noticed)g(this)g(c)o(hild)f(lately\))h(...)1010
1208 y Fi(3303:)20 b Fn(As)j(an)f(\\aide-memoi)o(re")e(set)j(the)g(\\SWTED")
1114 1258 y(\015ag.)17 b(Set)12 b(\\u.u)p 1358 1258 V 15 w(ar0[R0]",)d(\\u.u)
p 1628 1258 V 15 w(ar0[R1]")h(so)i(that)1114 1307 y(the)18
b(c)o(hild)g(pro)q(cess)h(status)g(w)o(ord)f(is)g(returned)h(to)1114
1357 y(the)14 b(paren)o(t;)1010 1442 y Fi(3309:)20 b Fn(The)h(\\SWTED")e
(\015ag)g(w)o(as)h(set.)37 b(This)20 b(means)1114 1492 y(that)e(the)h(paren)o
(t,)g(b)o(y)f(p)q(erforming)f(at)h(least)h(t)o(w)o(o)1114 1542
y(\\w)o(aits")g(in)g(succession)j(without)d(an)o(y)h(in)o(terv)o(en-)1114
1592 y(ing)13 b(call)h(on)g(\\ptrace",)g(is)g(not)g(v)o(ery)h(in)o(terested)h
(in)1114 1641 y(the)e(c)o(hild.)j(So)c(reset)i(b)q(oth)f(the)g(\\STR)o(C")e
(and)h(the)1114 1691 y(\\SWTED")g(\015ags)i(and)f(release)i(the)g(c)o(hild.)j
(\(Note)1114 1741 y(the)e(use)i(of)d(\\setrun")i(\(not)g(\\w)o(ak)o(eup"\))e
(to)h(com-)1114 1791 y(plemen)o(t)c(the)h(call)f(on)h(\\swtc)o(h")g
(\(4027\)\).)1010 1910 y Fg(13.24)56 b(ptrace)18 b(\(4164\))1010
1987 y Fn(This)24 b(pro)q(cedure)h(implemen)o(ts)d(the)i(\\ptrace")g(system)
1010 2037 y(call,)12 b(#26.)1010 2130 y Fi(4168:)20 b Fn(\\u.u)p
1220 2130 V 15 w(arg[2]")11 b(corresp)q(onds)16 b(to)d(the)h(\014rst)g
(param-)1114 2180 y(eter)i(in)g(the)g(\\C")f(program)f(calling)g(sequence.)25
b(If)1114 2230 y(this)19 b(is)h(zero,)h(a)e(c)o(hild)g(pro)q(cess)j(is)d
(asking)g(to)g(b)q(e)1114 2280 y(traced)d(b)o(y)f(its)h(paren)o(t,)g(so)g
(set)g(the)g(\\STR)o(C")f(\015ag)1114 2330 y(and)e(return.)1072
2423 y(Note)21 b(that)g(this)f(co)q(de)i(handles)f(the)g(only)e(explicit)1010
2473 y(action)9 b(the)h(c)o(hild)f(pro)q(cess)j(is)d(ask)o(ed)h(to)g(tak)o(e)
f(with)h(resp)q(ect)1010 2523 y(to)17 b(tracing.)27 b(There)18
b(is)f(no)g(real)g(reason)h(wh)o(y)e(ev)o(en)i(this)1010 2573
y(action)11 b(should)h(b)q(e)g(tak)o(en)g(b)o(y)f(the)i(c)o(hild)e(pro)q
(cess)j(and)d(not)1010 2622 y(b)o(y)e(the)i(paren)o(t)f(pro)q(cess.)18
b(F)m(rom)8 b(a)h(securit)o(y)i(p)q(oin)o(t)e(of)g(view)1010
2672 y(it)17 b(is)h(most)f(probably)h(desirable)g(that)g(a)g(c)o(hild)f(pro)q
(cess)1010 2722 y(should)f(only)g(b)q(e)h(traceable)g(if)f(it)g(giv)o(es)g
(its)g(p)q(ermission.)1010 2772 y(On)10 b(the)g(other)h(hand,)f(if)f(the)i(c)
o(hild)e(asks)h(to)g(b)q(e)g(traced)h(and)1010 2822 y(is)g(then)g(ignored)g
(b)o(y)f(the)i(paren)o(t,)f(the)h(c)o(hild)e(pro)q(cess)j(ma)o(y)-30
2946 y(58)p eop
%%Page: 59 67
66 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)769
b(13)42 b(SOFTW)m(ARE)16 b(INTERR)o(UPTS)-30 17 y Fn(b)q(e)i(blo)q(c)o(k)o
(ed)f(inde\014nitely)m(.)26 b(P)o(erhaps)18 b(the)g(b)q(est)g(solution)-30
66 y(w)o(ould)d(b)q(e)h(for)f(the)h(\\STR)o(C")e(\015ag)h(to)h(b)q(e)g(set)g
(only)e(after)-30 116 y(explicit)g(action)f(b)o(y)h Fi(b)q(oth)f
Fn(the)h(paren)o(t)h Fi(and)e Fn(the)h(c)o(hild.)-30 200 y
Fi(4172:)21 b Fn(Searc)o(h)11 b(the)g(\\pro)q(c")f(table)g(lo)q(oking)f(for)h
(a)g(pro)q(cess)74 250 y(whic)o(h:)19 b(is)14 b(stopp)q(ed;)h(matc)o(hes)e
(the)i(giv)o(en)f(pro)q(cess)74 299 y(iden)o(tifying)i(n)o(um)o(b)q(er;)h(is)
g(a)f(c)o(hild)g(of)h(the)g(curren)o(t)74 349 y(pro)q(cess;)-30
429 y Fi(4181:)k Fn(W)m(ait)8 b(for)i(the)g(\\ip)q(c")g(structure)i(to)d(b)q
(ecome)h(a)o(v)n(ail-)74 479 y(able)k(if)f(it)g(is)h(curren)o(tly)h(in)e
(use;)-30 559 y Fi(4183:)21 b Fn(Cop)o(y)13 b(the)i(parameters)f(in)o(to)f
(\\ip)q(c")g(...)-30 639 y Fi(4187:)21 b Fn(reset)15 b(the)g(\\SWTED")e
(\015ag,)g(and)h(...)-30 719 y Fi(4188:)21 b Fn(return)15 b(the)g(c)o(hild)e
(to)h(a)f(\\ready)h(to)g(run")g(state;)-30 799 y Fi(4189:)21
b Fn(Sleep)10 b(un)o(til)e(\\ip)q(c.ip)p 421 799 13 2 v 14
w(req")i(is)f(nonp)q(ositiv)o(e)g(\(4212\);)-30 879 y Fi(4191:)21
b Fn(Extract)g(a)g(v)n(alue)f(that)g(is)h(to)f(b)q(e)i(returned)g(to)74
928 y(the)e(paren)o(t)g(pro)q(cess,)i(c)o(hec)o(k)e(for)f(errors,)j(unlo)q(c)
o(k)74 978 y(\\ip)q(c")d(and)g(\\w)o(ak)o(e)g(up")g(an)o(y)g(pro)q(cesses)j
(w)o(aiting)74 1028 y(for)14 b(\\ip)q(c".)33 1111 y(Note)j(that)g(the)g
(\\sleeps")h(on)f(lines)f(4182,)g(4190)g(are)-30 1161 y(for)i(essen)o(tially)
g(di\013eren)o(t)h(reasons,)g(and)f(could)f(b)q(e)i(dif-)-30
1211 y(feren)o(tiated)h(to)e(go)q(o)q(d)g(e\013ect)i(b)o(y)e(replacing)g
(\\&ip)q(c")g(b)o(y)-30 1261 y(\\&ip)q(c.ip)p 126 1261 V 15
w(req")c(on)g(lines)f(4190)g(and)h(4213.)-30 1376 y Fg(13.25)56
b(pro)r(cxm)n(t)17 b(\(4204\))-30 1452 y Fn(This)c(pro)q(cedure)h(is)e
(executed)i(b)o(y)e(the)g(c)o(hild)g(pro)q(cess)i(un-)-30 1502
y(der)k(the)f(in\015uence)g(of)f(data)g(left)g(b)o(y)g(the)h(paren)o(t)g(in)f
(the)-30 1552 y(ip)q(c)f(structure.)-30 1636 y Fi(4209:)21
b Fn(If)e(\\ip)q(c.ip)p 271 1636 V 14 w(lo)q(c)o(k")f(is)h(set)h(wrongly)e
(for)h(the)g(cur-)74 1685 y(ren)o(t)e(pro)q(cess,)g(then)f(certainly)g(the)g
(rest)h(of)e(\\ip)q(c")74 1735 y(should)f(b)q(e)g(ignored.)33
1819 y(After)d(\\stop")f(\(4027\))f(calls)h(\\swtc)o(h",)h(the)f(c)o(hide)h
(pro-)-30 1869 y(cess)19 b(is)e(restarted)i(b)o(y)e(one)g(of)f(three)j(calls)
d(on)h(\\setrun")-30 1918 y(whic)o(h)j(lea)o(v)o(e)f(the)h(\\STR)o(C")f(and)g
(\\SWTED")g(\015ags)g(in)-30 1968 y(the)c(state)g(indicated:)323
2091 y(STR)o(C)50 b(SWTED)f(ip)q(c.ip)q(c)p 813 2091 V 15 w(lo)q(c)o(k)p
-30 2107 963 2 v -5 2142 a(exit)95 b(\(3254\))49 b(set)113
b(set)155 b(arbitrary)-5 2192 y(w)o(ait)85 b(\(3310\))49 b(reset)79
b(reset)121 b(arbitrary)-5 2242 y(ptrace)51 b(\(4188\))e(set)113
b(reset)121 b(prop)q(erly)14 b(set)33 2323 y(In)9 b(the)h(third)f(case)h
(\\ptrace")g(will)e(alw)o(a)o(ys)g(set)i(\\ip)q(c.ip)p 879
2323 13 2 v 15 w(lo)q(c)o(k")-30 2373 y(prop)q(erly)m(,)j(b)q(efore)g(the)g
(c)o(hild)e(is)i(restarted,)h(so)e(that)g(there)-30 2423 y(is)20
b(then)g(no)g(c)o(hance)h(of)e(the)h(test)h(on)e(4209)g(in)o(to)g(\\ip)q(c")
-30 2473 y(failing.)33 2523 y(In)10 b(the)h(second)g(case,)h(where)g(the)e
(paren)o(t)h(has)g(ignored)-30 2573 y(the)k(c)o(hild,)e(\\pro)q(cxm)o(t")f
(will)h(nev)o(er)i(in)e(fact)h(b)q(e)g(called.)33 2622 y(By)e(executing)g
(the)h(statemen)o(t)f(\\return\(0\)";)h(on)e(line)-30 2672
y(4210,)i(\\pro)q(cxm)o(t")g(forces)j(\\stop")e(to)g(lo)q(op)g(bac)o(k)g(to)g
(line)-30 2722 y(4020.)38 b(In)21 b(the)g(case)h(where)g(the)f(paren)o(t)g
(has)g(already)-30 2772 y(died,)14 b(the)h(test)g(on)f(line)f(4022)g(will)g
(then)i(fail,)d(and)i(a)f(call)-30 2822 y(on)h(\\exit")g(\(4032\))f(will)f
(result.)1010 17 y Fi(4211:)20 b Fn(Store)c(the)f(v)n(alue)g(of)f(\\ip)q
(c.ip)p 1602 17 V 14 w(req")h(b)q(efore)h(reset-)1114 66 y(ting)k(the)h
(latter,)h(\\w)o(ak)o(e)f(up")f(the)i(paren)o(t,)g(and)1114
116 y(select)15 b(the)f(next)h(action)e(as)h(indicated.)1072
208 y(The)f(v)n(arious)f(actions)g(are)h(adequately)f(explained)h(in)1010
257 y(Section)h(\\PTRA)o(CE)f(\(I)q(I\)")g(of)g(the)h(UPM,)g(with)f(the)h
(one)1010 307 y(quali\014cation)21 b(that)h(cases)h(1,)h(2)e(and)g(4,)h(5)f
(are)h(do)q(cu-)1010 357 y(men)o(ted)17 b(the)i(wrong)f(w)o(a)o(y)f(around)h
(\(i.e.)30 b(\\I")18 b(and)g(\\D")1010 407 y(spaces)d(resp)q(ectiv)o(ely)m(,)
g(not)e(\\D")g(and)h(\\I"!\).)1890 2946 y(59)p eop
%%Page: 60 68
67 bop -30 -144 a Fk(14)43 b(PR)o(OGRAM)16 b(SW)m(APPING)838
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(Section)22
b(Three)-30 66 y Fe(Section)e(Three)g(is)e(concerned)j(with)e(basic)g
(input/output)-30 116 y(op)q(erations)f(b)q(et)o(w)o(een)h(the)f(main)e(memo)
o(ry)f(and)i(disk)g(sto)o(r-)-30 166 y(age.)33 216 y(These)c(op)q(erations)f
(a)o(re)g(fundamental)g(to)g(the)g(activities)-30 266 y(of)f(p)o(rogram)g(sw)
o(apping)h(and)g(the)h(creation)f(and)g(referencing)-30 316
y(of)i(disk)g(\014les.)33 365 y(This)d(section)h(also)f(intro)q(duces)i(p)o
(ro)q(cedures)h(fo)o(r)c(the)i(use)-30 415 y(and)j(manipulation)f(of)f(the)i
(la)o(rge)f(\(512)f(b)o(yte\))i(bu\013ers.)-30 549 y Fj(14)70
b(Program)22 b(Sw)n(apping)-30 640 y Fn(UNIX,)11 b(lik)o(e)g(all)f
(time-sharing)f(systems,)j(and)f(some)f(m)o(ul-)-30 690 y(tiprogramming)15
b(systems)k(uses)i(\\program)c(sw)o(apping")-30 739 y(\(also)h(called)g
(\\rollin/roll-out"\))d(to)j(share)h(the)g(limited)-30 789
y(resource)f(of)d(the)i(main)c(ph)o(ysical)i(memory)f(among)f(sev-)-30
839 y(eral)h(pro)q(cesses.)33 889 y(Pro)q(cesses)24 b(whic)o(h)c(are)i(susp)q
(ended)h(ma)o(y)c(b)q(e)j(selec-)-30 939 y(tiv)o(ely)g(\\sw)o(app)q(ed)h
(out")f(b)o(y)g(writing)g(their)g(data)g(seg-)-30 988 y(men)o(ts)g
(\(including)f(the)i(\\p)q(er)g(pro)q(cess)h(data"\))e(in)o(to)f(a)-30
1038 y(\\sw)o(ap)14 b(area")g(on)g(disk)33 1088 y(The)25 b(main)d(memory)g
(area)i(whic)o(h)g(w)o(as)h(o)q(ccupied)-30 1138 y(can)20 b(then)g(b)q(e)g
(reassigned)h(to)e(other)h(pro)q(cesses,)j(whic)o(h)-30 1188
y(quite)11 b(probably)e(will)g(b)q(e)h(\\sw)o(app)q(ed)h(in")e(from)f(the)j
(\\sw)o(ap)-30 1238 y(area".)33 1287 y(Most)g(of)f(the)i(decisions)g
(regarding)e(\\sw)o(apping)g(out",)-30 1337 y(and)16 b(all)f(the)i(decisions)
f(regarding)g(\\sw)o(apping)f(in",)g(are)-30 1387 y(made)g(b)o(y)g(the)h(pro)
q(cedure)h(\\sc)o(hed".)23 b(\\Sw)o(apping)14 b(in")h(is)-30
1437 y(handled)k(b)o(y)g(a)g(direct)h(call)e(\(2034\))g(on)h(the)h(pro)q
(cedure)-30 1487 y(\\sw)o(ap")13 b(\(5196\),)g(whereas)i(\\sw)o(apping)d
(out")h(is)h(handled)-30 1536 y(b)o(y)g(a)g(call)f(\(2024\))g(on)h(\\xsw)o
(ap")f(\(4368\).)33 1586 y(F)m(or)g(those)i(arc)o(haeologists)e(who)h(lik)o
(e)f(to)h(p)q(onder)g(the)-30 1636 y(\\b)q(ones")h(of)f(earlier)h(v)o
(ersions)g(of)f(op)q(erating)h(systems,)f(it)-30 1686 y(seems)d(that)f
(originally)d(\\sc)o(hed")k(called)f(\\sw)o(ap")f(directly)-30
1736 y(to)15 b(\\sw)o(ap)g(out")g(pro)q(cesses,)i(rather)f(than)f(via)f
(\\xsw)o(ap".)-30 1786 y(The)21 b(extra)g(pro)q(cedure)h(\(one)e(of)g(sev)o
(eral)g(to)g(b)q(e)h(found)-30 1835 y(in)e(the)h(\014le)f(\\text.c"\))g(has)h
(b)q(een)g(necessitated)h(b)o(y)e(the)-30 1885 y(implemen)o(tation)11
b(of)i(the)i(sharable)f(\\text)g(segmen)o(ts".)33 1935 y(It)9
b(is)g(instructiv)o(e)h(to)f(estimate)g(ho)o(w)g(m)o(uc)o(h)f(extra)i(co)q
(de)-30 1985 y(has)15 b(b)q(een)h(necessitated)h(b)o(y)d(the)h(text)g(segmen)
o(t)f(feature:)-30 2035 y(in)i(\\text.c")g(are)g(four)g(pro)q(cedures)i
(\\xsw)o(ap",)e(\\xallo)q(c",)-30 2084 y(\\xfree")i(and)g(\\xccdec",)h(whic)o
(h)f(manipulate)d(an)j(arra)o(y)-30 2134 y(of)13 b(structures)i(called)e
(\\text",)f(whic)o(h)h(is)g(declared)h(in)e(the)-30 2184 y(\014le)j
(\\text.h".)21 b(Additional)14 b(co)q(de)i(has)f(also)f(b)q(een)i(added)-30
2234 y(to)e(\\sysl.c")g(and)f(\\slp.c".)-30 2346 y Fg(14.1)56
b(T)-5 b(ext)18 b(Segmen)n(ts)-30 2423 y Fn(T)m(ext)24 b(segmen)o(ts)g(are)g
(segmen)o(ts)g(whic)o(h)f(con)o(tain)g(only)-30 2473 y(\\pure")e(co)q(de)h
(and)e(data)g(i.e.)38 b(co)q(de)21 b(and)g(data)f(whic)o(h)-30
2523 y(remain)f(unaltered)h(throughout)g(the)g(program)f(execu-)-30
2573 y(tion,)e(so)g(that)f(they)h(ma)o(y)e(b)q(e)j(shared)f(amongst)e(sev)o
(eral)-30 2622 y(pro)q(cesses)i(executing)e(the)f(same)f(program.)33
2672 y(The)k(resulting)h(economies)e(in)h(space)h(can)g(b)q(e)g(quite)-30
2722 y(substan)o(tial)c(when)h(man)o(y)e(users)j(of)e(the)h(system)f(are)h
(ex-)-30 2772 y(ecuting)i(the)f(same)f(program)f(sim)o(ultaneously)f(e.g.)23
b(the)-30 2822 y(editor)15 b(or)e(the)i(\\shell".)1072 17 y(Information)8
b(ab)q(out)i(text)h(segmen)o(ts)f(m)o(ust)f(b)q(e)i(stored)1010
66 y(in)g(a)h(cen)o(tral)g(lo)q(cation,)f(and)h(hence)h(the)g(existence)g(of)
e(the)1010 116 y(\\text")20 b(arra)o(y)m(.)34 b(Eac)o(h)20
b(program)e(whic)o(h)h(shares)i(a)e(text)1010 166 y(segmen)o(t)c(k)o(eeps)h
(a)f(p)q(oin)o(ter)h(to)f(the)h(corresp)q(onding)g(text)1010
216 y(arra)o(y)d(elemen)o(t)h(in)f(\\u.u)p 1401 216 13 2 v
15 w(textp".)1072 267 y(The)j(text)g(segmen)o(t)g(is)f(stored)i(at)e(the)i(b)
q(eginning)e(of)1010 317 y(the)f(co)q(de)h(\014le.)j(The)c(\014rst)h(program)
d(to)i(b)q(egin)f(execution)1010 366 y(causes)g(a)e(cop)o(y)g(of)g(the)h
(text)g(segmen)o(t)f(to)g(b)q(e)h(made)e(in)h(the)1010 416
y(\\sw)o(ap")i(area.)1072 467 y(When)i(subsequen)o(tly)h(no)e(programs)g(are)
h(left)f(whic)o(h)1010 517 y(reference)j(the)e(text)g(segmen)o(t,)f(the)h
(resources)i(absorb)q(ed)1010 567 y(b)o(y)e(the)g(text)h(segmen)o(t)f(are)g
(released.)23 b(The)16 b(main)d(mem-)1010 616 y(ory)g(resource)j(is)e
(released)h(whenev)o(er)g(there)g(are)f(no)f(pro-)1010 666
y(grams)c(whic)o(h)h(reference)j(the)e(text)f(segmen)o(t)g(curren)o(tly)i(in)
1010 716 y(main)i(memory;)f(the)k(\\sw)o(ap")e(area)h(is)g(released)h(in)e
(gen-)1010 766 y(eral)j(whenev)o(er)h(there)h(are)e(no)g(programs)f(left)g
(running)1010 816 y(whic)o(h)d(reference)i(the)e(text)h(segmen)o(t.)1072
866 y(The)d(n)o(um)o(b)q(ers)f(in)g(eac)o(h)h(of)f(these)i(states)f(are)g
(denoted)1010 916 y(b)o(y)17 b(\\x)p 1116 916 V 14 w(ccoun)o(t")h(and)f(\\x)p
1414 916 V 15 w(coun)o(t")g(resp)q(ectiv)o(ely)m(.)29 b(Decre-)1010
966 y(men)o(ting)14 b(these)j(n)o(um)o(b)q(ers)f(is)g(handled)f(b)o(y)h(the)g
(routines)1010 1016 y(\\xccdec")21 b(and)f(\\xfree")g(whic)o(h)f(also)h(tak)o
(e)g(care)g(of)g(re-)1010 1066 y(leasing)12 b(resources)j(when)e(the)g(coun)o
(ts)g(reac)o(h)h(zero.)k(\(\\xc-)1010 1116 y(cdec")c(is)f(called)g(whenev)o
(er)i(a)e(program)f(is)h(sw)o(app)q(ed)h(out)1010 1165 y(or)f(terminates.)18
b(\\xfree")13 b(is)h(called)f(b)o(y)g(\\exit")g(whenev)o(er)1010
1215 y(a)g(program)g(terminates.\))1010 1337 y Fg(14.2)56 b(sc)n(hed)18
b(\(1940\))1010 1415 y Fn(Pro)q(cess)d(#0)e(executes)j(\\sc)o(hed".)j(When)14
b(it)f(is)g(not)h(w)o(ait-)1010 1465 y(ing)9 b(for)h(the)h(completion)e(of)g
(an)h(input/output)g(op)q(eration)1010 1515 y(that)h(it)f(has)h(initiated,)f
(it)g(sp)q(ends)i(most)e(of)g(its)h(time)e(w)o(ait-)1010 1565
y(ing)k(in)g(one)i(of)e(the)h(follo)o(wing)e(situations:)1010
1660 y Fi(A.)k(\(runout\))i Fn(None)9 b(of)g(the)h(pro)q(cesses)i(whic)o(h)d
(are)h(sw)o(ap-)1114 1710 y(p)q(ed)j(out)f(is)g(ready)g(to)h(run,)f(so)g
(that)h(there)g(is)f(noth-)1114 1760 y(ing)i(to)h(do.)23 b(The)15
b(situation)g(ma)o(y)f(b)q(e)i(c)o(hanged)f(b)o(y)1114 1809
y(a)h(call)g(to)h(\\w)o(ak)o(eup",)g(or)g(to)f(\\xsw)o(ap")h(called)f(b)o(y)
1114 1859 y(either)e(\\newpro)q(c")h(or)f(\\expand".)1010 1946
y Fi(B.)i(\(runin\))h Fn(There)f(is)e(at)g(least)h(one)f(pro)q(cess)i(sw)o
(app)q(ed)1114 1996 y(out)e(and)h(ready)h(to)e(run,)h(but)h(it)e(hasn't)h(b)q
(een)h(out)1114 2046 y(more)d(than)h(3)g(seconds)h(and/or)f(none)g(of)g(the)g
(pro-)1114 2096 y(cesses)20 b(presen)o(tly)g(in)d(main)g(memory)e(is)j
(inactiv)o(e)1114 2145 y(or)d(has)h(b)q(een)g(there)h(more)d(than)h(2)h
(seconds.)24 b(The)1114 2195 y(situation)14 b(ma)o(y)f(b)q(e)j(c)o(hanged)f
(b)o(y)g(the)g(e\017uxion)g(of)1114 2245 y(time)g(as)i(measured)g(b)o(y)g
(\\clo)q(c)o(k")f(or)h(b)o(y)g(a)f(call)g(to)1114 2295 y(\\sleep".)1010
2390 y(When)e(either)h(of)e(these)i(situations)f(terminate:)1010
2486 y Fi(1958:)20 b Fn(With)c(the)h(pro)q(cessor)h(running)e(at)g(priorit)o
(y)g(six,)1114 2535 y(so)g(that)g(the)h(clo)q(c)o(k)f(can't)g(in)o(terrupt)h
(and)f(c)o(hange)1114 2585 y(v)n(alues)g(of)h(\\p)p 1337 2585
V 15 w(time",)f(a)g(searc)o(h)j(is)e(made)f(for)g(the)1114
2635 y(pro)q(cess)j(whic)o(h)f(is)g(ready)g(to)g(run)g(and)g(has)g(b)q(een)
1114 2685 y(sw)o(app)q(ed)c(out)g(for)g(the)g(longest)g(time;)1010
2772 y Fi(1966:)20 b Fn(If)15 b(there)h(is)f(no)f(suc)o(h)i(pro)q(cess)g
(then)g(situation)e(A)1114 2822 y(holds;)-30 2946 y(60)p eop
%%Page: 61 69
68 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)837
b(14)43 b(PR)o(OGRAM)15 b(SW)m(APPING)-30 17 y Fi(1976:)21
b Fn(Searc)o(h)14 b(for)f(a)g(main)f(memory)f(area)i(of)g(adequate)74
66 y(size)18 b(to)g(hold)e(the)i(data)f(segmen)o(t.)28 b(If)17
b(an)h(asso)q(ci-)74 116 y(ated)h(text)f(segmen)o(t)g(m)o(ust)f(b)q(e)h
(presen)o(t)i(also)d(but)74 166 y(is)f(not)f(curren)o(tly)i(in)e(main)e
(memory)m(,)g(the)j(area)g(is)74 216 y(increased)f(b)o(y)f(the)h(size)f(of)g
(the)g(text)h(segmen)o(t;)-30 304 y Fi(1982:)21 b Fn(If)c(an)h(area)f(of)h
(adequate)g(size)g(is)g(a)o(v)n(ailable)d(the)74 354 y(program)e(branc)o(hes)
i(to)f(\\found2")f(\(2031\).)18 b(\(Note)74 404 y(that)i(the)h(program)d(do)q
(es)j(not)f(handle)g(the)h(case)74 453 y(where)f(there)f(is)f(su\016cien)o(t)
h(space)g(for)f(b)q(oth)g(text)74 503 y(and)j(data)g(segmen)o(ts)g(but)h(in)e
(distinct)i(areas)f(of)74 553 y(main)c(memory)m(.)31 b(W)m(ould)18
b(it)g(b)q(e)i(w)o(orth)f(while)g(to)74 603 y(extend)c(the)g(co)q(de)f(to)g
(co)o(v)o(er)g(this)g(p)q(ossibilit)o(y?\);)-30 691 y Fi(1990:)21
b Fn(Searc)o(h)15 b(for)f(a)g(pro)q(cess)i(whic)o(h)e(is)g(in)f(main)f(mem-)
74 741 y(ory)m(,)j(but)g(whic)o(h)g(is)g(not)g(the)g(sc)o(heduler)i(or)e(lo)q
(c)o(k)o(ed)74 791 y(\(i.e.)22 b(already)15 b(b)q(eing)h(sw)o(app)q(ed)g
(out\),)f(and)g(whose)74 841 y(state)g(is)f(\\SW)-5 b(AIT")13
b(or)h(\\SSTOP")g(\(but)g Fi(not)74 890 y Fn(\\SSLEEP"\))f(\(i.e.)k(the)c
(pro)q(cess)h(is)e(w)o(aiting)f(for)h(an)74 940 y(ev)o(en)o(t)k(of)e(lo)o(w)g
(precedence,)k(or)d(has)g(stopp)q(ed)h(dur-)74 990 y(ing)11
b(tracing)h(\(see)i(Chapter)e(Thirteen\)\).)19 b(If)11 b(suc)o(h)i(a)74
1040 y(pro)q(cess)j(is)d(found,)g(go)h(to)f(line)g(2021,)g(to)g(sw)o(ap)h
(the)74 1090 y(image)e(out.)74 1159 y(Note)27 b(that)f(there)i(seems)e(to)h
(b)q(e)g(a)f(bias)g(here)74 1208 y(against)d(pro)q(cesses)k(whose)d(\\pro)q
(c")g(en)o(tries)g(are)74 1258 y(early)14 b(in)f(the)i(\\pro)q(c")f(arra)o
(y;)-30 1346 y Fi(2003:)21 b Fn(If)14 b(the)h(image)d(to)i(b)q(e)h(sw)o(app)q
(ed)f(in)g(has)g(b)q(een)i(out)74 1396 y(less)f(than)f(3)f(seconds,)i(then)g
(situation)e(B)h(holds;)-30 1484 y Fi(2005:)21 b Fn(Searc)o(h)c(for)e(the)h
(pro)q(cess)i(whic)o(h)e(is)f(loaded,)g(but)74 1534 y(is)21
b(not)f(the)i(sc)o(heduler)g(or)f(lo)q(c)o(k)o(ed,)h(whose)f(state)74
1584 y(is)16 b(\\SR)o(UN")f(or)g(\\SSLEEP")h(\(i.e.)23 b(ready)16
b(to)g(run,)74 1634 y(or)j(w)o(aiting)f(for)h(an)g(ev)o(en)o(t)h(of)f(high)f
(precedence)q(\))74 1684 y(and)d(whic)o(h)h(has)f(b)q(een)i(in)e(main)e
(memory)g(for)i(the)74 1733 y(longest)f(time;)-30 1821 y Fi(2013:)21
b Fn(If)14 b(the)h(pro)q(cess)h(image)d(to)h(b)q(e)h(sw)o(app)q(ed)g(out)g
(has)74 1871 y(b)q(een)f(in)e(main)e(memory)f(for)j(less)h(than)g(2)f
(seconds,)74 1921 y(then)j(situation)e(B)h(holds.)74 1990 y(The)k(constan)o
(t)g(\\2")f(here)i(\(also)e(the)h(\\3")f(on)g(line)74 2040
y(2003\))10 b(is)h(somewhat)g(arbitrary)m(.)16 b(F)m(or)11
b(some)f(reason)74 2090 y(the)16 b(programmer)c(has)j(departed)h(from)d(his)i
(usual)74 2140 y(practice)h(of)e(naming)e(suc)o(h)j(constan)o(ts)h(to)e
(empha-)74 2189 y(sise)h(their)f(origins;)-30 2277 y Fi(2022:)21
b Fn(The)c(pro)q(cess)h(image)c(is)i(\015agged)g(as)h(not)f(loaded)74
2327 y(and)e(is)g(sw)o(app)q(ed)g(out)g(using)g(\\xsw)o(ap")f(\(4368\).)74
2396 y(Note)k(that)g(the)g(\\SSW)-5 b(AP")17 b(\015ag)f(is)g(not)h(set)h
(here)74 2446 y(b)q(ecause)i(the)g(pro)q(cess)g(sw)o(app)q(ed)f(out)f(is)h
(not)f(the)74 2496 y(curren)o(t)e(pro)q(cess.)j(\(Cf.)f(lines)c(1907,)e
(2286\);)-30 2584 y Fi(2032:)21 b Fn(Read)13 b(the)g(text)h(segmen)o(t)f(in)o
(to)f(main)f(memory)g(if)74 2634 y(necessary)m(.)33 b(Note)19
b(that)f(the)h(argumen)o(ts)f(for)g(the)74 2684 y(\\sw)o(ap")c(pro)q(cedure)h
(are:)124 2772 y Fl(\017)21 b Fn(an)16 b(address)j(within)d(the)i(sw)o(ap)f
(area)g(of)f(the)166 2822 y(disk;)1163 17 y Fl(\017)21 b Fn(a)11
b(main)d(memory)h(address)j(\(ordinal)e(n)o(um)o(b)q(er)1205
66 y(of)j(a)h(32)f(w)o(ord)h(blo)q(c)o(k\);)1163 136 y Fl(\017)21
b Fn(a)16 b(size)h(\(n)o(um)o(b)q(er)f(of)g(32)g(w)o(ord)h(blo)q(c)o(ks)f(to)
g(b)q(e)1205 185 y(transferred\);)1163 254 y Fl(\017)21 b Fn(a)k(direction)g
(indicator)g(\(\\B)p 1690 254 13 2 v 15 w(READ==1")1205 304
y(denotes)15 b(\\disk)f(to)f(main)f(memory"\);)1010 393 y Fi(2042:)20
b Fn(Sw)o(ap)14 b(in)f(the)i(data)e(segmen)o(t)h(and)g(...)1010
481 y Fi(2044:)20 b Fn(Release)d(the)f(disk)g(sw)o(ap)f(area)h(to)g(the)g(a)o
(v)n(ailable)1114 531 y(list,)25 b(record)f(the)h(main)c(memory)g(address,)27
b(set)1114 581 y(the)13 b(\\SLO)o(AD")e(\015ag)h(and)g(reset)i(the)f(accum)o
(ulated)1114 630 y(time)f(indicator.)1010 754 y Fg(14.3)56
b(xsw)n(ap)19 b(\(4368\))1010 833 y Fi(4373:)h Fn(If)d(\\oldsize")f(data)h(w)
o(as)g(not)f(supplied,)i(use)f(the)1114 882 y(curren)o(t)11
b(size)g(of)f(the)h(data)f(segmen)o(t)g(stored)h(in)f(\\u";)1010
971 y Fi(4375:)20 b Fn(Find)d(a)f(space)i(in)f(the)g(disk)g(sw)o(ap)g(area)g
(for)f(the)1114 1021 y(pro)q(cess's)i(data)f(segmen)o(t.)26
b(\(Note)17 b(that)g(the)g(disk)1114 1070 y(sw)o(ap)12 b(area)h(is)f(allo)q
(cated)g(in)g(terms)g(of)g(512)g(c)o(harac-)1114 1120 y(ter)i(blo)q(c)o
(ks\);)1010 1209 y Fi(4378:)20 b Fn(\\xccdec")d(\(4490\))d(is)h(called)g
(\(unconditionally!\))1114 1258 y(to)9 b(decrease)i(the)f(coun)o(t,)g(asso)q
(ciated)g(with)g(the)f(text)1114 1308 y(segmen)o(t,)i(of)h(the)g(n)o(um)o(b)q
(er)g(of)f(\\in)h(main)e(memory")1114 1358 y(pro)q(cesses)18
b(whic)o(h)e(reference)i(that)e(text)h(segmen)o(t.)1114 1408
y(If)d(the)h(coun)o(t)f(b)q(ecomes)h(zero,)g(the)g(main)e(memory)1114
1458 y(area)j(o)q(ccupied)i(b)o(y)e(the)h(text)g(segmen)o(t)g(is)f(simply)
1114 1507 y(returned)g(to)f(the)g(a)o(v)n(ailable)d(space.)22
b(\(There)16 b(is)e(no)1114 1557 y(need)21 b(to)f(cop)o(y)g(it)f(out,)j
(since,)g(as)e(w)o(e)g(shall)f(see,)1114 1607 y(there)c(will)e(b)q(e)i(a)f
(cop)o(y)g(already)g(in)f(the)i(disk)f(sw)o(ap)1114 1657 y(area\);)1010
1745 y Fi(4379:)20 b Fn(The)k(\\SLOCK")g(\015ag)f(is)h(set)h(while)e(the)h
(pro-)1114 1795 y(cess)d(is)f(b)q(eing)h(sw)o(app)q(ed)f(out.)37
b(This)20 b(is)g(to)g(pre-)1114 1845 y(v)o(en)o(t)15 b(\\sc)o(hed")g(from)e
(attempting)g(to)i(\\sw)o(ap)f(out")1114 1895 y(a)j(pro)q(cess)j(whic)o(h)e
(is)g(already)g(in)f(the)i(pro)q(cess)h(of)1114 1944 y(b)q(eing)f(\\sw)o(app)
q(ed)h(out".)36 b(\(This)19 b(can)h(only)f(hap-)1114 1994 y(p)q(en)12
b(if)f(\\sw)o(apping)g(out")g(w)o(as)h(started)h(initially)c(b)o(y)1114
2044 y(some)j(routine)i(other)g(than)g(\\sc)o(hed")g(e.g.)k(b)o(y)13
b(\\ex-)1114 2094 y(pand"\);)1010 2182 y Fi(4382:)20 b Fn(The)c(main)d
(memory)f(image)h(is)i(released)i(except)1114 2232 y(when)d(\\xsw)o(ap")f(is)
h(called)g(b)o(y)f(\\newpro)q(c";)1010 2320 y Fi(4388:)20 b
Fn(If)j(\\runout")f(is)g(set,)k(\\sc)o(hed")d(is)f(w)o(aiting)f(for)1114
2370 y(something)12 b(to)i(\\sw)o(ap)g(in",)e(so)i(w)o(ak)o(e)g(it)f(up.)1010
2493 y Fg(14.4)56 b(xallo)r(c)17 b(\(4433\))1010 2573 y Fn(\\xallo)q(c")i(is)
h(called)h(b)o(y)f(\\exec")h(\(3130\),)g(when)g(a)g(new)1010
2622 y(program)11 b(is)h(b)q(eing)h(initiated,)e(to)i(handle)f(the)i(allo)q
(cation)1010 2672 y(of,)g(or)g(linking)f(to,)i(the)g(text)g(segmen)o(t.)20
b(The)c(argumen)o(t,)1010 2722 y(\\ip",)11 b(is)h(a)f(p)q(oin)o(ter)i(to)f
(the)g(\\mo)q(de")f(of)g(the)i(co)q(de)g(\014le.)k(A)o(t)1010
2772 y(the)e(time)e(of)g(this)i(call,)e(\\u.u)p 1475 2772 V
14 w(arg[1]")f(con)o(tains)j(the)f(text)1010 2822 y(segmen)o(t)f(size)i(in)e
(b)o(ytes.)1890 2946 y(61)p eop
%%Page: 62 70
69 bop -30 -144 a Fk(14)43 b(PR)o(OGRAM)16 b(SW)m(APPING)838
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(4439:)21
b Fn(If)15 b(there)i(is)e(no)g(text)h(segmen)o(t,)f(return)i(immedi-)74
66 y(ately;)-30 154 y Fi(4441:)k Fn(Lo)q(ok)16 b(through)g(the)h(\\text")f
(arra)o(y)h(for)e(b)q(oth)i(an)74 204 y(un)o(used)i(en)o(try)f(and)g(an)g(en)
o(try)g(for)f(the)i(text)f(seg-)74 254 y(men)o(t.)e(If)11 b(the)h(latter)f
(can)h(b)q(e)g(found,)e(do)h(the)h(b)q(o)q(ok-)74 304 y(k)o(eeping)i(and)g
(go)f(to)h(\\out")f(\(4474\);)-30 391 y Fi(4452:)21 b Fn(Arrange)d(to)f(cop)o
(y)g(the)h(text)g(segmen)o(t)f(in)o(to)f(the)74 441 y(disk)e(sw)o(ap)f(area.)
19 b(Initialise)12 b(the)i(un)o(used)h(text)f(en-)74 491 y(try)m(,)f(and)h
(get)g(space)h(in)f(the)g(disk)g(sw)o(ap)g(area;)-30 579 y
Fi(4459:)21 b Fn(Change)11 b(the)g(space)g(o)q(ccupied)h(b)o(y)e(the)h(pro)q
(cess)i(to)74 629 y(one)i(large)f(enough)h(to)f(con)o(tain)g(the)h(\\p)q(er)g
(pro)q(cess)74 678 y(data")f(area)g(and)f(the)i(text)f(segmen)o(t;)-30
766 y Fi(4460:)21 b Fn(The)12 b(call)f(on)h(\\estabur")h(is)e(necessary)j(to)
e(set)h(the)74 816 y(user)f(mo)q(de)d(segmen)o(tation)h(registers)i(b)q
(efore)f(read-)74 866 y(ing)i(the)i(co)q(de)g(\014le;)-30 954
y Fi(4461:)21 b Fn(A)f(UNIX)h(pro)q(cess)h(can)f(only)e(initiate)h(one)g(in-)
74 1003 y(put/output)d(op)q(eration)f(at)h(a)f(time.)25 b(Hence)18
b(it)e(is)74 1053 y(p)q(ossible)h(to)g(store)g(i/o)f(parameters)h(at)f
(standard)74 1103 y(lo)q(cations)9 b(in)g(the)h(\\u")e(structure,)k(viz.)17
b(\\u.u)p 776 1103 13 2 v 14 w(coun)o(t",)74 1153 y(\\u.u)p
155 1153 V 15 w(o\013set[)d(]")f(and)h(\\u.u)p 497 1153 V 14
w(base";)-30 1241 y Fi(4462:)21 b Fn(The)12 b(o)q(ctal)g(v)n(alue)g(020)f
(\(decimal)f(16\))i(is)g(an)g(o\013set)74 1290 y(in)o(to)h(the)i(co)q(de)g
(\014le;)-30 1378 y Fi(4463:)21 b Fn(Information)14 b(is)i(to)g(b)q(e)h(read)
g(in)o(to)f(the)h(area)f(b)q(e-)74 1428 y(ginning)h(at)h(lo)q(cation)g(zero)h
(in)f(the)h(user)g(address)74 1478 y(space;)-30 1566 y Fi(4464:)i
Fn(Read)15 b(the)g(text)h(segmen)o(t)f(part)g(of)f(the)i(co)q(de)g(\014le)74
1615 y(in)o(to)d(the)i(curren)o(t)g(data)f(segmen)o(t;)-30
1703 y Fi(4467:)21 b Fn(\\Sw)o(ap)g(out")g(the)h(data)f(segmen)o(t)g(\(min)o
(us)f(the)74 1753 y(\\p)q(er)f(pro)q(cess)g(data"\))e(in)o(to)g(the)h(disk)g
(sw)o(ap)g(area)74 1803 y(reserv)o(ed)e(for)e(the)g(text)h(segmen)o(t;)-30
1891 y Fi(4473:)21 b Fn(\\Shrink")15 b(the)i(data)f(segmen)o(t)f({)h(it)g(is)
g(ab)q(out)g(to)74 1940 y(b)q(e)f(sw)o(app)q(ed)f(out;)-30
2028 y Fi(4475:)21 b Fn(\\sc)o(hed")13 b(alw)o(a)o(ys)f(\\sw)o(aps)g(in")g
(the)h(text)g(segmen)o(t)74 2078 y(b)q(efore)f(the)g(data)g(segmen)o(t)f
(i.e.)16 b(there)d(is)e(no)g(mec)o(h-)74 2128 y(anism)e(for)h(bringing)g(the)
h(text)h(segmen)o(t)e(in)o(to)g(main)74 2178 y(memory)i(once)k(the)f(data)f
(segmen)o(t)g(is)g(presen)o(t.)22 b(If)74 2227 y(the)16 b(text)f(segmen)o(t)f
(is)h(not)g(in)f(main)f(memory)m(,)e(get)74 2277 y(bac)o(k)20
b(in)o(to)f(step)i(b)o(y)f(\\sw)o(apping)f(out")h(the)g(data)74
2327 y(segmen)o(t)14 b(to)f(disk.)33 2423 y(It)19 b(will)f(b)q(e)i(noted)g
(that)f(the)h(co)q(de)h(to)e(handle)g(text)-30 2473 y(segmen)o(ts)f(is)f(v)o
(ery)h(conserv)n(ativ)o(e)g(whenev)o(er)h(the)f(situa-)-30
2523 y(tion)h(starts)h(to)f(get)g(complicated.)32 b(F)m(or)19
b(example,)f(the)-30 2573 y(\\panic")12 b(\(4451\))f(when)h(no)g(more)f(text)
i(en)o(tries)g(are)f(a)o(v)n(ail-)-30 2622 y(able)18 b(w)o(ould)e(seem)i(to)f
(b)q(e)h(a)g(rather)g(extreme)g(reaction.)-30 2672 y(Ho)o(w)o(ev)o(er)12
b(the)g(strategy)h(of)d(b)q(eing)i(generous)g(with)g(\\text")-30
2722 y(arra)o(y)h(space)h(is)f(quite)g(lik)o(ely)f(to)g(b)q(e)i(less)g(exp)q
(ensiv)o(e)g(than)-30 2772 y(the)24 b(co)q(de)f(needed)h(to)f(do)f(\\b)q
(etter".)46 b(What)22 b(do)g(y)o(ou)-30 2822 y(think?)1010
17 y Fg(14.5)56 b(xfree)17 b(\(4398\))1010 93 y Fn(\\xfree")g(is)f(called)g
(b)o(y)h(\\exit")f(\(3233\);)h(when)g(a)f(pro)q(cess)1010 143
y(is)e(b)q(eing)g(terminated,)f(and)h(b)o(y)h(\\exec")f(\(3128\),)g(when)g(a)
1010 193 y(pro)q(cess)i(is)d(b)q(eing)h(transmogri\014ed.)1010
284 y Fi(4402:)20 b Fn(Set)d(the)g(text)g(p)q(oin)o(ter)f(in)g(the)h(\\pro)q
(c")f(en)o(try)h(to)1114 334 y(\\NULL";)1010 417 y Fi(4403:)j
Fn(Decremen)o(t)13 b(the)f(main)e(memory)g(coun)o(t)i(and)g(if)f(it)1114
467 y(is)i(no)o(w)h(zero)h(...)1010 550 y Fi(4406:)20 b Fn(and)12
b(if)f(the)h(text)g(segmen)o(t)f(has)h(not)g(b)q(een)g(\015agged)1114
600 y(to)h(b)q(e)i(sa)o(v)o(ed,)e(...)1010 683 y Fi(4408:)20
b Fn(Abandon)d(the)h(image)d(of)h(the)h(text)h(segmen)o(t)f(in)1114
733 y(the)d(disk)g(sw)o(ap)g(area;)1010 816 y Fi(4411:)20 b
Fn(Call)10 b(\\iput")h(\(7344\))g(to)g(decremen)o(t)h(the)g(\\ino)q(de")1114
865 y(reference)k(coun)o(t)e(and)g(if)f(necessary)j(delete)f(it.)1072
957 y(\\ISVTX")21 b(\(5695\))f(is)g(a)g(mask)g(whic)o(h)g(de\014nes)i(the)
1010 1007 y(\\stic)o(ky)15 b(bit")g(men)o(tioned)f(in)h(section)h
(\\CHMOD\(I\)")f(of)1010 1056 y(the)d(UPM.)g(If)f(this)h(bit)g(is)f(set,)i
(the)f(disk)g(cop)o(y)g(of)f(the)h(text)1010 1106 y(segmen)o(t)h(is)g(allo)o
(w)o(ed)g(to)g(remain)f(in)h(the)h(disk)f(sw)o(ap)h(area)1010
1156 y(ev)o(en)d(when)g(no)f(programs)f(are)h(running)g(whic)o(h)h(reference)
1010 1206 y(it,)i(in)g(the)h(exp)q(ectation)h(that)f(it)f(will)f(b)q(e)j
(required)f(again)1010 1256 y(shortly)m(.)33 b(This)19 b(is)g(an)f(e\016cien)
o(t)i(device)g(for)e(commonly)1010 1305 y(used)d(programs)d(suc)o(h)j(as)f
(the)g(\\shell")g(or)g(the)g(editor.)-30 2946 y(62)p eop
%%Page: 63 71
70 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)657
b(15)43 b(INTR)o(ODUCTION)14 b(TO)g(BASIC)h(I/O)-30 20 y Fj(15)70
b(In)n(tro)r(duction)23 b(to)g(Basic)f(I/O)-30 113 y Fn(There)i(are)e(three)i
(\014les)e(whose)h(con)o(ten)o(ts)g(need)g(to)f(b)q(e)-30 163
y(thoroughly)e(absorb)q(ed)h(b)q(efore)g(the)f(sub)r(ject)i(of)d(UNIX)-30
213 y(input/output)14 b(is)g(broac)o(hed)g(in)g(detail.)-30
336 y Fg(15.1)56 b(The)18 b(File)g(`buf.h')-30 415 y Fn(This)11
b(\014le)g(declares)h(t)o(w)o(o)f(structures)i(called)e(\\buf)s(")f(\(4520\))
-30 465 y(and)21 b(\\devtab")f(\(4551\).)37 b(Instances)22
b(of)e(the)h(structure)-30 515 y(\\buf)s(")d(are)g(declared)h(as)f
('bfreelist)f(\(4567\))h(and)f(as)h(the)-30 565 y(arra)o(y)c(\\buf)s(")f
(\(!\))19 b(\(4535\))13 b(with)g(\\NBUF")i(elemen)o(ts.)33
616 y(The)j(structure)i(\\buf)s(")e(is)f(p)q(ossibly)h(misnamed)d(b)q(e-)-30
666 y(cause)h(it)f(is)f(in)g(fact)h(a)f Fi(bu\013er)i(header)d
Fn(\(or)i(bu\013er)h(con-)-30 716 y(trol)h(blo)q(c)o(k\).)26
b(The)17 b(bu\013er)h(areas)f(prop)q(er)h(are)f(allo)q(cated)-30
765 y(separately)e(and)f(declared)h(\(4720\))e(as)36 863 y
Ff(``char)20 b(buffers)h([NBUF])f([514];'')33 960 y Fn(P)o(oin)o(ters)c(from)
f(the)i(\\buf)s(")e(arra)o(y)h(to)g(the)h(\\bu\013ers")-30
1010 y(arra)o(y)d(are)g(set)h(up)f(b)o(y)g(the)g(pro)q(cedure)i(\\binit".)33
1061 y(Other)i(instances)g(of)f(the)g(structure)i(\\buf)s(")e(are)g(de-)-30
1111 y(clared)27 b(as)g(\\swbuf)s(")f(\(4721\))g(and)g(\\rrkbuf)s(")h
(\(5387\).)-30 1161 y(No)18 b(514)f(c)o(haracter)h(bu\013er)h(areas)f(are)g
(asso)q(ciated)g(with)-30 1210 y(\\bfreelist")c(or)g(\\swbuf)s(")g(or)g
(\\rrkbuf)s(".)33 1262 y(The)h(\\buf)s(")g(structure)i(ma)o(y)c(b)q(e)j
(divided)f(in)o(to)f(three)-30 1311 y(parts:)-30 1408 y Fi(\(a\))i(\015ags)k
Fn(These)13 b(con)o(v)o(ey)g(status)g(information)c(and)j(are)74
1458 y(con)o(tained)21 b(within)f(a)g(single)h(w)o(ord.)38
b(Masks)21 b(for)74 1508 y(setting)10 b(these)h(\015ags)e(are)h(de\014ned)g
(as)g(\\B)p 700 1508 13 2 v 15 w(WRITE",)74 1557 y(\\B)p 126
1557 V 15 w(READ")k(etc.)19 b(in)13 b(lines)h(4572)f(to)g(4586.)-30
1646 y Fi(\(b\))i(list)f(p)q(oin)o(ter)k Fn(F)m(orw)o(ard)g(and)h(bac)o(kw)o
(ard)g(p)q(oin)o(ters)74 1696 y(for)13 b(t)o(w)o(o)f(doubly)h(link)o(ed)f
(lists,)h(whic)o(h)g(w)o(e)g(shall)f(re-)74 1745 y(fer)i(to)g(as)g(the)h
(\\b"-list)d(and)i(the)h(\\a)o(v"-list.)-30 1834 y Fi(\(c\))h(i/o)f
(parameters)k Fn(A)26 b(set)i(of)e(v)n(alues)h(asso)q(ciated)74
1884 y(with)14 b(the)g(actual)g(data)f(transfer.)-30 2007 y
Fg(15.2)56 b(devtab)18 b(\(4551\))-30 2086 y Fn(The)12 b(\\devtab")e
(structure)j(has)e(\014v)o(e)g(w)o(ords,)g(the)g(last)g(four)-30
2136 y(of)j(whic)o(h)g(are)g(forw)o(ard)f(and)h(bac)o(kw)o(ard)g(p)q(oin)o
(ters.)33 2187 y(One)f(instance)h(of)e(\\devtab")g(is)h(declared)g(within)f
(the)-30 2237 y(device)h(handler)g(for)e(eac)o(h)i(blo)q(c)o(k)f(t)o(yp)q(e)g
(of)g(p)q(eripheral)g(de-)-30 2287 y(vice.)27 b(F)m(or)16 b(our)h(mo)q(del)e
(system)i(the)g(only)f(blo)q(c)o(k)g(device)-30 2336 y(is)d(the)h(RK05)e
(disk,)g(and)h(\\rktab")f(is)h(declared)h(as)f(a)g(\\de-)-30
2386 y(vtab")h(structure)i(at)e(line)f(5386.)33 2437 y(The)e(\\devtab")f
(structure)i(con)o(tains)f(some)e(status)i(in-)-30 2487 y(formation)d(for)h
(the)h(the)g(device)h(and)e(serv)o(es)i(as)f(a)f(list)g(head)-30
2537 y(for:)-30 2634 y Fi(\(a\))21 b Fn(the)d(list)g(of)f(bu\013ers)j(asso)q
(ciated)f(with)f(the)g(device,)74 2683 y(and)c(sim)o(ultaneously)e(on)h(the)i
(\\a)o(v"-list;)-30 2772 y Fi(\(b\))20 b Fn(the)15 b(list)e(of)h(outstanding)
g(i/o)f(requests)j(for)e(the)g(de-)74 2822 y(vice.)1010 17
y Fg(15.3)56 b(The)18 b(File)f(`conf.h')1010 94 y Fn(The)d(\014le)g
(\\conf.h")f(declares:)1072 186 y Fl(\017)21 b Fn(y)o(et)12
b(another)g(w)o(a)o(y)f(to)h(dissect)h(an)e(in)o(teger)h(in)o(to)g(t)o(w)o(o)
1114 236 y(parts)j(\(\\d)p 1283 236 V 15 w(minor")d(and)j(\\d)p
1565 236 V 14 w(ma)r(jor"\).)k(Note)c(that)1114 286 y(\\d)p
1160 286 V 14 w(ma)r(jor")d(corresp)q(onds)k(to)e(\\hib)o(yte")f(\(0180\);)
1072 370 y Fl(\017)21 b Fn(t)o(w)o(o)13 b(arra)o(ys)h(of)f(structures;)1072
454 y Fl(\017)21 b Fn(t)o(w)o(o)8 b(in)o(teger)i(v)n(ariables,)f(\\nlkdev")g
(and)g(\\nc)o(hrdev".)1072 546 y(The)24 b(t)o(w)o(o)f(arra)o(ys)h(of)f
(structures,)28 b(\\b)q(devsw")c(and)1010 596 y(\\cdevsw",)13
b(are)h(declared)g(but)f(not)g(dimensioned)f(or)h(ini-)1010
646 y(tialised)i(in)h(\\conf.h".)23 b(The)16 b(initialisation)d(of)j(these)h
(ar-)1010 696 y(ra)o(ys)d(is)g(p)q(erformed)f(in)h(the)g(\014le)g(\\conf.c".)
1010 813 y Fg(15.4)56 b(The)18 b(File)f(`conf.c')1010 890 y
Fn(This)c(\014le,)f(along)g(with)g(\\lo)o(w.s",)g(is)g(generated)j(individu-)
1010 940 y(ally)10 b(at)h(eac)o(h)g(installation)e(\(to)j(re\015ect)g(the)g
(set)g(of)f(p)q(eriph-)1010 990 y(erals)j(actually)g(installed\))f(b)o(y)h
(the)h(program)e(\\mk)o(conf)s(".)1010 1040 y(\(In)f(our)f(case,)i(\\conf.c")
e(re\015ects)j(the)e(represen)o(tativ)o(e)i(de-)1010 1090 y(vices)g(for)g
(our)g(mo)q(del)e(system.\))1072 1140 y(This)i(\014le)g(initialises)e(the)j
(follo)o(wing:)1053 1232 y Ff(bdevsw)43 b(\(4656\))64 b(swapdev)20
b(\(4696\))1053 1282 y(cdevsw)43 b(\(4663\))64 b(swplo)g(\(4637\))1053
1332 y(rootdev)21 b(\(4635\))64 b(nswap)g(\(4698\))1010 1450
y Fg(15.5)56 b(System)16 b(Generation)1010 1527 y Fn(System)f(generation)h
(at)f(a)g(UNIX)h(installation)e(consists)1010 1577 y(mainly)d(of:)1072
1669 y Fl(\017)21 b Fn(running)13 b(\\mk)o(conf)s(")f(with)i(appropriate)g
(input;)1072 1753 y Fl(\017)21 b Fn(recompiling)12 b(the)i(output)g(\014les)h
(\(created)g(as)f(\\c.c")1114 1803 y(and)f(\\l.s"\);)1072 1887
y Fl(\017)21 b Fn(reloading)14 b(the)j(system)e(with)g(the)i(revised)f(ob)r
(ject)1114 1937 y(\014les.)1072 2029 y(This)f(pro)q(cess)i(only)d(tak)o(es)i
(a)e(few)h(min)o(utes)f(\(not)h(the)1010 2079 y(sev)o(eral)24
b(hours)g(of)f(some)g(other)h(op)q(erating)f(systems\).)1010
2129 y(Note)15 b(that)f(\\b)q(devsw")h(and)f(\\cdevsw")i(are)e(de\014ned)i
(dif-)1010 2179 y(feren)o(tly)11 b(in)f(\\conf.c")g(from)f(elsewhere,)k
(namely)c(as)h(a)h(one)1010 2228 y(dimensional)e(arra)o(y)h(of)h(p)q(oin)o
(ters)h(to)e(functions)i(whic)o(h)f(re-)1010 2278 y(turn)18
b(in)o(teger)h(v)n(alues.)30 b(This)18 b(quietly)g(ignores)g(the)h(fact)1010
2328 y(that,)g(for)f(example,)f(\\rktab")h(is)g(not)g(a)g(function,)g(and)
1010 2378 y(relies)j(on)f(the)h(linking)e(program)g(not)h(to)g(enquire)h(to)q
(o)1010 2428 y(closely)14 b(in)o(to)g(the)h(nature)g(of)f(the)h(w)o(ork)g
(whic)o(h)f(it)g(is)g(p)q(er-)1010 2477 y(forming.)1010 2595
y Fg(15.6)56 b(sw)n(ap)20 b(\(5196\))1010 2672 y Fn(Before)11
b(plunging)e(in)o(to)h(all)f(the)i(detail)f(of)f(the)i(\014le)g(\\bio.c",)
1010 2722 y(it)18 b(will)f(b)q(e)j(instructiv)o(e)f(as)g(w)o(ell)f(as)g(con)o
(v)o(enien)o(t)h(to)g(ex-)1010 2772 y(amine)h(one)i(routine)h(whic)o(h)f(w)o
(as)g(in)o(tro)q(duced)g(earlier,)1010 2822 y(namely)12 b(\\sw)o(ap".)1890
2946 y(63)p eop
%%Page: 64 72
71 bop -30 -144 a Fk(15)43 b(INTR)o(ODUCTION)14 b(TO)g(BASIC)h(I/O)658
b(UNIX)14 b(6th)h(Edition)g(Commentary)33 17 y Fn(The)10 b(bu\013er)h(head)f
(\\swbuf)s(")g(w)o(as)f(declared)i(to)f(con)o(trol)-30 66 y(sw)o(apping)h
(input/output,)g(whic)o(h)g(m)o(ust)g(share)h(access)h(to)-30
116 y(the)d(disk)g(with)f(other)h(activit)o(y)m(.)15 b(No)9
b(elemen)o(t)g(of)g(\\bu\013ers")-30 166 y(is)17 b(asso)q(ciated)g(with)g
(\\swbuf)s(".)26 b(Instead)18 b(the)f(core)h(area)-30 216 y(o)q(ccupied)13
b(\(or)g(to)e(b)q(e)i(o)q(ccupied\))g(b)o(y)f(the)h(program)d(serv)o(es)-30
266 y(as)k(the)h(data)e(bu\013er.)-30 347 y Fi(5200:)21 b Fn(The)12
b(address)i(of)d(the)h(\015ags)g(in)g(\\swbuf)s(")g(is)f(trans-)74
397 y(ferred)16 b(to)e(the)h(register)h(v)n(ariable)d(\\fp")h(for)g(con)o(v)o
(e-)74 446 y(nience)h(and)f(econom)o(y;)-30 525 y Fi(5202:)21
b Fn(The)12 b(\\B)p 235 525 13 2 v 15 w(BUSY")g(\015ag)f(is)h(tested,)h(and)f
(if)f(it)g(is)g(on,)74 575 y(a)f(sw)o(ap)g(op)q(eration)g(is)f(already)h
(under)h(w)o(a)o(y)m(,)e(so)h(that)74 625 y(the)j(\\B)p 196
625 V 15 w(W)-5 b(ANTED")12 b(\015ag)g(is)g(set)h(and)f(the)h(pro)q(cess)74
675 y(m)o(ust)g(w)o(ait)g(via)g(a)h(call)f(on)h(\\sleep".)33
756 y(Note)j(that)g(the)h(co)q(de)f(lo)q(op)g(on)f(lines)h(5202)f(to)h(5205)
-30 806 y(runs)h(at)e(priorit)o(y)g(lev)o(el)g(six,)g(i.e.)25
b(one)17 b(higher)g(than)f(the)-30 855 y(disk)e(in)o(terrupt)h(priorit)o(y)m
(.)33 905 y(Can)d(y)o(ou)h(see)g(wh)o(y)g(this)g(is)f(necessary?)20
b(Under)14 b(what)-30 955 y(conditions)g(will)e(the)j(\\B)p
371 955 V 15 w(BUSY")f(\015ag)g(b)q(e)g(set?)-30 1036 y Fi(5206:)21
b Fn(The)14 b(\015ags)g(are)g(set)h(to)f(re\015ect:)124 1121
y Fl(\017)21 b Fn(\\swbuf)s(")13 b(is)h(in)f(use)i(\(\\B)p
559 1121 V 15 w(BUSY"\);)124 1184 y Fl(\017)21 b Fn(ph)o(ysical)11
b(i/o)g(implying)e(a)j(large)g(transfer)h(di-)166 1233 y(rect)i(to/from)c
(the)k(user)g(data)f(segmen)o(t)166 1283 y(\(\\B)p 234 1283
V 15 w(PHYS"\);)124 1346 y Fl(\017)21 b Fn(whether)d(the)g(op)q(eration)f(is)
h(read)g(or)f(write.)166 1395 y(\(\\rd\015g")c(is)h(a)g(parameter)f(to)h
(\\sw)o(ap"\);)-30 1481 y Fi(5207:)21 b Fn(The)10 b(\\b)p 227
1481 V 15 w(dev")g(\014eld)g(is)f(initialised.)15 b(\(Presumably)74
1530 y(this)j(could)f(ha)o(v)o(e)g(b)q(een)i(p)q(erformed)e(once)h(during)74
1580 y(initialisation)12 b(rather)j(than)f(ev)o(ery)h(time)e(\\swbuf)s(")74
1630 y(is)h(used,)g(i.e.)k(in)13 b(\\binit".\);)-30 1709 y
Fi(5208:)21 b Fn(\\b)p 146 1709 V 15 w(w)o(coun)o(t")14 b(is)f(initialised.)k
(Note)d(the)h(negativ)o(e)74 1759 y(v)n(alue)e(and)h(the)h(e\013ectiv)o(e)g
(m)o(ultiplicatio)o(n)c(b)o(y)j(32;)-30 1838 y Fi(5210:)21
b Fn(The)h(hardw)o(are)f(device)h(con)o(troller)g(requires)g(a)74
1887 y(full)h(ph)o(ysical)g(address)h(\(18)f(bits)h(on)f(the)i(PDP)74
1937 y(11/40\).)17 b(The)12 b(blo)q(c)o(k)g(n)o(um)o(b)q(er)f(of)g(a)h(32)f
(w)o(ord)h(blo)q(c)o(k)74 1987 y(m)o(ust)20 b(b)q(e)h(con)o(v)o(erted)g(in)o
(to)f(t)o(w)o(o)g(parts:)32 b(the)21 b(lo)o(w)74 2037 y(order)d(ten)g(bits)f
(are)h(shifted)f(left)g(six)g(places)h(and)74 2087 y(stored)24
b(as)g(\\b)p 315 2087 V 14 w(addr",)h(and)e(the)h(remaining)d(six)74
2137 y(high)16 b(order)h(bits)f(as)g(\\b)p 462 2137 V 15 w(xmem".)22
b(\(On)17 b(the)g(PDP)74 2186 y(11/40)h(and)h(11/45)f(only)g(t)o(w)o(o)h(of)g
(these)h(bits)f(are)74 2236 y(signi\014can)o(t.\);)-30 2315
y Fi(5212:)i Fn(A)13 b(mouthful)d(at)j(\014rst)g(glance!)18
b(Shift)12 b(\\sw)o(ap)q(dev")74 2365 y(eigh)o(t)j(places)h(to)f(the)h(righ)o
(t)f(to)g(obtain)g(the)g(ma)r(jor)74 2415 y(device)f(n)o(um)o(b)q(er.)j(Use)d
(the)g(result)g(to)e(index)h(\\b)q(de-)74 2465 y(vsw".)28 b(F)m(rom)16
b(the)i(structure)h(th)o(us)f(selected,)i(ex-)74 2514 y(tract)13
b(the)g(strategy)g(routine)g(and)f(execute)i(it)e(with)74 2564
y(the)f(address)g(of)f(\\swbuf)s(")g(passed)h(as)f(a)f(parameter;)-30
2643 y Fi(5213:)21 b Fn(Explain)11 b(wh)o(y)g(this)h(call)f(on)h(\\spl6")f
(is)g(necessary;)-30 2722 y Fi(5214:)21 b Fn(W)m(ait)g(un)o(til)h(the)i(i/o)d
(op)q(eration)i(is)g(complete.)74 2772 y(Note)15 b(that)f(the)g(\014rst)h
(parameter)f(to)g(\\sleep")g(is)g(in)74 2822 y(e\013ect)i(the)e(address)h(of)
f(\\swbuf)s(";)1010 17 y Fi(5216:)20 b Fn(W)m(ak)o(eup)d(those)h(pro)q
(cesses)i(\(if)d(an)o(y\))g(whic)o(h)h(are)1114 66 y(w)o(aiting)12
b(for)i(\\swbuf)s(";)1010 149 y Fi(5218:)20 b Fn(Reset)g(the)f(pro)q(cess)h
(or)f(priorit)o(y)e(to)i(zero,)h(th)o(us)1114 198 y(allo)o(wing)9
b(an)o(y)i(p)q(ending)h(in)o(terrupts)h(to)e(\\happ)q(en";)1010
280 y Fi(5219:)20 b Fn(Reset)11 b(b)q(oth)e(the)h(\\B)p 1461
280 V 15 w(BUSY")g(and)f(\\B)p 1747 280 V 15 w(W)-5 b(ANTED")1114
330 y(\015ags.)1010 446 y Fg(15.7)56 b(Race)18 b(Conditions)1010
523 y Fn(The)h(co)q(de)g(for)e(\\sw)o(ap")h(has)g(a)g(n)o(um)o(b)q(er)g(of)f
(in)o(teresting)1010 573 y(features.)i(In)13 b(particular)f(it)h(displa)o(ys)
f(in)h(micro)q(cosm)d(the)1010 622 y(problems)j(of)g(race)h(conditions)g
(when)g(sev)o(eral)g(pro)q(cesses)1010 672 y(are)g(running)g(together.)1010
770 y(Consider)g(the)h(follo)o(wing)c(scenario:)1072 820 y(No)g(sw)o(apping)g
(is)g(taking)f(place)h(when)h(pro)q(cess)h(A)e(ini-)1010 870
y(tiates)e(a)g(sw)o(apping)g(op)q(eration.)16 b(Denoting)9
b(\\swbuf.b)p 1863 870 V 15 w(\015ags")1010 919 y(b)o(y)k(simply)f
(\\\015ags",)h(w)o(e)h(ha)o(v)o(e)g(initially)1053 1008 y Ff(flags)21
b(==)h(null)1010 1097 y Fn(Pro)q(cess)c(A)e(is)g(not)g(dela)o(y)o(ed)g(at)g
(line)g(5204,)f(initiates)h(its)1010 1147 y(i/o)h(op)q(eration)h(and)f(go)q
(es)i(to)e(sleep)i(at)f(line)f(5215.)29 b(W)m(e)1010 1197 y(no)o(w)13
b(ha)o(v)o(e)1053 1286 y Ff(flags)21 b(==)h(B_BUSY)e(|)i(B_PHYS)e(|)i(rdflg)
1010 1375 y Fn(whic)o(h)14 b(w)o(as)f(set)i(at)f(line)f(5206.)1072
1425 y(Supp)q(ose)24 b(no)o(w)e(while)g(the)h(i/o)f(op)q(eration)h(is)f(pro-)
1010 1475 y(ceeding,)14 b(pro)q(cess)i(B)f(also)e(initiates)h(a)f(sw)o
(apping)h(op)q(era-)1010 1524 y(tion.)j(It)12 b(to)q(o)g(b)q(egins)g(to)g
(execute)i(\\sw)o(ap",)e(but)g(\014nds)g(the)1010 1574 y(\\B)p
1062 1574 V 15 w(BUSY")19 b(\015ag)e(set,)j(so)e(it)g(sets)h(the)g(\\B)p
1707 1574 V 15 w(W)-5 b(ANTED")1010 1624 y(\015ag)15 b(\(5203\))f(and)i(go)q
(es)f(to)h(sleep)g(also)f(\(5204\).)21 b(W)m(e)15 b(no)o(w)1010
1674 y(ha)o(v)o(e)1053 1763 y Ff(flags)21 b(==)h(B_BUSY)e(|)i(B_PHYS)e(|)i
(rdflg)f(|)g(B_WANTED)1072 1852 y Fn(A)o(t)28 b(last)f(the)h(i/o)f(op)q
(eration)g(completes.)59 b(Pro-)1010 1902 y(cess)21 b(C)e(tak)o(es)g(the)h
(in)o(terrupt)g(and)f(executes)i(\\rkin)o(tr",)1010 1951 y(whic)o(h)27
b(calls)g(\(5471\))f(\\io)q(done")h(whic)o(h)g(calls)g(\(5301\))1010
2001 y(\\w)o(ak)o(eup")d(to)h(a)o(w)o(ak)o(en)g(pro)q(cess)i(A)e(and)g(pro)q
(cess)i(B.)1010 2051 y(\\io)q(done")17 b(also)g(sets)i(the)f(\\B)p
1487 2051 V 15 w(DONE")g(\015ag)f(and)h(resets)1010 2101 y(the)c(\\B)p
1133 2101 V 15 w(W)-5 b(ANTED")14 b(\015ag)g(so)g(that)1053
2190 y Ff(flags)21 b(==)h(B_BUSY)e(|)i(B_PHYS)e(|)i(rdflg)f(|)g(B_DONE)1072
2279 y Fn(What)g(happ)q(ens)i(next)f(dep)q(ends)h(on)e(the)h(order)h(in)1010
2329 y(whic)o(h)g(pro)q(cess)i(A)e(and)f(pro)q(cess)j(B)f(are)f(reactiv)n
(ated.)1010 2378 y(\(Since)14 b(they)h(b)q(oth)f(ha)o(v)o(e)g(the)g(same)g
(priorit)o(y)m(,)e(\\PSWP",)1010 2428 y(it)h(is)h(a)g(toss-up)g(whic)o(h)g
(go)q(es)g(\014rst.\))1010 2517 y Fi(Case)i(\(a\):)k Fn(Pro)q(cess)e(A)d(go)q
(es)g(\014rst.)22 b(\\B)p 1665 2517 V 15 w(DONE")15 b(is)g(set)1114
2567 y(so)9 b(no)g(more)f(sleeping)i(is)f(needed.)18 b(\\B)p
1707 2567 V 15 w(W)-5 b(ANTED")1114 2617 y(is)14 b(reset)i(so)f(there)h(is)e
(no)g(one)h(to)g(\\w)o(ak)o(eup".)k(Pro-)1114 2667 y(cess)j(A)e(tidies)h(up)f
(\(5219\),)h(and)f(lea)o(v)o(es)h(\\sw)o(ap")1114 2716 y(with)1157
2822 y Ff(flags)g(==)g(B_PHYS)g(|)g(rdflg)g(|)h(B_DONE)-30
2946 y Fn(64)p eop
%%Page: 65 73
72 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)657
b(15)43 b(INTR)o(ODUCTION)14 b(TO)g(BASIC)h(I/O)74 17 y Fn(Pro)q(cess)h(B)e
(no)o(w)f(runs)h(and)g(is)f(able)h(to)f(initiate)g(its)74 66
y(i/o)g(op)q(eration)h(without)f(further)i(dela)o(y)m(.)-30
146 y Fi(Case)i(\(b\):)i Fn(Pro)q(cess)12 b(B)e(go)q(es)h(\014rst.)17
b(It)10 b(\014nds)g(\\B)p 743 146 13 2 v 15 w(BUSY")74 196
y(on,)18 b(so)f(it)g(turns)h(the)g(\\B)p 486 196 V 15 w(W)-5
b(ANTED")17 b(\015ag)g(bac)o(k)74 246 y(on,)c(and)h(go)q(es)g(to)g(sleep)h
(again,)d(lea)o(ving)118 345 y Ff(flags)21 b(==)g(B_BUSY)g(|)g(B_PHYS)g(|)g
(rdflg)g(|)314 395 y(B_DONE)g(|)g(B_WANTED)74 493 y Fn(Pro)q(cess)i(A)e
(starts)h(again)d(as)i(in)f(Case)h(\(a\),)h(but)74 543 y(this)16
b(time)f(\014nds)h(\\B)p 407 543 V 15 w(W)-5 b(ANTED")16 b(on)f(so)h(it)g(m)o
(ust)74 593 y(call)e(\\w)o(ak)o(eup")g(\(5217\))h(in)f(addition)g(to)g(its)h
(other)74 643 y(c)o(hores.)k(Pro)q(cess)14 b(B)e(\014nally)f(w)o(ak)o(es)h
(again)f(and)h(the)74 693 y(whole)i(c)o(hain)f(completes.)33
776 y(Case)20 b(\(b\))g(is)g(ob)o(viously)e(m)o(uc)o(h)h(less)h(e\016cien)o
(t)h(than)-30 826 y(case)f(\(a\).)33 b(It)19 b(w)o(ould)f(seem)h(that)g(a)f
(simple)g(c)o(hange)h(to)-30 876 y(line)14 b(5215)f(to)g(read)14
960 y Ff(sleep)21 b(\(fp,)g(PSWP-1\);)-30 1043 y Fn(w)o(ould)15
b(cost)g(virtually)f(nothing)g(and)h(ensure)i(that)e(Case)-30
1093 y(\(b\))g(nev)o(er)f(o)q(ccurred!)33 1143 y(The)g(necessit)o(y)i(for)d
(the)i(raising)e(of)g(pro)q(cessor)j(prior-)-30 1193 y(it)o(y)g(at)g(v)n
(arious)f(p)q(oin)o(ts)h(should)f(b)q(e)i(studied:)23 b(for)15
b(exam-)-30 1243 y(ple)j(if)e(line)h(5201)f(w)o(as)h(omitted)f(and)h(if)f
(pro)q(cess)j(B)f(had)-30 1293 y(just)f(completed)e(line)h(5203)f(when)i(the)
g(\\i/o)e(complete")-30 1342 y(in)o(terrupt)i(o)q(ccurred)g(for)e(Pro)q(cess)
j(A's)e(op)q(eration,)f(then)-30 1392 y(\\io)q(done")k(w)o(ould)f(turn)i
(o\013)f(\\B)p 490 1392 V 15 w(W)-5 b(ANTED")19 b(and)g(p)q(er-)-30
1442 y(form)e(\\w)o(ak)o(eup")g(b)q(efore)i(pro)q(cess)h(B)f(w)o(en)o(t)f(to)
g(sleep)h(...)-30 1492 y(forev)o(er!)g(A)14 b(bad)g(scene.)-30
1607 y Fg(15.8)56 b(Reen)n(trancy)-30 1683 y Fn(Note)19 b(also)f(the)h
(assumption)e(made)g(ab)q(o)o(v)o(e,)i(that)g(b)q(oth)-30 1733
y(pro)q(cess)f(A)e(and)g(pro)q(cess)i(B)f(could)f(execute)h(\\sw)o(ap")f(si-)
-30 1783 y(m)o(ultaneously)m(.)j(All)14 b(UNIX)h(pro)q(cedures)j(are)d(in)f
(general)-30 1833 y(\\re-en)o(tran)o(t")22 b(\(whic)o(h)e(means)g(m)o
(ultiple)e(sim)o(ultaneous)-30 1883 y(executions)c(are)f(p)q(ossible\).)18
b(Ho)o(w)12 b(w)o(ould)g(UNIX)h(ha)o(v)o(e)f(to)-30 1932 y(c)o(hange)j(if)e
(re-en)o(trancy)i(w)o(ere)g(not)f(allo)o(w)o(ed?)-30 2047 y
Fg(15.9)56 b(F)-5 b(or)19 b(the)f(Uninitiated)-30 2124 y Fn(W)m(e)j(can)f(no)
o(w)h(return)g(to)g(complete)f(an)g(in)o(v)o(estigation)-30
2174 y(started)h(in)e(Chapter)h(Eigh)o(t)f(concerning)h(\\aretu")g(and)-30
2224 y(\\u.u)p 51 2224 V 15 w(ssa)o(v":)33 2273 y(After)c(setting)f(\\u.u)p
361 2273 V 15 w(ssa)o(v")g(\(2284\),)f(\\expand")h(calls)-30
2323 y(\(2285\))h(\\xsw)o(ap",)f(whic)o(h)h(calls)f(\(4380\))g(\\sw)o(ap",)h
(whic)o(h)-30 2373 y(calls)22 b(\(5215\))f(\\sleep",)i(whic)o(h)f(calls)f
(\(2084\))g(\\swtc)o(h",)-30 2423 y(whic)o(h)14 b Fi(resets)f
Fn(\\u.u)p 304 2423 V 14 w(rsa)o(v")h(\(2189\).)33 2473 y(Th)o(us)19
b(in)f(fact)h(\\u.u)p 364 2473 V 14 w(rsa)o(v")g(\014nally)e(gets)j(reset)g
(to)f(a)-30 2522 y(v)n(alue)j(appropriate)g(to)g(four)f(pro)q(cedure)j(calls)
e(deep)q(er)-30 2572 y(than)14 b(that)g(for)g(\\u.u)p 302 2572
V 14 w(ssa)o(v".)-30 2687 y Fg(15.10)56 b(Additional)18 b(Reading)-30
2764 y Fn(The)k(article)g(\\The)f(UNIX)h(I/O)f(System")f(b)o(y)i(Dennis)-30
2814 y(Ritc)o(hie)14 b(is)g(highly)e(p)q(ertinen)o(t.)1890
2946 y(65)p eop
%%Page: 66 74
73 bop -30 -144 a Fk(16)43 b(THE)15 b(RK)g(DISK)g(DRIVER)836
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(16)70 b(The)22
b(RK)h(Disk)f(Driv)n(er)-30 108 y Fn(The)j(RK)f(disk)g(storage)h(system)f
(emplo)o(ys)f(a)h(remo)o(v-)-30 158 y(able)16 b(disk)g(cartridge)h(con)o
(taining)e(a)h(single)g(disk,)g(whic)o(h)-30 208 y(is)h(moun)o(ted)f(inside)g
(a)h(driv)o(e)g(with)f(mo)o(ving)e(read/write)-30 257 y(heads.)33
307 y(The)c(device)h(designated)f(RK11-D)e(consists)j(of)e(a)h(disk)-30
357 y(con)o(troller)16 b(together)h(with)e(a)g(single)h(driv)o(e.)23
b(Additional)-30 407 y(driv)o(es,)f(designated)f(RK05,)g(up)f(to)g(a)g(total)
f(of)h(sev)o(en,)-30 457 y(ma)o(y)12 b(b)q(e)j(added)f(to)g(a)f(single)h
(RK11-D.)33 507 y(A)e(requiremen)o(t)g(for)g(more)g(than)g(eigh)o(t)g(driv)o
(es)g(w)o(ould)-30 557 y(require)j(an)e(additional)f(con)o(troller)i(with)f
(a)g(di\013eren)o(t)i(set)-30 607 y(of)20 b(UNIBUS)i(addresses.)40
b(Also)20 b(the)h(co)q(de)g(in)g(the)g(\014le)-30 656 y(\\rk.c")11
b(w)o(ould)f(ha)o(v)o(e)h(to)g(b)q(e)h(mo)q(di\014ed)d(to)i(handle)g(the)h
(case)-30 706 y(of)17 b(t)o(w)o(o)g(or)g(more)f(con)o(trollers.)28
b(This)18 b(case)g(is)f(most)f(un-)-30 756 y(lik)o(ely)9 b(b)q(ecause)j
(requiremen)o(ts)e(for)g(large)g(amoun)o(ts)f(of)g(on-)-30
806 y(line)h(disk)f(storage)i(will)d(b)q(e)i(more)f(economically)f(pro)o
(vided)-30 856 y(otherwise)15 b(e.g.)j(b)o(y)c(the)g(RP04)f(disk)h(system.)
-30 948 y(Cartridge)h(capacit)o(y:)i(1,228,800)12 b(w)o(ords)158
998 y(\(4800)h(512)g(b)o(yte)h(records\))-30 1048 y(Surfaces/cartridge:)25
b(2)-30 1098 y(T)m(rac)o(ks/surface:)90 b(200)13 b(\(plus)h(3)g(spare\))-30
1147 y(Sectors/T)m(rac)o(k:)103 b(12)-30 1197 y(W)m(ords/Sector:)j(256)-30
1247 y(Recording)14 b(densit)o(y:)29 b(2040)13 b(bpi)h(maxim)n(um)-30
1297 y(Rotation)f(sp)q(eed:)82 b(1500)13 b(rpm)-30 1347 y(Half)g(rev)o
(olution:)82 b(20)14 b(msecs)-30 1396 y(T)m(rac)o(k)g(p)q(ositioning:)158
1446 y(10)f(msecs)h(\(one)g(trac)o(k\))158 1496 y(50)f(msecs)h(\(a)o(v)o
(erage\))158 1546 y(85)f(msecs)h(\(w)o(orst)g(case\))-30 1596
y(In)o(terrupt)i(V)m(ector)e(Address:)20 b(220)-30 1646 y(Priorit)o(y)14
b(Lev)o(el:)104 b(5)139 1792 y Fi(Unibus)13 b(Register)h(Addresses)58
1842 y Fn(Driv)o(e)f(Status)189 b(RKDS)66 b(777400)58 1891
y(Error)319 b(RKER)62 b(777402)58 1941 y(Con)o(trol)13 b(Status)150
b(RK)o(CS)69 b(777404)58 1991 y(W)m(ord)13 b(Coun)o(t)191 b(RKW)o(C)49
b(777406)58 2041 y(Curren)o(t)15 b(bus)f(address)51 b(RKBA)61
b(777410)58 2091 y(Disk)13 b(address)188 b(RKD)o(A)59 b(777412)58
2140 y(Data)13 b(Bu\013er)203 b(RKDB)60 b(777416)156 2231 y(T)m(able)13
b(16.1)g(RK)h(Vital)f(Statistics)33 2323 y(The)f(a)o(v)o(erage)f(total)g
(access)i(time)d(is)h(70)g(milllseconds.)-30 2373 y(With)j(m)o(ulti-driv)o(e)
f(subsystems,)h(seeking)i(b)o(y)e(one)h(driv)o(e)-30 2423 y(ma)o(y)f(b)q(e)i
(o)o(v)o(erlapp)q(ed)g(with)f(reading)g(or)h(writing)f(b)o(y)g(an-)-30
2473 y(other)20 b(driv)o(e.)33 b(Ho)o(w)o(ev)o(er)20 b(this)f(feature)g(is)g
(not)g(used)h(b)o(y)-30 2522 y(UNIX)13 b(b)q(ecause)h(of)e(bugs)h(whic)o(h)f
(existed)h(at)f(one)h(time)e(in)-30 2572 y(the)k(hardw)o(are)f(con)o
(troller.)33 2622 y(In)d(initiating)e(a)h(data)h(transfer,)h(RKD)o(A,)e(RRBA)
h(and)-30 2672 y(RK)o(C)18 b(are)g(set,)h(and)f(then)g(RK)o(CS)f(is)h(set.)30
b(Up)q(on)18 b(com-)-30 2722 y(pletion,)j(status)f(information)d(is)j(a)o(v)n
(ailable)d(in)i(RK)o(CS,)-30 2772 y(RRER)f(and)h(RKDS.)e(When)i(an)g(error)g
(o)q(ccurs,)i(UNIX)-30 2822 y(simply)f(calls)i(\\dev)o(error")g(\(2447\))f
(to)h(displa)o(y)f(RKER)1010 17 y(and)14 b(RKDS)g(on)g(the)h(system)f
(console,)h(without)e(an)o(y)h(at-)1010 66 y(tempt)g(at)i(analysis.)21
b(An)16 b(op)q(eration)f(is)g(rep)q(eated)i(up)e(to)1010 116
y(ten)g(times)e(b)q(efore)i(an)g(error)g(is)f(rep)q(orted)i(b)o(y)e(the)h
(device)1010 166 y(driv)o(er.)1072 222 y(The)c(register)g(formats)d(whic)o(h)
i(are)h(describ)q(ed)h(fully)d(in)1010 272 y(the)i(\\PDP11)e(P)o(eripherals)i
(Handb)q(o)q(ok")f(are)g(re\015ected)j(in)1010 322 y(the)j(program)d(co)q(de)
k(at)e(sev)o(eral)h(p)q(oin)o(ts.)22 b(The)16 b(follo)o(wing)1010
372 y(summaries)e(su\016ce)i(to)g(describ)q(e)h(the)g(features)g(used)f(b)o
(y)1010 421 y(UNIX:)1124 467 y Fi(Con)o(trol)e(Status)g(Register)g(\(RK)o
(CS\))p 1072 483 787 2 v 1103 518 a Fn(bit)268 b(description)1097
568 y(15)70 b(Set)15 b(when)f(an)o(y)f(bit)h(of)f(RKER)h(\(the)1209
618 y(Error)h(Register\))f(is)g(set;)1097 717 y(7)91 b(Set)15
b(when)f(the)g(con)o(trol)g(is)g(no)1209 767 y(longer)g(engaged)g(in)f(activ)
o(ely)1209 817 y(executing)i(a)e(function)h(and)g(is)f(ready)1209
867 y(to)h(accept)h(a)f(command;)1097 966 y(6)91 b(When)14
b(set,)h(the)f(con)o(trol)g(will)e(issue)1209 1016 y(an)i(in)o(terrupt)g(to)g
(v)o(ector)h(address)1209 1066 y(220)e(up)q(on)h(op)q(eration)g(completion)e
(or)1209 1116 y(error;)1097 1216 y(5{4)49 b(Memory)13 b(Extension.)18
b(The)d(t)o(w)o(o)e(most)1209 1265 y(signi\014can)o(t)h(bits)f(of)h(the)g(13)
g(bit)1209 1315 y(ph)o(ysical)f(bus)i(address.)k(\(The)c(other)1209
1365 y(16)e(bits)h(are)h(recorded)g(in)f(RKBA.\);)1097 1465
y(3{1)49 b(F)m(unction)14 b(to)f(b)q(e)i(p)q(erformed:)1209
1564 y(CONTR)o(OL)f(RESET:)f(000)1209 1614 y(WRITE:)g(001)1209
1664 y(READ:)g(010)1209 1714 y(etc.,)1097 1813 y(0)91 b(Initiate)14
b(the)g(function)g(designated)1209 1863 y(b)o(y)g(bits)g(1)f(to)h(3)g(when)g
(set.)19 b(\(write)1209 1913 y(only\);)1136 2013 y Fi(W)l(ord)d(Coun)o(t)e
(Register)g(\(RKW)o(C\))p 1072 2029 V 1072 2068 a Fn(Con)o(tains)d(the)h(t)o
(w)o(os)g(complemen)o(t)d(of)i(the)h(n)o(um)o(b)q(er)f(of)1010
2118 y(w)o(ords)j(to)g(b)q(e)g(transferred.)1097 2238 y Fi(Disk)h(Address)f
(Register)g(\(RKD)o(A\))p 1072 2255 716 2 v 1124 2290 a Fn(bit)232
b(description)1097 2339 y(15{13)49 b(Driv)o(e)13 b(n)o(um)o(b)q(er)g(\(0)h
(to)g(7\))1097 2389 y(12{5)70 b(Cylinder)13 b(n)o(um)o(b)q(er)g(\(0)h(to)g
(199\))1097 2439 y(4)133 b(Surface)14 b(n)o(um)o(b)q(er)f(\(0,1\))1097
2489 y(3-0)98 b(Sector)15 b(address)g(\(0)e(to)h(11\))1010
2634 y Fg(16.1)56 b(The)18 b(\014le)g(`rk.c')1010 2722 y Fn(This)d(\014le)h
(con)o(tains)g(the)g(co)q(de)h(whic)o(h)e(is)h(sp)q(eci\014c)h(to)e(the)1010
2772 y(RK)23 b(disk)g(system,)i(i.e.)45 b(whic)o(h)24 b(is)f(the)g(RK)g
(\\device)1010 2822 y(driv)o(er".)-30 2946 y(66)p eop
%%Page: 67 75
74 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)834
b(16)43 b(THE)15 b(RK)g(DISK)g(DRIVER)-30 17 y Fg(16.2)56 b(rkstrategy)17
b(\(5389\))-30 93 y Fn(The)j(strategy)h(routine)e(is)h(called,)g(e.g.)34
b(from)18 b(\\sw)o(ap")-30 143 y(\(5212\),)13 b(to)h(handle)g(b)q(oth)g(read)
g(and)g(write)g(requests.)-30 227 y Fi(5397:)21 b Fn(The)e(test)h(and)f(call)
f(on)h(\\mapallo)q(c")d(here)k(is)f(a)74 277 y(\\no-op")13
b(except)i(on)f(the)h(PDP11/70)d(system;)-30 357 y Fi(5399:)21
b Fn(The)15 b(co)q(de)g(from)e(here)j(to)f(line)f(5402)f(app)q(ears)j(to)74
407 y(b)q(e)h(unnecessarily)h(devious!)25 b(See)17 b(the)g(discussion)74
457 y(of)j(\\rk)n(addr")g(b)q(elo)o(w.)38 b(If)20 b(the)i(blo)q(c)o(k)e(n)o
(um)o(b)q(er)g(is)74 506 y(to)q(o)10 b(large,)g(set)h(the)f(\\B)p
433 506 13 2 v 16 w(ERR)o(OR")e(\015ag)i(and)g(rep)q(ort)74
556 y(\\completion";)-30 636 y Fi(5407:)21 b Fn(Link)12 b(the)i(bu\013er)g
(in)o(to)e(a)h(FIF)o(O)g(list)f(for)h(the)h(con-)74 686 y(troller.)45
b(The)23 b(list)f(is)h(singly)e(link)o(ed,)j(uses)g(the)74
736 y(\\a)o(v)p 139 736 V 14 w(forw")9 b(p)q(oin)o(ter)h(of)f(the)h(\\buf)s
(")f(structures,)j(and)74 786 y(has)j(head)h(and)f(tail)f(p)q(oin)o(ters)h
(in)g(\\rktab".)21 b(In)o(ter-)74 836 y(rupts)e(from)d(disk)i(devices)h(ma)o
(y)d(not)h(b)q(e)i(allo)o(w)o(ed)74 885 y(after)14 b(the)h(\014rst)g(step;)
-30 966 y Fi(5414:)21 b Fn(If)14 b(the)h(RK)g(con)o(troller)g(is)f(not)h
(curren)o(tly)g(activ)o(e,)74 1015 y(w)o(ak)o(e)23 b(it)f(up)h(via)f(a)g
(call)g(on)h(\\rkstart")g(\(5440\),)74 1065 y(whic)o(h)d(c)o(hec)o(ks)h(that)
e(there)i(is)e(something)g(to)g(do)74 1115 y(\(5444\),)11 b(\015ags)f(the)i
(con)o(troller)f(as)g(busy)g(\(5446\))f(and)74 1165 y(calls)20
b(\\devstart")i(\(5447\),)f(passing)f(as)h(parame-)74 1215
y(ters:)124 1302 y Fl(\017)g Fn(a)h(p)q(oin)o(ter)h(to)f(the)h(\014rst)h
(enqueued)g(bu\013er)166 1351 y(header;)124 1415 y Fl(\017)d
Fn(the)e(address)h(of)e(the)h(RKD)o(A)f(disk)g(address)166
1465 y(register.)32 b(\(The)19 b(v)n(alue)f(passed)h(is)f(in)g(e\013ect)166
1514 y(0177412.)e(See)f(lines)e(5363,)g(5382.\);)124 1578 y
Fl(\017)21 b Fn(a)12 b(\\disk)g(address")i(computed)e(b)o(y)h(\\rk)n(addr";)
124 1641 y Fl(\017)21 b Fn(zero)13 b(\(not)g(really)f(imp)q(ortan)o(t)f(in)h
(our)h(discus-)166 1691 y(sion,)g(and)g(ma)o(y)f(b)q(e)j(ignored\).)-30
1806 y Fg(16.3)56 b(rk)m(addr)19 b(\(5420\))-30 1883 y Fn(The)f(co)q(de)h(in)
e(this)g(pro)q(cedure)j(incorp)q(orates)e(a)f(sp)q(ecial)-30
1933 y(feature)i(for)e(\014les)h(whic)o(h)f(extend)i(o)o(v)o(er)e(more)g
(than)g(one)-30 1982 y(disk)h(driv)o(e.)29 b(This)18 b(feature)g(is)f
(describ)q(ed)j(in)d(the)h(UPM)-30 2032 y(Section)i(\\RK\(IV\)".)f(Its)h
(usefulness)h(seems)f(to)f(b)q(e)h(re-)-30 2082 y(stricted.)33
2132 y(The)11 b(v)n(alue)g(returned)i(b)o(y)e(\\rk)n(addr")g(is)g(formatted)f
(for)-30 2182 y(direct)15 b(transmission)e(to)h(the)g(con)o(trol)g(register,)
g(RKD)o(A.)-30 2297 y Fg(16.4)56 b(devstart)18 b(\(5096\))-30
2373 y Fn(This)e(pro)q(cedure)i(when)f(called)e(for)h(the)h(RK)e(disk)h
(loads)-30 2423 y(appropriate)10 b(v)n(alues)f(in)o(to)f(the)i(registers)h
(RKD)o(A,)d(RKBA,)-30 2473 y(RKW)o(C)21 b(and)f(RK)o(CS)h(in)g(succession.)41
b(Only)20 b(the)i(last)-30 2523 y(v)n(alue)14 b(needs)h(to)f(b)q(e)g
(computed)g(at)f(this)h(stage.)33 2573 y(The)19 b(calculation,)g(though)f
(messy)h(in)f(app)q(earance,)-30 2622 y(is)c(straigh)o(t)f(forw)o(ard.)k
(Note)d(that)f(\\h)o(b)q(com")f(is)h(zero)h(and)-30 2672 y(\\rbp-)p
Fh(>)p Fn(b)p 124 2672 V 16 w(xmem")i(con)o(tains)i(the)i(t)o(w)o(o)e(high)g
(order)i(bits)-30 2722 y(of)14 b(the)g(ph)o(ysical)f(core)h(address.)20
b(The)14 b(loading)e(of)h(RK)o(CS)-30 2772 y(initialises)k(the)i(disk)f(con)o
(troller)g(i.e.)30 b(the)19 b(op)q(eration)f(is)-30 2822 y(no)o(w)c(en)o
(tirely)g(under)h(the)f(con)o(trol)g(of)f(the)i(hardw)o(are.)1072
17 y(\\devstart")21 b(returns)i(to)d(\\rkstart")h(\(5448\),)g(whic)o(h)1010
66 y(returns)j(to)e(\\rkstrategy")h(\(5416\),)h(whic)o(h)e(resets)i(the)1010
116 y(pro)q(cessor)f(priorit)o(y)d(and)h(returns)i(to)e(\\sw)o(ap")f
(\(5213\),)1010 166 y(whic)o(h)14 b(...)1010 282 y Fg(16.5)56
b(rkin)n(tr)17 b(\(5451\))1010 359 y Fn(This)d(pro)q(cedure)j(is)e(in)o(v)o
(ok)o(ed)e(to)i(handle)g(the)g(in)o(terrupts)1010 409 y(whic)o(h)22
b(o)q(ccur)i(when)f(RK)f(disk)g(op)q(erations)h(are)f(com-)1010
459 y(pleted.)1010 550 y Fi(5455:)e Fn(Chec)o(k)15 b(for)e(a)h(false)g
(alarm!)1010 633 y Fi(5459:)20 b Fn(Insp)q(ect)c(the)e(error)h(bit;)e(if)g
(set)i(...)1010 716 y Fi(5460:)20 b Fn(Call)13 b(\\dev)o(error")h(\(2447\))e
(to)i(displa)o(y)e(a)h(message)1114 766 y(on)g(the)i(system)e(console)i
(terminal;)1010 849 y Fi(5461:)20 b Fn(Clear)c(the)f(in)o(ternal)g(registers)
i(of)e(the)h(disk)f(con-)1114 899 y(troller)e(and)h(...)1010
982 y Fi(5462:)20 b Fn(W)m(ait)10 b(till)g(this)h(is)g(completed)f(\(usually)
g(a)h(few)g(mi-)1114 1031 y(croseconds\);)1010 1114 y Fi(5463:)20
b Fn(If)e(the)g(op)q(eration)g(has)g(b)q(een)h(retried)g(less)f(than)1114
1164 y(ten)c(times,)f(call)h(\\rkstart")g(to)g(try)g(again.)k(Other-)1114
1214 y(wise)c(giv)o(e)f(up)h(and)g(rep)q(ort)h(an)e(error;)1010
1297 y Fi(5469:)20 b Fn(Set)e(the)g(\\retry")f(\(!\))28 b(coun)o(t)17
b(bac)o(k)g(to)g(zero,)i(re-)1114 1347 y(mo)o(v)o(e)d(the)j(curren)o(t)h(op)q
(eration)e(from)e(the)j(\\actf)s(")1114 1397 y(list,)j(and)g(complete)f(the)h
(op)q(eration)f(b)o(y)g(calling)1114 1447 y(\\io)q(done";)1010
1530 y Fi(5472:)f Fn(\\rkstart")e(is)f(called)h(unconditionally)d(here.)30
b(If)1114 1579 y(the)16 b(call)g(is)g(not)g(necessary)i(\(b)q(ecause)g(the)f
(\\actf)s(")1114 1629 y(list)h(is)h(empt)o(y\))f(\\rkstart")i(will)d(return)k
(imm)o(edi-)1114 1679 y(ately)13 b(\(5444\).)1010 1795 y Fg(16.6)56
b(io)r(done)17 b(\(5018\))1010 1872 y Fn(This)12 b(routine)g(is)g(primarily)d
(concerned)14 b(with)e(the)h(return)1010 1922 y(of)k(resources)j(when)e(a)f
(blo)q(c)o(k)g(i/o)f(op)q(eration)i(has)f(com-)1010 1971 y(pleted.)i(It:)1072
2063 y Fl(\017)i Fn(frees)c(up)g(the)h(Unibus)e(map)g(\(for)g(11/70's,)g(if)f
(ap-)1114 2113 y(propriate\);)1072 2196 y Fl(\017)21 b Fn(sets)15
b(the)f(\\B)p 1318 2196 V 15 w(DONE")g(\015ag;)1072 2279 y
Fl(\017)21 b Fn(releases)10 b(the)g(bu\013er)h(if)d(the)i(i/o)e(w)o(as)h
(async)o(hronous,)1114 2328 y(or)24 b(else)i(resets)h(the)e(\\B)p
1526 2328 V 15 w(W)-5 b(ANTED")25 b(\015ag)f(and)1114 2378
y(w)o(ak)o(es)15 b(up)g(an)o(y)g(pro)q(cess)h(w)o(aiting)e(for)h(the)g(i/o)f
(op-)1114 2428 y(eration)f(to)h(complete.)1890 2946 y(67)p
eop
%%Page: 68 76
75 bop -30 -144 a Fk(17)43 b(BUFFER)16 b(MANIPULA)m(TION)775
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(17)70 b(Bu\013er)23
b(Manipulation)-30 111 y Fn(In)d(this)f(c)o(hapter)i(w)o(e)e(lo)q(ok)g(at)g
(the)h(\014le)f(\\bio.c")f(in)h(de-)-30 161 y(tail.)h(It)14
b(con)o(tains)h(most)e(of)h(the)h(basic)g(routines)g(used)h(to)-30
211 y(manipulate)10 b(bu\013er)i(headers)g(and)f(bu\013ers)i(\(4535,)d
(4720\).)33 263 y(Individual)18 b(bu\013er)j(headers)g(are)f(tagged)f(b)o(y)h
(a)f(de-)-30 313 y(vice)f(n)o(um)o(b)q(er)f(\\b)p 259 313 13
2 v 15 w(dev",)h(\(4527\))f(and)g(a)g(blo)q(c)o(k)g(n)o(um)o(b)q(er)-30
362 y(\\b)p 16 362 V 15 w(blkno",)12 b(\(4531\).)18 b(\(Note)c(the)g(w)o(a)o
(y)f(in)g(whic)o(h)g(the)h(lat-)-30 412 y(ter)h(is)f(declared)h(as)f(an)f
(unsigned)i(in)o(teger.\))33 464 y(Bu\013er)24 b(headers)h(ma)o(y)c(b)q(e)j
(link)o(ed)f(sim)o(ultaneously)-30 514 y(in)o(to)14 b(t)o(w)o(o)f(lists:)-30
613 y Fi(the)i(\\b"-lists)j Fn(are)g(lists,)g(one)f(p)q(er)h(device)g(con)o
(troller,)74 663 y(whic)o(h)k(link)f(together)h(bu\013ers)i(asso)q(ciated)e
(with)74 713 y(that)14 b(device)h(t)o(yp)q(e;)-30 804 y Fi(the)g(\\a)o
(v"-list)k Fn(is)13 b(a)f(list)h(of)f(bu\013ers)i(whic)o(h)f(ma)o(y)e(b)q(e)i
(de-)74 854 y(tac)o(hed)18 b(from)c(their)j(curren)o(t)i(use)e(and)g(con)o(v)
o(erted)74 903 y(to)d(an)g(alternate)g(use.)33 1003 y(Both)h(the)g(\\a)o
(v"-list)d(and)j(the)g(v)n(arious)f(\\b"-lists)f(are)-30 1052
y(doubly)g(link)o(ed)f(to)h(facilitate)f(insertion)h(and)g(deletion)g(at)-30
1102 y(an)o(y)h(p)q(oin)o(t.)-30 1229 y Fg(17.1)56 b(Flags)-30
1309 y Fn(If)12 b(a)g(bu\013er)h(is)f(withdra)o(wn)g(temp)q(orarily)e(from)g
(the)j(\\a)o(v"-)-30 1359 y(list,)g(then)i(its)f(\\B)p 256
1359 V 15 w(BUSY")g(\015ag)g(is)f(raised.)33 1411 y(If)k(the)g(con)o(ten)o
(ts)i(of)d(a)h(bu\013er)i(correctly)f(re\015ect)h(the)-30 1461
y(information)7 b(that)j(is)g(or)g(should)f(b)q(e)i(stored)f(on)g(disk,)g
(then)-30 1511 y(the)15 b(\\B)p 94 1511 V 15 w(DONE")f(\015ag)f(is)h(raised.)
33 1562 y(If)g(the)h(\\B)p 199 1562 V 15 w(DEL)-5 b(WRI")13
b(\015ag)h(is)g(raised,)h(the)g(con)o(ten)o(ts)-30 1612 y(of)20
b(the)h(bu\013er)g(are)g(more)e(up)h(to)g(date)h(than)f(the)h(con-)-30
1662 y(ten)o(ts)g(of)e(the)i(corresp)q(onding)g(disk)e(blo)q(c)o(k,)i(and)e
(hence)-30 1712 y(the)c(bu\013er)h(m)o(ust)d(b)q(e)i(written)g(out)f(b)q
(efore)i(it)e(can)g(b)q(e)h(re-)-30 1762 y(assigned.)-30 1888
y Fg(17.2)56 b(A)19 b(Cac)n(he-lik)n(e)f(Memory)-30 1969 y
Fn(It)f(will)e(b)q(e)i(seen)h(that)f(the)g(large)f(bu\013ers)i(in)e(UNIX)h
(are)-30 2019 y(manipulated)i(in)h(a)g(w)o(a)o(y)g(whic)o(h)h(is)f(analogous)
g(to)g(the)-30 2068 y(op)q(eration)c(of)f(hardw)o(are)i(cac)o(he)f(attac)o
(hed)h(to)e(the)i(main)-30 2118 y(memory)12 b(of)h(a)h(computer)f(e.g.)18
b(the)d(PDP11/70.)33 2170 y(Bu\013ers)j(are)e(not)g(assigned)g(to)g(an)o(y)g
(particular)g(pro-)-30 2220 y(gram)j(or)h(\014le,)h(except)g(for)f(v)o(ery)g
(short)h(in)o(terv)n(als)e(at)h(a)-30 2270 y(time.)43 b(In)22
b(this)g(w)o(a)o(y)g(a)g(relativ)o(ely)g(small)e(n)o(um)o(b)q(er)h(of)-30
2319 y(bu\013ers)g(can)f(b)q(e)g(shared)h(e\013ectiv)o(ely)f(amongst)e(a)h
(large)-30 2369 y(n)o(um)o(b)q(er)14 b(of)f(programs)g(and)g(\014les.)33
2421 y(Information)c(is)k(left)e(in)h(the)h(bu\013ers)h(un)o(til)d(the)i
(bu\013er)-30 2471 y(is)f(needed)g(i.e.)17 b(immedia)o(te)9
b(\\write)i(through")g(is)h(a)o(v)o(oided)-30 2521 y(if)f(only)g(part)g(of)g
(the)h(bu\013er)g(has)g(recen)o(tly)g(b)q(een)h(c)o(hanged.)-30
2571 y(Programs)20 b(whic)o(h)h(read)g(or)f(write)h(records)i(whic)o(h)d(are)
-30 2620 y(small)d(compared)g(with)h(the)h(bu\013er)h(size)f(are)g(then)g
(not)-30 2670 y(p)q(enalised)c(unduly)m(.)33 2722 y(Finally)c(when)j
(programs)e(are)h(terminated)f(and)h(\014les)-30 2772 y(are)k(closed,)g(the)g
(problems)e(of)h(ensuring)h(that)f(the)h(pro-)-30 2822 y(gram's)9
b(bu\013ers)i(are)f(\015ushed)h(prop)q(erly)g(\(problems)e(whic)o(h)1010
17 y(ha)o(v)o(e)j(plagued)g(other)g(op)q(erating)g(systems\))h(ha)o(v)o(e)f
(largely)1010 66 y(disapp)q(eared.)1072 116 y(There)21 b(is)e(one)g(area)h
(of)e(practical)i(concern:)30 b(if)18 b(the)1010 166 y(decision)i(\\when)g
(to)g(write")g(is)g(left)g(to)g(the)g(op)q(erating)1010 216
y(system)c(alone,)g(then)i(some)d(bu\013ers)j(ma)o(y)d(not)h(b)q(e)h(writ-)
1010 266 y(ten)f(out)g(for)f(a)h(v)o(ery)g(long)f(time.)22
b(Accordingly)16 b(there)h(is)1010 316 y(a)c(utilit)o(y)f(program)h(whic)o(h)
g(runs)h(t)o(wice)g(p)q(er)h(min)o(ute)d(and)1010 365 y(forces)19
b(all)e(suc)o(h)i(bu\013ers)h(to)e(b)q(e)g(written)h(out)f(uncondi-)1010
415 y(tionally)m(.)25 b(This)17 b(limits)e(the)j(lik)o(ely)e(amoun)o(t)f(of)i
(damage)1010 465 y(that)d(a)f(sudden)i(system)f(crash)h(ma)o(y)d(cause.)1010
581 y Fg(17.3)56 b(clrbuf)18 b(\(5038\))1010 658 y Fn(This)23
b(routine)g(zeros)i(out)e(the)h(\014rst)g(256)e(w)o(ords)i(\(512)1010
708 y(b)o(ytes\))h(of)f(the)h(bu\013er.)52 b(Note)25 b(that)f(the)h
(parameter)1010 758 y(passed)h(to)f(\\clrbuf)s(")g(is)g(the)g(address)i(of)d
(the)i(bu\013er)1010 808 y(header.)19 b(\\clrbuf)s(")13 b(is)h(called)g(b)o
(y)f(\\allo)q(c")g(\(6982\).)1010 924 y Fg(17.4)56 b(incore)17
b(\(4899\))1010 1001 y Fn(This)11 b(routine)g(searc)o(hes)j(for)d(a)g
(bu\013er)h(that)f(is)g(already)g(as-)1010 1050 y(signed)j(to)h(a)f
(particular)g(\(device,)h(blo)q(c)o(k)f(n)o(um)o(b)q(er\))g(pair.)1010
1100 y(It)j(searc)o(hes)i(the)f(circular)f(\\b"-list)f(whose)h(head)h(is)e
(the)1010 1150 y(\\devtab")10 b(structure)j(for)d(the)h(device)g(t)o(yp)q(e.)
18 b(If)10 b(a)g(bu\013er)h(is)1010 1200 y(found,)h(the)i(address)g(of)f(the)
h(bu\013er)g(header)g(is)f(returned.)1010 1250 y(\\incore")h(is)f(called)h(b)
o(y)g(\\breada")f(\(4780,)g(4788\).)1010 1366 y Fg(17.5)56
b(getblk)17 b(\(4921\))1010 1443 y Fn(This)e(routine)g(p)q(erforms)f(the)i
(same)e(searc)o(h)i(as)f(\\incore")1010 1493 y(but)h(go)q(es)g(further)h(in)e
(that)h(if)f(the)h(initial)e(searc)o(h)j(is)e(un-)1010 1542
y(successful,)20 b(a)d(bu\013er)i(is)e(allo)q(cated)g(from)f(the)j(\\a)o
(v"-list)1010 1592 y(\(a)o(v)n(ailable)12 b(list\).)1072 1642
y(By)j(a)f(call)g(on)g(\\nota)o(v)n(ail")e(\(4999\),)i(the)h(bu\013er)g(is)g
(re-)1010 1692 y(mo)o(v)o(ed)8 b(from)g(the)i(\\a)o(v"-list)e(and)i
(\015agged)f(as)h(\\B)p 1771 1692 V 15 w(BUSY".)1072 1742 y(\\getblk")21
b(is)g(more)g(suspicious)h(of)f(its)g(parameters)1010 1791
y(than)14 b(\\incore".)k(It)c(is)f(called)h(b)o(y)1053 1883
y Ff(exec)65 b(\(3040\))173 b(writei)21 b(\(6304\))1053 1933
y(exit)65 b(\(3237\))173 b(iinit)43 b(\(6928\))1053 1983 y(bread)g(\(4758\))
173 b(alloc)43 b(\(6981\))1053 2032 y(breada)21 b(\(4781,4789\))63
b(free)i(\(7016\))1053 2082 y(smount)21 b(\(6123\))173 b(update)21
b(\(7216\))1010 2174 y Fi(4940:)f Fn(A)o(t)f(this)f(p)q(oin)o(t)g(the)h
(required)g(bu\013er)g(has)g(b)q(een)1114 2223 y(lo)q(cated)g(b)o(y)g(searc)o
(hing)h(the)g(\\b"-list.)33 b(Either)20 b(it)1114 2273 y(is)11
b(\\B)p 1205 2273 V 15 w(BUSY")i(in)e(whic)o(h)g(case)i(a)f(\\sleep")g(m)o
(ust)e(b)q(e)1114 2323 y(tak)o(en)g(\(4943\),)g(or)h(else)g(it)f(is)h
(appropriated)f(\(4948\);)1010 2406 y Fi(4953:)20 b Fn(If)15
b(the)h(required)g(bu\013er)g(has)g(not)f(b)q(een)h(lo)q(cated,)1114
2456 y(and)9 b(if)f(the)i(\\a)o(v"-list)e(is)h(empt)o(y)m(,)f(set)i(the)g
(\\B)p 1799 2456 V 15 w(W)-5 b(ANTED")1114 2506 y(\015ag)11
b(for)g(the)h(\\a)o(v"-list)e(and)h(go)g(to)g(\\sleep")h(\(4955\);)1010
2589 y Fi(4960:)20 b Fn(If)15 b(the)g(\\a)o(v"-list)e(is)h(not)g(empt)o(y)m
(,)f(select)j(the)f(\014rst)1114 2639 y(mem)o(b)q(er,)8 b(and)i(if)f(it)h
(represen)o(ts)j(a)c(\\dela)o(y)o(ed)h(write")1114 2689 y(arrange)h(to)g(ha)o
(v)o(e)g(it)g(written)h(out)f(async)o(hronously)1114 2738 y(\(4962\);)1010
2822 y Fi(4966:)20 b Fn(\\B)p 1191 2822 V 15 w(RELOC")14 b(is)g(a)f(relic!)19
b(\(See)c(4583\);)-30 2946 y(68)p eop
%%Page: 69 77
76 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)776
b(17)42 b(BUFFER)16 b(MANIPULA)m(TION)-30 17 y Fi(4967:)21
b Fn(The)14 b(co)q(de)h(from)d(here)j(un)o(til)e(4973)f(uncondition-)74
66 y(ally)k(remo)o(v)o(es)g(the)i(bu\013er)g(from)d(the)j(\\b"-list)e(for)74
116 y(its)10 b(curren)o(t)h(device)f(t)o(yp)q(e)g(and)g(reinserts)h(it)e(in)o
(to)g(the)74 166 y(bn-list)i(for)f(the)i(new)f(device)h(t)o(yp)q(e.)18
b(Since)11 b(this)g(will)74 216 y(frequen)o(tly)k(b)q(e)h(a)e(\\no-op")g
(i.e.)20 b(the)c(new)f(and)f(old)74 266 y(device)k(t)o(yp)q(e)g(will)d(b)q(e)
j(the)f(same,)g(it)g(w)o(ould)f(seem)74 316 y(desirable)f(to)e(insert)i(a)f
(test)96 419 y Ff(if)21 b(\(bp->b_dev)f(==)i(dev\))74 522 y
Fn(b)q(efore)15 b(executing)g(lines)e(4967)g(to)h(4974.)74
587 y(Note)h(the)f(sp)q(ecial)g(handling)f(for)g(calls)h(where)74
637 y(\\dev)g(==)f(NODEV")h(\({1\).)j(\(Suc)o(h)d(calls)f(inciden-)74
687 y(tally)h(are)h(made)f(without)g(a)h(second)g(parameter)g(-)74
737 y(tut!)k(tut!)f(See)d(e.g.)i(3040.\))33 824 y(\\bfreelist")e(serv)o(es)i
(as)f(the)g(\\devtab")f(structure)j(for)-30 874 y(the)d(\\b"-list)e(for)g
(\\NODEV".)-30 989 y Fg(17.6)56 b(brelse)18 b(\(4869\))-30
1066 y Fn(This)13 b(pro)q(cedure)i(tak)o(es)e(the)g(bu\013er)h(passed)f(as)g
(a)f(param-)-30 1116 y(eter)k(and)d(links)h(it)f(bac)o(k)h(in)o(to)f(the)i
(\\a)o(v"-list.)33 1166 y(An)o(y)e(pro)q(cess)h(whic)o(h)f(is)g(either)g(w)o
(aiting)f(for)g(the)i(par-)-30 1216 y(ticular)g(bu\013er)h(or)f(an)o(y)f(a)o
(v)n(ailable)f(bu\013er)j(is)e(w)o(ok)o(en)h(up.)33 1265 y(Note)21
b(ho)o(w)o(ev)o(er)f(that)h(since)g(b)q(oth)g(\\sleeps")g(\(4943,)-30
1315 y(4955\))14 b(are)g(at)h(the)f(same)g(priorit)o(y)m(,)e(if)i(t)o(w)o(o)f
(pro)q(cesses)k(are)-30 1365 y(w)o(aiting)d({)h(one)h(for)f(the)g(particular)
g(bu\013er)i(and)e(one)g(for)-30 1415 y(an)o(y)f(bu\013er)h({)e(it)h(will)e
(b)q(e)j(a)e(toss-up)i(whic)o(h)f(will)e(get)i(it.)33 1465
y(By)f(giving)e(the)i(\014rst)h(priorit)o(y)e(o)o(v)o(er)g(the)i(second)f
(\(e.g.)-30 1514 y(b)o(y)e(biasing)g(b)o(y)g(one\))g(the)h(race)g(should)f(b)
q(e)h(resolv)o(ed)g(more)-30 1564 y(satisfactorily)m(.)29 b(The)19
b(disadv)n(an)o(tage)e(of)g(suc)o(h)i(a)e(c)o(hange)-30 1614
y(migh)o(t)12 b(b)q(e)j(that)f(it)f(could)h(lead)f(to)h(a)g(deadlo)q(c)o(k)f
(situation)-30 1664 y(in)h(certain)g(rather)h(p)q(eculiar)f(circumstances.)33
1714 y(If)i(an)h(error)h(has)g(o)q(ccurred)h(e.g.)27 b(up)q(on)17
b(reading)g(in-)-30 1763 y(formation)j(in)o(to)g(the)j(bu\013er)f(the)g
(information)d(in)i(the)-30 1813 y(bu\013er)f(ma)o(y)d(b)q(e)j(incorrect.)34
b(The)20 b(assignmen)o(t)d(on)i(line)-30 1863 y(4883)k(ensures)i(that)f(the)g
(information)d(in)i(the)h(bu\013er)-30 1913 y(will)13 b(not)h(b)q(e)g(mistak)
o(enly)e(retriev)o(ed)j(subsequen)o(tly)m(.)k(The)-30 1963
y(\\B)p 22 1963 13 2 v 16 w(ERR)o(OR")11 b(\015ag)h(is)g(set)i(e.g.)j(b)o(y)
12 b(\\rkstrategy")h(\(5403\))-30 2013 y(and)h(\\rkin)o(tr")g(\(5467\).)33
2062 y(T)m(o)d(see)i(ho)o(w)e(this)h(could)f(o)q(ccur,)i(consider)f(what)g
(hap-)-30 2112 y(p)q(ens)k(to)f(a)g(bu\013er)g(when)h(a)e(disk)h(i/o)f(op)q
(eration)g(is)h(com-)-30 2162 y(pleted:)-30 2249 y Fi(5471)21
b Fn(\\rkin)o(tr")13 b(calls)h(\\io)q(done";)-30 2331 y Fi(5026)21
b Fn(\\io)q(done")13 b(sets)i(the)f(\\B)p 465 2331 V 16 w(DONE")g(\015ag;)-30
2412 y Fi(5028)21 b Fn(\\io)q(done")13 b(calls)g(\\brelse";)-30
2494 y Fi(4387)21 b Fn(\\brelse")10 b(resets)h(the)f(\\B)p
472 2494 V 15 w(W)-5 b(ANTED",)9 b(\\B)p 769 2494 V 15 w(BUSY")74
2543 y(and)g(\\B)p 202 2543 V 15 w(ASYNC")h(\015ags)f(but)h(not)f(the)h(\\B)p
742 2543 V 15 w(DONE")74 2593 y(\015ag;)74 2659 y(.)18 b(.)g(.)g(.)g(.)g(.)g
(.)g(.)g(.)g(.)g(.)g(.)-30 2740 y Fi(4948)j Fn(\\getblk")9
b(\014nds)i(the)g(bu\013er)h(and)e(calls)g(\\nota)o(v)n(ail";)-30
2822 y Fi(5010)21 b Fn(\\nota)o(v)n(ail")11 b(sets)k(the)g(\\B)p
490 2822 V 15 w(BUSY")f(\015ag;)1010 17 y Fi(4759)20 b Fn(\\bread")25
b(\(whic)o(h)g(called)g(\\getblk"\))f(\014nds)h(the)1114 66
y(\\B)p 1166 66 V 15 w(DONE")14 b(\015ag)f(set)i(and)f(exits.)1072
151 y(Note)28 b(that)f(bu\013er)i(headers)g(are)e(remo)o(v)o(ed)g(from)1010
201 y(the)d(\\a)o(v"-list)d(b)o(y)i(\\nota)o(v)n(ail")e(and)i(are)g(returned)
i(b)o(y)1010 251 y(\\brelse".)f(Bu\013er)18 b(headers)f(are)f(mo)o(v)o(ed)e
(from)h(one)h(\\b"-)1010 300 y(list)d(to)h(another)g(b)o(y)g(\\getblk".)1010
415 y Fg(17.7)56 b(binit)17 b(\(5055\))1010 492 y Fn(This)h(pro)q(cedure)h
(is)f(called)g(b)o(y)f(\\main")e(\(1614\))i(to)h(ini-)1010
542 y(tialise)12 b(the)i(bu\013er)h(p)q(o)q(ol.)i(Empt)o(y)m(,)11
b(doubly)i(link)o(ed)g(circu-)1010 592 y(lar)g(lists)h(are)g(set)h(up:)1072
676 y Fl(\017)21 b Fn(for)13 b(the)i(\\a)o(v"-list)d(\(\\bfreelist")i(is)g
(head\);)1072 756 y Fl(\017)21 b Fn(the)9 b(\\b"-list)g(for)g(n)o(ull)f
(devices)i(\(\\dev)g(==)g(NODEV"\))1114 806 y(\(\\bfreelist")k(is)f(again)g
(head\);)1072 886 y Fl(\017)21 b Fn(a)13 b(\\b"-list)g(for)h(eac)o(h)g(ma)r
(jor)e(device)j(t)o(yp)q(e.)1010 971 y(F)m(or)e(eac)o(h)i(bu\013er:)1072
1055 y Fl(\017)21 b Fn(the)11 b(bu\013er)h(header)g(is)f(link)o(ed)f(in)o(to)
g(the)i(\\b"-list)d(for)1114 1105 y(the)14 b(device)h(\\NODEV")f(\({1\);)1072
1185 y Fl(\017)21 b Fn(the)16 b(address)g(of)f(the)h(bu\013er)h(is)e(set)h
(in)f(the)h(header)1114 1235 y(\(5067\);)1072 1315 y Fl(\017)21
b Fn(the)g(bu\013er)h(\015ags)f(are)g(set)h(as)f(\\B)p 1678
1315 V 15 w(BUSY")h(\(this)1114 1365 y(do)q(esn't)14 b(seem)g(to)f(b)q(e)i
(really)e(necessary\))j(\(5072\);)1072 1445 y Fl(\017)21 b
Fn(the)c(bu\013er)h(header)g(is)f(link)o(ed)f(in)o(to)g(the)i(\\a)o(v"-list)
1114 1495 y(b)o(y)13 b(a)h(call)f(on)h(\\brelse")g(\(5073\);)1072
1580 y(The)25 b(n)o(um)o(b)q(er)f(of)h(blo)q(c)o(k)f(devices)i(is)f(recorded)
h(as)1010 1629 y(\\n)o(blkdev".)41 b(This)22 b(is)g(used)h(for)e(c)o(hec)o
(king)i(v)n(alues)e(for)1010 1679 y(\\dev")f(in)g(\\getblk")g(\(4927\),)h
(\\getmdev")e(\(6192\))h(and)1010 1729 y(\\op)q(eni")j(\(6720\).)47
b(Insp)q(ection)25 b(of)e(\\b)q(devsw")i(\(4656\))1010 1779
y(sho)o(ws)16 b(that)h(\\n)o(blkdev")e(will)g(b)q(e)i(set)g(to)f(eigh)o(t)g
(whereas)1010 1829 y(the)e(v)n(alue)g(one)g(is)f(what)h(is)g(really)f
(required.)1072 1879 y(This)19 b(result)h(could)f(b)q(e)g(obtained)g(b)o(y)g
(\\editing")f(as)1010 1928 y(follo)o(ws:)1097 2013 y Ff(/5084/m/5081/)h
("nblkdev=i;)1097 2063 y(/5083/m/5077/)g("i++)1010 2178 y Fg(17.8)56
b(bread)18 b(\(4754\))1010 2254 y Fn(This)j(is)g(the)h(standard)g(pro)q
(cedure)h(for)e(reading)g(from)1010 2304 y(blo)q(c)o(k)13 b(devices.)20
b(It)14 b(is)f(called)h(b)o(y:)1053 2388 y Ff(wait)65 b(\(3282\))129
b(iinit)43 b(\(6927\))1053 2438 y(breada)21 b(\(4799\))129
b(alloc)43 b(\(6973\))1053 2488 y(statl)g(\(6051\))129 b(ialloc)21
b(\(7097\))1053 2538 y(smount)g(\(6116\))129 b(iget)65 b(\(7319\))1053
2588 y(readi)43 b(\(6258\))129 b(iupdat)21 b(\(7386\))1053
2638 y(writei)g(\(6305\))129 b(itrunc)21 b(\(7426,)g(7431\))1053
2687 y(bmap)65 b(\(6472,6488\))19 b(namei)43 b(\(7625\))1072
2772 y Fn(\\getblk")16 b(\014nds)h(a)f(bu\013er.)26 b(If)16
b(the)h(\\B)p 1693 2772 V 15 w(DONE")g(\015ag)1010 2822 y(is)d(set)g(no)g
(i/o)f(is)h(needed.)1890 2946 y(69)p eop
%%Page: 70 78
77 bop -30 -144 a Fk(17)43 b(BUFFER)16 b(MANIPULA)m(TION)775
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fg(17.9)56
b(breada)19 b(\(4773\))-30 93 y Fn(This)24 b(pro)q(cedure)h(has)e(an)g
(additional)f(parameter,)j(as)-30 143 y(compared)11 b(with)g(\\bread".)17
b(It)11 b(is)g(called)g(only)f(b)o(y)h(\\readi")-30 193 y(\(6256\).)-30
281 y Fi(4780:)21 b Fn(Chec)o(k)15 b(if)e(the)i(desired)g(blo)q(c)o(k)f(has)h
(already)f(b)q(een)74 331 y(assigned)f(to)f(a)g(bu\013er.)18
b(\(It)12 b(ma)o(y)f(not)h(y)o(et)g(b)q(e)h(a)o(v)n(ail-)74
381 y(able,)g(but)i(at)e(least)h(is)g(it)g(there?\);)-30 463
y Fi(4781:)21 b Fn(If)16 b(not)g(initiate)f(the)i(necessary)h(read)f(op)q
(eration)74 513 y(but)d(don't)g(w)o(ait)f(for)g(it)h(to)g(\014nish;)-30
595 y Fi(4788:)21 b Fn(Lo)q(ok)14 b(around)g(for)g(the)h(\\read)g(ahead")f
(blo)q(c)o(k.)19 b(If)74 644 y(it)g(is)g(not)g(there,)j(allo)q(cate)d(a)g
(bu\013er)h(\(4789\))e(but)74 694 y(release)13 b(it)f(\(4791\))f(if)g(the)i
(bu\013er)f(is)g(already)g(ready;)-30 776 y Fi(4793:)21 b Fn(The)14
b(\\read)f(ahead")g(blo)q(c)o(k)g(is)g(not)g(ready)m(,)g(so)g(ini-)74
826 y(tiate)h(an)g(async)o(hronous)g(read)h(op)q(eration;)-30
908 y Fi(4798:)21 b Fn(If)12 b(a)h(bu\013er)g(w)o(as)g(assigned)g(to)g(the)g
(curren)o(t)h(blo)q(c)o(k)74 958 y(call)f(\\bread")h(to)g(wrap)g(it)f(up,)h
(else...)-30 1039 y Fi(4800:)21 b Fn(W)m(ait)g(for)h(the)i(completion)d(of)h
(the)h(op)q(eration)74 1089 y(whic)o(h)14 b(w)o(as)g(started)h(at)f(line)f
(4785.)-30 1205 y Fg(17.10)56 b(b)n(write)19 b(\(4809\))-30
1282 y Fn(This)14 b(is)f(the)g(standard)h(pro)q(cedure)h(for)e(writing)f(to)h
(blo)q(c)o(k)-30 1331 y(devices.)39 b(It)21 b(is)f(called)g(b)o(y)g(\\exit")g
(\(3239\),)h(\\ba)o(write")-30 1381 y(\(4863\),)26 b(\\getblk")e(\(4963\),)i
(\\b\015ush")f(\(5241\),)g(\\free")-30 1431 y(\(7021\),)11
b(\\up)q(date")h(\(7221\))e(and)h(\\iup)q(dat")g(\(7400\).)16
b(N.B.)-30 1481 y(\\writei")e(calls)f(\\ba)o(write")h(\(6310\)!)-30
1569 y Fi(4820:)21 b Fn(If)16 b(the)g(\\B)p 269 1569 13 2 v
15 w(ASYNC")g(\015ag)g(is)g(not)f(set,)i(the)g(pro-)74 1619
y(cedure)c(do)q(es)g(not)e(return)i(un)o(til)d(the)i(i/o)f(op)q(eration)74
1669 y(is)j(completed;)-30 1751 y Fi(4823:)21 b Fn(If)11 b(the)h(\\B)p
260 1751 V 15 w(ASYNC")g(is)g(set,)g(but)g(\\B)f(DEL)-5 b(WRI")74
1801 y Fi(w)o(as)17 b Fn(not)g(set)h(\(note)f(\\\015ag")f(is)h(set)g(at)g
(line)g(4816\))74 1850 y(call)h(\\geterror")i(\(5336\))e(to)g(c)o(hec)o(k)i
(on)e(the)i(error)74 1900 y(\015ag.)26 b(\(If)16 b(\\B)p 289
1900 V 15 w(DEL)-5 b(WRI")16 b(w)o(as)h(set,)g(and)g(there)h(is)74
1950 y(an)f(error,)h(sending)f(the)g(error)h(indication)d(to)i(the)74
2000 y(righ)o(t)d(pro)q(cess)h(is)f(\\to)q(o)f(hard."\).)k(The)d(call)f
(\(4824\))74 2050 y(on)18 b(\\geterror")g(will)e(only)h(rep)q(ort)i(errors)g
(related)74 2099 y(to)14 b(the)g(initiation)e(of)i(the)g(write)g(op)q
(eration.)-30 2215 y Fg(17.11)56 b(ba)n(write)19 b(\(4856\))-30
2292 y Fn(This)10 b(pro)q(cedure)h(is)f(called)f(b)o(y)h(\\writei")f
(\(6310\))f(and)i(\\b)q(d-)-30 2342 y(write")21 b(\(4845\).)37
b(\\writei")20 b(calls)g(either)h(\\ba)o(write")f(or)-30 2391
y(\\b)q(dwrite")g(dep)q(ending)f(on)g(whether)h(the)g(blo)q(c)o(k)e(to)h(b)q
(e)-30 2441 y(written)c(has)f(b)q(een)h(wholly)e(or)g(partially)g(\014lled.)
-30 2557 y Fg(17.12)56 b(b)r(dwrite)18 b(\(4836\))-30 2634
y Fn(This)23 b(pro)q(cedure)i(is)d(called)g(b)o(y)h(\\writei")f(\(6311\))g
(and)-30 2683 y(\\bmap")12 b(\(6443,)h(6449,)f(6485,)h(6500)f(and)i(6501)f
(!\).)-30 2772 y Fi(4844:)21 b Fn(Don't)12 b(dela)o(y)g(the)h(write)f(if)g
(the)h(device)g(is)g(a)f(mag-)74 2822 y(netic)j(tap)q(e)f(driv)o(e)g(...)j(k)
o(eep)e(ev)o(erything)f(in)f(order;)1010 17 y Fi(4847:)20 b
Fn(Set)11 b(the)h(\\B)p 1328 17 V 15 w(DONE",)e(\\B)p 1559
17 V 15 w(DEL)-5 b(WRI")10 b(\015ags)g(and)1114 66 y(call)k(\\brelse")h(to)f
(link)g(the)h(bu\013er)h(in)o(to)e(the)h(\\a)o(v"-)1114 116
y(list.)1010 232 y Fg(17.13)56 b(b\015ush)19 b(\(5229\))1010
309 y Fn(This)12 b(pro)q(cedure)i(is)f(called)f(b)o(y)g(\\up)q(date")h
(\(7201\),)e(whic)o(h)1010 359 y(is)25 b(called)f(b)o(y)h(\\panic")f
(\(2420\),)j(\\sync")e(\(3489\))f(and)1010 409 y(\\sumoun)o(t")12
b(\(6150\).)1072 459 y(\\b\015ush")d(searc)o(hes)j(the)e(\\a)o(v"-list)d(for)
i(\\dela)o(y)o(ed)g(write")1010 508 y(blo)q(c)o(ks)22 b(and)h(forces)g(them)f
(to)g(b)q(e)i(written)f(out)f(asyn-)1010 558 y(c)o(hronously)m(.)1072
608 y(Note)15 b(that)f(as)g(\\nota)o(v)n(ail")e(adjusts)j(the)f(links)g(of)f
(the)1010 658 y(\\a)o(v"-list,)i(the)j(searc)o(h)g(\(whic)o(h)f(runs)g(at)g
(pro)q(cessor)h(pri-)1010 708 y(orit)o(y)f(six\))g(is)h(reinitiated)f(after)h
(eac)o(h)g(\\dela)o(y)o(ed)f(write")1010 757 y(blo)q(c)o(k)c(is)h(encoun)o
(tered.)1072 807 y(Note)20 b(also)f(that)g(since)i(it)e(happ)q(ens)h(that)g
(\\b\015ush")1010 857 y(is)j(only)f(called)g(b)o(y)h(\\up)q(date")g(with)g
(\\dev")g(equal)f(to)1010 907 y(\\NODEV",)16 b(line)f(5238,)h(in)g
(particular,)g(could)g(b)q(e)h(sim-)1010 957 y(pli\014ed.)1010
1073 y Fg(17.14)56 b(ph)n(ysio)18 b(\(5259\))1010 1149 y Fn(This)11
b(routine)g(is)f(called)h(to)f(handle)h(\\ra)o(w")f(input/output)1010
1199 y(i.e.)26 b(op)q(erations)16 b(whic)o(h)h(ignore)f(the)i(normal)c(512)i
(c)o(har-)1010 1249 y(acter)f(blo)q(c)o(k)e(size.)1072 1299
y(\\ph)o(ysio")i(is)h(called)g(b)o(y)g(\\rkread")h(\(5476\))e(and)h(\\rk-)
1010 1349 y(write")f(\(5483\))g(whic)o(h)g(app)q(ear)g(as)h(en)o(tries)g(in)f
(the)g(arra)o(y)1010 1399 y(\\cdevsw")f(\(4684\))1072 1448
y(\\Ra)o(w)g(i/o")g(is)h(not)h(an)f(essen)o(tial)g(feature)h(of)f(UNIX.)1010
1498 y(F)m(or)c(disk)h(devices)i(it)d(is)h(used)h(mainly)c(for)j(cop)o(ying)f
(whole)1010 1548 y(disks)17 b(and)f(c)o(hec)o(king)h(the)g(in)o(tegrit)o(y)f
(of)g(the)i(\014le)e(system)1010 1598 y(as)e(a)g(whole)g(\(see)i(e.g.)j
(ICHECK)14 b(\(VI)q(I)q(I\))h(in)f(the)h(UPM\),)1010 1648 y(where)h(it)e(is)h
(con)o(v)o(enien)o(t)g(to)f(read)i(whole)e(trac)o(ks,)h(rather)1010
1697 y(than)f(single)f(blo)q(c)o(ks,)h(at)f(a)h(time.)1072
1747 y(Note)20 b(the)g(declaration)f(of)g(\\strat")h(\(5261\).)34
b(Since)1010 1797 y(the)14 b(actual)e(parameter)h(used)h(e.g.)j
(\\rkstrategy")d(\(5389\))1010 1847 y(do)q(es)c(not)f(return)i(an)o(y)e(v)n
(alue,)g(is)g(this)h(form)e(of)g(declaration)1010 1897 y(really)13
b(necessary?)-30 2946 y(70)p eop
%%Page: 71 79
78 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)691
b(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)-30 17 y Fc(Section)20
b(F)-5 b(our)33 68 y Fe(Section)18 b(F)o(our)e(is)h(concerned)j(with)d
(\014les)h(and)f(\014le)h(sys-)-30 118 y(tems.)33 169 y(A)12
b(\014le)i(system)e(is)g(a)h(set)g(of)f(\014les)i(and)f(asso)q(ciated)h
(tables)-30 219 y(and)h(directo)o(ries)h(o)o(rganised)e(onto)g(a)g(single)g
(sto)o(rage)g(device)-30 268 y(such)i(as)d(a)h(disk)g(pack.)33
320 y(This)g(section)g(covers)g(the)g(means)f(of)g(creating)h(and)g(ac-)-30
369 y(cessing)j(\014les,)f(lo)q(cating)g(\014les)g(via)g(directo)o(ries,)h
(and)f(o)o(rgan-)-30 419 y(ising)e(and)h(maintaining)e(\014le)i(systems.)33
470 y(It)d(also)g(includes)j(the)f(co)q(de)g(fo)o(r)e(an)h(exotic)g(b)o(reed)
i(of)d(\014le)-30 520 y(called)j(a)f(\\pip)q(e".)-30 665 y
Fj(18)70 b(File)21 b(Access)h(and)h(Con)n(trol)-30 758 y Fn(A)14
b(large)e(part)i(of)e(ev)o(ery)i(op)q(erating)f(system)g(seems)g(to)g(b)q(e)
-30 808 y(concerned)j(with)c(data)h(managemen)o(t)e(and)h(\014le)i(manage-)
-30 858 y(men)o(t,)f(and)h(UNIX)g(turns)h(out)e(to)h(b)q(e)h(no)e(exception.)
33 909 y(Section)d(F)m(our)f(of)f(the)i(source)h(co)q(de)f(con)o(tains)g
(thirteen)-30 959 y(\014les.)33 1010 y(The)28 b(\014rst)h(four)f(con)o(tain)g
(common)e(declarations)-30 1059 y(needed)16 b(b)o(y)d(v)n(arious)h(of)f(the)h
(other)h(routines:)-30 1156 y Fi(\\\014le.h")20 b Fn(describ)q(es)14
b(the)f(structure)h(of)d(the)i(\\\014le")e(arra)o(y;)-30 1245
y Fi(\\\014lsvs.h")20 b Fn(describ)q(es)k(the)g(structure)g(of)e(the)i(\\sup)
q(er)74 1294 y(blo)q(c)o(k")14 b(for)f(\\moun)o(ted")f(\014le)i(systems;)-30
1383 y Fi(\\ino.h")20 b Fn(describ)q(es)11 b(the)f(structure)h(of)e(\\ino)q
(des")g(recorded)74 1433 y(on)14 b(\\moun)o(ted")e(devices;)-30
1521 y Fi(\\ino)q(de.h")19 b Fn(describ)q(es)g(the)e(structure)h(of)e(the)h
(\\ino)q(de")74 1571 y(arra)o(y;)33 1667 y(The)10 b(next)g(t)o(w)o(o)g
(\014les,)g(\\sys2.c")g(and)f(\\sys3.c")h(con)o(tain)-30 1717
y(co)q(de)17 b(for)e(system)h(calls.)22 b(\(\\sys1.c")16 b(and)f(\\sys4.c")h
(w)o(ere)-30 1767 y(presen)o(ted)g(in)e(Section)g(Tw)o(o\).)33
1818 y(Tne)i(next)g(\014v)o(e)g(\014les,)h(\\rdwri.c",)e(\\subr.c",)h
(\\\014o.c",)-30 1868 y(\\allo)q(c.c")f(and)g(\\iget.c",)f(together)j(presen)
o(t)g(the)f(princi-)-30 1918 y(pal)11 b(routines)g(for)g(\014le)f(managemen)o
(t,)f(and)h(pro)o(vide)h(a)g(link)-30 1968 y(b)q(et)o(w)o(een)j(the)g(i/o)d
(orien)o(ted)i(system)g(calls)f(and)g(the)i(basic)-30 2017
y(i/o)f(routines.)33 2069 y(The)20 b(\014le)f(\\nami.c")e(is)j(concerned)h
(with)e(searc)o(hing)-30 2118 y(directories)g(to)f(con)o(v)o(ert)g(\014le)g
(pathnames)e(in)o(to)h(\\ino)q(de")-30 2168 y(references.)33
2219 y(Finally)m(,)8 b(\\pip)q(e.c")j(is)f(the)h(\\device)h(driv)o(er")e(for)
h(pip)q(es.)-30 2343 y Fg(18.1)56 b(File)18 b(Characteristics)-30
2422 y Fn(A)24 b(UNIX)g(\014le)g(is)g(conceptually)f(a)h(named)e(c)o
(haracter)-30 2472 y(string,)16 b(stored)g(on)f(one)h(of)f(a)g(v)n(ariet)o(y)
g(of)f(p)q(eripheral)i(de-)-30 2521 y(vices)h(\(or)g(in)f(the)h(main)d
(memory\),)g(and)i(accessible)i(via)-30 2571 y(mec)o(hanisms)10
b(appropriate)h(to)g(the)h(usual)f(p)q(eripheral)g(de-)-30
2621 y(vices.)33 2672 y(It)18 b(will)e(b)q(e)j(noted)f(that)g(there)i(is)e
(no)f(record)j(struc-)-30 2722 y(ture)h(asso)q(ciated)f(with)g(UNIX)g
(\014les.)36 b(Ho)o(w)o(ev)o(er)20 b(\\new-)-30 2772 y(line")13
b(c)o(haracters)i(ma)o(y)c(b)q(e)i(inserted)i(in)o(to)d(the)h(\014le)h(to)e
(de-)-30 2822 y(\014ne)j(substrings)g(analogous)d(to)i(records.)1072
17 y(UNIX)j(carries)g(the)f(ideas)g(of)g(device)h(indep)q(endence)1010
66 y(to)11 b(their)h(logical)e(extreme)i(b)o(y)g(allo)o(wing)d(the)j(\014le)g
(name)f(in)1010 116 y(e\013ect)16 b(to)f(determine)g(uniquely)f(all)g(relev)n
(an)o(t)h(attributes)1010 166 y(of)e(the)i(\014le.)1010 306
y Fg(18.2)56 b(System)16 b(Calls)1010 392 y Fn(The)j(follo)o(wing)c(system)j
(calls)g(are)h(pro)o(vided)f(expressly)1010 441 y(for)13 b(\014le)h
(manipulation:)1046 553 y Fi(#)51 b(Name)f(Line)123 b(#)52
b(Name)67 b(Line)p 1021 569 900 2 v 1046 604 a Fn(3)j(read)94
b(5711)131 b(14)50 b(mkno)q(d)63 b(5952)1046 654 y(4)70 b(write)80
b(5720)131 b(15)50 b(c)o(hmo)q(d)68 b(3560)1046 704 y(5)i(op)q(en)86
b(5765)131 b(16)50 b(c)o(ho)o(wn)76 b(3575)1046 754 y(6)70
b(close)87 b(5846)131 b(19)50 b(seek)115 b(5861)1046 804 y(8)70
b(creat)83 b(5781)131 b(21)50 b(moun)o(t)71 b(6086)1046 853
y(9)f(link)103 b(5909)131 b(22)50 b(umoun)o(t)e(6144)1046 903
y(10)h(unlink)57 b(3510)131 b(41)50 b(dup)120 b(6069)1046 953
y(12)49 b(c)o(hdir)81 b(3538)131 b(42)50 b(pip)q(e)112 b(7723)1010
1089 y Fg(18.3)56 b(Con)n(trol)19 b(T)-5 b(ables)1010 1174
y Fn(The)14 b(arra)o(ys)h(\\\014le")e(and)h(\\ino)q(de")f(are)i(essen)o(tial)
f(comp)q(o-)1010 1224 y(nen)o(ts)h(of)e(the)h(\014le)g(access)i(mec)o
(hanism.)1010 1364 y Fg(18.4)56 b(\014le)17 b(\(5507\))1010
1449 y Fn(The)c(arra)o(y)f(\\\014le")h(is)f(de\014ned)i(as)f(an)f(arra)o(y)g
(of)h(structures)1010 1499 y(\(also)g(named)g(\\\014le"\).)1072
1553 y(An)k(elemen)o(t)e(of)h(the)h(\\\014le")f(arra)o(y)g(is)g(considered)i
(to)1010 1603 y(b)q(e)c(unallo)q(cated)g(if)f(\\f)p 1363 1603
13 2 v 14 w(coun)o(t")h(is)g(zero.)1072 1658 y(Eac)o(h)c(\\op)q(en")g(or)f
(\\creat")h(system)g(call)f(results)h(in)f(the)1010 1707 y(allo)q(cation)h
(of)h(an)g(elemen)o(t)g(of)g(the)i(\\\014le")e(arra)o(y)m(.)16
b(The)c(ad-)1010 1757 y(dress)k(of)d(this)i(elemen)o(t)f(is)g(stored)h(in)f
(an)g(elemen)o(t)g(of)f(the)1010 1807 y(calling)j(pro)q(cess's)k(arra)o(y)d
(\\u.u)p 1515 1807 V 14 w(o\014le".)29 b(It)18 b(is)g(the)g(index)1010
1857 y(of)f(the)g(newly)h(allo)q(cated)e(elemen)o(t)h(of)g(the)h(latter)f
(arra)o(y)1010 1907 y(whic)o(h)f(is)f(passed)i(bac)o(k)f(to)g(the)h(user)g
(pro)q(cess.)26 b(Descen-)1010 1957 y(dan)o(ts)12 b(of)f(a)g(pro)q(cess)i
(created)g(b)o(y)f(\\newpro)q(c")g(inherit)f(the)1010 2006
y(con)o(ten)o(ts)k(of)e(the)i(paren)o(t's)f(\\u.u)p 1532 2006
V 14 w(o\014le")g(arra)o(y)m(.)1072 2061 y(Eac)o(h)c(elemen)o(t)e(of)h
(\\\014le")g(includes)h(a)f(coun)o(ter,)h(\\f)p 1843 2061 V
15 w(coun)o(t",)1010 2111 y(to)g(determine)h(the)g(n)o(um)o(b)q(er)f(of)h
(curren)o(t)h(pro)q(cesses)h(whic)o(h)1010 2160 y(reference)j(it.)1072
2215 y(\\f)p 1108 2215 V 14 w(coun)o(t")g(is)g(incremen)o(ted)g(b)o(y)f
(\\newpro)q(c")h(\(1878\),)1010 2265 y(\\dup")11 b(\(6079\))g(and)g(\\fallo)q
(c")f(\(6857\);)h(it)g(is)g(decremen)o(ted)1010 2314 y(b)o(y)i(\\closef)s(")h
(\(6657\))f(and)h(\(if)f(the)i(\014le)f(can't)f(b)q(e)i(op)q(ened\))1010
2364 y(b)o(y)e(\\op)q(enl")h(\(5836\).)1072 2419 y(The)k(\\f)p
1197 2419 V 14 w(\015ag")e(\(5509\))g(of)h(the)g(\\\014le")g(elemen)o(t)f
(notes)1010 2468 y(whether)f(the)g(\014le)f(is)g(op)q(en)h(for)f(reading)g
(and/or)g(writing)1010 2518 y(or)i(whether)i(it)f(is)f(a)h(\\pip)q(e")f(or)h
(not.)26 b(\(F)m(urther)17 b(discus-)1010 2568 y(sion)9 b(of)h(\\pip)q(es")g
(will)e(b)q(e)j(deferred)g(till)e(Chapter)h(Tw)o(en)o(t)o(y-)1010
2618 y(One.\))1072 2672 y(The)25 b(\\\014le")g(structure)i(also)d(con)o
(tains)h(a)f(p)q(oin)o(ter,)1010 2722 y(\\f)p 1046 2722 V 14
w(ino)q(de")16 b(\(5511\))g(to)g(an)g(en)o(try)h(in)f(the)h(\\ino)q(de")f
(table,)1010 2772 y(and)h(a)h(32)f(bit)g(in)o(teger,)i(\\f)p
1450 2772 V 14 w(o\013set")g(\(5512\),)e(whic)o(h)h(is)f(a)1010
2822 y(logical)12 b(p)q(oin)o(ter)i(to)g(a)f(c)o(haracter)j(within)d(the)h
(\014le.)1890 2946 y(71)p eop
%%Page: 72 80
79 bop -30 -144 a Fk(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)691
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fg(18.5)56
b(ino)r(de)18 b(\(5659\))-30 93 y Fn(\\ino)q(de")h(is)f(de\014ned)i(as)f(an)f
(arra)o(y)h(of)f(structures)j(\(also)-30 143 y(named)13 b(\\ino)q(de"\).)33
193 y(An)k(elemen)o(t)g(of)g(the)g(\\ino)q(de")g(is)g(considered)i(to)e(b)q
(e)-30 243 y(unallo)q(cated)24 b(if)g(the)h(reference)h(coun)o(t,)h(\\i)p
692 243 13 2 v 14 w(coun)o(t",)g(is)-30 293 y(zero.)33 342
y(A)o(t)17 b(eac)o(h)h(p)q(oin)o(t)e(in)h(time,)f(\\ino)q(de")h(con)o(tains)g
(a)g(sin-)-30 392 y(gle)e(en)o(try)h(for)f(eac)o(h)h(\014le)f(whic)o(h)g(ma)o
(y)e(b)q(e)j(referenced)i(for)-30 442 y(normal)d(i/o)g(op)q(erations,)i(or)g
(whic)o(h)f(is)g(b)q(eing)h(executed)-30 492 y(or)i(whic)o(h)f(has)g(b)q(een)
i(executed)g(and)e(has)g(the)h(\\stic)o(ky")-30 542 y(bit)c(set,)h(or)f(whic)
o(h)g(is)g(the)g(w)o(orking)f(directory)i(for)f(some)-30 591
y(pro)q(cess.)33 641 y(Sev)o(eral)i(\\\014le")f(table)g(en)o(tries)i(ma)o(y)d
(p)q(oin)o(t)h(to)h(a)f(sin-)-30 691 y(gle)j(\\ino)q(de")f(en)o(try)m(.)32
b(The)19 b(ino)q(de)f(en)o(try)h(describ)q(es)i(the)-30 741
y(general)15 b(disp)q(orition)e(of)g(the)h(\014le.)-30 857
y Fg(18.6)56 b(Resources)18 b(Required)-30 933 y Fn(Eac)o(h)f(\014le)e
(requires)i(the)g(dedication)e(of)h(certain)g(system)-30 983
y(resources.)24 b(When)16 b(a)f(\014le)g(exists,)g(but)h(is)e(not)h(b)q(eing)
h(ref-)-30 1033 y(erenced)g(in)e(an)o(y)f(w)o(a)o(y)m(,)g(it)g(requires:)-30
1123 y Fi(\(a\))21 b Fn(a)14 b(directory)h(en)o(try)h(\(16)e(c)o(haracters)i
(in)f(a)f(directory)74 1173 y(\014le\);)-30 1255 y Fi(\(b\))20
b Fn(a)15 b(disk)g(\\ino)q(de")g(en)o(try)h(\(32)f(c)o(haracters)i(in)e(a)g
(table)74 1305 y(stored)g(on)f(the)g(disk\);)-30 1388 y Fi(\(c\))21
b Fn(zero,)d(one)g(or)g(more)e(blo)q(c)o(ks)i(of)f(disk)g(storage)h(\(512)74
1438 y(c)o(haracters)e(eac)o(h\).)-30 1528 y(In)h(addition)f(if)f(the)j
(\014le)e(is)h(b)q(eing)f(referenced)j(for)e(some)-30 1577
y(purp)q(ose,)e(it)f(requires)-30 1668 y Fi(\(d\))20 b Fn(a)13
b(core)h(\\ino)q(de")e(en)o(try)i(\(32)f(c)o(haracters)i(in)e(the)h(\\in-)74
1717 y(o)q(de")g(arra)o(y\);)-30 1807 y(Finally)g(if)f(a)i(user)h(program)d
(has)i(\\op)q(ened")g(the)g(\014le)g(for)-30 1857 y(reading)k(or)f(writing,)h
(a)f(n)o(um)o(b)q(er)g(of)g(resources)j(are)e(re-)-30 1907
y(quired:)-30 1997 y Fi(\(e\))h Fn(a)14 b(\\\014le")f(arra)o(y)h(en)o(try)g
(\(8)g(c)o(haracters\);)-30 2080 y Fi(\(f)5 b(\))19 b Fn(an)11
b(en)o(try)h(in)e(the)i(user)g(program's)d(\\u.u)p 679 2080
V 14 w(o\014le")i(arra)o(y)74 2129 y(\(one)17 b(w)o(ord)f(p)q(er)h(\014le,)f
(p)q(oin)o(ting)f(to)h(a)g(\\\014le")g(arra)o(y)74 2179 y(en)o(try\);)33
2269 y(Mec)o(hanisms)10 b(ha)o(v)o(e)h(to)g(b)q(e)h(set)g(up)f(for)f(allo)q
(cating)g(and)-30 2319 y(deallo)q(cating)18 b(eac)o(h)g(of)g(these)h
(resources)i(in)d(an)g(orderly)-30 2369 y(manner.)f(The)12
b(follo)o(wing)e(table)h(giv)o(es)h(the)h(names)e(of)g(the)-30
2419 y(principal)j(pro)q(cedures)i(in)o(v)o(olv)o(ed:)93 2506
y Fi(resource)211 b(obtain)48 b(free)p 68 2523 726 2 v 93 2558
a Fn(directory)15 b(en)o(try)115 b(namei)72 b(namei)93 2607
y(disk)14 b(\\ino)q(de")f(en)o(try)52 b(iallo)q(c)85 b(ifree)93
2657 y(disk)14 b(storage)g(blo)q(c)o(k)60 b(allo)q(c)97 b(free)93
2707 y(core)15 b(\\ino)q(de")e(en)o(try)51 b(iget)115 b(iput)93
2757 y(\\\014le")14 b(table)f(en)o(try)80 b(fallo)q(c)k(closef)93
2807 y(\\u)p 139 2807 13 2 v 15 w(o\014le")13 b(en)o(try)125
b(ufallo)q(c)61 b(close)1010 17 y Fg(18.7)56 b(Op)r(ening)17
b(a)i(File)1010 97 y Fn(When)g(a)f(program)f(wishes)j(to)e(reference)j(a)e
(\014le)f(whic)o(h)1010 146 y(already)f(exists,)h(it)f(m)o(ust)f(\\op)q(en")h
(the)h(\014le)f(to)g(create)h(a)1010 196 y(\\bridge")12 b(to)h(the)h(\014le.)
j(\(Note)d(that)f(in)g(UNIX,)f(pro)q(cesses)1010 246 y(usually)e(inherit)h
(the)h(op)q(en)f(\014les)h(of)e(their)i(paren)o(ts)f(or)g(pre-)1010
296 y(decessors,)16 b(so)f(that)f(often)h(all)e(needed)j(\014les)f(are)f
(already)1010 346 y(implicitly)e(op)q(en.\))22 b(If)15 b(the)h(\014le)f(do)q
(es)h(not)f(already)g(exist,)1010 395 y(it)e(m)o(ust)g(b)q(e)i(\\created".)
1072 447 y(This)f(second)h(case)g(will)d(b)q(e)j(in)o(v)o(estigated)e
(\014rst:)1010 573 y Fg(18.8)56 b(creat)18 b(\(5781\))1010
652 y Fi(5786:)i Fn(\\namei")9 b(\(7518\))g(con)o(v)o(erts)j(a)e(pathname)g
(in)o(to)f(an)1114 702 y(\\ino)q(de")g(p)q(oin)o(ter.)17 b(\\uc)o(har")9
b(is)h(the)g(name)f(of)g(a)g(pro-)1114 752 y(cedure)15 b(whic)o(h)g(reco)o(v)
o(ers)g(the)g(pathname,)e(c)o(harac-)1114 802 y(ter)h(b)o(y)f(c)o(haracter,)i
(from)d(the)i(user)g(program)e(data)1114 852 y(area;)1010 942
y Fi(5787:)20 b Fn(A)g(n)o(ull)e(\\ino)q(de")h(p)q(oin)o(ter)h(indicates)g
(either)g(an)1114 992 y(error)15 b(or)f(that)g(no)g(\014le)g(of)f(that)h
(name)f(already)h(ex-)1114 1041 y(ists;)1010 1132 y Fi(5788:)20
b Fn(F)m(or)e(error)h(conditions,)f(see)h(\\CREA)m(T)e(\(I)q(I\)")h(in)1114
1181 y(the)c(UPM;)1010 1271 y Fi(5790:)20 b Fn(\\makno)q(de")8
b(\(7455\))h(creates)j(a)d(core)i(\\ino)q(de")e(via)1114 1321
y(a)17 b(call)g(on)h(\\iallo)q(c")e(and)i(then)g(initialises)f(it)g(and)1114
1371 y(en)o(ters)e(it)e(in)o(to)g(the)i(appropriate)e(directory)m(.)19
b(Note)1114 1421 y(the)14 b(explicit)g(resetting)h(of)e(the)h(\\stic)o(ky")g
(bit)1010 1546 y Fg(18.9)56 b(op)r(enl)17 b(\(5804\))1010 1626
y Fn(This)25 b(pro)q(cedure)i(is)e(called)g(b)o(y)g(\\op)q(en")g(\(5774\))f
(and)1010 1676 y(\\creat")d(\(5793,)f(5795\),)h(passing)f(v)n(alues)g(of)g
(the)h(third)1010 1726 y(parameter,)d(\\trf)s(",)g(of)f(0,)h(2)g(and)f(1)h
(resp)q(ectiv)o(ely)m(.)31 b(The)1010 1776 y(v)n(alue)14 b(2)g(represen)o(ts)
j(the)e(case)h(where)f(no)f(\014le)h(of)f(the)h(de-)1010 1826
y(sired)f(name)f(already)h(exists.)1010 1924 y Fi(5812:)20
b Fn(The)j(second)g(parameter,)g(\\mo)q(de",)g(can)f(tak)o(e)1114
1974 y(the)17 b(v)n(alues)g(01)g(\(\\FREAD"\),)f(02)h(\(\\FWRITE"\))1114
2024 y(or)e(03)g(\(\\FREAD)g Ff(|)h Fn(FWRITE"\))f(when)h(\\trf)s(")f(is)1114
2073 y(0,)e(but)h(only)f(02)g(otherwise;)1114 2143 y(Whete)j(a)f(\014le)g(of)
g(the)h(desired)h(name)d(already)h(ex-)1114 2193 y(ists,)g(c)o(hec)o(k)i(the)
f(access)h(p)q(ermissions)e(for)h(the)g(de-)1114 2243 y(sired)d(mo)q(de\(s\))
f(of)g(activit)o(y)g(via)f(calls)h(on)h(\\access")1114 2293
y(\(6746\),)i(whic)o(h)i(ma)o(y)d(set)k(\\u.u)p 1620 2293 V
14 w(error")f(as)g(a)f(side-)1114 2343 y(e\013ect;)1010 2433
y Fi(5824:)k Fn(If)f(the)g(\014le)g(is)g(b)q(eing)g(\\created",)h(eliminate)d
(its)1114 2482 y(previous)9 b(con)o(ten)o(ts)i(via)d(a)h(call)f(on)i
(\\itrunc")f(\(7414\).)1114 2532 y(The)17 b(co)q(de)h(here)g(could)f(b)q(e)g
(impro)o(v)o(ed)f(b)o(y)g(c)o(hang-)1114 2582 y(ing)d(the)i(test)g(to)f
(\\\(trf)h(==)f(1\)".)19 b(V)m(erify)14 b(that)g(this)1114
2632 y(w)o(ould)f(b)q(e)h(so.)1010 2722 y Fi(5826:)20 b Fn(\\prele")13
b(\(7882\))e(is)i(used)g(to)f(\\unlo)q(c)o(k")g(\\ino)q(des".)1114
2772 y(Where,)25 b(y)o(ou)e(ma)o(y)e(ask,)k(did)e(the)g(\\ino)q(de")g(get)
1114 2822 y(\\lo)q(c)o(k)o(ed",)13 b(and)g(wh)o(y?)-30 2946
y(72)p eop
%%Page: 73 81
80 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)691
b(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)-30 17 y Fi(5827:)21
b Fn(Note)28 b(that)f(\\fallo)q(c")e(\(6847\))i(calls)f(\\ufallo)q(c")74
66 y(\(6824\))13 b(as)h(the)h(\014rst)g(thing)e(it)g(do)q(es;)-30
148 y Fi(5831:)21 b Fn(\\ufallo)q(c")8 b(lea)o(v)o(es)h(the)h(user)g(\014le)g
(iden)o(tifying)d(n)o(um-)74 198 y(b)q(er)17 b(\\u.u)p 230
198 13 2 v 14 w(ar0[R0]".)23 b(Wh)o(y)15 b(do)q(es)i(this)f(statemen)o(t)74
248 y(o)q(ccur)11 b(where)g(it)f(do)q(es,)h(instead)f(of)f(after)i(line)e
(5834?)-30 330 y Fi(5832:)21 b Fn(\\op)q(eni")14 b(\(6702\))g(is)h(called)g
(to)g(call)f(handlers)h(for)74 380 y(sp)q(ecial)e(\014les,)g(in)f(cae)i(an)o
(y)e(device)h(sp)q(eci\014c)i(actions)74 430 y(are)f(required)f(\(for)g(disk)
g(\014les)g(there)h(is)f(no)f(action\);)-30 512 y Fi(5839:)21
b Fn(In)h(the)g(case)g(of)f(an)g(error)i(while)e(making)e(the)74
562 y(\\\014le")j(arra)o(y)g(en)o(try)m(,)i(the)f(\\ino)q(de")e(en)o(try)i
(is)f(re-)74 611 y(leased)15 b(b)o(y)e(a)h(call)f(on)h(\\iput".)33
700 y(It)d(will)f(b)q(e)i(seen)h(that)f(resp)q(onsibilit)o(y)e(is)i(quite)f
(widely)-30 750 y(distributed.)23 b(The)16 b(\\\014le")e(table)h(en)o(try)h
(is)f(initialised)f(b)o(y)-30 800 y(\\fallo)q(c")j(and)h(\\op)q(enl";)i(the)f
(\\ino)q(de")f(table)g(en)o(try)m(,)h(b)o(y)-30 850 y(\\iget",)13
b(\\iallo)q(c")f(and)i(\\makno)q(de".)33 899 y(Note)g(that)f(\\iallo)q(c")f
(clears)i(out)f(the)h(\\i)p 667 899 V 15 w(addr")f(arra)o(y)-30
949 y(of)g(a)g(newly)g(allo)q(cated)g(\\ino)q(de")g(and)g(\\itrunc")g(do)q
(es)h(the)-30 999 y(same)j(for)h(a)f(pre-existing)h(\\ino)q(de",)g(so)g(that)
g(after)g(the)-30 1049 y(\\creat")f(system)f(call,)f(there)i(are)f(no)g(disk)
g(blo)q(c)o(ks)g(asso-)-30 1099 y(ciated)f(with)e(the)i(\014le,)e(no)o(w)h
(classed)g(as)g(\\small".)-30 1214 y Fg(18.10)56 b(op)r(en)18
b(\(5763\))-30 1291 y Fn(W)m(e)13 b(no)o(w)g(turn)g(to)g(consider)h(the)f
(case)h(where)h(a)d(program)-30 1341 y(wishes)j(to)f(reference)i(a)e(\014le)g
(whic)o(h)f(already)h(exists.)33 1391 y(\\namei")g(is)h(called)h(\(5770\))f
(with)h(a)f(second)i(param-)-30 1441 y(eter)g(of)d(zero)i(to)f(lo)q(cate)g
(the)h(named)e(\014le.)21 b(\(\\u.u)p 757 1441 V 14 w(arg[0]")-30
1490 y(con)o(tains)11 b(the)g(address)h(in)e(the)i(user)f(space)h(of)e(a)g(c)
o(haracter)-30 1540 y(string)k(whic)o(h)g(de\014nes)h(a)f(\014le)g(path)g
(name.\))33 1590 y(\\u.u)p 114 1590 V 14 w(arg[1]")g(has)i(to)f(b)q(e)h
(incremen)o(ted)g(b)o(y)f(one,)h(b)q(e-)-30 1640 y(cause)21
b(there)g(is)f(a)f(mismatc)o(h)e(b)q(et)o(w)o(een)k(the)f(user)h(pro-)-30
1690 y(gramming)10 b(con)o(v)o(en)o(tions)j(and)g(the)g(in)o(ternal)g(data)f
(repre-)-30 1739 y(sen)o(tations.\))-30 1855 y Fg(18.11)56
b(op)r(enl)18 b(revisited)-30 1932 y Fn(\\trf)s(")12 b(is)g(no)o(w)g(zero,)h
(so)f(access)h(p)q(ermissions)f(are)g(c)o(hec)o(k)o(ed)-30
1982 y(\(5813\))18 b(but)h(the)f(existing)h(\014le)f(\(if)f(an)o(y\))h(is)h
(not)f(deallo-)-30 2031 y(cated)d(\(5824\).)33 2081 y(What)c(is)h(a)g(little)
f(disconcerting)i(here)g(is)f(that,)g(apart)-30 2131 y(from)i(the)i(call)f
(on)h(\\fallo)q(c")d(\(5827\),)i(there)i(is)f(no)f(direct)-30
2181 y(call)k(on)h(an)o(y)f(of)f(the)j(\\resource)g(allo)q(cation")d
(routines.)-30 2231 y(Of)c(course,)g(for)g(an)f(existing)g(\014le,)h(neither)
g(directory)g(en-)-30 2281 y(try)h(nor)g(disk)f(\\ino)q(de")g(en)o(try)h(nor)
f(disk)g(blo)q(c)o(ks)h(need)g(b)q(e)-30 2330 y(allo)q(cated.)30
b(The)18 b(core)h(\\ino)q(de")e(en)o(try)h(is)g(allo)q(cated)f(\(if)-30
2380 y(necessary\))j(as)e(a)f(side-e\013ect)i(of)e(the)h(call)f(on)g
(\\namei",)-30 2430 y(but)e(...)i(where)e(is)e(it)h(initialised?)-30
2546 y Fg(18.12)56 b(close)18 b(\(5846\))-30 2622 y Fn(The)g(\\close")f
(system)f(call)g(is)h(used)h(to)f(sev)o(er)h(explicitly)-30
2672 y(the)g(connection)g(b)q(et)o(w)o(een)g(a)f(user)h(program)d(and)i(a)g
(\014le)-30 2722 y(and)d(th)o(us)g(can)g(b)q(e)h(regarded)f(as)g(the)h(in)o
(v)o(erse)f(of)f(\\op)q(en".)33 2772 y(The)j(user)i(program's)d(\014le)h
(iden)o(ti\014cation)f(is)i(passed)-30 2822 y(via)12 b(r0.)18
b(The)13 b(v)n(alue)f(is)h(v)n(alidated)e(b)o(y)i(\\getf)s(")f(\(6619\),)g
(the)1010 17 y(\\u.u)p 1091 17 V 14 w(o\014le")18 b(en)o(try)h(is)g(erased,)h
(and)f(a)f(call)g(is)g(made)f(on)1010 66 y(\\closef)s(".)1010
182 y Fg(18.13)56 b(closef)17 b(\(6643\))1010 259 y Fn(\\closef)s(")g(is)h
(called)f(b)o(y)g(\\close")h(\(5854\))f(and)g(b)o(y)h(\\exit")1010
309 y(\(3230\).)37 b(\(The)21 b(latter)g(is)g(more)e(common)f(since)j(most)
1010 358 y(\014les)14 b(do)f(not)g(get)h(closed)g(explicitly)e(but)i(only)e
(implicitly)1010 408 y(when)i(the)h(user)g(program)d(terminates.\))1010
496 y Fi(6649:)20 b Fn(If)e(the)h(\014le)f(is)h(a)f(pip)q(e,)h(reset)h(the)f
(mo)q(de)e(of)g(the)1114 546 y(pip)q(e)11 b(and)g(\\w)o(ak)o(eup")f(an)o(y)h
(pro)q(cess)i(whic)o(h)e(is)g(w)o(ait-)1114 596 y(ing)i(for)h(the)h(pip)q(e,)
f(either)i(for)e(information)d(or)j(for)1114 646 y(space;)1010
727 y Fi(6655:)20 b Fn(If)11 b(this)f(is)h(the)g(last)g(pro)q(cess)h(to)f
(reference)i(the)f(\014le,)1114 777 y(call)g(\\closei")h(\(6672\))g(to)g
(handle)h(an)o(y)f(sp)q(ecial)h(end)1114 827 y(of)d(\014le)h(pro)q(cessing)h
(for)e(sp)q(ecial)h(\014les)h(and)e(then)i(call)1114 877 y(\\iput";)1010
958 y Fi(6657:)20 b Fn(Decremen)o(t)c(the)h(\\\014le")e(en)o(try)h(reference)
i(coun)o(t.)1114 1008 y(If)e(this)h(no)o(w)f(zero,)i(the)g(en)o(try)f(is)g
(no)f(longer)h(allo-)1114 1058 y(cated.)1010 1174 y Fg(18.14)56
b(iput)18 b(\(7344\))1010 1250 y Fn(\\closei",)11 b(as)h(its)f(last)g(action)
h(calls)f(\\iput".)16 b(This)c(routine)1010 1300 y(is)h(in)g(fact)g(called)g
(from)e(man)o(y)g(places,)j(whenev)o(er)g(a)f(con-)1010 1350
y(nection)j(to)f(a)g(core)i(\\ino)q(de")e(is)g(to)h(b)q(e)g(sev)o(ered)h(and)
e(the)1010 1400 y(reference)h(coun)o(t)e(decremen)o(ted.)1010
1488 y Fi(7350:)20 b Fn(If)e(the)h(reference)i(coun)o(t)d(is)g(one)h(at)f
(this)g(p)q(oin)o(t,)1114 1537 y(the)g(\\ino)q(de")g(is)f(to)h(b)q(e)h
(released.)31 b(While)17 b(this)h(is)1114 1587 y(happ)q(ening,)13
b(it)g(should)h(b)q(e)h(lo)q(c)o(k)o(ed.)1010 1669 y Fi(7352:)20
b Fn(If)11 b(the)g(n)o(um)o(b)q(er)f(of)g(\\links")g(to)h(the)g(\014le)g(is)f
(zero)i(\(or)1114 1719 y(less\))i(the)h(\014le)f(is)f(to)h(b)q(e)h(deallo)q
(cated)f(\(see)h(b)q(elo)o(w\);)1010 1800 y Fi(7357:)20 b Fn(\\iup)q(dat")f
(\(7374\))h(up)q(dates)h(the)f(accessed)i(and)1114 1850 y(up)q(date)11
b(times)g(as)g(recorded)i(on)d(the)i(disk)f(\\ino)q(de";)1010
1932 y Fi(7358:)20 b Fn(\\prele")14 b(unlo)q(c)o(ks)g(the)g(\\ino)q(de".)k
(Wh)o(y)13 b(should)g(it)1114 1982 y(b)q(e)h(called)g(here)h(as)f(w)o(ell)f
(as)h(at)g(line)f(7363?)1010 2097 y Fg(18.15)56 b(Deletion)16
b(of)j(Files)1010 2174 y Fn(New)k(\014les)f(are)h(automatically)c(en)o(tered)
24 b(in)o(to)d(the)i(\014le)1010 2224 y(directory)e(as)g(p)q(ermanen)o(t)g
(\014les)g(as)g(so)q(on)g(as)g(they)h(are)1010 2274 y(\\op)q(ened".)k
(Subsequen)o(t)18 b(\\closing")d(of)h(a)g(\014le)g(do)q(es)h(not)1010
2323 y(automatically)7 b(cause)k(its)f(deletion.)16 b(As)11
b(w)o(as)f(seen)h(at)f(line)1010 2373 y(7352,)h(deletion)i(will)e(o)q(ccur)i
(when)g(the)g(\014eld)g(\\i)p 1761 2373 V 14 w(nlink")f(of)1010
2423 y(the)17 b(core)f(\\ino)q(de")g(en)o(try)h(is)f(zero.)25
b(This)16 b(\014eld)g(is)g(set)h(to)1010 2473 y(one)e(initially)e(b)o(y)i
(\\makno)q(de")f(\(7464\))g(when)i(the)g(\014le)f(is)1010 2523
y(\014rst)f(created.)19 b(It)14 b(ma)o(y)d(b)q(e)j(incremen)o(ted)f(b)o(y)g
(the)h(system)1010 2573 y(call)h(\\link")g(\(5941\))h(and)g(decremen)o(ted)i
(b)o(y)e(the)h(system)1010 2622 y(call)c(\\unlink")f(\(3529\).)1072
2672 y(Programs)k(whic)o(h)g(create)j(temp)q(orary)d(\\w)o(ork)g(\014les")
1010 2722 y(should)11 b(remo)o(v)o(e)g(these)i(\014les)f(b)q(efore)g
(terminating,)e(b)o(y)h(ex-)1010 2772 y(ecuting)g(an)f(\\unlink")g(system)g
(call.)16 b(Note)11 b(that)g(the)g(\\un-)1010 2822 y(link")f(call)g(do)q(es)i
(not)f(of)f(itself)h(remo)o(v)o(e)f(the)i(\014le.)17 b(This)11
b(can)1890 2946 y(73)p eop
%%Page: 74 82
81 bop -30 -144 a Fk(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)691
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fn(only)h(happ)q(en)h(when)g
(the)g(reference)i(coun)o(t)d(\(\\i)p 742 17 13 2 v 15 w(coun)o(t"\))-30
66 y(is)e(ab)q(out)g(to)g(b)q(e)g(decremen)o(ted)h(to)f(zero)h(\(7350,)d
(7362\).)33 117 y(T)m(o)d(minim)o(ise)f(the)i(problems)f(asso)q(ciated)i
(with)f(\\tem-)-30 167 y(p)q(orary")28 b(\014les)g(whic)o(h)f(surviv)o(e)h
(program)d(or)j(system)-30 217 y(crashes,)22 b(programmers)17
b(should)h(observ)o(e)i(the)g(con)o(v)o(en-)-30 267 y(tions)14
b(that:)-30 361 y Fi(\(a\))21 b Fn(temp)q(orary)14 b(\014les)i(should)g(b)q
(e)g(\\unlink)o(ed")e(immedi-)74 411 y(ately)g(after)g(they)g(are)h(op)q
(ened;)-30 498 y Fi(\(b\))20 b Fn(temp)q(orary)12 b(\014les)i(should)e(alw)o
(a)o(ys)g(b)q(e)i(placed)f(in)g(the)74 547 y(\\tmp")18 b(directory)m(.)34
b(Unique)20 b(\014le)f(names)g(can)g(b)q(e)74 597 y(generated)11
b(b)o(y)f(incorp)q(orating)f(the)h(pro)q(cess's)i(iden-)74
647 y(tifying)k(n)o(um)o(b)q(er)g(in)o(to)g(the)i(\014le)f(name)f(\(See)i
(\\get-)74 697 y(pid")13 b(\(3480\)\).)-30 818 y Fg(18.16)56
b(Reading)18 b(and)h(W)-5 b(riting)-30 896 y Fn(It)22 b(is)f(of)f(in)o
(terest)i(to)f(w)o(ork)g(through)g(an)g(abbreviated)-30 946
y(summary)11 b(of)i(the)i(co)q(de)f(whic)o(h)f(is)h(in)o(v)o(ok)o(ed)e(when)i
(a)g(user)-30 995 y(pro)q(cess)g(p)q(erforms)e(a)f(\\read")h(system)g(call)f
(b)q(efore)i(exam-)-30 1045 y(ining)g(the)i(co)q(de)f(in)g(detail.)36
1141 y Ff(....)21 b(read)g(\(f,)g(b,)g(n\);)h(/*user)e(program/)341
1240 y({trap)h(occurs})36 1290 y(2693)g(trap)341 1390 y({system)f(call)h(#3})
36 1440 y(5711)g(read)g(\(\);)36 1490 y(5713)64 b(rdwr)21 b(\(PREAD\);)33
1584 y Fn(Execution)12 b(of)f(the)i(system)e(call)g(b)o(y)h(the)g(user)h(pro)
q(cess)-30 1634 y(results)19 b(in)d(the)i(activ)n(ation)e(of)g(\\trap")h
(running)g(in)f(k)o(er-)-30 1684 y(nel)j(mo)q(de.)29 b(\\trap")18
b(recognises)i(system)e(call)f(#3,)h(and)-30 1734 y(calls)g(\(via)f
(\\trapl"\))g(the)h(routine)g(\\read",)g(whic)o(h)g(calls)-30
1784 y(\\rdwr".)14 1879 y Ff(5731)j(rdwr)14 1979 y(5736)g(fp)g(=)h(getf)f
(\(u.u_ar0[R0];)14 2029 y(5743)g(u.u_base)f(=)i(u.u_arg[0];)14
2078 y(5744)f(u.u_count)f(=)i(u.u_arg[1];)14 2128 y(5745)f(u.u_segflg)f(=)h
(0;)14 2178 y(5751)g(u.u_offset[1])e(=)j(f2->f)e(offset[1];)14
2228 y(5752)h(u.u_offset[0])e(=)j(fp->f)e(offset[0];)14 2278
y(5754)h(readi\(fp->f)f(inode\);)14 2327 y(5756)h(dpadd\(fp->f)f(offset,)276
2377 y(u.u_arg[1]-u.u_)o(count)o(\);)33 2472 y Fn(\\rdwr")12
b(includes)h(m)o(uc)o(h)e(co)q(de)i(whic)o(h)f(is)g(common)e(to)-30
2522 y(b)q(oth)19 b(\\read")g(and)f(\\write")g(op)q(erations.)33
b(It)18 b(con)o(v)o(erts,)-30 2572 y(via)12 b(\\getf)s(")g(\(6619\),)f(the)i
(\014le)g(iden)o(ti\014cation)e(supplied)i(b)o(y)-30 2621 y(the)h(user)h(pro)
q(cess)g(in)o(to)d(the)i(address)h(of)d(an)h(en)o(try)h(in)f(the)-30
2671 y(\\\014le")h(arra)o(y)m(.)33 2722 y(Note)f(that)h(the)f(\014rst)h
(parameter)f(of)g(the)h(system)e(call)-30 2772 y(is)h(passed)h(in)e(a)g
(di\013eren)o(t)i(w)o(a)o(y)e(from)e(the)k(remaining)c(t)o(w)o(o)-30
2822 y(parameters.)1072 17 y(\\u.u)p 1153 17 V 14 w(seg\015g")18
b(is)g(set)h(to)e(zero)i(to)f(indicate)g(that)f(the)1010 66
y(op)q(eration)f(destination)f(is)h(in)g(the)g(user)h(address)g(space.)1010
116 y(After)12 b(\\readi")e(is)h(called)g(with)g(a)g(parameter)g(whic)o(h)g
(is)g(an)1010 166 y(\\ino)q(de")16 b(p)q(oin)o(ter,)g(the)h(\014nal)e(accoun)
o(ting)h(is)g(p)q(erformed)1010 216 y(b)o(y)h(adding)f(the)i(n)o(um)o(b)q(er)
f(of)g(c)o(haracters)i(requested)g(for)1010 266 y(transfer)j(less)f(the)h
(residual)e(n)o(um)o(b)q(er)h(not)f(transferred)1010 316 y(\(left)14
b(in)f(\\u.u)p 1228 316 V 14 w(coun)o(t"\))h(to)g(the)h(\014le)f(o\013set.)
1053 415 y Ff(6221)21 b(readi)1053 515 y(6239)g(lbn)h(=)f(lshift)g
(\(u.u_offset,)e(-9\);)1053 565 y(6240)i(on)h(=)f(u.u_offset[1])e(&)j(0777;)
1053 614 y(6241)f(n)h(=)g(min)f(\(512)g(-)g(on,)g(u.u_count\);)1053
664 y(6248)g(bn)h(=)f(bmap\(ip,)f(lbn\);)1053 714 y(6250)h(dn)h(=)f
(ip->i_dev;)1053 764 y(6258)g(bp)h(=)f(bread)g(\(dn,)g(bn\);)1053
814 y(6260)g(iomove)g(\(bp,)g(on,)g(n,)g(B)h(READ\);)1053 863
y(6261)f(brelse)g(\(bp\);)1072 1011 y Fn(\\readi")e(con)o(v)o(erts)h(the)f
(\014le)g(o\013set)h(in)o(to)e(t)o(w)o(o)h(parts:)1010 1061
y(a)f(logical)f(blo)q(c)o(k)h(n)o(um)o(b)q(er,)h(\\lbn",)f(and)h(an)f(index)h
(in)o(to)1010 1111 y(the)f(blo)q(c)o(k,)g(\\on".)28 b(The)19
b(n)o(um)o(b)q(er)d(of)i(c)o(haracters)h(to)e(b)q(e)1010 1161
y(transferred)e(is)e(the)h(minim)n(um)c(of)i(\\u.u)p 1646 1161
V 15 w(coun)o(t")h(and)g(the)1010 1211 y(n)o(um)o(b)q(er)c(of)h(c)o
(haracters)h(left)f(in)g(the)h(blo)q(c)o(k)e(\(in)h(whic)o(h)g(case)1010
1260 y(additional)g(blo)q(c)o(k\(s\))i(m)o(ust)e(b)q(e)i(read)g(\(not)g(sho)o
(wn\)\))g(\(and)1010 1310 y(the)h(n)o(um)o(b)q(er)f(of)g(c)o(haracters)i
(remaining)d(in)h(the)h(\014le)g(\(this)1010 1360 y(case)i(is)e(not)h(sho)o
(wn\)\).)1072 1411 y(\\dn")9 b(is)h(the)g(device)h(n)o(um)o(b)q(er)e(whic)o
(h)g(is)h(stored)h(within)1010 1461 y(the)f(\\ino)q(de".)16
b(\\bn")10 b(is)f(the)h(actual)g(blo)q(c)o(k)f(n)o(um)o(b)q(er)g(on)g(the)
1010 1511 y(device)j(\(disk\),)g(whic)o(h)f(is)g(computed)g(b)o(y)g(\\bmap")f
(\(6415\))1010 1561 y(using)j(\\lbn".)1072 1612 y(The)20 b(call)g(on)f
(\\bread")h(\014nds)h(the)f(required)h(blo)q(c)o(k,)1010 1662
y(cop)o(ying)9 b(it)g(in)o(to)g(core)i(from)c(disk)j(if)f(necessary)m(.)18
b(\\iomo)o(v)o(e")1010 1712 y(\(6364\))12 b(transfers)i(the)f(appropriate)g
(c)o(haracters)h(to)f(their)1010 1762 y(destination,)g(and)h(p)q(erforms)f
(accoun)o(ting)h(c)o(hores.)1010 1887 y Fg(18.17)56 b(rdwr)19
b(\(5731\))1010 1966 y Fn(\\read")13 b(and)g(\\write")g(p)q(erform)g(similar)
e(op)q(erations)i(and)1010 2016 y(share)22 b(m)o(uc)o(h)d(co)q(de.)40
b(The)21 b(t)o(w)o(o)g(system)f(calls,)i(\\read")1010 2066
y(\(5711\))10 b(and)h(\\write")g(\(5720\),)f(call)h(\\rdwr")g(imm)o(ediately)
1010 2116 y(to:)1010 2214 y Fi(5736:)20 b Fn(Con)o(v)o(ert)15
b(the)h(user)g(program)d(\014le)i(iden)o(ti\014cation)1114
2264 y(to)e(a)h(p)q(oin)o(ter)g(in)f(the)i(\014le)f(table;)1010
2353 y Fi(5739:)20 b Fn(Chec)o(k)c(that)g(the)g(op)q(eration)f(\(read)h(or)f
(write\))h(is)1114 2403 y(in)e(accordance)j(with)d(the)i(mo)q(de)e(with)h
(whic)o(h)f(the)1114 2453 y(\014le)f(w)o(as)h(op)q(ened;)1010
2543 y Fi(5743:)20 b Fn(Set)k(up)g(v)n(arious)f(standard)h(lo)q(cations)f(in)
g(\\u")1114 2592 y(with)13 b(the)i(appropriate)f(parameters;)1010
2682 y Fi(5746:)20 b Fn(\\pip)q(es")13 b(get)f(sp)q(ecial)g(treatmen)o(t)g
(righ)o(t)g(from)e(the)1114 2732 y(start!)1010 2822 y Fi(5755:)20
b Fn(Call)13 b(\\readi")g(or)h(\\writei")f(as)h(appropriate;)-30
2946 y(74)p eop
%%Page: 75 83
82 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)691
b(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)-30 17 y Fi(5756:)21
b Fn(Up)q(date)c(the)g(\014le)f(o\013set)h(b)o(y)m(,)f(and)g(set)h(the)g(v)n
(alue)74 66 y(returned)f(to)e(the)h(user)g(program)d(to,)i(the)g(n)o(um)o(b)q
(er)74 116 y(of)g(c)o(haracters)h(actually)e(transferred.)-30
231 y Fg(18.18)56 b(readi)18 b(\(6221\))-30 308 y Fi(6230:)j
Fn(If)g(no)f(c)o(haracters)j(are)e(to)g(b)q(e)h(transferred,)i(do)74
358 y(nothing;)-30 438 y Fi(6232:)d Fn(Set)12 b(the)g(\\ino)q(de")e(\015ag)h
(to)g(indicate)g(that)h(the)g(\\in-)74 487 y(o)q(de")i(has)g(b)q(een)h
(accessed;)-30 567 y Fi(6233:)21 b Fn(If)14 b(the)h(\014le)g(is)g(a)f(c)o
(haracter)i(sp)q(ecial)f(\014le,)f(call)g(the)74 617 y(appropriate)g(device)g
(\\read")f(pro)q(cedure,)i(passing)74 667 y(the)g(device)f(iden)o
(ti\014cation)g(as)g(parameter;)-30 747 y Fi(6238:)21 b Fn(Begin)12
b(a)h(lo)q(op)e(to)h(transfer)i(data)e(in)g(amoun)o(ts)f(up)74
797 y(to)19 b(512)g(c)o(haracters)i(at)e(a)f(time)g(un)o(til)h(\(6262\))f
(ei-)74 846 y(ther)13 b(an)e(irreco)o(v)o(erable)h(error)h(condition)e(has)h
(b)q(een)74 896 y(encoun)o(tered)i(or)e(the)g(requested)i(n)o(um)o(b)q(er)d
(of)h(c)o(har-)74 946 y(acters)k(has)e(b)q(een)h(transferred;)-30
1026 y Fi(6239:)21 b Fn(\\lshift")16 b(\(1410\))g(concatenates)j(the)f(t)o(w)
o(o)e(w)o(ords)74 1076 y(of)f(the)h(arra)o(y)f(\\u.u)p 387
1076 13 2 v 14 w(o\013set",)h(shifts)g(righ)o(t)f(b)o(y)g(nine)74
1126 y(places,)f(and)g(truncates)h(to)f(16)f(bits.)19 b(This)13
b(de\014nes)74 1175 y(the)g(\\logical)c(blo)q(c)o(k)j(n)o(um)o(b)q(er")e(of)h
(the)i(\014le)e(whic)o(h)h(is)74 1225 y(to)i(b)q(e)g(referenced;)-30
1305 y Fi(6240:)21 b Fn(\\on")13 b(is)h(a)f(c)o(haracter)j(o\013set)f(within)
e(the)h(blo)q(c)o(k;)-30 1385 y Fi(6241:)21 b Fn(\\n")15 b(is)f(determined)i
(initially)c(as)j(the)h(minim)n(um)74 1435 y(of)26 b(the)g(n)o(um)o(b)q(er)g
(of)f(c)o(haracters)j(b)q(ey)o(ond)e(\\on")74 1485 y(in)19
b(the)g(blo)q(c)o(k,)h(and)f(the)h(n)o(um)o(b)q(er)e(requested)j(for)74
1535 y(transfer.)29 b(\(Note)17 b(that)h(\\min")c(\(6339\))j(treats)h(its)74
1584 y(argumen)o(ts)13 b(as)h(unsigned)h(in)o(tegers.\))-30
1664 y Fi(6242:)21 b Fn(If)13 b(the)i(\014le)f(is)g(not)f(a)h(sp)q(ecial)g
(blo)q(c)o(k)g(\014le)g(then)g(...)-30 1744 y Fi(6243:)21 b
Fn(Compare)13 b(the)i(\014le)f(o\013set)h(with)f(the)h(curren)o(t)h(\014le)74
1794 y(size;)-30 1874 y Fi(6246:)21 b Fn(Reset)13 b(\\n")f(as)g(the)h(minim)n
(um)8 b(of)k(the)h(c)o(haracters)74 1924 y(requested)g(and)e(the)g(remaining)
e(c)o(haracters)k(in)d(the)74 1974 y(\014le;)-30 2054 y Fi(6248:)21
b Fn(Call)h(\\bmap")e(to)j(con)o(v)o(ert)g(the)h(logical)d(blo)q(c)o(k)74
2103 y(n)o(um)o(b)q(er)16 b(for)f(the)i(\014le)f(to)g(a)f(ph)o(ysical)h(blo)q
(c)o(k)f(n)o(um-)74 2153 y(b)q(er)f(for)e(its)g(host)h(device.)19
b(There)13 b(will)e(b)q(e)i(more)f(on)74 2203 y(\\bmap")h(shortly)m(.)22
b(F)m(or)14 b(no)o(w,)h(note)h(that)f(\\bmap")74 2253 y(sets)g(\\rablo)q(c)o
(k")e(as)h(a)g(side)g(e\013ect;)-30 2333 y Fi(6250:)21 b Fn(Set)f(\\dn")g(as)
g(the)g(device)h(iden)o(ti\014cation)e(from)74 2383 y(the)c(\\ino)q(de";)-30
2462 y Fi(6251:)21 b Fn(If)13 b(the)i(\014le)f(is)g(a)f(sp)q(ecial)h(blo)q(c)
o(k)g(\014le)g(then)g(...)-30 2542 y Fi(6252:)21 b Fn(Set)15
b(\\dn")g(from)d(the)k(\\i)p 481 2542 V 14 w(addr")e(\014eld)h(of)f(the)i
(\\in-)74 2592 y(o)q(de")h(en)o(try)m(.)27 b(\(Presumably)16
b(this)h(will)e(nearly)i(al-)74 2642 y(w)o(a)o(ys)c(b)q(e)g(the)h(same)e(as)h
(the)g(\\i)p 558 2642 V 14 w(dev")g(\014eld,)g(so)g(wh)o(y)74
2692 y(the)i(distinction?\))-30 2772 y Fi(6253:)21 b Fn(Set)11
b(the)g(\\read)g(ahead)f(blo)q(c)o(k")g(to)h(the)g(next)g(ph)o(ys-)74
2822 y(ical)i(blo)q(c)o(k;)1010 17 y Fi(6255:)20 b Fn(If)13
b(the)g(blo)q(c)o(ks)g(of)g(the)g(\014le)g(are)g(apparen)o(tly)g(b)q(eing)
1114 66 y(read)h(sequen)o(tially)f(then)i(...)1010 156 y Fi(6256:)20
b Fn(Call)12 b(\\breada")h(to)g(read)h(the)f(desired)h(blo)q(c)o(k)f(and)1114
205 y(to)g(initiate)f(reading)h(of)g(the)h(\\read)g(ahead)f(blo)q(c)o(k";)
1010 294 y Fi(6258:)20 b Fn(else)15 b(just)f(read)g(the)h(desired)g(blo)q(c)o
(k;)1010 383 y Fi(6260:)20 b Fn(Call)15 b(\\iomo)o(v)o(e")e(to)i(transfer)i
(information)c(from)1114 433 y(the)h(bu\013er)h(to)f(the)g(user)h(area;)1010
522 y Fi(6261:)20 b Fn(Return)15 b(the)f(bu\013er)h(to)f(the)g(\\a)o
(v"-list.)1010 647 y Fg(18.19)56 b(writei)1010 726 y Fi(6303:)20
b Fn(If)14 b(less)h(than)f(a)g(full)f(blo)q(c)o(k)h(is)g(b)q(eing)h(written)f
(the)1114 776 y(previous)i(con)o(ten)o(ts)g(of)g(the)g(bu\013er)h(m)o(ust)d
(b)q(e)j(read)1114 826 y(so)10 b(that)h(the)g(appropriate)f(part)h(can)f(b)q
(e)h(preserv)o(ed,)1114 875 y(otherwise)j(just)h(get)f(an)o(y)f(a)o(v)n
(ailable)f(bu\013er;)1010 964 y Fi(6311:)20 b Fn(There)14 b(is)e(no)h
(\\write)f(ahead")h(facilit)o(y)m(,)d(but)j(there)1114 1014
y(is)20 b(a)g(\\dela)o(y)o(ed)g(write")g(for)g(bu\013ers)i(whose)f(\014nal)
1114 1064 y(c)o(haracters)15 b(ha)o(v)o(e)f(not)g(b)q(een)h(c)o(hanged;)1010
1153 y Fi(6312:)20 b Fn(If)27 b(the)g(\014le)f(o\013set)i(no)o(w)e(p)q(oin)o
(ts)h(b)q(ey)o(ond)f(the)1114 1203 y(recorded)14 b(end)g(of)e(\014le)h(c)o
(haracter,)i(the)e(\014le)g(has)g(ob-)1114 1253 y(viously)g(gro)o(wn)g
(bigger!)1010 1342 y Fi(6318:)20 b Fn(Wh)o(y)25 b(is)h(it)f
(necessary/desirable)j(to)e(set)g(the)1114 1392 y(\\IUPD")13
b(\015ag)g(again?)k(\(See)e(line)f(6285.\))1010 1516 y Fg(18.20)56
b(iomo)n(v)n(e)17 b(\(6364\))1010 1595 y Fn(The)j(commen)o(t)d(at)i(the)h(b)q
(eginning)e(of)h(this)g(pro)q(cedure)1010 1645 y(sa)o(ys)k(most)e(of)h(what)h
(needs)h(to)e(b)q(e)h(said.)44 b(\\cop)o(yin",)1010 1695 y(\\cop)o(y)o(out",)
18 b(\\cpass")h(and)f(\\passc")g(ma)o(y)f(b)q(e)h(found)g(at)1010
1745 y(lines)c(1244,)e(1252,)g(6542)h(and)h(6517)f(resp)q(ectiv)o(ely)m(.)
1010 1869 y Fg(18.21)56 b(bmap)17 b(\(6415\))1010 1948 y Fn(A)k(general)g
(description)g(of)g(the)g(function)g(of)f(\\bmap")1010 1998
y(ma)o(y)14 b(b)q(e)i(found)f(on)g(P)o(age)h(2)f(of)g(\\FILE)h(SYSTEM)g
(\(V\)")1010 2048 y(of)d(the)i(UPM.)1010 2145 y Fi(6423:)20
b Fn(Files)11 b(of)f(more)f(than)i(2**15)e(blo)q(c)o(ks)i(\(2**24)e(c)o(har-)
1114 2195 y(acters\))15 b(are)f(not)g(supp)q(orted;)1010 2284
y Fi(6427:)20 b Fn(Start)15 b(with)f(the)h(\\small")c(\014le)j(algorithm)e
(\(\014le)i(is)1114 2334 y(not)h(greater)i(than)f(eigh)o(t)g(blo)q(c)o(ks)g
(i.e.)23 b(4096)15 b(c)o(har-)1114 2384 y(acters\);)1010 2473
y Fi(6431:)20 b Fn(If)10 b(the)h(blo)q(c)o(k)f(n)o(um)o(b)q(er)f(is)h(8)g(or)
h(more,)e(the)i(\\small")1114 2523 y(\014le)h(m)o(ust)f(con)o(v)o(erted)j(in)
o(to)e(a)g(large)g(\014le.)17 b(Note)c(this)1114 2573 y(is)j(a)g(side)h
(e\013ect)i(of)c(\\bmap",)g(and)i(should)f(o)q(ccur)1114 2622
y(only)8 b(when)i(\\bmap")d(has)j(b)q(een)g(called)g(b)o(y)f(\\writei")1114
2672 y(\(and)14 b(nev)o(er)i(b)o(y)e(\\readi")g({)g(see)i(line)e(6245\).)19
b(Th)o(us)1114 2722 y(all)10 b(\014les)i(start)g(life)e(as)i(\\small")c
(\014les)k(and)f(are)h(nev)o(er)1114 2772 y(explicitly)i(c)o(hanged)i(to)g
(\\large")f(\014les.)24 b(Note)16 b(also)1114 2822 y(that)e(the)g(c)o(hange)g
(is)g(irrev)o(ersible!)1890 2946 y(75)p eop
%%Page: 76 84
83 bop -30 -144 a Fk(18)43 b(FILE)15 b(A)o(CCESS)g(AND)g(CONTR)o(OL)691
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(6435:)21
b Fn(\\allo)q(c")e(\(6956\))h(allo)q(cates)g(a)g(blo)q(c)o(k)h(on)f(device)74
66 y(\\d")12 b(from)e(the)j(device's)f(free)h(list.)k(It)12
b(then)h(assigns)74 116 y(a)f(bu\013er)h(to)f(this)g(blo)q(c)o(k)g(and)g
(returns)i(a)e(p)q(oin)o(ter)g(to)74 166 y(the)j(bu\013er)g(header;)-30
249 y Fi(6438:)21 b Fn(The)e(eigh)o(t)g(bu\013er)h(addresses)h(in)e(the)h
(\\i)p 776 249 13 2 v 14 w(addr")74 299 y(arra)o(y)25 b(for)g(the)h(\\ino)q
(de")f(are)h(copied)f(in)o(to)g(the)74 349 y(bu\013er)15 b(area)f(and)g(then)
g(erased;)-30 432 y Fi(6442:)21 b Fn(\\i)p 135 432 V 14 w(addr[0]")9
b(is)h(set)i(to)e(p)q(oin)o(t)f(to)i(the)g(bu\013er)g(whic)o(h)74
482 y(is)j(set)h(up)f(for)f(a)h(\\dela)o(y)o(ed")f(write;)-30
565 y Fi(6448:)21 b Fn(The)15 b(\014le)g(is)g(still)f(small.)20
b(Get)15 b(the)g(next)h(blo)q(c)o(k)f(if)74 614 y(necessary;)-30
697 y Fi(6456:)21 b Fn(Note)14 b(the)h(setting)f(of)f(\\rablo)q(c)o(k";)-30
814 y Fg(18.22)56 b(Lefto)n(v)n(ers)-30 890 y Fn(Y)m(ou)12
b(should)h(in)o(v)o(estigate)f(the)h(follo)o(wing)d(pro)q(cedures)15
b(for)-30 940 y(y)o(ourself:)36 1031 y Ff(seek)43 b(\(5861\))64
b(statl)21 b(\(6045\))36 1081 y(sslep)g(\(5979\))64 b(dup)h(\(6069\))36
1131 y(fstat)21 b(\(6014\))64 b(owner)21 b(\(6791\))36 1181
y(stat)43 b(\(6028\))64 b(suser)21 b(\(6811\))-30 2946 y Fn(76)p
eop
%%Page: 77 85
84 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)379
b(19)43 b(FILE)15 b(DIRECTORIES)h(AND)f(DIRECTOR)m(Y)f(FILES)-30
17 y Fj(19)70 b(File)13 b(Directories)g(and)k(Direc-)108 91
y(tory)24 b(Files)-30 195 y Fn(As)k(w)o(e)g(ha)o(v)o(e)f(seen,)k(m)o(uc)o(h)
26 b(imp)q(ortan)o(t)g(information)-30 245 y(ab)q(out)19 b(individual)e
(\014les)i(is)g(con)o(tained)g(in)g(the)g(\\ino)q(de")-30 295
y(tables.)f(If)10 b(the)g(\014le)h(is)f(curren)o(tly)h(accessible,)h(or)e(b)q
(eing)h(ac-)-30 345 y(cessed,)17 b(the)e(relev)n(an)o(t)g(information)c(is)k
(held)f(in)h(the)g(core)-30 395 y(\\ino)q(de")c(table.)16 b(If)11
b(a)f(\014le)h(is)f(on)h(disk)f(\(more)g(generally)m(,)g(on)-30
444 y(some)17 b(\014le)g(system)g(v)o(olume\))e(and)i(is)g(not)h(curren)o
(tly)g(ac-)-30 494 y(cessible,)e(then)f(the)g(relev)n(an)o(t)g(\\ino)q(de")f
(table)h(is)f(the)h(one)-30 544 y(recorded)h(on)e(the)g(disk)g(\(\014le)g
(system)g(v)o(olume\).)33 601 y(Notably)k(absen)o(t)i(from)d(the)j(\\ino)q
(de")e(table)h(is)g(an)o(y)-30 651 y(information)12 b(regarding)i(the)h
(\\name")e(of)h(the)h(\014le.)20 b(This)-30 700 y(is)14 b(stored)h(in)f(the)g
(directory)h(\014les.)-30 854 y Fg(19.1)56 b(The)18 b(Directory)f(Data)i
(Structure)-30 943 y Fn(Eac)o(h)d(\014le)f(m)o(ust)f(ha)o(v)o(e)h(at)g(least)
g(one)g(name.)20 b(A)c(\014le)f(ma)o(y)-30 993 y(ha)o(v)o(e)k(more)e(than)i
(one)g(distinct)g(name,)f(but)g(the)i(same)-30 1043 y(name)e(ma)o(y)f(not)h
(b)q(e)h(shared)h(b)o(y)e(t)o(w)h(distinct)g(\014les,)h(i.e.)-30
1093 y(eac)o(h)15 b(name)e(m)o(ust)f(de\014ne)j(a)f(unique)g(\014le.)33
1150 y(A)i(name)f(ma)o(y)f(b)q(e)i(m)o(ultipart.)22 b(When)17
b(written,)f(the)-30 1200 y(parts)g(or)e(comp)q(onen)o(ts)g(of)g(the)i(name)d
(are)i(separated)h(b)o(y)-30 1249 y(slashes)k(\(\\/"\).)31
b(The)18 b(order)i(of)d(comp)q(onen)o(ts)h(within)g(a)-30 1299
y(name)h(is)g(signi\014can)o(t)g(i.e.)35 b(\\a/b/c")19 b(is)g(di\013eren)o(t)
h(from)-30 1349 y(\\a/c/b".)33 1406 y(If)14 b(\014le)g(names)g(are)h(divided)
e(in)o(to)h(t)o(w)o(o)g(parts:)20 b(an)14 b(ini-)-30 1456 y(tial)k(part)h(or)
g(\\stem")f(and)g(a)h(\014nal)f(part)h(or)g(\\ending",)-30
1505 y(then)13 b(t)o(w)o(o)e(\014les)h(whose)g(names)f(ha)o(v)o(e)g(iden)o
(tical)g(stems)g(are)-30 1555 y(usually)h(relate)g(in)g(some)f(w)o(a)o(y)m(.)
16 b(They)c(ma)o(y)e(reside)j(on)f(the)-30 1605 y(same)j(disk,)g(they)g(ma)o
(y)f(b)q(elong)h(to)g(the)h(same)e(user,)i(etc.)-30 1655 y(Users)h(mak)o(e)c
(initial)f(reference)17 b(to)e(\014les)g(b)o(y)f(quoting)g(the)-30
1705 y(\014le)j(name,)e(e.g.)25 b(in)16 b(the)h(\\op)q(en")f(system)g(call.)
24 b(An)17 b(im-)-30 1755 y(p)q(ortan)o(t)f(op)q(erating)g(sysem)g(function)f
(is)h(to)g(deco)q(de)h(the)-30 1804 y(name)d(in)o(to)g(the)i(corresp)q
(onding)f(\\ino)q(de")g(en)o(try)m(.)21 b(T)m(o)14 b(do)-30
1854 y(this,)h(UNIX)g(creates)h(and)e(main)o(tains)e(a)j(directory)g(data)-30
1904 y(structure.)20 b(This)11 b(structure)j(is)d(equiv)n(alen)o(t)g(to)g(a)g
(directed)-30 1954 y(graph)j(with)g(named)f(edges.)33 2011
y(In)g(its)g(purest)h(form,)d(the)i(graph)g(is)g(a)g(tree)h(i.e.)j(it)c(has)
-30 2060 y(a)j(single)f(ro)q(ot)g(no)q(de,)h(with)f(exactly)h(one)g(path)f(b)
q(et)o(w)o(een)-30 2110 y(the)i(ro)q(ot)f(and)g(an)o(y)g(no)q(de.)25
b(More)16 b(commonly)d(in)i(UNIX)-30 2160 y(\(but)h(not)e(so)h(commonly)c(in)
j(other)i(op)q(erating)e(systems\))-30 2210 y(the)i(graph)f(is)f(a)h(lattice)
g(whic)o(h)f(ma)o(y)f(b)q(e)j(obtained)e(from)-30 2260 y(a)g(tree)h(b)o(y)f
(coalescing)g(one)g(or)g(more)f(groups)h(of)f(lea)o(v)o(es.)33
2316 y(In)18 b(this)g(case,)i(while)d(there)j(is)e(still)f(only)g(one)i(path)
-30 2366 y(b)q(et)o(w)o(een)f(the)e(ro)q(ot)g(and)g(an)o(y)g(in)o(terior)f
(no)q(de,)i(thee)g(ma)o(y)-30 2416 y(b)q(e)c(more)e(than)h(one)g(path)g(b)q
(et)o(w)o(een)h(the)g(ro)q(ot)e(and)h(a)g(leaf.)-30 2466 y(Lea)o(v)o(es)f
(are)f(no)q(des)g(without)f(successors)k(and)c(corresp)q(ond)-30
2516 y(to)15 b(data)f(\014les.)19 b(In)o(terior)c(no)q(des)g(are)g(no)q(des)g
(with)f(succes-)-30 2566 y(sors)h(and)f(corresp)q(ond)h(to)f(directory)h
(\014les.)33 2622 y(The)f(name)f(for)h(a)g(\014le)g(is)g(obtained)g(from)f
(the)h(names)-30 2672 y(of)h(the)i(edges)f(of)f(the)h(path)g(b)q(et)o(w)o
(een)h(the)f(ro)q(ot)g(and)f(the)-30 2722 y(no)q(de)d(corresp)q(onding)g(to)e
(the)i(\014le.)17 b(\(F)m(or)11 b(this)f(reason,)i(the)-30
2772 y(name)e(is)g(often)h(referred)h(to)f(as)f(a)h(\\pathname".\))k(If)10
b(there)-30 2822 y(are)15 b(sev)o(eral)f(paths,)g(then)g(the)h(\014le)f(has)g
(sev)o(eral)g(names.)1010 17 y Fg(19.2)56 b(Directory)16 b(Files)1010
95 y Fn(A)i(directory)g(\014le)g(is)f(in)g(man)o(y)f(resp)q(ects)k
(indistinguish-)1010 145 y(able)14 b(from)e(a)i(non-directory)h(\014le.)k(Ho)
o(w)o(ev)o(er)14 b(it)g(con)o(tains)1010 195 y(information)8
b(whic)o(h)j(is)f(used)i(in)f(lo)q(cating)e(other)j(\014les)f(and)1010
245 y(hence)17 b(its)f(con)o(ten)o(ts)h(are)f(carefully)f(protected,)j(and)e
(are)1010 295 y(manipulated)c(b)o(y)h(the)i(op)q(erating)f(system)f(alone.)
1072 346 y(In)19 b(ev)o(ery)h(\014le,)g(the)g(information)c(is)j(stored)h(as)
f(one)1010 395 y(or)d(more)f(512)g(c)o(haracter)j(blo)q(c)o(ks.)24
b(Eac)o(h)17 b(blo)q(c)o(k)e(of)h(a)g(di-)1010 445 y(rectory)g(\014le)f(is)g
(divided)f(in)o(to)g(32)h(*)f(16)h(c)o(haracter)h(struc-)1010
495 y(tures.)27 b(Eac)o(h)17 b(structure)h(consists)g(of)d(a)i(16)e(bit)i
(\\ino)q(de")1010 545 y(table)10 b(p)q(oin)o(ter)g(and)f(a)h(14)f(c)o
(haracter)j(name.)j(The)c(\\ino)q(de")1010 595 y(p)q(oin)o(ter)j(is)g(to)f
(the)i(\\ino)q(de")e(table)h(on)g(the)g(same)f(disk)h(or)1010
645 y(\014le)i(system)f(v)o(olume)f(as)i(the)g(\014les)g(whic)o(h)g(the)g
(directory)1010 694 y(references.)23 b(\(More)15 b(on)g(this)f(later.\))21
b(An)15 b(\\ino)q(de")f(v)n(alue)1010 744 y(of)f(zero)i(de\014nes)g(a)f(n)o
(ull)f(en)o(try)h(in)g(the)g(directory)m(.)1072 795 y(The)g(pro)q(cedures)j
(whic)o(h)c(reference)k(directories)e(are:)1075 892 y Ff(namei)43
b(\(7518\))20 b(search)h(directory)1075 942 y(link)65 b(\(5909\))20
b(create)h(alternate)f(name)1075 992 y(wdir)65 b(\(7477\))20
b(write)h(directory)f(entry)1075 1042 y(unlink)h(\(3510\))f(delete)h(name)
1010 1164 y Fg(19.3)56 b(namei)16 b(\(7518\))1010 1243 y Fi(7531:)k
Fn(\\u.u)p 1220 1243 13 2 v 15 w(cdir")12 b(de\014nes)i(the)g(\\ino)q(de")e
(of)g(a)g(pro)q(cess's)1114 1293 y(curren)o(t)k(directory)m(.)23
b(A)16 b(pro)q(cess)h(inherits)f(its)f(par-)1114 1342 y(en)o(t's)k(curren)o
(t)h(directory)f(at)f(birth)h(\(\\newpro)q(c",)1114 1392 y(1883\).)d(The)c
(curren)o(t)i(directory)e(ma)o(y)e(b)q(e)j(c)o(hanged)1114
1442 y(using)g(the)i(\\c)o(hdir")e(\(3538\))g(system)h(call;)1010
1530 y Fi(7532:)20 b Fn(Note)14 b(that)f(\\func")f(is)h(a)g(parameter)f(to)h
(\\namei")1114 1579 y(and)d(is)f(alw)o(a)o(ys)h(either)g(\\uc)o(har")g
(\(7689\))g(or)g(\\sc)o(har")1114 1629 y(\(7679\);)1010 1717
y Fi(7534:)20 b Fn(\\iget")14 b(\(7276\))f(is)g(called)h(to:)1163
1805 y Fl(\017)21 b Fn(w)o(ait)14 b(un)o(til)f(suc)o(h)i(time)e(as)i(the)g
(\\ino)q(de")f(cor-)1205 1854 y(resp)q(onding)g(to)g(\\dp")g(is)f(no)h
(longer)g(lo)q(c)o(k)o(ed;)1163 1923 y Fl(\017)21 b Fn(c)o(hec)o(k)e(that)e
(the)i(asso)q(ciated)f(\014le)g(system)f(is)1205 1973 y(still)c(moun)o(ted;)
1163 2042 y Fl(\017)21 b Fn(incremen)o(t)14 b(the)g(reference)i(coun)o(t;)
1163 2110 y Fl(\017)21 b Fn(lo)q(c)o(k)13 b(the)i(\\ino)q(de";)1010
2198 y Fi(7535:)20 b Fn(Multiple)14 b(slashes)g(are)h(acceptable!)k(\(i.e.)
1114 2248 y(\\////a///b/")11 b(is)j(the)g(same)f(as)h(\\/a/b"\);)1010
2335 y Fi(7537:)20 b Fn(An)o(y)g(attempt)e(to)h(replace)i(or)e(delete)i(the)e
(cur-)1114 2385 y(ren)o(t)f(w)o(orking)f(directory)h(or)g(the)h(ro)q(ot)e
(directory)1114 2435 y(is)c(b)q(ounced)i(immediately!)1010
2523 y Fi(7542:)20 b Fn(The)15 b(lab)q(el)e(\\clo)q(op")h(marks)f(the)h(b)q
(eginning)g(of)f(a)1114 2573 y(program)d(lo)q(op)h(that)h(extends)h(to)f
(line)f(7667.)17 b(Eac)o(h)1114 2622 y(cycle)e(analyses)g(a)g(comp)q(onen)o
(t)f(of)h(the)g(pathname)1114 2672 y(\(i.e.)h(a)10 b(string)g(terminated)g(b)
o(y)g(a)f(n)o(ull)h(c)o(haracter)h(or)1114 2722 y(one)j(or)h(more)e
(slashes\).)21 b(Note)15 b(that)g(a)f(name)f(ma)o(y)1114 2772
y(b)q(e)d(constructed)h(from)d(man)o(y)g(di\013eren)o(t)i(c)o(haracters)1114
2822 y(\(7571\);)1890 2946 y(77)p eop
%%Page: 78 86
85 bop -30 -144 a Fk(19)43 b(FILE)15 b(DIRECTORIES)h(AND)f(DIRECTOR)m(Y)g
(FILES)380 b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y
Fi(7550:)21 b Fn(The)15 b(end)g(of)g(the)g(pathname)f(has)h(b)q(een)g(reac)o
(hed)74 66 y(\(successfully\).)41 b(Return)21 b(the)h(curren)o(t)g(v)n(alue)e
(of)74 116 y(\\dp";)-30 200 y Fi(7563:)h Fn(\\searc)o(h")16
b(p)q(ermission)e(for)h(directories)h(is)f(co)q(ded)74 250
y(in)g(the)h(same)f(w)o(a)o(y)g(as)h(\\execute")g(p)q(ermission)f(for)74
300 y(other)g(\014les;)-30 384 y Fi(7570:)21 b Fn(Cop)o(y)f(the)h(name)e(in)o
(to)h(a)g(more)f(accessible)j(lo-)74 434 y(cation)17 b(b)q(efore)g
(attempting)f(to)g(matc)o(h)g(it)g(with)h(a)74 484 y(directory)f(en)o(try)m
(.)21 b(Note)16 b(that)f(a)g(name)e(of)i(greater)74 534 y(than)f(\\DIRSIZ")f
(c)o(haracters)j(is)e(truncated;)-30 618 y Fi(7589:)21 b Fn(\\u.u)p
181 618 13 2 v 14 w(coun)o(t")c(is)f(set)h(to)f(the)h(n)o(um)o(b)q(er)f(of)g
(en)o(tries)74 668 y(in)e(the)g(directory;)-30 752 y Fi(7592:)21
b Fn(The)f(lab)q(el)g(\\elo)q(op")f(marks)f(the)j(b)q(eginning)e(of)74
802 y(a)f(program)f(lo)q(op)h(whic)o(h)g(extends)i(to)e(line)g(7647.)74
851 y(Eac)o(h)c(cycle)h(of)e(the)i(lo)q(op)e(handles)h(a)g(single)f(direc-)74
901 y(tory)h(en)o(try;)-30 985 y Fi(7600:)21 b Fn(If)28 b(the)h(directory)g
(has)f(b)q(een)i(searc)o(hed)g(\(lin-)74 1035 y(early!\))25
b(without)15 b(matc)o(hing)f(the)j(supplied)f(path-)74 1085
y(name)10 b(comp)q(onen)o(t,)g(then)h(there)h(m)o(ust)d(b)q(e)i(an)g(error)74
1135 y(unless:)74 1228 y Fi(\(a\))20 b Fn(this)f(is)g(the)h(last)f(comp)q
(onen)o(t)f(of)g(the)i(path-)166 1277 y(name,)12 b(i.e.)17
b(\\c==`)p Ff(\\)p Fn(0')d(";)74 1344 y Fi(\(b\))20 b Fn(the)13
b(\014le)f(is)g(to)g(b)q(e)h(created,)g(i.e.)k(\\\015ag)12
b(==)h(1";)166 1394 y(ard)74 1461 y Fi(\(c\))20 b Fn(the)14
b(user)h(program)d(has)h(\\write")h(p)q(ermission)166 1511
y(for)f(the)i(directory;)-30 1604 y Fi(7606:)21 b Fn(Record)11
b(the)g(\\ino)q(de")f(address)i(for)e(the)h(directory)74 1654
y(for)j(the)g(new)h(\014le)e(in)h(\\u.u)p 491 1654 V 14 w(p)q(dir";)-30
1738 y Fi(7607:)21 b Fn(If)h(a)g(suitable)g(slot)g(for)g(a)g(new)g(directory)
h(en-)74 1788 y(try)18 b(has)g(previously)g(b)q(een)h(encoun)o(tered)h
(\(7642\),)74 1837 y(store)c(the)g(v)n(alue)e(in)h(\\u.u)p
489 1837 V 14 w(o\013set[1]";)f(else)i(set)g(the)74 1887 y(\\IUPD")c(fIag)g
(for)g(the)h(\\dp")f(designated)h(\\ino)q(de")74 1937 y(\(but)h(wh)o(y?\);)
-30 2021 y Fi(7622:)21 b Fn(When)e(appropriate,)g(read)g(a)f(new)h(blo)q(c)o
(k)f(from)74 2071 y(the)j(directory)g(\014le)f(\(note)h(the)g(use)g(of)e
(\\bread"\))74 2121 y(\(wh)o(y)12 b(not)g(\\breada"?\),)g(after)g(carefully)g
(releasing)74 2171 y(an)o(y)i(previously)f(held)h(bu\013er;)-30
2255 y Fi(7636:)21 b Fn(Cop)o(y)e(the)h(eigh)o(t)f(w)o(ords)h(of)f(the)h
(directory)g(en-)74 2305 y(try)i(in)o(to)f(the)h(arra)o(y)f(\\u.u)p
518 2305 V 14 w(den)o(t".)41 b(The)22 b(reason)74 2354 y(for)12
b(cop)o(ying)g(b)q(efore)h(comparing)e(is)h(obscure!)19 b(Can)74
2404 y(this)e(actually)f(b)q(e)h(more)f(e\016cien)o(t?)28 b(\(The)17
b(reason)74 2454 y(for)11 b(cop)o(ying)f(the)h(whole)g(directory)g(at)g(all)e
(is)i(rather)74 2504 y(p)q(erplexing)j(to)g(the)h(author)e(of)h(these)h
(notes.\);)-30 2588 y Fi(7645:)21 b Fn(This)11 b(comparison)f(mak)o(es)g
(e\016cien)o(t)h(use)h(of)f(a)g(sin-)74 2638 y(gle)17 b(c)o(haracter)i(p)q
(oin)o(ter)f(register)g(v)n(ariable,)f(\\cp".)74 2688 y(The)c(lo)q(op)e(w)o
(ould)g(b)q(e)i(ev)o(en)f(more)f(e\016cien)o(t)i(if)e(w)o(ord)74
2737 y(b)o(y)j(w)o(ord)g(comparison)e(w)o(ere)j(used;)-30 2822
y Fi(7647:)21 b Fn(The)14 b(\\elo)q(op")f(cycle)i(is)f(terminated)f(b)o(y)h
(one)g(of:)1179 17 y Ff(return\(NULL\);)84 b(\(7610\))1179
66 y(goto)21 b(out;)173 b(\(7605,)21 b(7613\))1114 165 y Fn(a)k(successful)i
(matc)o(h)e(so)g(that)h(the)g(branc)o(h)g(to)1114 215 y(\\elo)q(op")13
b(\(7647\))g(is)h(not)f(tak)o(en;)1010 295 y Fi(7657:)20 b
Fn(If)14 b(the)h(name)e(is)h(to)g(b)q(e)h(deleted)g(\(\\\015ag==2"\),)f(if)
1114 345 y(the)f(pathname)f(has)h(b)q(een)h(completed,)e(and)h(if)f(the)1114
395 y(user)i(program)d(has)j(\\write")f(access)i(to)e(the)h(direc-)1114
444 y(tory)m(,)19 b(then)g(return)h(a)f(p)q(oin)o(ter)g(to)g(the)g(directory)
1114 494 y(\\ino)q(de";)1114 559 y(Sa)o(v)o(e)10 b(the)i(device)f(iden)o(tit)
o(y)f(temp)q(orarily)f(\(wh)o(y)i(not)1114 609 y(in)17 b(the)h(register)h
(\\c"?\))29 b(and)18 b(call)f(\\iput")g(\(7344\))1114 659 y(to)j(unlo)q(c)o
(k)f(\\dp",)i(to)f(decremen)o(t)h(the)g(reference)1114 709
y(coun)o(t)11 b(on)f(\\dp")h(and)f(to)h(p)q(erform)f(an)o(y)h(consequen)o(t)
1114 758 y(pro)q(cesslng;)1010 838 y Fi(7664:)20 b Fn(Rev)n(alidate)13
b(\\dp")h(to)g(p)q(oin)o(t)f(to)h(the)h(\\ino)q(de")e(for)1114
888 y(the)h(next)h(lev)o(el)e(\014le;)1010 968 y Fi(7665:)20
b Fn(\\dp==NULL")d(shouldn't)g(happ)q(en,)g(since)g(the)1114
1018 y(directory)10 b(sa)o(ys)g(the)g(\014le)f(exists!)18 b(Ho)o(w)o(ev)o(er)
10 b(\\ino)q(de")1114 1068 y(table)k(o)o(v)o(er\015o)o(ws)g(and)g(i/o)g
(errors)i(can)e(o)q(ccur,)h(and)1114 1118 y(sometimes)g(the)j(\014le)g
(system)f(ma)o(y)f(b)q(e)i(left)f(in)g(an)1114 1167 y(inconsisten)o(t)d
(state)h(after)f(a)g(system)f(crash.)1010 1282 y Fg(19.4)56
b(Some)17 b(Commen)n(ts)1010 1359 y Fn(\\namei")f(is)i(a)g(k)o(ey)g(pro)q
(cedure)j(whic)o(h)d(w)o(ould)f(seem)h(to)1010 1409 y(ha)o(v)o(e)h(b)q(een)i
(written)f(v)o(ery)f(early)m(,)h(to)f(ha)o(v)o(e)h(b)q(een)g(thor-)1010
1459 y(oughly)13 b(debugged)i(and)f(then)h(to)f(ha)o(v)o(e)g(b)q(een)i(left)e
(essen-)1010 1508 y(tially)i(unc)o(hanged.)30 b(The)19 b(in)o(terface)f(b)q
(et)o(w)o(een)h(\\namei")1010 1558 y(and)d(the)h(rest)h(of)e(the)h(system)f
(is)g(rather)i(complex,)d(and)1010 1608 y(for)c(that)h(reason)h(alone,)e(it)h
(w)o(ould)f(not)h(win)f(the)i(prize)f(for)1010 1658 y(\\Pro)q(cedure)k(of)d
(the)h(Y)m(ear".)1072 1708 y(\\namei")h(is)i(called)g(thirteen)h(times)e(b)o
(y)h(t)o(w)o(elv)o(e)g(dif-)1010 1757 y(feren)o(t)e(pro)q(cedures:)1097
1854 y Fi(line)56 b(routine)50 b(parameters)p 1072 1871 620
2 v 1097 1906 a Fn(3034)f(exec)127 b(uc)o(har)50 b(0)1097 1956
y(3543)f(c)o(hdir)112 b(uc)o(har)50 b(0)1097 2005 y(5770)f(op)q(en)117
b(uc)o(har)50 b(0)1097 2055 y(5914)f(link)134 b(uc)o(har)50
b(0)1097 2105 y(6033)f(stat)134 b(uc)o(har)50 b(0)1097 2155
y(6097)f(smoun)o(t)69 b(uc)o(har)50 b(0)1097 2205 y(6186)f(getmdev)g(uc)o
(har)h(0)1097 2255 y(6976)f(o)o(wner)96 b(uc)o(har)50 b(0)1097
2354 y(5786)f(creat)114 b(uc)o(har)50 b(1)1097 2404 y(5928)f(link)134
b(uc)o(har)50 b(1)1097 2454 y(5958)f(mkno)q(d)77 b(uc)o(har)50
b(1)1097 2553 y(3515)f(unlink)88 b(uc)o(har)50 b(2)1097 2653
y(4101)f(core)130 b(sc)o(har)57 b(1)1010 2745 y(It)14 b(will)e(b)q(e)j(seen)g
(that:)1010 2822 y Fi(\(a\))20 b Fn(there)15 b(are)f(t)o(w)o(o)g(calls)f
(from)f(\\link";)-30 2946 y(78)p eop
%%Page: 79 87
86 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)379
b(19)43 b(FILE)15 b(DIRECTORIES)h(AND)f(DIRECTOR)m(Y)f(FILES)-30
17 y Fi(\(b\))20 b Fn(the)13 b(calls)e(can)i(b)q(e)f(divided)g(in)o(to)g
(four)f(categories,)i(of)74 66 y(whic)o(h)h(the)h(\014rst)f(is)g(b)o(y)g(far)
f(the)i(largest;)-30 150 y Fi(\(c\))21 b Fn(the)13 b(last)g(t)o(w)o(o)g
(categories)h(ha)o(v)o(e)f(only)f(one)i(represen-)74 200 y(tativ)o(e)g(eac)o
(h;)-30 283 y Fi(\(d\))20 b Fn(in)d(particular,)i(there)g(is)f(only)f(one)i
(call)e(in)o(v)o(olving)74 333 y(the)d(routine)g(\\sc)o(har",)g(whic)o(h)f
(is)h(alw)o(a)o(ys)e(for)h(a)h(\014le)74 383 y(called)k(\\core".)31
b(\(If)18 b(this)g(case)h(w)o(ere)h(handled)e(as)74 433 y(a)d(sp)q(ecial)f
(case)i(e.g.)k(where)15 b(the)g(second)h(parame-)74 482 y(ter)f(had)f(the)g
(v)n(alue)g(\\3",)e(then)j(the)g(\\uc)o(har"s)f(and)74 532
y(\\sc)o(har")g(could)g(b)q(e)h(eliminated.\))-30 616 y(\\namei")d(ma)o(y)g
(terminate)h(in)h(a)f(v)n(ariet)o(y)h(of)f(w)o(a)o(ys:)-30
707 y Fi(\(a\))21 b Fn(if)8 b(there)j(has)e(b)q(een)i(an)e(error,)i(then)f(a)
f(\\NULL")g(v)n(alue)74 757 y(is)i(returned)i(and)d(the)i(v)n(ariable)e
(\\u.u)p 659 757 13 2 v 14 w(error")h(is)g(set.)74 824 y(\(Most)19
b(errors)g(result)g(in)e(a)h(branc)o(h)h(to)f(the)g(lab)q(el)74
874 y(\\out")c(\(7669\))g(so)h(that)g(reference)i(coun)o(ts)f(for)e(the)74
923 y(ino)q(des)i(are)g(prop)q(erly)g(main)o(tained)d(\(7670\).)23
b(This)74 973 y(is)13 b(not)h(necessary)h(if)d(the)i(failure)f(o)q(ccurs)i
(in)d(\\iget")74 1023 y(\(7664\).\);)-30 1107 y Fi(\(b\))20
b Fn(if)d(\\\015ag==2")g(\(i.e.)29 b(the)19 b(call)e(is)g(from)f
(\\unlink"\),)74 1156 y(the)e(v)n(alue)f(returned)i(\(in)e(normal)e
(circumstances\))74 1206 y(is)i(an)g(\\ino)q(de")f(p)q(oin)o(ter)h(for)g(the)
g(paren)o(t)h(directory)74 1256 y(of)g(the)g(named)f(\014le)h(\(7660\);)-30
1339 y Fi(\(c\))21 b Fn(if)c(\\\015ag==1")g(\(i.e.)30 b(the)19
b(call)e(is)h(from)e(\\creat")j(or)74 1389 y(\\link")11 b(or)i(\\mkno)q(d",)d
(and)j(a)f(\014le)h(is)f(to)h(b)q(e)g(created)74 1439 y(if)g(it)h(do)q(es)g
(not)g(already)f(exist\))i(and)e(if)g(the)i(named)74 1489 y(\014le)k(do)q(es)
g(not)g(exist,)h(then)f(a)f(\\NULL")h(v)n(alue)f(is)74 1539
y(returned)d(\(7610\).)j(In)13 b(this)h(case)g(a)f(p)q(oin)o(ter)h(to)f(the)
74 1588 y(\\ino)q(de")i(for)g(the)h(directory)g(whic)o(h)f(will)f(p)q(oin)o
(t)h(to)74 1638 y(the)10 b(new)g(\014le,)g(is)f(left)h(in)f(\\u.u)p
528 1638 V 14 w(p)q(dir")g(\(7606\).)16 b(\(Note)74 1688 y(also)10
b(that)f(in)h(this)g(case,)h(\\u.u)p 538 1688 V 14 w(o\013set")g(is)f(left)f
(p)q(oin)o(t-)74 1738 y(ing)16 b(either)i(at)e(an)h(empt)o(y)e(directory)j
(en)o(try)f(or)g(at)74 1788 y(the)e(end)f(of)f(the)i(directory)g(\014le.\);)
-30 1871 y Fi(\(d\))20 b Fn(if)10 b(in)h(the)h(remaining)d(cases,)k(the)f
(\014le)f(exists,)h(an)g(\\in-)74 1921 y(o)q(de")20 b(p)q(oin)o(ter)f(for)g
(the)h(\014le)f(is)g(returned)i(\(7551\).)74 1971 y(The)12
b(\\ino)q(de")f(is)h(lo)q(c)o(k)o(ed)f(and)g(the)h(reference)i(coun)o(t)74
2021 y(has)22 b(b)q(een)g(incremen)o(ted.)40 b(A)22 b(call)e(to)h(\\iput")g
(is)74 2070 y(needed)16 b(subsequen)o(tly)g(to)f(undo)f(b)q(oth)h(these)h
(side)74 2120 y(e\013ects.)-30 2237 y Fg(19.5)56 b(link)18
b(\(5909\))-30 2314 y Fn(This)13 b(pro)q(cedure)h(implemen)o(ts)d(a)h(system)
g(call)g(whic)o(h)g(en-)-30 2364 y(ters)17 b(a)d(new)i(name)d(for)i(an)g
(existing)f(\014le)h(in)o(to)g(the)g(direc-)-30 2413 y(tory)d(structure.)19
b(Argumen)o(ts)11 b(to)g(the)h(pro)q(cedure)h(are)f(the)-30
2463 y(existing)i(and)g(the)g(new)h(names)e(of)g(the)h(\014le;)-30
2555 y Fi(5914:)21 b Fn(Lo)q(ok)13 b(up)h(the)h(existing)e(\014le)h(name;)-30
2639 y Fi(5917:)21 b Fn(If)c(the)i(\014le)e(already)h(has)f(127)g(di\013eren)
o(t)i(names,)74 2688 y(quit)14 b(in)f(disgust;)-30 2772 y Fi(5921:)21
b Fn(If)9 b(the)i(existing)e(\014le)h(turns)h(out)e(to)h(b)q(e)g(a)g
(directory)m(,)74 2822 y(then)15 b(only)e(the)h(sup)q(er-user)j(ma)o(y)12
b(rename)h(it;)1010 17 y Fi(5926:)20 b Fn(Unlo)q(c)o(k)28 b(the)g(existing)g
(\014le)f(\\ino)q(de")h(This)f(is)1114 66 y(lo)q(c)o(k)o(ed)12
b(when)h(the)h(\014rst)f(call)f(on)g(\\namei")f(do)q(es)i(an)1114
116 y(\\iget")g(\(7534,)f(7664\).)1114 181 y(Under)20 b(what)f(conditions)g
(w)o(ould)f(the)i(failure)e(to)1114 230 y(unlo)q(c)o(k)e(the)i(\\ino)q(de")e
(here)i(b)q(e)f(disastrous?)28 b(The)1114 280 y(c)o(hances)18
b(that)f(the)g(existing)g(\014le)g(w)o(ould)f(b)q(e)h(a)g(di-)1114
330 y(rectory)c(encoun)o(tered)i(in)d(the)h(searc)o(h)h(for)e(the)i(new)1114
380 y(name)20 b(w)o(ould)h(seem)g(sligh)o(t,)i(if)e(not)g(imp)q(ossible.)1114
430 y(Most)f(probably)g(the)h(relev)n(an)o(t)f(circumstance)h(is)1114
479 y(where)12 b(the)g(system)e(is)h(attempting)f(to)h(recreate)i(an)1114
529 y(alternativ)o(e)h(\014le)g(name)f(or)i(alias,)e(whic)o(h)h
Fi(already)1114 579 y Fn(exists;)1010 658 y Fi(5927:)20 b Fn(Searc)o(h)h(the)
f(directory)g(for)f(the)h(second)h(name,)1114 708 y(with)13
b(the)i(in)o(ten)o(tion)e(of)g(creating)h(a)g(new)g(en)o(try;)1010
786 y Fi(5930:)20 b Fn(There)25 b(is)e(an)g(existing)g(\014le)g(with)g(the)h
(second)1114 836 y(name;)1010 915 y Fi(5935:)c Fn(\\u.u)p 1220
915 V 15 w(p)q(dir")c(is)g(set)h(as)g(a)f(side)h(e\013ect)h(of)e(the)h(call)
1114 965 y(on)d(\\namei")e(\(5928\).)18 b(Chec)o(k)c(that)h(the)f(directory)
1114 1014 y(resides)h(on)f(the)g(same)f(device)i(as)f(the)g(\014le;)1010
1093 y Fi(5940:)20 b Fn(W)m(rite)14 b(a)f(new)i(directory)f(en)o(try)h(\(see)
g(b)q(elo)o(w\);)1010 1172 y Fi(5941:)20 b Fn(Increase)c(the)e(\\link")f
(coun)o(t)h(for)g(the)g(\014le.)1010 1286 y Fg(19.6)56 b(wdir)18
b(\(7477\))1010 1363 y Fn(This)13 b(pro)q(cedure)h(en)o(ters)h(a)d(new)i
(name)d(in)o(to)i(a)f(directory)m(.)1010 1413 y(It)h(is)f(called)h(b)o(y)g
(\\link")e(\(5940\))h(and)h(\\makno)q(de")e(\(7467\))1010 1462
y(with)i(a)h(p)q(oin)o(ter)g(to)g(a)f(\(core\))i(\\ino)q(de")f(as)g
(parameter.)1072 1512 y(The)d(sixteen)h(c)o(haracters)g(of)e(the)h(directory)
g(en)o(try)h(are)1010 1562 y(copied)18 b(in)o(to)g(the)h(structure)h(\\u.u)p
1571 1562 V 14 w(den)o(t",)f(and)g(written)1010 1612 y(from)d(there)j(in)o
(to)e(the)h(directory)g(\014le.)30 b(\(Note)18 b(that)f(the)1010
1662 y(previous)g(con)o(ten)o(t)h(of)f(\\u.u)p 1461 1662 V
15 w(den)o(t")g(will)f(ha)o(v)o(e)h(b)q(een)h(the)1010 1712
y(name)13 b(of)g(the)h(last)g(en)o(try)g(in)g(the)g(directory)h(\014le.\))
1072 1761 y(The)k(pro)q(cedure)i(assumes)e(that)g(the)g(directory)h(\014le)
1010 1811 y(has)12 b(already)g(b)q(een)i(searc)o(hed,)f(that)g(the)g(\\ino)q
(de")f(for)f(the)1010 1861 y(dlrectory)18 b(\014le)g(has)f(already)h(b)q(een)
g(allo)q(cated)g(and)f(that)1010 1911 y(the)h(v)n(alues)f(of)g(\\u.u)g
(o\013set")h(ha)o(v)o(e)f(b)q(een)i(set)g(appropri-)1010 1961
y(ately)m(.)1010 2075 y Fg(19.7)56 b(makno)r(de)16 b(\(7455\))1010
2152 y Fn(This)10 b(pro)q(cedure)i(is)e(called)g(from)e(\\core")j(\(4105\),)f
(\\creat")1010 2201 y(\(5790\))17 b(and)h(\\mkno)q(d")e(\(5966\),)i(after)h
(a)e(previous)i(call)1010 2251 y(on)g(\\namei")e(with)h(a)h(second)h
(parameter)f(of)g(one,)h(has)1010 2301 y(rev)o(ealed)14 b(that)g(no)g(\014le)
g(of)f(the)i(sp)q(eci\014ed)g(name)e(existed.)1010 2415 y Fg(19.8)56
b(unlink)17 b(\(3510\))1010 2492 y Fn(This)24 b(pro)q(cedure)h(implemen)o(ts)
d(a)h(system)h(call)f(whic)o(h)1010 2542 y(deletes)f(a)f(\014le)g(name)f
(from)g(the)h(directory)h(structure.)1010 2592 y(\(When)c(all)e(references)21
b(to)c(a)h(\014le)f(are)i(deleted,)g(the)f(\014le)1010 2641
y(itself)13 b(will)g(b)q(e)h(deleted.\))1010 2722 y Fi(3515:)20
b Fn(Searc)o(h)11 b(for)f(a)g(\014le)g(with)g(the)h(sp)q(eci\014ed)h(name,)d
(and)1114 2772 y(if)j(it)i(exists,)g(return)h(a)e(p)q(oin)o(ter)h(to)f(the)i
(\\ino)q(de")e(of)1114 2822 y(the)h(immediate)d(paren)o(t)j(directory;)1890
2946 y(79)p eop
%%Page: 80 88
87 bop -30 -144 a Fk(19)43 b(FILE)15 b(DIRECTORIES)h(AND)f(DIRECTOR)m(Y)g
(FILES)380 b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y
Fi(3518:)21 b Fn(Unlo)q(c)o(k)14 b(the)g(paren)o(t)h(directory;)-30
107 y Fi(3519:)21 b Fn(Get)14 b(an)g(\\ino)q(de")f(p)q(oin)o(ter)h(to)g(the)g
(\014le)g(itself;)-30 197 y Fi(3522:)21 b Fn(Unlinking)8 b(directories)j(is)f
(forbidden,)g(except)h(for)74 247 y(sup)q(er-users;)-30 337
y Fi(3528:)21 b Fn(Rewrite)10 b(the)g(directory)g(en)o(try)h(with)e(the)h
(\\ino)q(de")74 387 y(v)n(alue)j(set)i(to)f(zero;)-30 477 y
Fi(3529:)21 b Fn(Decremen)o(t)14 b(the)h(\\link")d(coun)o(t.)33
575 y(Note)g(that)h(there)g(is)f(no)g(attempt)g(to)g(reduce)i(the)f(size)-30
625 y(of)h(a)f(directory)i(b)q(elo)o(w)f(its)f(\\high)g(w)o(ater")i(mark.)-30
751 y Fg(19.9)56 b(mkno)r(d)17 b(\(5952\))-30 831 y Fn(This)d(pro)q(cedure,)i
(whic)o(h)e(implemen)o(ts)d(a)j(system)g(call)f(of)-30 880
y(the)20 b(same)f(name,)g(is)g(only)g(executable)h(b)o(y)g(the)g(sup)q(er-)
-30 930 y(user.)f(As)12 b(explained)g(in)f(the)i(Section)f(\\MKNOD\(I)q(I\)")
g(of)-30 980 y(the)f(UPM,)f(this)h(system)f(call)f(is)h(used)h(to)f(create)i
(\\ino)q(des")-30 1030 y(for)i(sp)q(ecial)g(\014les.)33 1081
y(\\mkno)q(d")f(also)j(solv)o(es)f(the)i(problem)d(of)h(\\where)i(do)-30
1131 y(directories)25 b(come)e(from"?)45 b(The)23 b(second)i(parameter)-30
1181 y(passed)20 b(to)f(\\mkno)q(d")e(is)i(used,)h(without)f(mo)q
(di\014cation)-30 1231 y(or)g(restriction)g(to)f(set)h(\\i)p
388 1231 13 2 v 14 w(mo)q(de".)30 b(\(Compare)17 b(\\creat")-30
1281 y(\(5790\))d(and)g(\\c)o(hmo)q(d")f(\(3569\)\).)19 b(This)14
b(is)h(the)g(only)e(w)o(a)o(y)-30 1330 y(an)19 b(\\ino)q(de")f(can)g(get)h
(\015agged)f(as)h(a)f(directory)m(,)h(for)f(in-)-30 1380 y(stance.)33
1432 y(In)j(suc)o(h)h(cases,)j(the)d(third)f(parameter)g(passed)i(to)-30
1482 y(\\mkno)q(d")15 b Fi(m)o(ust)f Fn(b)q(e)j(zero.)25 b(This)16
b(v)n(alue)f(is)h(copied)g(in)o(to)-30 1531 y(\\i)p 5 1531
V 15 w(addr[0]")11 b(\(as)i(is)f(appropriate)h(for)f(sp)q(ecial)h(\014les\),)
g(and,)-30 1581 y(if)d(non-zero,)i(will)d(b)q(e)j(accepted)g(uncritically)e
(b)o(y)h(\\bmap")-30 1631 y(\(6447\).)18 b(It)c(migh)o(t)d(b)q(e)k(pruden)o
(t)g(to)f(insert)g(a)g(test)36 1731 y Ff(if)21 b(\(ip->i_mode)f(&)h(\(IFCHR)g
(&)g(IFBLK\))g(!=)g(0\))-30 1830 y Fn(b)q(efore)12 b(line)e(5969,)g(rather)i
(than)e(rely)h(inde\014nitely)g(on)f(the)-30 1880 y(infallibilit)o(y)g(of)k
(the)g(sup)q(er-user.)-30 2005 y Fg(19.10)56 b(access)19 b(\(6746\))-30
2085 y Fn(This)d(pro)q(cedure)h(is)e(called)g(b)o(y)g(\\exec")h(\(3041\),)f
(\\c)o(hdir")-30 2135 y(\(3552\),)9 b(\\core")h(\(4109\),)f(\\op)q(enl")g
(\(5815,)g(5817\),)g(\\namei")-30 2185 y(\(7563,)15 b(7664,)f(7658\))g(to)h
(c)o(hec)o(k)h(access)i(p)q(ermission)c(to)h(a)-30 2235 y(\014le.)j(The)11
b(second)h(parameter,)f(\\mo)q(de",)e(is)i(equal)g(to)f(one)-30
2284 y(of)i(\\IEXEC",)g(\\IWRITE")f(and)h(\\IREAD",)f(with)h(o)q(ctal)-30
2334 y(v)n(alues)i(of)f(0100,)g(0200)g(and)g(0400)g(resp)q(ectiv)o(ely)m(.)
-30 2433 y Fi(6753:)21 b Fn(\\write")14 b(p)q(ermission)f(is)h(denied)h(if)e
(the)i(\014le)f(is)g(on)74 2482 y(a)e(\014le)g(system)g(v)o(olume)e(whic)o(h)
i(has)g(b)q(een)h(moun)o(ted)74 2532 y(as)j(\\read)g(only")f(or)h(if)f(the)h
(\014le)g(is)g(functioning)f(as)74 2582 y(the)g(text)f(segmen)o(t)g(for)f(an)
h(executing)h(program;)-30 2672 y Fi(6763:)21 b Fn(the)d(suer-user)h(ma)o(y)c
(not)h(execute)j(a)e(\014le)g(unless)74 2722 y(it)d(is)h(\\executable")g(in)f
(at)g(least)h(one)f(of)g(the)h(three)74 2772 y(\\p)q(ermission")h(groups.)27
b(In)17 b(an)o(y)f(other)h(situation)74 2822 y(he)e(is)e(alw)o(a)o(ys)g(allo)
o(w)o(ed)g(access;)1010 17 y Fi(6769:)20 b Fn(If)14 b(the)h(user)h(is)e(not)h
(the)g(o)o(wner)f(of)g(the)h(\014le,)f(shift)1114 66 y(\\m")h(three)20
b(places)e(to)g(the)g(righ)o(t)f(so)h(that)g(group)1114 116
y(p)q(ermissions)12 b(will)f(b)q(e)i(op)q(erativ)o(e)g(...)j(If)d(the)g
(groups)1114 166 y(don't)g(matc)o(h,)f(shift)i(\\m")e(again;)1010
249 y Fi(6774:)20 b Fn(Compare)13 b(\\m")f(and)i(the)g(access)i(p)q
(ermissions.)1072 340 y(Note)f(that)g(there)h(is)f(an)f(anomaly)e(here)k(in)f
(that)f(if)g(a)1010 390 y(\014le)h(has)g(a)g(\\mo)q(de")f(of)g(0077,)h(the)g
(o)o(wner)h(cannot)f(refer-)1010 440 y(ence)g(it)e(at)g(all,)f(but)h(ev)o
(ery)o(one)h(else)g(can.)k(This)c(situation)1010 490 y(could)d(b)q(e)h(c)o
(hanged)g(satisfactorily)f(b)o(y)g(inserting)h(a)f(state-)1010
540 y(men)o(t)1075 631 y Ff(m)22 b(=|)43 b(\(m)21 b(|)44 b(\(m)21
b(>>)g(3\)\))h(>>)f(3;)1010 722 y Fn(after)14 b(line)f(6752,)g(and)g
(replacing)h(lines)g(6764,)e(6765)h(b)o(y)1075 814 y Ff(if)22
b(\(m)f(&)h(IEXEC)e(&&)i(\(m)f(&)h(ip->i_mode\))d(==)j(0\))-30
2946 y Fn(80)p eop
%%Page: 81 89
88 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)991
b(20)43 b(FILE)15 b(SYSTEMS)-30 17 y Fj(20)70 b(File)21 b(Systems)-30
108 y Fn(In)c(most)f(computer)h(systems)g(more)f(than)h(one)g(p)q(eriph-)-30
158 y(eral)g(storage)h(device)g(is)f(used)h(for)e(the)i(storage)f(of)g
(\014les.)-30 208 y(It)k(is)f(no)o(w)f(necessary)j(to)e(discuss)i(a)e(n)o(um)
o(b)q(er)f(of)g(mat-)-30 258 y(ters)14 b(p)q(ertaining)f(to)f(the)h
(managemen)o(t)e(b)o(y)h(UNIX)h(of)f(the)-30 308 y(whole)20
b(set)h(of)e(\014les)i(and)e(\014le)h(storage)h(devices.)37
b(First,)-30 358 y(some)13 b(de\014nitions:)-30 451 y Fi(\014le)i(system:)20
b Fn(an)d(in)o(tegrated)g(collection)g(of)g(\014les)g(with)74
501 y(a)h(hierarc)o(hical)f(system)h(of)f(directories)i(recorded)74
550 y(on)14 b(a)f(single)h(blo)q(c)o(k)g(orien)o(ted)g(storage)g(device;)-30
635 y Fi(storage)h(device:)20 b Fn(a)10 b(device)h(whic)o(h)f(can)g(store)h
(informa-)74 685 y(tion)j(\(esp)q(ecially)g(disk)f(pac)o(k)h(or)g(DECtap)q
(e,)g(etc.\);)-30 770 y Fi(access)j(device:)j Fn(a)h(mec)o(hanism)e(for)i
(transferring)h(in-)74 820 y(formation)12 b(to)h(or)h(from)e(a)i(storage)g
(device;)-30 905 y Fi(a)j(storage)d(device)20 b Fn(is)i(only)f
Fi(accessible)f Fn(if)i(it)f(is)h(in-)74 955 y(serted)d(in)e(an)h(access)h
(device.)29 b(In)18 b(this)f(situation)74 1005 y(reference)h(to)d(the)h
(storage)f(device)i(is)e(made)f(via)g(a)74 1055 y(reference)j(to)c(the)i
(access)h(dev)o(ce;)-30 1140 y Fi(a)h(storage)d(device)20 b
Fn(is)d(acceptable)g(as)g(a)g Fi(\014le)h(system)74 1189 y(v)o(olume)12
b Fn(if:)74 1283 y Fi(\(a\))20 b Fn(information)i(is)i(recorded)i(as)f
(addressable)166 1333 y(blo)q(c)o(ks)12 b(of)g(512)g(c)o(haracters)j(eac)o
(h,)e(whic)o(h)f(can)166 1383 y(b)q(e)i(indep)q(enden)o(tly)h(read)f(or)g
(written.)166 1441 y(\(Note)25 b(IBM)g(compatible)f(magnetic)f(tap)q(e)166
1491 y(do)q(es)14 b(not)g(satisfy)g(this)g(condition.\);)74
1559 y Fi(\(b\))20 b Fn(the)g(information)c(recorded)21 b(on)e(the)h(device)
166 1608 y(satis\014es)14 b(certain)h(consistency)g(criteria:)166
1667 y(blo)q(c)o(k)10 b(#1)g(is)h(formatted)e(as)i(a)f(\\sup)q(er)i(blo)q(c)o
(k")166 1717 y(\(see)j(b)q(elo)o(w\);)166 1775 y(blo)q(c)o(ks)9
b(#2)f(to)i(#\(n+1\))f(\(where)h(n)g(is)f(recorded)166 1825
y(in)h(the)i(\\sup)q(er)g(blo)q(c)o(k"\))f(con)o(tain)f(an)h(\\ino)q(de")166
1875 y(table)17 b(whic)o(h)g(references)j(all)c(\014les)i(recorded)166
1925 y(on)c(the)i(storage)f(device,)g(and)g(do)q(es)h(not)f(ref-)166
1975 y(erence)h(an)o(y)d(other)h(\014les;)166 2033 y(directory)22
b(\014les)g(recorded)h(on)f(the)g(storage)166 2083 y(device)11
b(reference)i(all,)d(and)g(only)m(,)g(\014les)h(on)f(the)166
2133 y(same)18 b(storage)i(device,)h(i.e.)34 b(a)19 b(\014le)g(system)166
2183 y(v)o(olume)f(constitutes)k(a)e(self-con)o(tained)h(set)166
2233 y(of)13 b(\014les,)h(directories)h(and)e(\\ino)q(de")h(table;)-30
2326 y Fi(a)j(\014le)d(system)h(v)o(olume)k Fn(is)14 b(moun)o(ted)f(if)g(the)
h(presence)74 2376 y(of)h(the)i(storage)f(device)h(in)e(an)g(access)j(device)
f(has)74 2426 y(b)q(een)26 b(formally)c(recognised)j(b)o(y)g(the)g(op)q
(erating)74 2476 y(system.)-30 2595 y Fg(20.1)56 b(The)18 b(`Sup)r(er)g(Blo)r
(c)n(k')f(\(5561\))-30 2672 y Fn(The)11 b(\\sup)q(er)g(blo)q(c)o(k")e(is)h
(alw)o(a)o(ys)f(recorded)j(as)e(blo)q(c)o(k)g(#l)f(on)-30 2722
y(the)i(storage)g(device.)18 b(\(Blo)q(c)o(k)10 b(#0)g(is)g(alw)o(a)o(ys)g
(ignored)g(and)-30 2772 y(is)19 b(a)o(v)n(ailable)e(for)i(miscellaneous)f
(uses)j(not)e(necessarily)-30 2822 y(concerned)d(with)e(UNIX.\))1072
17 y(The)f(\\sup)q(er)h(blo)q(c)o(k")e(con)o(tains)h(information)d(used)k(in)
1010 66 y(allo)q(cating)k(resources,)24 b(viz.)37 b(the)20
b(storage)h(blo)q(c)o(ks)f(and)1010 116 y(the)13 b(en)o(tries)h(in)e(the)h
(\\ino)q(de")f(table)h(recorded)h(on)f(the)g(\014le)1010 166
y(system.)27 b(While)16 b(the)i(\014le)f(system)f(v)o(olume)f(is)i(moun)o
(ted)1010 216 y(a)g(cop)o(y)g(of)f(the)i(\\sup)q(er)g(blo)q(c)o(k")e(is)h
(main)o(tained)e(in)h(core)1010 266 y(and)g(up)q(dated)g(there.)26
b(T)m(o)15 b(prev)o(en)o(t)i(the)g(storage)f(device)1010 316
y(cop)o(y)e(b)q(ecoming)e(to)q(o)i(far)g(out)g(of)f(date,)h(its)g(con)o(ten)o
(ts)h(are)1010 365 y(written)f(out)g(at)g(regular)g(in)o(terv)n(als.)1010
493 y Fg(20.2)56 b(The)18 b('moun)n(t')f(table)h(\(0272\))1010
574 y Fn(The)23 b(\\moun)o(t")e(table)i(con)o(tained)g(an)f(en)o(try)i(for)f
(eac)o(h)1010 624 y(moun)o(ted)10 b(\014le)g(system)h(v)o(olume.)k(Eac)o(h)c
(en)o(try)g(de\014nes)h(the)1010 674 y(device)h(on)f(whic)o(h)h(the)g(\014le)
f(system)h(v)o(olume)d(is)j(moun)o(ted,)1010 723 y(a)23 b(p)q(oin)o(ter)g(to)
g(the)h(bu\013er)g(whic)o(h)g(stores)g(the)g(\\sup)q(er)1010
773 y(blo)q(c)o(k")13 b(for)g(the)h(device,)f(and)h(an)f(\\ino)q(de")g(p)q
(oin)o(ter.)18 b(The)1010 823 y(table)c(is)f(referenced)k(as)d(follo)o(ws:)
1010 923 y Fi(iinit)f(\(6922\))19 b Fn(whic)o(h)26 b(is)f(called)h(b)o(y)f
(\\main")e(\(1615\),)1114 973 y(mak)o(es)12 b(an)i(en)o(try)h(for)e(the)i(ro)
q(ot)e(device;)1010 1065 y Fi(smoun)o(t)h(\(6086\))19 b Fn(is)c(a)h(system)f
(call)g(whic)o(h)g(mak)o(es)g(en-)1114 1115 y(tries)f(for)g(additional)e
(devices;)1010 1207 y Fi(iget)i(\(7276\))20 b Fn(searc)o(hes)h(the)f(\\moun)o
(t")d(table)i(if)f(it)h(en-)1114 1256 y(coun)o(ters)14 b(an)f(\\ino)q(de")g
(with)g(the)h(`IMOUNT')f(\015ag)1114 1306 y(set;)1010 1398
y Fi(getfs)h(\(7167\))20 b Fn(searc)o(hes)h(the)f(\\moun)o(t")d(table)i(to)g
(\014nd)1114 1448 y(and)13 b(return)i(a)e(p)q(oin)o(ter)h(to)f(the)h(\\sup)q
(er)h(blo)q(c)o(k")d(for)1114 1498 y(a)h(particular)h(device;)1010
1590 y Fi(up)q(date)g(\(7201\))20 b Fn(is)12 b(called)h(p)q(erio)q(dically)f
(and)g(searc)o(hes)1114 1639 y(the)d(\\moun)o(t")f(table)h(to)g(lo)q(cate)g
(information)e(whic)o(h)1114 1689 y(should)j(b)q(e)h(written)g(from)d(core)j
(tables)g(in)o(to)e(the)i(ta-)1114 1739 y(bles)j(main)o(tained)e(on)h(the)i
(\014le)f(system)f(v)o(olumes;)1010 1831 y Fi(sumoun)o(t)g(\(6144\))19
b Fn(is)j(a)g(system)g(call)g(whic)o(h)g(deletes)1114 1881
y(en)o(tries)15 b(from)d(the)i(table.)1010 2009 y Fg(20.3)56
b(iinit)17 b(\(6922\))1010 2089 y Fn(This)12 b(routine)h(is)f(called)g(b)o(y)
h(\\main")d(\(1615\))h(to)i(initialise)1010 2139 y(the)h(\\moun)o(t")e(table)
i(en)o(try)g(for)g(the)g(ro)q(ot)g(device.)1010 2239 y Fi(6926:)20
b Fn(Call)13 b(the)i(\\op)q(en")e(routine)i(for)e(the)i(ro)q(ot)f(device.)
1114 2289 y(Note)23 b(that)g(\\ro)q(otdev")g(is)f(de\014ned)i(in)f(\\conf.c")
1114 2339 y(\(4695\);)1010 2431 y Fi(6931:)d Fn(Cop)o(y)13
b(the)h(con)o(ten)o(ts)g(of)f(the)h(ro)q(ot)f(device)h(\\sup)q(er)1114
2481 y(blo)q(c)o(k")g(in)o(to)g(a)h(bu\013er)h(area)f(not)g(asso)q(ciated)g
(with)1114 2530 y(an)o(y)e(particular)h(device;)1010 2622 y
Fi(6933:)20 b Fn(The)f(zero)q(eth)g(en)o(try)g(in)e(the)i(\\moun)o(t")c
(table)j(is)1114 2672 y(assigned)d(to)g(the)h(ro)q(ot)g(device.)23
b(Only)15 b(t)o(w)o(o)g(of)f(the)1114 2722 y(three)j(elemen)o(ts)f(are)g
(explicitly)g(initialised.)23 b(The)1114 2772 y(third,)16 b(the)g(\\ino)q
(de")g(p)q(oin)o(ter,)g(will)e(nev)o(er)j(b)q(e)g(ref-)1114
2822 y(erenced;)1890 2946 y(81)p eop
%%Page: 82 90
89 bop -30 -144 a Fk(20)43 b(FILE)15 b(SYSTEMS)993 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fi(6936:)21 b Fn(The)14
b(\\lo)q(c)o(ks")f(stored)i(in)e(the)h(\\sup)q(er)h(blo)q(c)o(k")e(are)74
66 y(explicitly)i(reset.)24 b(\(These)17 b(lo)q(c)o(ks)f(ma)o(y)d(ha)o(v)o(e)
j(b)q(een)74 116 y(set)i(when)f(the)g(\\sup)q(er)h(blo)q(c)o(k")e(w)o(as)h
(last)f(written)74 166 y(on)o(to)e(the)g(\014le)g(system)g(v)o(olume\);)-30
255 y Fi(6938:)21 b Fn(The)15 b(ro)q(ot)g(device)g(is)g(moun)o(ted)f(in)g(a)h
(\\writable")74 305 y(state;)-30 393 y Fi(6939:)21 b Fn(The)14
b(system)g(sets)g(its)g(idea)g(of)f(the)h(curren)o(t)h(time)74
443 y(and)c(date)f(from)f(the)i(time)e(recorded)k(in)d(the)h(\\sup)q(er)74
493 y(blo)q(c)o(k".)27 b(\(If)16 b(the)i(system)e(has)h(b)q(een)h(stopp)q(ed)
g(for)74 543 y(an)12 b(appreciable)g(p)q(erio)q(d,)g(the)h(computer)e(op)q
(erator)74 592 y(will)i(need)i(to)e(reset)j(the)e(con)o(ten)o(ts)h(of)f
(\\time".\))-30 716 y Fg(20.4)56 b(Moun)n(ting)-30 795 y Fn(F)m(rom)13
b(an)i(op)q(erational)f(view)g(p)q(oin)o(t,)g(\\moun)o(ting")e(a)j(\014le)-30
845 y(system)g(v)o(olume)e(in)o(v)o(olv)o(es)i(placing)f(it)g(in)h(a)g
(suitable)g(ac-)-30 895 y(cess)h(device,)e(readying)g(the)h(device,)f(and)g
(then)g(en)o(tering)-30 945 y(a)g(command)d(suc)o(h)k(as)f(parameters.)58
1043 y Ff(``/etc/mount)19 b(/dev/rk2)h(/rk2'')-30 1140 y Fn(to)f(the)f
(\\shell",)h(whic)o(h)f(forks)g(a)g(program)e(to)j(p)q(erform)-30
1190 y(a)14 b(\\moun)o(t")d(system)j(call,)e(passing)h(p)q(oin)o(ters)i(to)e
(the)h(t)o(w)o(o)-30 1240 y(\014le)g(names)f(as)h(parameters.)-30
1364 y Fg(20.5)56 b(smoun)n(t)18 b(\(6086\))-30 1443 y Fi(6093:)j
Fn(\\getmdev")11 b(deco)q(des)j(the)f(\014rst)g(argumen)o(t)e(to)h(lo-)74
1493 y(cate)j(a)e(blo)q(c)o(k)h(orien)o(ted)g(access)i(device;)-30
1581 y Fi(6096:)21 b Fn(\\u.u)p 181 1581 13 2 v 14 w(dirp")j(is)h(reset)h
(preparatory)f(to)f(calling)74 1631 y(\\namei")i(to)i(deco)q(de)h(the)g
(second)g(\014le)f(name.)74 1681 y(\(Note)e(that)f(\\u.u)p
384 1681 V 14 w(dirp")f(is)h(set)h(b)o(y)e(\\trap")h(to)74
1731 y(\\u.u)p 155 1731 V 15 w(arg[0]")12 b(\(2770\);)-30 1819
y Fi(6100:)21 b Fn(Chec)o(k)13 b(that)f(the)g(\014le)g(named)f(b)o(y)h(the)g
(second)h(pa-)74 1869 y(rameter)i(is)f(in)g(a)h(satisfactory)f(condition,)g
(i.e.)20 b(no)74 1919 y(one)h(else)g(is)g(curren)o(tly)g(accessing)h(the)f
(\014le,)h(and)74 1969 y(that)11 b(the)h(\014le)e(is)h(not)g(a)f(sp)q(ecial)h
(\014le)g(\(blo)q(c)o(k)g(or)g(c)o(har-)74 2019 y(acter\);)-30
2107 y Fi(6103:)21 b Fn(Searc)o(h)k(the)f(\\moun)o(t")e(table)h(lo)q(oking)f
(for)i(an)74 2157 y(empt)o(y)10 b(en)o(try)i(\(\\mp-)p Fh(>)p
Fn(m)d(bufp==NULL"\))j(or)f(an)74 2207 y(en)o(try)26 b(already)e(made)g(for)g
(the)i(device.)51 b(\(The)74 2257 y(\\moun)o(t")24 b(data)i(structure)i(is)e
(de\014ned)h(at)f(line)74 2307 y(0272\);)-30 2395 y Fi(6111:)21
b Fn(\\smp")d(should)h(p)q(oin)o(t)g(to)h(a)f(suitable)g(en)o(try)h(in)74
2445 y(the)15 b(\\moun)o(t")d(table;)-30 2534 y Fi(6113:)21
b Fn(P)o(erform)26 b(the)i(appropriate)g(\\op)q(en")f(routine,)74
2583 y(with)18 b(the)h(device)g(name)e(and)h(a)f(read/write)i(\015ag)74
2633 y(as)g(argumen)o(ts.)30 b(\(As)19 b(w)o(as)f(seen)i(earlier,)f(for)f
(the)74 2683 y(RK05)13 b(disk)h(the)h(\\op)q(en")e(routine)i(is)e(a)h
(\\no-op"\);)-30 2772 y Fi(6116:)21 b Fn(Read)14 b(blo)q(c)o(k)g(#1)g(from)e
(the)j(device.)21 b(This)14 b(blo)q(c)o(k)74 2822 y(is)g(the)g(\\sup)q(er)h
(blo)q(c)o(k";)1010 17 y Fi(6124:)20 b Fn(Cop)o(y)13 b(the)g(\\sup)q(er)h
(blo)q(c)o(k")e(in)o(to)g(a)g(bu\013er)i(asso)q(ci-)1114 66
y(ated)g(with)g(\\NODEV",)g(from)e(the)j(bu\013er)g(asso)q(ci-)1114
116 y(ated)f(with)g(\\d".)19 b(The)14 b(second)h(bu\013er)h(will)c(not)i(b)q
(e)1114 166 y(released)g(again)f(un)o(til)f(the)i(device)g(is)f(unmoun)o
(ted;)1010 261 y Fi(6130:)20 b Fn(\\ip")g(p)q(oin)o(ts)g(to)h(the)g(\\ino)q
(de")f(for)g(the)h(second)1114 311 y(named)d(\014le.)33 b(This)19
b(\\ino)q(de")g(is)f(no)o(w)h(\015agged)g(as)1114 360 y(\\IMOUNT".)k(The)i
(e\013ect)g(of)f(this)g(is)g(to)g(force)1114 410 y(\\iget")18
b(\(7292\))f(to)i(ignore)f(the)h(normal)e(con)o(ten)o(ts)1114
460 y(of)k(the)h(\014le,)h(while)f(the)g(\014le)g(system)f(v)o(olume)f(is)
1114 510 y(moun)o(ted.)28 b(\(In)18 b(practice,)h(the)f(second)h(\014le)f(is)
f(an)1114 560 y(empt)o(y)9 b(\014le)h(created)h(esp)q(ecially)f(for)g(this)g
(purp)q(ose.\))1010 691 y Fg(20.6)56 b(Notes)1010 773 y Fi(1.)21
b Fn(The)g(\\read/write")g(status)h(of)f(a)f(moun)o(ted)g(device)1114
823 y(dep)q(ends)d(only)f(on)g(the)h(parameters)f(pro)o(vided)g(to)1114
873 y(\\smoun)o(t".)23 b(No)16 b(attempt)f(is)h(made)g(to)g(sense)h(the)1114
923 y(hardw)o(are)d(\\read/write")g(status.)19 b(Th)o(us)14
b(if)f(a)g(disk)1114 973 y(is)g(readied)h(with)g(\\write)f(protect")i(on,)e
(but)h(is)f(not)1114 1022 y(moun)o(ted)19 b(\\read)i(only",)f(then)h(the)g
(system)g(will)1114 1072 y(complain)11 b(vigorously)m(.)1010
1167 y Fi(2.)21 b Fn(The)14 b(\\moun)o(t")e(pro)q(cedure)k(do)q(es)e(not)g
(carry)h(out)f(an)o(y)1114 1217 y(kind)h(of)g(lab)q(el)h(c)o(hec)o(king)g(on)
f(the)i(\\moun)o(ted")d(\014le)1114 1267 y(system)k(v)o(olume.)29
b(This)18 b(is)h(reasonable)f(in)g(a)g(sit-)1114 1316 y(uation)g(where)i
(\014le)f(system)f(v)o(olumes)g(are)h(rarely)1114 1366 y(rearranged.)g(Ho)o
(w)o(ev)o(er)c(in)e(situations)h(where)h(v)o(ol-)1114 1416
y(umes)c(are)i(moun)o(ted)f(and)g(remoun)o(ted)g(frequen)o(tly)m(,)1114
1466 y(some)h(means)g(of)h(v)o(erifying)f(that)h(the)g(correct)i(v)o(ol-)1114
1516 y(ume)11 b(has)h(b)q(een)i(moun)o(ted)d(w)o(ould)g(seem)h(desirable.)
1114 1565 y(\(F)m(urther,)g(if)f(a)g(\014le)h(system)f(v)o(olume)f(con)o
(tains)h(sen-)1114 1615 y(sitiv)o(e)k(information,)d(it)k(ma)o(y)d(b)q(e)j
(desirable)g(to)g(in-)1114 1665 y(clude)21 b(some)g(form)f(of)g(passw)o(ord)i
(protection)g(as)1114 1715 y(w)o(ell.)43 b(There)24 b(is)e(ro)q(om)g(in)g
(the)h(\\sup)q(er)h(blo)q(c)o(k")1114 1765 y(\(5575\))15 b(for)i(the)g
(storage)g(of)f(a)g(name)f(and)h(an)h(en-)1114 1814 y(crypted)e(passw)o
(ord.\))1010 1946 y Fg(20.7)56 b(iget)17 b(\(7276\))1010 2028
y Fn(This)22 b(pro)q(cedure)i(is)e(called)g(b)o(y)g(\\main")e(\(1616,1618\),)
1010 2078 y(\\unlink")8 b(\(3519\),)h(\\iallo)q(c")f(\(7078\))h(and)h
(\\namei")d(\(7534,)1010 2128 y(7664\))j(with)h(t)o(w)o(o)f(parameters)i
(whic)o(h)f(together)h(uniquely)1010 2178 y(iden)o(tify)g(a)g(\014le:)18
b(a)12 b(device,)h(and)g(the)g(\\ino)q(de")g(n)o(um)o(b)q(er)f(of)1010
2227 y(a)f(\014le)h(on)f(the)i(device.)18 b(\\iget")11 b(returns)i(a)f
(reference)i(to)d(an)1010 2277 y(en)o(try)j(in)g(the)g(core)h(\\ino)q(de")e
(table.)1072 2330 y(When)20 b(\\iget")f(is)h(called,)g(the)g(core)h(\\ino)q
(de")e(table)1010 2380 y(is)13 b(searc)o(hed)i(\014rst)f(to)f(see)h(if)f(an)g
(en)o(try)h(already)e(exists)i(for)1010 2430 y(the)d(\014le)g(in)f(the)i
(core)g(\\ino)q(de")e(table.)17 b(If)10 b(not,)h(then)h(\\iget")1010
2479 y(creates)k(one.)1010 2582 y Fi(7285:)k Fn(Searc)o(h)15
b(the)g(core)f(\\ino)q(de")g(table)f(...)1010 2677 y Fi(7286:)20
b Fn(If)g(an)g(en)o(try)h(for)f(the)g(designated)h(\014le)f(already)1114
2727 y(exists)14 b(...)1010 2822 y Fi(7287:)20 b Fn(Then)15
b(if)e(it)g(is)h(lo)q(c)o(k)o(ed)g(go)f(to)h(sleep;)-30 2946
y(82)p eop
%%Page: 83 91
90 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)991
b(20)43 b(FILE)15 b(SYSTEMS)-30 17 y Fi(7290:)21 b Fn(T)m(ry)9
b(again.)16 b(\(Note)10 b(the)h(whole)e(table)h(needs)h(to)f(b)q(e)74
66 y(searc)o(hed)21 b(again)d(from)g(the)i(b)q(eginning,)f(b)q(ecause)74
116 y(the)c(en)o(try)f(ma)o(y)e(ha)o(v)o(e)i(v)n(anished!\);)-30
194 y Fi(7292:)21 b Fn(If)15 b(the)h(IMOUNT)f(\015ag)g(is)g(on)g(...)21
b(this)16 b(is)f(an)g(im-)74 244 y(p)q(ortan)o(t)d(p)q(ossibilit)o(y)e(for)h
(whic)o(h)g(w)o(e)g(will)f(dela)o(y)h(the)74 294 y(discussion;)-30
371 y Fi(7302:)21 b Fn(If)d(the)h(\\IMOUNT")f(\015ag)g(is)g(not)h(set,)g
(increase)74 421 y(the)11 b(\\ino)q(de")f(reference)j(coun)o(t,)e(set)g(the)g
(\\ILOCK")74 471 y(\015ag)j(and)f(return)i(a)f(p)q(oin)o(ter)g(to)g(the)g
(\\ino)q(de";)-30 549 y Fi(7306:)21 b Fn(Mak)o(e)d(a)g(note)g(of)f(the)i
(\014rst)g(empt)o(y)e(slot)h(in)f(the)74 599 y(\\ino)q(de")d(table;)-30
676 y Fi(7309:)21 b Fn(If)16 b(the)h(\\ino)q(de")f(table)g(is)g(full,)g(send)
h(a)f(message)74 726 y(to)e(the)g(op)q(erator,)g(and)g(tak)o(e)g(an)g(error)h
(exit;)-30 804 y Fi(7314:)21 b Fn(A)o(t)15 b(this)f(p)q(oin)o(t,)g(a)h(new)g
(en)o(try)g(is)g(to)f(b)q(e)i(made)d(in)74 854 y(the)i(\\ino)q(de")e(table;)
-30 931 y Fi(7319:)21 b Fn(Read)16 b(the)h(blo)q(c)o(k)e(whic)o(h)h(con)o
(tains)g(the)h(\014le)f(sys-)74 981 y(tem)11 b(v)o(olume)f(\\ino)q(de".)17
b(Note)c(the)f(use)h(of)f(\\bread")74 1031 y(instead)18 b(of)e(\\readi",)h
(the)h(assumption)d(that)j(\\in-)74 1081 y(o)q(de")c(information)d(b)q(egins)
k(in)e(blo)q(c)o(k)h(#2)f(and)h(the)74 1131 y(con)o(v)o(en)o(tion)g(that)g(v)
n(alid)f(\\ino)q(de")g(n)o(um)o(b)q(ers)h(b)q(egin)74 1180
y(at)g(one)g(\(not)g(zero\);)-30 1258 y Fi(7326:)21 b Fn(A)14
b(read)f(error)i(at)e(this)h(p)q(oin)o(t)f(isn't)g(v)o(ery)g(w)o(ell)g(re-)74
1308 y(p)q(orted)i(to)f(the)g(rest)h(of)f(the)g(system;)-30
1386 y Fi(7328:)21 b Fn(Cop)o(y)9 b(the)h(relev)n(an)o(t)f(\\ino)q(de")g
(information.)k(This)74 1436 y(co)q(de)g(mak)o(es)e(implicit)e(use)k(of)f
(the)g(con)o(ten)o(ts)i(of)d(the)74 1485 y(\014le)j(\\ino.h")e(\(Sheet)j
(56\),)d(whic)o(h)i(isn't)f(referenced)74 1535 y(explicitly)g(an)o(ywhere.)
-30 1613 y(Let)i(us)f(no)o(w)g(return)h(to)e(un\014nished)i(business:)-30
1691 y Fi(7292:)21 b Fn(The)10 b(\\IMOUNT")f(\015ag)g(is)h(found)f(to)g(b)q
(e)h(set.)18 b(This)74 1741 y(\015ag)c(w)o(as)g(set)h(b)o(y)g(\\smoun)o(t",)d
(when)j(a)f(\014le)g(system)74 1791 y(v)o(olume)e(w)o(as)i(moun)o(ted;)-30
1869 y Fi(7293:)21 b Fn(Searc)o(h)h(the)g(\\moun)o(t")d(table)i(to)g(\014nd)h
(the)f(en-)74 1919 y(try)16 b(whic)o(h)f(p)q(oin)o(ts)g(to)h(the)g(curen)o(t)
g(\\ino)q(de".)22 b(\(Al-)74 1968 y(though)c(searc)o(hing)h(this)f(table)g
(is)f(not)h(a)g(horren-)74 2018 y(dous)h(o)o(v)o(erhead,)g(it)e(do)q(es)i
(seem)f(p)q(ossible)h(that)f(a)74 2068 y(\\bac)o(k)g(p)q(oin)o(ter")f(could)h
(b)q(e)g(con)o(v)o(enien)o(tly)g(stored)74 2118 y(in)g(in)g(the)h(\\ino)q
(de")f(e.g.)31 b(in)18 b(the)h(\\i)p 672 2118 13 2 v 14 w(lastr")f(\014eld.)
74 2168 y(This)c(w)o(ould)f(sa)o(v)o(e)h(b)q(oth)g(time)f(and)g(co)q(de)i
(space.;)-30 2245 y Fi(7396:)21 b Fn(Reset)c(\\dev")g(and)f(\\ino")f(to)i
(the)g(moun)o(ted)e(de-)74 2295 y(vice)i(n)o(um)o(b)q(er)f(and)h(the)g(\\ino)
q(de")g(n)o(um)o(b)q(er)f(of)g(the)74 2345 y(ro)q(ot)11 b(directory)h(on)f
(the)g(moun)o(ted)f(\014le)h(system)g(v)o(ol-)74 2395 y(ume.)17
b(Start)e(again.)33 2473 y(Clearly)m(,)c(since)i(\\iget")f(is)h(called)f(b)o
(y)h(\\namei")d(\(7534,)-30 2523 y(7664\),)24 b(this)e(tec)o(hnique)i(allo)o
(ws)d(the)i(whole)f(directory)-30 2573 y(structure)17 b(on)c(the)i(moun)o
(ted)e(\014le)h(system)g(v)o(olume)e(to)i(b)q(e)-30 2622 y(in)o(tegrated)f
(in)o(to)e(the)i(pre-existing)f(directory)h(structure.)-30
2672 y(If)g(w)o(e)g(momen)o(tarily)c(ignore)k(the)h(p)q(ossible)f(deviations)
f(of)-30 2722 y(directory)17 b(structures)h(a)o(w)o(a)o(y)d(from)f(tree)j
(structures,)h(w)o(e)-30 2772 y(ha)o(v)o(e)d(the)g(situation)f(where)i(a)f
(leaf)f(of)g(the)h(existing)f(tree)-30 2822 y(is)g(b)q(eing)g(replaced)h(b)o
(y)f(an)f(en)o(tire)i(subtree.)1010 17 y Fg(20.8)56 b(getfs)18
b(\(7167\))1010 96 y Fn(There)c(is)f(little)f(that)h(needs)h(to)f(b)q(e)h
(said)e(ab)q(out)h(this)g(pro-)1010 146 y(cedure)k(in)f(addition)e(to)i(the)h
(author's)e(commen)o(t.)22 b(This)1010 196 y(pro)q(cedure)16
b(is)d(called)h(b)o(y)1075 296 y Ff(access)64 b(\(6754\))108
b(ialloc)64 b(\(7072\))1075 345 y(alloc)86 b(\(6961\))108 b(ifree)86
b(\(7138\))1075 395 y(free)108 b(\(7004\))g(iupdat)64 b(\(7383\))1072
493 y Fn(Note)18 b(the)g(cunning)f(use)h(of)e(\\n1",)h(\\n2")g(whic)o(h)g
(are)1010 543 y(declared)g(as)f(c)o(haracter)i(p)q(oin)o(ters)f(i.e.)25
b(as)16 b(unsigned)h(in-)1010 593 y(tegers.)j(This)14 b(allo)o(ws)f(only)g
(one)h(sided)h(tests)g(on)f(the)h(t)o(w)o(o)1010 643 y(v)n(ariables)e(at)h
(line)f(7177.)1010 768 y Fg(20.9)56 b(up)r(date)18 b(\(7201\))1010
847 y Fn(The)25 b(function)g(of)f(this)h(pro)q(cedure,)k(in)24
b(its)h(broadest)1010 897 y(terms,)12 b(is)h(to)g(ensure)i(that)e
(information)d(on)j(the)h(\014le)f(sys-)1010 947 y(tem)h(v)o(olumes)f(is)i(k)
o(ept)h(up)f(to)f(date.)22 b(The)16 b(commen)o(t)c(for)1010
997 y(this)19 b(pro)q(cedure)h(\(b)q(eginning)e(on)h(line)f(7190\))g(describ)
q(es)1010 1047 y(the)j(three)h(main)c(sub-functions,)k(\(in)e(the)h(rev)o
(erse)h(or-)1010 1096 y(der!\).)1072 1148 y(\\up)q(date")f(is)f(the)h(whole)f
(business)h(of)f(the)h(\\sync")1010 1198 y(system)d(call)f(\(3486\).)31
b(This)18 b(ma)o(y)f(b)q(e)i(in)o(v)o(ok)o(ed)e(via)g(the)1010
1248 y(\\sync")22 b(shell)g(command.)40 b(Alternativ)o(ely)22
b(there)h(is)f(a)1010 1297 y(standard)15 b(system)g(program)e(whic)o(h)i
(runs)h(con)o(tin)o(uously)1010 1347 y(and)f(whose)g(only)f(function)h(is)g
(to)g(call)f(\\sync")h(ev)o(ery)h(30)1010 1397 y(seconds.)j(\(See)c(\\UPD)o
(A)m(TE\(VI)q(I)q(I\)")f(in)g(the)g(UPM.\))1072 1448 y(\\up)q(date")i(is)f
(called)g(b)o(y)h(\\sumoun)o(t")e(\(6150\))g(b)q(efore)1010
1498 y(a)e(\014le)h(system)g(v)o(olume)d(is)j(unmoun)o(ted,)f(and)g(b)o(y)h
(\\panic")1010 1548 y(\(2420\))e(as)h(the)h(last)e(action)h(of)f(the)i
(system)f(b)q(efore)g(activ-)1010 1598 y(it)o(y)h(ceases.)1010
1696 y Fi(7207:)20 b Fn(If)g(another)h(execution)g(of)f(\\up)q(date")g(is)g
(under)1114 1746 y(w)o(a)o(y)m(,)12 b(then)i(just)h(return;)1010
1835 y Fi(7210:)20 b Fn(Searc)o(h)15 b(the)g(\\moun)o(t")c(table;)1010
1925 y Fi(7211:)20 b Fn(F)m(or)14 b(eac)o(h)g(moun)o(ted)f(v)o(olume,)f(...)
1010 2015 y Fi(7213:)20 b Fn(Unless)15 b(the)e(\014le)h(system)f(has)g(not)h
(b)q(een)g(recen)o(tly)1114 2064 y(mo)q(di\014ed)c(or)i(the)h(\\sup)q(er)g
(blo)q(c)o(k")f(is)f(lo)q(c)o(k)o(ed)h(or)g(the)1114 2114 y(v)o(olume)g(has)i
(b)q(een)h(moun)o(ted)d(\\read)j(only")d(...)1010 2204 y Fi(7217:)20
b Fn(Up)q(date)i(the)g(\\sup)q(er)h(blo)q(c)o(k",)f(cop)o(y)g(it)f(in)o(to)f
(a)1114 2254 y(bu\013er)c(and)g(write)g(the)h(bu\013er)g(out)e(on)o(to)h(the)
g(v)o(ol-)1114 2304 y(ume;)1010 2393 y Fi(7223:)k Fn(Searc)o(h)15
b(the)g(\\ino)q(de")e(table,)h(and)f(for)h(eac)o(h)g(non-)1114
2443 y(n)o(ull)j(en)o(try)m(,)j(lo)q(c)o(k)e(the)i(en)o(try)f(and)g(call)f
(\\iup)q(dat")1114 2493 y(to)13 b(up)q(date)h(the)g(\\ino)q(de")f(en)o(try)i
(on)e(the)h(v)o(olume)e(if)1114 2543 y(appropriate;)1010 2632
y Fi(7229:)20 b Fn(Allo)o(w)15 b(additional)f(executions)k(of)d(\\up)q(date")
h(to)1114 2682 y(commence;)1010 2772 y Fi(7230:)k Fn(\\b\015ush")29
b(\(5229\))f(forces)i(out)e(an)o(y)g(\\dela)o(y)o(ed)1114 2822
y(write")14 b(blo)q(c)o(ks.)1890 2946 y(83)p eop
%%Page: 84 92
91 bop -30 -144 a Fk(20)43 b(FILE)15 b(SYSTEMS)993 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fg(20.10)56 b(sumoun)n(t)18
b(\(6144\))-30 93 y Fn(This)j(system)f(call)g(deletes)i(an)f(en)o(try)g(for)f
(a)h(moun)o(ted)-30 143 y(device)12 b(from)d(the)j(\\moun)o(t")d(table.)17
b(The)11 b(purp)q(ose)h(of)f(this)-30 193 y(call)j(is)f(to)h(ensure)i(that)e
(tra\016c)g(to)f(and)h(from)e(the)j(device)-30 243 y(is)f(terminated)f(prop)q
(erly)m(,)h(b)q(efore)g(the)h(storage)f(device)h(is)-30 293
y(ph)o(ysically)e(remo)o(v)o(ed)g(from)f(the)j(access)h(device.)-30
382 y Fi(6154:)21 b Fn(Searc)o(h)16 b(the)g(\\moun)o(t")d(table)i(for)g(the)h
(appropri-)74 431 y(ate)e(en)o(try;)-30 514 y Fi(6161:)21 b
Fn(Searc)o(h)10 b(the)g(\\ino)q(de")f(table)h(for)f(an)o(y)g(outstanding)74
563 y(en)o(tries)22 b(for)e(\014les)h(on)f(the)i(device.)39
b(If)20 b(an)o(y)g(suc)o(h)74 613 y(exist,)e(tak)o(e)g(an)f(error)h(exit,)g
(and)f(do)g(not)g(c)o(hange)74 663 y(the)e(\\moun)o(t")d(table)h(en)o(try;)
-30 745 y Fi(6168:)21 b Fn(Clear)14 b(the)g(\\IMOUNT")g(\015ag.)-30
861 y Fg(20.11)56 b(Resource)18 b(Allo)r(cation)-30 938 y Fn(Our)c(atten)o
(tion)e(no)o(w)h(turns)h(to)e(the)i(managemen)o(t)c(of)i(the)-30
987 y(resources)h(of)c(an)g(individual)f(FSV)i(\(\014le)f(system)h(v)o
(olume\).)33 1037 y(Storage)h(blo)q(c)o(ks)f(are)i(allo)q(cated)e(from)f(the)
i(free)h(list)e(b)o(y)-30 1087 y(\\allo)q(c")17 b(at)g(the)h(request)h(of)e
(\\bmap".)27 b(Storage)18 b(blo)q(c)o(ks)-30 1137 y(are)c(returned)h(to)e
(the)h(free)g(list)f(b)o(y)g(\\free")h(at)f(the)h(b)q(ehest)-30
1187 y(of)f(\\itrunc")h(\(whic)o(h)f(is)h(called)f(b)o(y)g(\\core",)h(\\op)q
(enl")f(and)-30 1236 y(\\iput"\).)33 1286 y(En)o(tries)i(in)f(the)h(FSV)f
(\\ino)q(de")g(tables)h(are)g(made)e(b)o(y)-30 1336 y(\\iallo)q(c",)e(whic)o
(h)i(is)g(called)f(b)o(y)h(\\makno)q(de")e(and)h(\\pip)q(e".)-30
1386 y(En)o(tries)i(in)f(this)f(table)h(are)g(cancelled)h(b)o(y)e(\\ifree",)h
(whic)o(h)-30 1436 y(is)h(called)g(b)o(y)f(\\iput".)33 1486
y(The)22 b(\\sup)q(er)h(blo)q(c)o(k")e(for)h(the)h(FSV)f(is)f(cen)o(tral)i
(to)-30 1535 y(the)17 b(resource)h(managemen)o(t)c(pro)q(cedures.)26
b(The)17 b(\\sup)q(er)-30 1585 y(blo)q(c)o(k")d(\(5561\))f(con)o(tains:)33
1674 y Fl(\017)20 b Fn(size)15 b(information)c(\(total)i(resources)j(a)o(v)n
(ailable\);)33 1756 y Fl(\017)k Fn(list)14 b(of)f(up)h(to)g(100)f(a)o(v)n
(ailable)e(storage)k(blo)q(c)o(ks;)33 1839 y Fl(\017)20 b Fn(list)14
b(of)f(up)h(to)g(100)f(a)o(v)n(ailable)e(\\ino)q(de")j(en)o(tries;)33
1921 y Fl(\017)20 b Fn(lo)q(c)o(ks)i(to)g(con)o(trol)f(manipulation)e(of)i
(the)i(ab)q(o)o(v)o(e)74 1970 y(lists;)33 2053 y Fl(\017)d
Fn(\015ags;)33 2135 y Fl(\017)g Fn(curren)o(t)c(date)e(of)f(last)h(up)q
(date.)33 2224 y(If)19 b(the)i(list)f(in)g(core)h(of)e(a)o(v)n(ailable)f
(\\ino)q(de")i(en)o(tries)-30 2274 y(for)13 b(the)h(\014le)e(system)h(v)o
(olume)e(ev)o(er)j(b)q(ecomes)f(exhausted,)-30 2323 y(then)27
b(the)g(en)o(tire)g(table)f(on)f(the)i(FSV)f(is)g(read)h(and)-30
2373 y(searc)o(hed)14 b(to)f(rebuild)f(the)h(list.)k(Con)o(v)o(ersely)12
b(if)g(the)h(a)o(v)n(ail-)-30 2423 y(able)i(\\ino)q(de")e(table)h(o)o(v)o
(er\015o)o(ws,)g(additional)f(en)o(tries)i(are)-30 2473 y(simply)d(forgotten)
i(to)g(b)q(e)g(redisco)o(v)o(ered)i(later.)33 2523 y(A)e(di\013eren)o(t)i
(strategy)f(is)f(used)h(for)f(the)h(list)f(of)g(a)o(v)n(ail-)-30
2573 y(able)j(storage)g(blo)q(c)o(ks.)26 b(These)18 b(blo)q(c)o(ks)f(are)g
(arranged)g(in)-30 2622 y(groups)12 b(of)f(up)h(to)g(one)g(h)o(undred)g(blo)q
(c)o(ks.)17 b(The)c(\014rst)f(blo)q(c)o(k)-30 2672 y(in)f(eac)o(h)h(group)g
(\(except)h(the)f(v)o(ery)f(\014rst\))i(is)e(used)h(to)g(store)-30
2722 y(the)k(addresses)h(of)d(the)h(blo)q(c)o(ks)g(b)q(elonging)f(to)g(the)i
(previ-)-30 2772 y(ous)h(group.)26 b(Addresses)19 b(of)d(blo)q(c)o(ks)g(in)g
(the)h(last)g(incom-)-30 2822 y(plete)e(group)f(are)g(stored)h(in)e(the)i
(\\sup)q(er)g(blo)q(c)o(k".)1072 17 y(The)f(\014rst)g(en)o(try)g(in)e(the)i
(\014rst)g(list)f(of)g(blo)q(c)o(k)f(n)o(um)o(b)q(ers)1010
66 y(is)17 b(zero,)i(whic)o(h)e(acts)h(as)f(a)h(sen)o(tinel.)28
b(Since)18 b(the)g(whole)1010 116 y(list)e(is)g(sub)r(ject)j(to)d(a)g(LIF)o
(O)h(discipline,)f(disco)o(v)o(ery)h(of)f(a)1010 166 y(blo)q(c)o(k)h(n)o(um)o
(b)q(er)g(of)g(zero)i(in)e(the)h(list)f(signi\014es)h(that)f(the)1010
216 y(list)c(is)h(in)f(fact)h(empt)o(y)m(.)1010 333 y Fg(20.12)56
b(allo)r(c)17 b(\(6965\))1010 410 y Fn(This)f(is)f(called)h(b)o(y)f(\\bmap")f
(\(6435,)h(6448,)g(6468,)g(6480,)1010 460 y(6497\))i(whenev)o(er)j(a)e(new)h
(storage)g(blo)q(c)o(k)f(is)g(needed)i(to)1010 510 y(store)15
b(part)f(of)f(a)h(\014le.)1010 602 y Fi(6961:)20 b Fn(Con)o(v)o(ert)c(kno)o
(wledge)f(of)f(the)i(device)g(name)e(in)o(to)1114 652 y(a)f(p)q(oin)o(ter)h
(to)g(the)h(\\sup)q(er)f(blo)q(c)o(k";)1010 735 y Fi(6962:)20
b Fn(If)13 b(\\s)p 1219 735 13 2 v 15 w(\015o)q(c)o(k")f(is)h(set,)g(the)g
(list)g(of)f(a)o(v)n(ailable)e(blo)q(c)o(ks)1114 785 y(is)20
b(curren)o(tly)h(b)q(eing)g(up)q(dated)g(b)o(y)f(another)h(pro-)1114
835 y(cess;)1010 919 y Fi(6967:)f Fn(Obtain)15 b(the)h(blo)q(c)o(k)f(n)o(um)o
(b)q(er)g(of)g(the)g(next)h(a)o(v)n(ail-)1114 969 y(able)d(storage)i(blo)q(c)
o(k;)1010 1052 y Fi(6968:)20 b Fn(If)15 b(the)h(last)g(blo)q(c)o(k)f(n)o(um)o
(b)q(er)f(on)h(the)h(list)f(is)h(zero,)1114 1102 y(the)e(en)o(tire)h(list)e
(is)h(no)o(w)f(empt)o(y;)1010 1186 y Fi(6970:)20 b Fn(\\badblo)q(c)o(k")13
b(\(7040\))g(is)g(used)i(to)e(c)o(hec)o(k)i(that)e(the)1114
1236 y(blo)q(c)o(k)20 b(n)o(um)o(b)q(er)h(obtained)f(from)g(the)h(list)g
(seems)1114 1286 y(reasonable;)1010 1369 y Fi(6971:)f Fn(If)d(the)h(list)f
(of)f(a)o(v)n(ailable)f(blo)q(c)o(ks)i(in)g(the)h(\\sup)q(er)1114
1419 y(blo)q(c)o(k")d(is)i(no)o(w)f(empt)o(y)m(,)e(then)j(the)g(blo)q(c)o(k)f
(just)h(lo-)1114 1469 y(cated)h(will)f(con)o(tain)h(the)g(addresses)i(of)e
(the)h(next)1114 1519 y(group)13 b(of)1010 1603 y Fi(6972:)20
b Fn(Set)11 b(\\s)p 1246 1603 V 15 w(\015o)q(c)o(k")f(to)g(dela)o(y)g(an)o(y)
g(other)h(pro)q(cess)h(from)1114 1652 y(getting)f(a)h(\\no)g(space")g
(indication)f(b)q(efore)i(the)g(list)1114 1702 y(of)k(a)o(v)n(ailable)f(blo)q
(c)o(ks)i(in)f(the)i(\\sup)q(er)g(blo)q(c)o(k")e(can)1114 1752
y(b)q(e)d(replenished;)1010 1836 y Fi(6975:)20 b Fn(Determine)11
b(the)h(n)o(um)o(b)q(er)e(of)g(v)n(alid)g(en)o(tries)i(in)e(the)1114
1886 y(list)j(to)h(b)q(e)g(copied;)1010 1969 y Fi(6978:)20
b Fn(Reset)14 b(\\s)p 1291 1969 V 15 w(\015o)q(c)o(k",)e(and)h(\\w)o(ak)o
(eup")f(an)o(y)o(one)g(w)o(ait-)1114 2019 y(ing;)1010 2103
y Fi(6982:)20 b Fn(Clear)k(the)h(bu\013er)g(so)f(that)g(an)o(y)f(information)
1114 2153 y(recorded)12 b(in)e(the)h(\014le)g(b)o(y)f(default)h(will)e(b)q(e)
i(all)e(zeros;)1010 2236 y Fi(6983:)20 b Fn(Set)f(the)g(\\mo)q(di\014ed")e
(\015ag)h(to)g(ensure)i(that)e(the)1114 2286 y(\\sup)q(er)11
b(blo)q(c)o(k")f(will)f(b)q(e)i(written)g(out)f(b)o(y)g(\\up)q(date")1114
2336 y(\(7213\).)1010 2453 y Fg(20.13)56 b(itrunc)18 b(\(7414\))1010
2530 y Fn(This)d(pro)q(cedure)h(is)f(called)g(b)o(y)f(\\core")i(\(4112\),)e
(\\op)q(enl")1010 2580 y(\(5825\))c(and)h(\\iput")f(\(7353\).)16
b(In)11 b(the)h(\014rst)g(t)o(w)o(o)e(cases,)i(the)1010 2630
y(con)o(ten)o(ts)k(of)f(the)h(\\\014le")f(are)h(ab)q(out)f(to)g(b)q(e)h
(replaced.)24 b(In)1010 2680 y(the)14 b(third)g(case,)h(the)f(\014le)g(is)g
(ab)q(out)g(to)f(b)q(e)i(abandoned.)1010 2772 y Fi(7421:)20
b Fn(If)14 b(the)i(\014le)e(is)g(a)h(c)o(haracter)h(or)e(blo)q(c)o(k)g(sp)q
(ecial)h(\014le)1114 2822 y(then)f(there)h(is)f(nothing)f(to)h(do;)-30
2946 y(84)p eop
%%Page: 85 93
92 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)991
b(20)43 b(FILE)15 b(SYSTEMS)-30 17 y Fi(7423:)21 b Fn(Searc)o(h)16
b(bac)o(kw)o(ards)f(the)g(list)f(of)h(blo)q(c)o(k)f(n)o(um)o(b)q(ers)74
66 y(stored)h(in)f(the)g(\\ino)q(de";)-30 155 y Fi(7425:)21
b Fn(If)16 b(the)h(\014le)f(is)h(large,)f(then)h(an)f(indirect)h(fetc)o(h)g
(is)74 205 y(needed.)i(\(A)12 b(double)f(indirect)h(fetc)o(h)g(is)f(needed)i
(for)74 255 y(blo)q(c)o(ks)h(n)o(um)o(b)q(ered)g(sev)o(en)h(and)e(higher.\);)
-30 343 y Fi(7427:)21 b Fn(Reference)d(all)d Fi(257)h Fn(elemen)o(ts)h(of)f
(the)h(bu\013er)g(in)74 393 y(rev)o(erse)24 b(order.)44 b(\(Note)22
b(this)g(seems)h(to)e(b)q(e)i(the)74 443 y(only)c(place)h(where)h(c)o
(haracters)g(#512,)f(#513)e(of)74 492 y(the)13 b(bu\013er)g(area)f(are)g
(referenced.)20 b(Since)13 b(they)f(will)74 542 y(presumably)f(con)o(tain)h
(zero,)h(they)f(will)f(con)o(tribute)74 592 y(nothing)20 b(to)g(the)h
(calculation.)37 b(Hence)21 b(if)f(\\510")74 642 y(w)o(ere)13
b(substituted)g(for)f(\\512")e(here,)j(and)f(again)f(on)74
692 y(line)20 b(7432,)g(a)g(general)h(impro)o(v)o(emen)o(t)c(all)j(round)74
741 y(w)o(ould)13 b(result)i(\(?\)\);)-30 830 y Fi(7438:)21
b Fn(\\free")j(returns)g(an)g(individual)d(blo)q(c)o(k)i(to)g(the)74
880 y(a)o(v)n(ailable)12 b(list;)-30 968 y Fi(7439:)21 b Fn(This)14
b(is)g(the)g(end)h(of)e(the)i(\\for")e(statemen)o(t)h(com-)74
1018 y(mencing)19 b(on)h(line)f(7427.)35 b(\(Lik)o(ewise)20
b(the)h(state-)74 1068 y(men)o(t)13 b(whic)o(h)h(b)q(egins)g(at)g(7432)f
(ends)i(at)e(7435.\);)-30 1156 y Fi(7443:)21 b Fn(Clear)14
b(the)g(en)o(try)h(in)e(\\i)p 474 1156 13 2 v 14 w(addr[)h(]";)-30
1245 y Fi(7445:)21 b Fn(Reset)14 b(size)f(information,)c(and)k(\015ag)f(the)h
(\\ino)q(de")74 1294 y(as)h(\\up)q(dated".)-30 1418 y Fg(20.14)56
b(free)18 b(\(7000\))-30 1497 y Fn(This)h(pro)q(cedure)h(is)f(called)f(b)o(y)
g(\\itrunc")h(\(7435,)f(7438,)-30 1547 y(7442\))i(to)f(reinsert)j(a)d(simple)
g(storage)h(blo)q(c)o(k)g(in)o(to)f(the)-30 1597 y(a)o(v)n(ailable)12
b(list)i(for)f(a)h(device.)-30 1693 y Fi(7005:)21 b Fn(It)16
b(is)h(not)f(clear)h(wh)o(y)f(the)h(\\s)p 573 1693 V 15 w(fmo)q(d")e(\015ag)g
(is)i(set)74 1743 y(here)j(as)f(w)o(ell)f(as)h(at)f(the)h(end)g(of)g(the)g
(pro)q(cedure)74 1793 y(\(line)14 b(7026\).)j(An)o(y)d(suggestions?)-30
1881 y Fi(7006:)21 b Fn(Observ)o(e)15 b(the)g(lo)q(c)o(king)e(proto)q(col;)
-30 1970 y Fi(7010:)21 b Fn(If)c(no)h(free)h(blo)q(c)o(ks)e(previously)h
(existed)h(for)e(the)74 2020 y(device,)i(restore)g(the)e(situation)g(b)o(y)g
(setting)h(up)f(a)74 2069 y(one)c(elemen)o(t)f(list)g(con)o(taining)g(an)g
(en)o(try)i(for)e(blo)q(c)o(k)74 2119 y(#0.)37 b(This)20 b(v)n(alue)f(will)g
(subsequen)o(tly)j(b)q(e)f(in)o(ter-)74 2169 y(preted)16 b(as)d(an)h(\\end)g
(of)g(list")f(sen)o(tinel;)-30 2257 y Fi(7014:)21 b Fn(If)c(the)h(a)o(v)n
(ailable)d(list)i(in)g(the)h(\\sup)q(er)g(blo)q(c)o(k")f(is)74
2307 y(already)12 b(full,)f(it)h(is)h(time)e(to)h(write)h(it)f(out)g(on)o(to)
g(the)74 2357 y(FSV.)i(Set)g(\\s)p 291 2357 V 15 w(\015o)q(c)o(k";)-30
2445 y Fi(7016:)21 b Fn(Get)14 b(a)g(bu\013er,)g(asso)q(ciated)h(with)e(the)i
(blo)q(c)o(k)e(no)o(w)74 2495 y(b)q(eing)h(en)o(tered)i(in)d(the)i(free)f
(list;)-30 2584 y Fi(7019:)21 b Fn(Cop)o(y)e(the)h(con)o(ten)o(ts)h(of)e(the)
h(sup)q(er)h(blo)q(c)o(k)f(list,)74 2634 y(preceded)h(b)o(y)d(a)f(coun)o(t)i
(of)e(the)i(n)o(um)o(b)q(er)f(of)f(v)n(alid)74 2683 y(blo)q(c)o(ks,)12
b(in)o(to)g(the)g(bu\013er;)h(write)g(the)f(bu\013er;)i(unset)74
2733 y(the)h(lo)q(c)o(k)e(and)h(\\w)o(ak)o(eup")f(an)o(yb)q(o)q(dy)h(w)o
(aiting,)-30 2822 y Fi(7025:)21 b Fn(Add)13 b(the)g(returned)h(blo)q(c)o(k)f
(to)f(the)h(a)o(v)n(ailable)e(list.)1010 17 y Fg(20.15)56 b(iput)18
b(\(7344\))1010 96 y Fn(This)12 b(pro)q(cedure)i(is)e(one)h(of)e(the)i(most)e
(p)q(opular)h(in)g(UNIX)1010 146 y(\(called)k(from)f(nearly)i(thirt)o(y)f
(di\013eren)o(t)h(places\))h(and)e(its)1010 196 y(use)f(will)d(ha)o(v)o(e)i
(already)f(b)q(een)i(frequen)o(tly)f(observ)o(ed.)1072 247
y(In)21 b(essence)i(it)e(simply)d(decremen)o(ts)k(the)g(reference)1010
297 y(coun)o(t)17 b(for)f(the)i(\\ino)q(de")e(passed)i(as)f(a)f(parameter,)h
(and)1010 347 y(then)f(calls)f(\\prele")h(\(7882\))f(to)h(reset)h(the)f
(\\ino)q(de")f(lo)q(c)o(k)1010 397 y(and)f(to)f(p)q(erform)g(an)o(y)h
(necessary)i(\\w)o(ak)o(eup"s.)1072 448 y(\\iput")f(has)h(an)g(imp)q(ortan)o
(t)e(side)i(e\013ect.)25 b(If)15 b(the)i(ref-)1010 498 y(erence)f(coun)o(t)e
(is)g(going)f(to)g(b)q(e)i(reduced)h(to)d(zero,)i(then)f(a)1010
548 y(release)i(of)d(resources)k(is)e(indicated.)20 b(This)14
b(ma)o(y)f(b)q(e)i(sim-)1010 597 y(ply)10 b(the)i(core)f(\\ino)q(de",)g(or)g
(b)q(oth)g(that)g(and)f(the)i(\014le)f(itself,)1010 647 y(if)i(the)h(n)o(um)o
(b)q(er)g(of)f(links)g(is)h(also)f(zero.)1010 772 y Fg(20.16)56
b(ifree)17 b(\(7134\))1010 851 y Fn(This)9 b(pro)q(cedure)i(is)f(called)f(b)o
(y)g(\\iput")g(\(7355\))f(to)i(return)g(a)1010 901 y(FSV)j(\\ino)q(de")f(to)g
(the)h(a)o(v)n(ailable)d(list)i(main)o(tained)e(in)i(the)1010
951 y(\\sup)q(er)17 b(blo)q(c)o(k".)23 b(If)15 b(this)h(list)f(is)h(already)f
(full)g(\(as)h(noted)1010 1001 y(ab)q(o)o(v)o(e\))g(or)g(if)f(the)i(list)e
(is)h(lo)q(c)o(k)o(ed)g(\(using)g(\\s)p 1723 1001 V 15 w(ilo)q(c)o(k"\))f
(the)1010 1050 y(information)c(is)j(simply)d(discarded.)1010
1175 y Fg(20.17)56 b(iup)r(dat)18 b(\(7374\))1010 1254 y Fn(This)10
b(pro)q(cedure)h(is)f(called)g(b)o(y)f(\\statl")g(\(6050\),)h(\\up)q(date")
1010 1304 y(\(7226\))i(and)g(\\iput")g(\(7357\))g(to)h(revise)g(a)g
(particular)f(\\in-)1010 1354 y(o)q(de")18 b(en)o(try)i(on)e(a)g(FSV.)g(It)h
(do)q(es)g(nothing)f(if)g(the)h(cor-)1010 1404 y(resp)q(onding)14
b(core)g(\\ino)q(de")f(is)h(not)f(\015agged)h(\(\\IUPD")f(or)1010
1454 y(\\IA)o(CC"\);)1072 1505 y(The)h(\\IUPD")g(\015ag)f(ma)o(y)f(b)q(e)j
(set)g(b)o(y)e(one)h(of)1053 1604 y Ff(unlink)21 b(\(3530\))173
b(bmap)21 b(\(6452,6467\))1053 1654 y(chmod)43 b(\(3570\))173
b(itrunc)42 b(\(7448\))1053 1704 y(chown)h(\(3583\))173 b(maknode)20
b(\(7462\))1053 1753 y(link)65 b(\(5942\))173 b(namei)64 b(\(7609\))1053
1803 y(writei)21 b(\(6285,6318\))63 b(pipe)86 b(\(7751\))1010
1901 y Fn(The)14 b(\\IA)o(CC")f(\015ag)h(ma)o(y)e(b)q(e)i(set)h(b)o(y)f(one)g
(of)1053 2000 y Ff(readi)43 b(\(6232\))151 b(maknode)21 b(\(7462\))1053
2050 y(writei)g(\(6285\))151 b(pipe)87 b(\(7751\))1072 2147
y Fn(The)14 b(\015ags)g(are)h(reset)g(b)o(y)f(\\iput")f(\(7359\).)1010
2245 y Fi(7383:)20 b Fn(F)m(orget)d(it,)g(if)e(the)j(FSV)f(has)g(b)q(een)g
(moun)o(ted)f(as)1114 2294 y(\\read)e(only";)1010 2384 y Fi(7386:)20
b Fn(Read)e(the)h(appropriate)f(blo)q(c)o(k)g(con)o(taining)e(the)1114
2434 y(FSV)f(\\ino)q(de")f(en)o(try)m(.)21 b(As)15 b(observ)o(ed)h(earlier)f
(with)1114 2483 y(resp)q(ect)g(to)e(\\iget",)f(note)h(the)h(the)g(use)g(of)e
(\\bread")1114 2533 y(instead)19 b(of)f(\\readi",)h(the)h(assumption)d(that)i
(the)1114 2583 y(\\ino)q(de")10 b(table)g(b)q(egins)h(at)g(blo)q(c)o(k)f(#2)g
(and)h(the)g(con-)1114 2633 y(v)o(en)o(tion)k(that)h(v)n(alid)e(\\ino)q(de")h
(n)o(um)o(b)q(ers)g(b)q(egin)h(at)1114 2683 y(one;)1010 2772
y Fi(7389:)k Fn(Cop)o(y)11 b(the)i(relev)n(an)o(t)e(information)e(from)h(the)
i(core)1114 2822 y(\\ino)q(de";)1890 2946 y(85)p eop
%%Page: 86 94
93 bop -30 -144 a Fk(20)43 b(FILE)15 b(SYSTEMS)993 b(UNIX)14
b(6th)h(Edition)g(Commentary)-30 17 y Fi(7391:)21 b Fn(If)d(appropriate,)g
(up)q(date)h(the)g(time)d(of)i(last)g(ac-)74 66 y(cess;)-30
149 y Fi(7396:)j Fn(If)12 b(appropriate,)g(up)q(date)h(the)g(time)e(of)h
(last)g(mo)q(d-)74 199 y(i\014cation;)-30 282 y Fi(7400:)21
b Fn(W)m(rite)13 b(the)i(up)q(dated)f(blo)q(c)o(k)g(bac)o(k)g(to)g(the)g
(FSV.)-30 2946 y(86)p eop
%%Page: 87 95
94 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)1175
b(21)43 b(PIPES)-30 17 y Fj(21)70 b(Pip)r(es)-30 109 y Fn(A)11
b(\\pip)q(e")f(is)g(a)g(FIF)o(O)h(c)o(haracter)h(list,)e(whic)o(h)g(is)g
(managed)-30 159 y(b)o(y)k(UNIX)g(as)g(y)o(et)h(another)f(v)n(ariet)o(y)f(of)
g(\014le.)33 209 y(One)26 b(group)g(of)f(pro)q(cesses)k(ma)o(y)24
b(\\write")i(in)o(to)f(a)-30 259 y(\\pip)q(e")d(and)g(another)h(group)f(ma)o
(y)e(\\read")j(from)d(the)-30 309 y(same)13 b(\\pip)q(e".)k(Hence)e(\\pip)q
(e"s)f(ma)o(y)d(b)q(e,)i(and)h(are)f(used,)-30 358 y(primarily)f(for)h(in)o
(terpro)q(cess)j(comm)o(unication.)33 409 y(By)j(exploiting)f(the)i(concept)g
(of)f(a)g(\\\014lter",)h(whic)o(h)-30 459 y(is)d(a)g(program)f(whic)o(h)h
(reads)h(an)e(input)h(\014le)g(and)g(trans-)-30 509 y(forms)f(it)g(in)o(to)g
(an)h(output)g(\014le,)g(and)g(b)o(y)f(using)h(\\pip)q(es")-30
558 y(to)c(link)f(t)o(w)o(o)g(or)h(more)e(programs)h(of)g(this)h(t)o(yp)q(e)g
(together,)-30 608 y(UNIX)i(o\013ers)h(its)e(users)i(a)e(surprisingly)g
(comprehensiv)o(e)-30 658 y(and)g(sophisticated)h(set)g(of)e(facilities.)-30
778 y Fg(21.1)56 b(pip)r(e)18 b(\(7723\))-30 855 y Fn(A)e(\\pip)q(e")f(is)g
(created)i(as)e(a)g(result)h(of)f(a)g(system)g(call)g(on)-30
905 y(the)g(\\pip)q(e")f(pro)q(cedure.)-30 999 y Fi(7728:)21
b Fn(Allo)q(cate)14 b(an)f(\\ino)q(de")h(for)f(the)i(ro)q(ot)f(device;)-30
1085 y Fi(7731:)21 b Fn(Allo)q(cate)14 b(a)f(\\\014le")h(table)f(en)o(try;)
-30 1170 y Fi(7736:)21 b Fn(Remem)o(b)q(er)12 b(the)j(\\\014le")f(table)g(en)
o(try)h(as)f(\\r")g(and)74 1220 y(allo)q(cate)g(a)f(second)i(\\\014le")f
(table)f(en)o(try;)-30 1306 y Fi(7744:)21 b Fn(Return)10 b(user)h(\014le)f
(iden)o(ti\014cations)g(in)f(R0)g(and)h(R1;)-30 1391 y Fi(7746:)21
b Fn(Complete)12 b(the)i(en)o(tries)h(in)e(the)h(\\\014le")f(arra)o(y)g(and)
74 1441 y(the)i(\\ino)q(de")e(en)o(try)m(.)-30 1560 y Fg(21.2)56
b(readp)19 b(\(7758\))-30 1638 y Fn(\\pip)q(es")10 b(are)g(di\013eren)o(t)h
(from)c(other)j(\014les)g(in)f(that)h(t)o(w)o(o)f(sep-)-30
1688 y(arate)16 b(o\013sets)g(in)o(to)e(the)i(\014le)f(are)g(k)o(ept)g({)g
(one)g(for)g(\\read")-30 1738 y(op)q(erations)22 b(and)g(one)f(for)h
(\\write")f(op)q(erations.)41 b(The)-30 1788 y(\\write")14
b(o\013set)h(is)f(actually)f(the)h(same)f(as)h(the)h(\014le)f(size.)-30
1882 y Fi(7763:)21 b Fn(the)11 b(parameter)f(passed)i(to)e(\\readp")h(is)f(a)
g(p)q(oin)o(ter)74 1931 y(to)i(a)g(\\\014le")f(arra)o(y)h(en)o(try)m(,)g
(from)e(whic)o(h)i(an)f(\\ino)q(de")74 1981 y(p)q(oin)o(ter)j(can)g(b)q(e)h
(extracted;)-30 2067 y Fi(7768:)21 b Fn(\\plo)q(c)o(k")16 b(\(7862\))f
(ensures)k(that)d(only)g(one)g(op)q(er-)74 2117 y(ation)f(tak)o(es)h(place)g
(at)f(a)g(time:)20 b(either)c(\\read")g(or)74 2166 y(\\write";)-30
2252 y Fi(7776:)21 b Fn(If)12 b(a)g(pro)q(cess)i(wishing)e(to)g(write)g(to)h
(a)f(\\pip)q(e")g(has)74 2302 y(b)q(een)k(blo)q(c)o(k)o(ed)f(b)q(ecause)h
(the)g(pip)q(e)f(w)o(as)g(\\full")e(\(or)74 2352 y(rather)18
b(b)q(ecause)h(the)e(v)n(alid)f(part)h(of)f(the)i(\014le)f(had)74
2401 y(reac)o(hed)c(the)f(\014le)f(limit\),)e(it)i(will)f(ha)o(v)o(e)h
(signi\014ed)g(its)74 2451 y(predicamen)o(t)g(b)o(y)h(setting)g(the)g
(\\IWRITE")e(\015ag)h(in)74 2501 y(\\ip-)p Fh(>)p Fn(i)p 190
2501 13 2 v 14 w(mo)q(de";)-30 2587 y Fi(7786:)21 b Fn(Release)14
b(the)h(lo)q(c)o(k)e(b)q(efore)i(going)e(to)g(sleep;)-30 2672
y Fi(7787:)21 b Fn(\\i)p 135 2672 V 14 w(coun)o(t")15 b(is)g(the)h(n)o(um)o
(b)q(er)e(of)h(\014le)g(table)g(en)o(tries)74 2722 y(p)q(oin)o(ting)i(at)g
(the)i(\\ino)q(de".)29 b(If)17 b(this)h(is)f(less)i(than)74
2772 y(t)o(w)o(o,)14 b(then)g(the)h(group)f(of)g(\\writers")h(m)o(ust)e(b)q
(e)i(ex-)74 2822 y(tinct;)1010 17 y Fi(7789:)20 b Fn(A)h(pro)q(cess)i(w)o
(aiting)c(for)i(input)f(will)f(raise)i(the)1114 66 y(\\IREAD")d(\015ag.)32
b(Since)20 b(a)e(pip)q(e)i(cannot)f(b)q(e)g(full)1114 116 y(and)13
b(empt)o(y)g(sim)o(ultaneously)m(,)e(no)i(more)g(than)h(one)1114
166 y(of)j(the)i(\015aqs)f(\\IWRITE")f(or)h(\\IREAD")f(should)1114
216 y(b)q(e)d(set)h(at)f(an)o(y)f(one)h(time;)1010 299 y Fi(7799:)20
b Fn(\\prele")14 b(unlo)q(c)o(ks)f(the)h(\014le)f(and)g(\\w)o(ak)o(es)g(up")h
(an)o(y)1114 349 y(pro)q(cess)h(w)o(aiting)e(for)g(the)i(pip)q(e.)1010
465 y Fg(21.3)56 b(writep)18 b(\(7805\))1010 542 y Fn(The)26
b(structure)i(of)e(this)f(pro)q(cedure)j(ec)o(ho)q(es)g(that)e(of)1010
591 y(\\readp")14 b(in)f(man)o(y)f(resp)q(ects.)1010 683 y
Fi(7828:)20 b Fn(Note)13 b(that)g(a)f(\\writer",)h(whic)o(h)f(\014nds)h(that)
g(there)1114 733 y(are)f(no)f(more)g(\\readers")i(left,)e(receiv)o(es)i(a)f
(\\signal")1114 782 y(just)h(in)g(case)h(he)g(is)g(not)f(monitoring)e(the)j
(result)g(of)1114 832 y(his)f(\\write")h(op)q(eration.)1114
899 y(\(A)23 b(\\reader")g(in)g(the)h(analogous)d(situation)i(re-)1114
948 y(ceiv)o(es)16 b(a)f(zero)h(c)o(haracter)g(coun)o(t)g(as)f(the)h(result)g
(of)1114 998 y(the)g(read,)h(and)f(this)g(is)f(the)i(standard)f
(end-of-\014le)1114 1048 y(indication.\))1010 1131 y Fi(7835:)k
Fn(The)e(\\pip)q(e")e(size)i(is)f(not)g(allo)o(w)o(ed)e(to)i(gro)o(w)g(b)q
(e-)1114 1181 y(y)o(ond)d(\\PIPSIZ")g(c)o(haracters.)21 b(As)15
b(long)f(as)g(\\PIP-)1114 1231 y(SIZ")i(\(7715\))g(is)g(no)g(greater)h(than)g
(4096,)e(the)i(\014le)1114 1280 y(will)10 b(not)j(b)q(e)f(con)o(v)o(erted)i
(to)e(a)g(\\large")g(\014le.)17 b(This)12 b(is)1114 1330 y(highly)h
(desirable)h(from)f(the)i(viewp)q(oin)o(t)f(of)f(access)1114
1380 y(e\016ciency)m(.)1114 1447 y(\(Note)f(that)h(\\PIPSIZ")f(limits)e(the)j
(\\write")f(o\013set)1114 1496 y(p)q(oin)o(ter)k(v)n(alue.)25
b(If)17 b(the)g(\\read")f(o\013set)i(p)q(oin)o(ter)e(is)1114
1546 y(not)c(far)g(b)q(ehind,)g(the)h(true)g(con)o(ten)o(t)g(of)f(the)g
(\\pip)q(e")1114 1596 y(ma)o(y)g(b)q(e)i(quite)g(small\).)1010
1712 y Fg(21.4)56 b(plo)r(c)n(k)17 b(\(7862\))1010 1789 y Fn(Lo)q(c)o(k)h
(the)g(\\ino)q(de")f(after)h(w)o(aiting)f(if)g(necessary)m(.)31
b(This)1010 1839 y(pro)q(cedure)14 b(is)e(called)g(b)o(y)g(\\readp")g
(\(7768\))f(and)h(\\writep")1010 1888 y(\(7815\).)1010 2005
y Fg(21.5)56 b(prele)17 b(\(7882\))1010 2081 y Fn(Unlo)q(c)o(k)h(the)h(\\ino)
q(de")f(and)g(\\w)o(ak)o(e")g(an)o(y)g(w)o(aiting)f(pro-)1010
2131 y(cesses.)44 b(This)22 b(pro)q(cedure)i(is)e(called)f(b)o(y)h(sev)o
(eral)g(oth-)1010 2181 y(ers)16 b(\(esp)q(ecially)g(\\iput"\),)e(in)h
(addition)f(to)h(\\readp")g(and)1010 2231 y(\\writep".)1890
2946 y(87)p eop
%%Page: 88 96
95 bop -30 -144 a Fk(22)43 b(CHARA)o(CTER)15 b(ORIENTED)g(SPECIAL)g(FILES)457
b(UNIX)14 b(6th)h(Edition)g(Commentary)33 17 y Fe(Section)d(Five)g(is)f(the)h
(\014nal)g(section:)18 b(last)11 b(but)h(not)g(least.)-30 66
y(It)f(is)g(concerned)k(with)d(input/output)h(fo)o(r)e(the)h(slo)o(w)o(er,)g
(cha)o(r-)-30 116 y(acter)j(o)o(riented)h(p)q(eripheral)g(deviees.)33
166 y(Such)h(devices)g(sha)o(re)g(a)f(common)e(bu\013er)j(p)q(o)q(ol,)f
(which)-30 216 y(is)e(manipulated)h(b)o(y)f(a)g(set)g(of)f(standa)o(rd)i(p)o
(ro)q(cedures.)33 266 y(The)21 b(set)f(of)f(cha)o(racter)i(o)o(riented)h(p)q
(eripheral)g(devices)-30 316 y(a)o(re)15 b(exempli\014ed)g(b)o(y)f(the)h
(follo)o(wing:)33 388 y Fl(\017)20 b Fe(KL/DL11)14 b(interactive)i(terminal)
33 464 y Fl(\017)k Fe(PC11)13 b(pap)q(er)i(tap)q(e)g(reader/punch)33
539 y Fl(\017)20 b Fe(LP11)14 b(line)g(p)o(rinter.)-30 673
y Fj(22)70 b(Character)44 b(Orien)n(ted)e(Sp)r(e-)108 748 y(cial)21
b(Files)-30 839 y Fn(Character)14 b(orien)o(ted)e(p)q(eripheral)h(devices)g
(are)f(relativ)o(ely)-30 889 y(slo)o(w)20 b(\()p Fh(<)h Fn(1000)e(c)o
(haraeters)j(p)q(er)f(second\))g(and)f(in)o(v)o(olv)o(e)-30
938 y(c)o(haracter)30 b(b)o(y)e(c)o(haracter)h(transmission)e(of)h(v)n
(ariable)-30 988 y(length,)14 b(usually)f(short,)h(records.)33
1038 y(A)j(device)h(handler)f(\(as)g(its)g(name)f(suggests\))i(is)f(the)-30
1088 y(soft)o(w)o(are)d(part)f(of)f(the)i(in)o(terface)g(b)q(et)o(w)o(een)g
(a)f(device)h(and)-30 1138 y(the)i(general)g(system.)22 b(In)15
b(general,)h(the)f(device)i(handler)-30 1187 y(is)11 b(the)h(only)e(part)i
(of)e(the)i(soft)o(w)o(are)f(whic)o(h)g(recognises)h(the)-30
1237 y(idiosyncrasies)j(of)e(a)h(particular)f(device.)33 1287
y(As)h(far)f(as)h(p)q(ossible)g(or)g(reasonable,)g(a)f(single)h(device)-30
1337 y(driv)o(er)h(is)g(written)g(to)g(serv)o(e)h(man)o(y)d(separate)i
(devices)h(of)-30 1387 y(similar)c(t)o(yp)q(es,)i(and,)f(where)i
(appropriate,)f(sev)o(eral)g(suc)o(h)-30 1436 y(devices)19
b(sim)o(ultaneously)m(.)25 b(The)18 b(group)f(of)g(\\in)o(teractiv)o(e)-30
1486 y(terminals")8 b(\(with)i(k)o(eyb)q(oard)f(input)g(and)h(a)f(serial)g
(prin)o(ter)-30 1536 y(or)16 b(visual)f(displa)o(y)f(output\))i(can)g(just)g
(b)q(e)g(co)q(erced)i(with)-30 1586 y(di\016cult)o(y)e(in)o(to)g(a)g(single)g
(device)h(driv)o(er,)g(as)f(the)h(reader)-30 1636 y(ma)o(y)12
b(judge)i(during)g(his)g(p)q(erusal)g(of)f(the)i(\014le)f(\\tt)o(y)m(.c".)33
1686 y(The)f(standard)g(UNIX)g(device)g(handlers)g(for)f(c)o(harac-)-30
1735 y(ter)k(devices)f(mak)o(e)e(use)i(of)f(the)h(pro)q(cedures)h(\\putc")f
(and)-30 1785 y(\\getc")e(whic)o(h)g(store)h(and)e(retriev)o(e)i(c)o
(haracters)h(in)o(to)d(and)-30 1835 y(from)f(a)h(standard)h(bu\013er)g(p)q(o)
q(ol.)k(This)12 b(will)f(b)q(e)i(describ)q(ed)-30 1885 y(in)h(more)f(detail)g
(in)h(Chapter)g(Tw)o(en)o(t)o(y-Three.)33 1935 y(The)f(\\PDP11)g(P)o
(eripherals)h(Handb)q(o)q(ok")f(should)g(b)q(e)-30 1984 y(consulted)24
b(for)f(more)e(complete)i(information)c(on)k(the)-30 2034 y(device)d(con)o
(troller)e(hardw)o(are)h(and)g(the)g(devices)h(them-)-30 2084
y(selv)o(es.)-30 2197 y Fg(22.1)56 b(LP11)19 b(Line)e(Prin)n(ter)i(Driv)n(er)
-30 2274 y Fn(This)c(driv)o(er)f(is)g(to)g(b)q(e)h(found)e(in)h(the)h(\014le)
f(\\lp.c")f(\(Sheets)-30 2323 y(88,)18 b(89\).)30 b(Muc)o(h)18
b(of)g(the)g(complexit)o(y)e(of)i(this)g(driv)o(er)g(is)-30
2373 y(con)o(tained)c(in)f(the)h(pro)q(eedure)h(\\lp)q(canon")e(\(8879\).)k
(This)-30 2423 y(pro)q(cedure)d(is)d(in)o(v)o(olv)o(ed)f(in)h(the)h(prop)q
(er)h(handling)d(of)h(sp)q(e-)-30 2473 y(cial)h(c)o(haracters)j(and)e(this)f
(is)h(a)g(separate)h(issue)f(from)e(the)-30 2523 y(one)k(w)o(e)f(wish)f(to)h
(study)h(\014rst.)33 2573 y(Initially)i(one)i(ma)o(y)e(ignore)i(\\lp)q
(canon")g(b)o(y)g(assum-)-30 2622 y(ing)f(that)g(all)e(calls)i(up)q(on)g(it)g
(\(lines)g(8859,)f(8865,)h(8875\))-30 2672 y(are)i(simply)c(replaced)k(b)o(y)
e(similar)e(calls)j(up)q(on)f(\\lp)q(out-)-30 2722 y(put")f(\(8986\).)26
b(\\lp)q(canon")16 b(acts)h(as)g(a)f(\\\014nal)g(\014lter")h(for)-30
2772 y(c)o(haracters)g(going)c(to)i(the)g(line)f(prin)o(ter:)20
b(handling)14 b(co)q(de)-30 2822 y(con)o(v)o(ersions,)h(sp)q(ecial)f(format)e
(c)o(haracters,)j(etc.)1010 17 y Fg(22.2)56 b(lp)r(op)r(en)17
b(\(8850\))1010 93 y Fn(When)d(a)f(line)h(prin)o(ter)g(\014le)g(is)g(op)q
(ened,)g(the)g(normal)e(call-)1010 143 y(ing)h(sequence)j(is)e(follo)o(w)o
(ed:)1072 193 y(\\op)q(en")f(\(5774\))f(calls)h(\\op)q(en1",)f(whic)o(h)h
(\(5832\))f(calls)1010 243 y(\\op)q(eni",)k(whic)o(h)g(\(6716\))g(calls,)g
(in)g(the)h(case)g(of)f(a)g(c)o(har-)1010 293 y(acter)i(sp)q(ecial)f(\014le,)
g(\\cdevsw[..].d)p 1570 293 13 2 v 14 w(op)q(en".)27 b(In)17
b(the)g(case)1010 342 y(of)f(the)i(line)e(prin)o(ter,)i(this)f(latter)g
(translates)h(\(4675\))e(to)1010 392 y(\\lp)q(op)q(en".)1010
478 y Fi(8853:)k Fn(T)m(ak)o(e)j(the)g(error)h(exit)f(if)f(either)i(another)g
(line)1114 528 y(prin)o(ter)h(\014le)f(is)h(already)f(op)q(en,)j(or)e(if)e
(the)j(line)1114 578 y(prin)o(ter)17 b(is)g(not)g(ready)g(\(e.g)g(the)g(p)q
(o)o(w)o(er)g(is)g(o\013,)g(or)1114 628 y(there)d(is)g(no)f(pap)q(er,)g(or)h
(the)g(prin)o(ter)g(drum)e(gate)h(is)1114 677 y(op)q(en,)j(or)h(the)f(temp)q
(erature)h(is)g(to)q(o)f(high,)f(or)h(the)1114 727 y(op)q(erator)e(has)g
(switc)o(hed)h(the)f(prin)o(ter)h(o\013-line.\))1010 808 y
Fi(8857:)20 b Fn(Set)e(the)f(\\lp11.\015ag")d(to)j(indicate)f(that)h(the)g
(\014le)1114 858 y(is)f(op)q(en,)i(the)f(prin)o(ter)g(has)g(a)f(\\form)f
(feed")i(capa-)1114 908 y(bilit)o(y)g(and)i(lines)g(are)g(to)g(b)q(e)h(inden)
o(ted)g(b)o(y)e(eigh)o(t)1114 957 y(c)o(haracters.)1010 1073
y Fg(22.3)56 b(Notes)1010 1149 y Fi(\(a\))20 b Fn(\\lp11")e(is)i(a)f(sev)o
(en)i(w)o(ord)f(structure)i(de\014ned)f(b)q(e-)1114 1199 y(ginning)c(at)i
(line)f(8829.)33 b(The)19 b(\014rst)h(three)g(w)o(ords)1114
1249 y(of)13 b(the)h(structure)h(in)f(fact)f(constitute)i(a)e(structure)1114
1299 y(of)g(t)o(yp)q(e)i(\\clist")f(\(7908\).)k(Only)c(the)h(\014rst)g
(elemen)o(t)1114 1349 y(is)f(explicitly)g(manipulated)f(in)h(\\lp.c".)19
b(The)d(next)1114 1398 y(t)o(w)o(o)11 b(are)i(used)g(implicitly)c(b)o(y)j
(\\putc")g(and)g(\\getc".)1010 1479 y Fi(\(b\))19 b Fn(\\\015ag")e(is)h(the)h
(fourth)f(elemen)o(t)g(of)g(the)g(structure.)1114 1529 y(The)c(remaining)e
(three)j(elemen)o(ts)f(are)1139 1641 y(\\mcc")48 b(maxim)o(um)9
b(c)o(haracter)15 b(coun)o(t)1139 1691 y(\\ccc")66 b(curren)o(t)16
b(c)o(haracter)f(coun)o(t)1139 1741 y(\\mlc")54 b(maxim)o(um)9
b(line)k(coun)o(t)1010 1868 y Fi(\(c\))20 b Fn(The)13 b(line)g(prin)o(ter)h
(con)o(troller)f(has)g(t)o(w)o(o)g(registers)h(on)1114 1918
y(the)g(UNIBUS.)1010 2004 y Fg(Line)j(Prin)n(ter)i(Status)g(Register)e
(\(\\lpsr"\))1010 2090 y Fi(bit)d(15)21 b Fn(Set)26 b(when)h(an)f(error)h
(condition)e(exists)i(\(see)1114 2139 y(ab)q(o)o(v)o(e\);)1010
2220 y Fi(bit)14 b(7)i(\\DONE")21 b Fn(Set)13 b(when)g(the)g(prin)o(ter)g
(con)o(troller)f(is)1114 2270 y(ready)i(to)g(receiv)o(e)h(the)f(next)h(c)o
(haracter;)1010 2351 y Fi(bit)f(6)i(\\IENABLE")22 b Fn(Set)10
b(to)g(allo)o(w)f(\\DONE")h(or)g(\\Er-)1114 2401 y(ror")j(to)h(cause)h(an)f
(in)o(terrupt;)1010 2487 y Fg(Line)d(Prin)n(ter)h(Data)h(Bu\013er)f(Register)
e(\(\\lp-)1010 2536 y(buf)5 b("\))1072 2586 y Fn(Bits)14 b(6)f(through)g(0)g
(hold)g(the)h(sev)o(en)h(bit)e(ASCI)q(I)g(co)q(de)1010 2636
y(for)20 b(the)h(c)o(haracter)h(to)f(b)q(e)g(prin)o(ted.)38
b(This)20 b(register)i(is)1010 2686 y(\\write)14 b(only".)1010
2772 y Fi(8858:)20 b Fn(Set)g(the)g(\\enable)f(in)o(terrupts")h(bit)e(in)h
(the)h(line)1114 2822 y(prin)o(ter)14 b(status)h(register;)-30
2946 y(88)p eop
%%Page: 89 97
96 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)456
b(22)43 b(CHARA)o(CTER)14 b(ORIENTED)h(SPECIAL)g(FILES)-30
17 y Fi(8859:)21 b Fn(Send)13 b(a)g(\\form)e(feed")i(\(or)g(\\new)g(page"\))f
(c)o(harac-)74 66 y(ter)19 b(to)e(the)i(prin)o(ter,)f(to)g(ensure)h(that)f(c)
o(haracters)74 116 y(whic)o(h)12 b(follo)o(w)f(will)g(start)h(on)h(a)f(new)g
(page.)18 b(\(As)13 b(al-)74 166 y(ready)f(noted)h(ab)q(o)o(v)o(e,)e(at)h
(this)g(stage)g(w)o(e)g(are)h(ignor-)74 216 y(ing)j(\\lp)q(canon")h(and)f
(assuming)g(line)g(8859)g(to)h(b)q(e)74 266 y(simply)e(\\lp)q(output)h(\(F)o
(ORM\)".)f(\\lp)q(canon")h(do)q(es)74 316 y(things)e(lik)o(e)f(suppressing)i
(all)d(but)i(the)g(\014rst)h(\\form)74 365 y(feed")20 b(in)g(a)f(string)h(of)
f(\\form)f(feed"s)i(and)f(\\new)74 415 y(line"s,)13 b(to)h(a)o(v)o(oid)f(w)o
(asting)g(pap)q(er.\);)-30 530 y Fg(22.4)56 b(lp)r(output)18
b(\(8986\))-30 606 y Fn(This)23 b(pro)q(cedure)i(is)d(called)h(with)f(a)g(c)o
(haracter)j(to)d(b)q(e)-30 656 y(prin)o(ted,)14 b(as)g(a)g(parameter.)-30
737 y Fi(8988:)21 b Fn(\\lp11.cc")14 b(is)i(a)f(coun)o(t)h(of)f(the)h(n)o(um)
o(b)q(er)f(of)g(c)o(har-)74 787 y(acters)j(w)o(aiting)d(to)i(b)q(e)g(sen)o(t)
g(to)f(the)i(line)e(prin)o(ter.)74 837 y(If)g(this)g(is)f(already)h(large)g
(enough)g(\(\\LPHW)-5 b(A)m(T",)74 887 y(8819\),)14 b(\\sleep")i(for)e(a)h
(while)g(\(so)g(as)g(not)g(to)g(\015o)q(o)q(d)74 937 y(the)g(c)o(haracter)g
(bu\013er)g(p)q(o)q(ol\);)-30 1015 y Fi(8990:)21 b Fn(Call)g(\\putc")g
(\(0967\))h(to)f(store)i(the)f(c)o(haracter)74 1065 y(in)i(a)h(safe)g(place.)
50 b(\(The)25 b(function)f(of)h(\\putc")74 1115 y(and)14 b(its)g(companion)e
(\\getc")j(is)f(a)f(ma)r(jor)g(topic)h(to)74 1165 y(b)q(e)19
b(discussed)i(in)d(Chapter)h(Tw)o(en)o(t)o(y)f(Three.\))34
b(It)74 1215 y(should)17 b(b)q(e)h(noted)f(that)h(no)f(c)o(hec)o(k)h(is)f
(made)f(that)74 1265 y(\\putc")i(w)o(as)g(successful)i(in)d(storing)h(the)g
(c)o(harac-)74 1314 y(ter.)32 b(\(There)19 b(ma)o(y)d(ha)o(v)o(e)i(b)q(een)h
(no)f(space)h(in)f(the)74 1364 y(c)o(haracter)d(bu\013ers.\))20
b(In)13 b(practice)i(there)g(seems)f(to)74 1414 y(b)q(e)f(no)g(real)f
(problem)f(here,)j(but)e(one)h(can)g(w)o(onder.)-30 1493 y
Fi(8991:)21 b Fn(Raise)f(the)h(pro)q(cessor)h(priorit)o(y)e(su\016cien)o(tly)
g(to)74 1543 y(inhibit)f(the)i(in)o(terrupts)g(from)d(the)i(line)g(prin)o
(ter,)74 1593 y(call)28 b(\\lpstart")g(and)g(then)g(drop)h(the)f(priorit)o(y)
74 1642 y(again.)-30 1757 y Fg(22.5)56 b(lpstart)18 b(\(8967\))-30
1834 y Fn(While)13 b(the)i(line)e(prin)o(ter)h(is)f(ready)m(,)h(and)f(while)g
(there)i(are)-30 1883 y(still)10 b(c)o(haracters)i(stored)f(a)o(w)o(a)o(y)e
(in)h(the)h(\\safe)g(place",)f(k)o(eep)-30 1933 y(sending)15
b(c)o(haracters)g(to)f(the)g(prin)o(ter)h(con)o(troller.)33
1983 y(The)g(presumption)g(is)f(that)i(while)e(the)i(con)o(troller)f(is)-30
2033 y(building)f(up)g(a)g(set)i(of)e(c)o(haracters)i(for)e(a)h(complete)f
(line,)-30 2083 y(the)i(\\DONE")f(bit)g(will)f(reset)i(faster)g(than)f(the)h
(CP)f(can)-30 2132 y(feed)g(c)o(haracters)h(to)d(the)i(con)o(troller.)33
2182 y(Ho)o(w)o(ev)o(er)i(once)h(a)e(prin)o(t)h(cycle)h(has)f(b)q(een)h
(initiated,)-30 2232 y(the)12 b(\\DONE")f(bit)g(will)f(not)h(b)q(e)h(reset)h
(again)d(for)h(a)g(p)q(erio)q(d)-30 2282 y(of)k(the)g(order)h(of)e(100)h
(milli)o(seconds)f(\(dep)q(ending)h(on)g(the)-30 2332 y(sp)q(eed)h(of)d(the)i
(prin)o(ter\).)33 2381 y(Note)k(that)g(during)g(this)g(series)h(of)e(data)h
(transfers,)-30 2431 y(in)o(terrupts)e(will)c(b)q(e)j(inhiblted)e(and)h(so)g
(\\lpin)o(t")e(will)h(not)-30 2481 y(b)q(e)j(getting)f(in)o(to)f(the)h(act)g
(whenev)o(er)i(the)e(\\DONE")g(bit)-30 2531 y(is)i(set,)g(except)h(p)q
(ossibly)e(once)h(at)g(the)g(v)o(ery)f(end)h(when)-30 2581
y(the)d(pro)q(cessor)h(priorit)o(y)d(is)h(reduced)h(again.)-30
2695 y Fg(22.6)56 b(lpinit\(8976\))-30 2772 y Fn(This)16 b(pro)q(cedure)i(is)
d(called)h(to)f(handle)h(in)o(terrupts)g(from)-30 2822 y(the)g(line)e(prin)o
(ter.)21 b(As)15 b(men)o(tioned)f(ab)q(o)o(v)o(e,)g(most)f(p)q(oten-)1010
17 y(tial)g(in)o(terrupts)i(are)g(ignored)e(b)o(y)h(the)h(pro)q(cessor.)20
b(Those)1010 66 y(in)o(terrupts)h(whic)o(h)e(are)i(accepted)g(b)o(y)f(the)g
(CP)g(will)e(b)q(e)1010 116 y(asso)q(ciated)c(with)g(either)1010
209 y Fi(\(a\))20 b Fn(completion)12 b(of)h(a)h(prin)o(t)g(cycle;)g(or)1010
294 y Fi(\(b\))19 b Fn(the)f(prin)o(ter)g(going)e(ready)h(after)h(a)f(p)q
(erio)q(d)g(during)1114 344 y(whic)o(h)c(the)i(\\Error")f(bit)g(w)o(as)f
(set;)i(or)1010 429 y Fi(\(c\))20 b Fn(the)c(last)e(transfer)i(in)f(a)g
(series)h(of)e(c)o(haracter)j(trans-)1114 479 y(fers;)1010
572 y Fi(8980:)j Fn(Start)11 b(transferring)g(c)o(haracters)i(in)o(to)c(the)i
(prin)o(ter)1114 621 y(bu\013er)k(again;)1010 706 y Fi(8981:)20
b Fn(W)m(ak)o(eup)14 b(the)h(pro)q(cess)h(w)o(aiting)d(to)h(feed)h(c)o
(harac-)1114 756 y(ters)e(to)f(the)g(prin)o(ter)h(if)e(the)i(n)o(um)o(b)q(er)
e(of)g(c)o(haracters)1114 806 y(w)o(aiting)18 b(to)i(b)q(e)h(sen)o(t)g(is)f
(either)h(zero)g(or)f(exactly)1114 856 y(\\LPL)-5 b(W)g(A)m(T")13
b(\(8818\).)1072 949 y(This)20 b(latter)g(condition)f(is)g(somewhat)g
(puzzling)h(in)1010 999 y(that)13 b(it)f(will)g(only)g Fi(o)q(ccasionally)f
Fn(b)q(e)i(satis\014ed.)18 b(The)c(in-)1010 1048 y(ten)o(tion)e(surely)g(is)g
(\\if)f(the)i(n)o(um)o(b)q(er)f(of)f(c)o(haracters)j(in)d(the)1010
1098 y(list)k(is)h(getting)g(lo)o(w,)f(start)i(re\014lling".)23
b(Ho)o(w)o(ev)o(er)17 b(if)e(\\lp-)1010 1148 y(start")d(carries)g(out)f(a)g
(series)i(of)d(transfers)j(without)e(in)o(ter-)1010 1198 y(ruption)i(\(at)g
(least)h(b)o(y)f(\\lpin)o(t"\))f(the)i(n)o(um)o(b)q(er)f(of)g(c)o(harac-)1010
1248 y(ters)g(could)f(go)f(from)f(a)h(v)n(alue)h(greater)h(than)e(\\LPL)-5
b(W)g(A)m(T")1010 1298 y(to)18 b(one)g(less)h(than)f(this)g(without)g(this)g
(test)h(ev)o(er)g(b)q(eing)1010 1347 y(made.)g(Accordingly)14
b(the)h(w)o(aiting)e(pro)q(cess)k(will)c(not)h(b)q(e)1010 1397
y(a)o(w)o(ak)o(ened)j(un)o(til)g(the)i(list)e(is)g(completely)g(empt)o(y)m(.)
28 b(The)1010 1447 y(result)14 b(could)g(b)q(e)g(frequen)o(tly)g(to)g(dela)o
(y)f(the)h(initiation)e(of)1010 1497 y(the)h(next)h(prin)o(t)e(cycle,)h(and)g
(hence)h(to)f(allo)o(w)e(the)i(prin)o(ter)1010 1547 y(to)h(run)g(b)q(elo)o(w)
f(its)h(rated)h(capacit)o(y)m(.)1072 1597 y(One)k(solution)f(to)g(this)g
(problem)g(is)g(to)g(c)o(hange)h(en-)1010 1647 y(tirely)h(the)i(bu\013ering)f
(strategy)g(for)g(line)f(prin)o(ters.)40 b(A)1010 1697 y(less)18
b(drastic)g(c)o(hange)g(w)o(ould)e(in)o(v)o(olv)o(e)g(in)o(v)o(en)o(ting)h(a)
g(new)1010 1746 y(\015ag,)12 b(\\lp11.w\015ag")e(sa)o(y)m(,)i(replacing)h
(lines)f(8981,)g(8982)f(b)o(y)1010 1796 y(something)h(lik)o(e)1053
1890 y Ff(if)22 b(\(lp11.cc)e(<=)h(LPLWAT)g(&&)g(lp11.wflag\))1053
1940 y({)153 b(wakeup)20 b(\(&lp11\);)1228 1989 y(lp11.wflag)f(=)j(0)1053
2039 y(})1010 2132 y Fn(and)14 b(replacing)f(line)h(8989)f(b)o(y)1053
2226 y Ff({)153 b(lp11.wflag++;)1228 2276 y(sleep\(&lp11,)19
b(LPRI\);)1053 2326 y(})1010 2444 y Fg(22.7)56 b(lp)n(write)18
b(\(8870\))1010 2522 y Fn(This)e(is)g(the)h(pro)q(cedure)h(whic)o(h)e(is)h
(in)o(v)o(ok)o(ed)e(as)h(a)g(result)1010 2572 y(of)d(the)i(write)f(system)f
(call:)1072 2622 y(\\write")j(\(5722\))e(calls)i(\\rdwr",)f(whic)o(h)h
(\(5755\))e(calls)1010 2672 y(\\writei",)23 b(whic)o(h)e(\(6287\))g(calls)h
(\\cdevsw[..].d)e(write",)1010 2722 y(whic)o(h)14 b(translates)g(\(4675\))f
(to)h(\\lp)o(write".)1072 2772 y(\\lp)o(write")e(tak)o(es)h(the)g(non-n)o
(ull)e(c)o(haracters)j(of)e(a)g(n)o(ull)1010 2822 y(terminated)19
b(string)i(recorded)h(in)e(the)g(user)i(area,)f(and)1890 2946
y(89)p eop
%%Page: 90 98
97 bop -30 -144 a Fk(22)43 b(CHARA)o(CTER)15 b(ORIENTED)g(SPECIAL)g(FILES)457
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fn(passes)j(them)d(to)h(\\lp)
q(output")g(\(via)f(\\lp)q(canon"\))h(one)g(at)-30 66 y(a)e(time.)33
118 y(The)19 b(list)g(of)f(pro)q(cedure)j(calls)d(whic)o(h)h(leads)g(to)g
(the)-30 167 y(in)o(v)o(o)q(cation)e(of)g(this)h(pro)q(cedure)i(is)d(similar)
f(to)h(that)h(for)-30 217 y(\\lp)q(op)q(en".)38 b(A)21 b(\\form)e(feed")i(c)o
(haracter)h(is)e(output)h(to)-30 267 y(clear)13 b(the)g(curren)o(t)h(page,)e
(and)g(the)h(\\op)q(en")f(\015ag)g(is)h(reset.)-30 390 y Fg(22.8)56
b(Discussion)-30 469 y Fn(\\lp)o(write")9 b(is)g(called)g(one)h(or)f(more)g
(times)f(to)h(send)i(a)e(string)-30 519 y(of)19 b(c)o(haracters)h(to)f(the)g
(prin)o(ter.)33 b(In)19 b(turn)g(it)f(calls)h(\\lp-)-30 569
y(canon")14 b(whic)o(h)g(calls)g(\\lp)q(output".)k(If)c(at)g(an)o(y)f(p)q
(oin)o(t)h(to)q(o)-30 619 y(man)o(y)k(c)o(haracters)k(are)e(stored)h(a)o(w)o
(a)o(y)m(,)e(the)h(pro)q(css)h(will)-30 669 y(\\sleep")c(in)e(\\lp)q
(output".)23 b(So)q(oner)17 b(or)e(later)h(\\lp)q(output")-30
719 y(will)i(con)o(tin)o(ue,)j(will)c(store)j(the)g(c)o(haracter)h(in)e(a)g
(bu\013er)-30 768 y(area,)d(and)g(will)e(then)i(call)f(\\lpstart")g(to)g
(send,)i(if)e(p)q(ossi-)-30 818 y(ble,)f(a)f(string)h(of)g(c)o(haracters)h
(to)f(the)h(prin)o(ter)f(con)o(troller.)33 869 y(\\lpstart")k(is)h(called)g
(b)q(oth)g(when)g(more)f(c)o(haracters)-30 919 y(are)11 b(a)o(v)n(ailable)d
(to)i(b)q(e)h(sen)o(t,)h(and)e(when)g(an)g(in)o(terrupt)h(from)-30
969 y(the)k(prin)o(ter)f(is)g(tak)o(en.)33 1020 y(The)19 b(ma)r(jorit)o(y)d
(of)i(calls)g(on)g(\\lpstart")g(will)f(in)h(fact)-30 1070 y(ac)o(hiev)o(e)j
(nothing.)36 b(Occasionally)19 b(\(usually)h(when)g(the)-30
1120 y(prin)o(ter)d(has)e(just)h(completed)f(a)g(prin)o(t)h(cycle\))g
(\\lpstart")-30 1170 y(will)d(b)q(e)i(able)e(to)h(send)h(a)f(whole)g(string)g
(of)f(c)o(haracters)j(to)-30 1219 y(the)f(prin)o(ter)f(con)o(troller.)-30
1343 y Fg(22.9)56 b(lp)r(canon)19 b(\(8879\))-30 1422 y Fn(This)d(pro)q
(cedure)i(in)o(terprets)g(c)o(haracters)f(b)q(eing)f(sen)o(t)h(to)-30
1472 y(the)c(line)f(prin)o(ter)g(and)g(mak)o(e)f(v)n(arious)g(mo)q
(di\014cations,)f(in-)-30 1521 y(sertions)15 b(and)f(deletions.)k(It)c(th)o
(us)h(functions)f(as)g(a)f(\014lter.)-30 1618 y Fi(8884:)21
b Fn(The)c(section)h(of)e(co)q(de)i(from)d(here)j(to)f(line)g(8913)74
1668 y(is)d(concerned)i(with)e(c)o(haracter)i(translation)d(when)74
1718 y(the)j(full)d(96)h(c)o(haracter)j(set)e(is)g(not)g(a)o(v)n(ailable,)d
(and)74 1767 y(a)i(64)f(c)o(haracter)i(set)g(is)f(in)f(use.)74
1837 y(Since)h(the)g(capabilities)e(of)g(a)h(prin)o(ter)h(do)e(not)h(usu-)74
1886 y(ally)20 b(c)o(hange)h(with)g(time,)f(the)i(de\014ned)g(v)n(ariable)74
1936 y(\\CAP")d(\(8840\))e(m)o(ust)h(b)q(e)h(set)g(once)g(and)g(for)f(all)74
1986 y(\(at)c(a)g(particular)f(installation\).)74 2055 y(The)e(run-time)f
(test)i(on)f(\(lp11.\015ag)e(&)i(CAP\))g(could)74 2105 y(b)q(e)j(replaced)h
(b)o(y)e(a)h(compile-tim)o(e)d(test)k(on)e(\(CAP\))74 2155
y(and)e(if)g(the)h(compiler)e(has)h(its)g(\\druthers",)i(if)d(CAP)74
2205 y(turns)i(out)e(to)h(b)q(e)g(zero,)h(the)f(whole)f(section)i(of)e(co)q
(de)74 2254 y(to)j(line)f(8913)g(could)h(b)q(e)g(compiled)f(do)o(wn)g(to)h
(noth-)74 2304 y(ing.)74 2373 y(The)g(presen)o(t)i(co)q(de)e(could)g(b)q(e)g
(said)f(to)h(plan)f(ahead)74 2423 y(for)f(a)g(situation)f(where)i(an)f
(installation)e(ma)o(y)g(ha)o(v)o(e)74 2473 y(t)o(w)o(o)14
b(or)g(more)f(prin)o(ters)j(of)d(di\013eren)o(t)i(t)o(yp)q(es.)20
b(Ev)o(en)74 2523 y(so)e(there)h(is)f(a)f(basic)h(inconsistency)h(here)g(in)e
(the)74 2573 y(use)h(of)e(\\CAP",)g(\\IND")g(and)h(\\EJECT")g(on)f(the)74
2622 y(one)k(hand,)h(and)e(\\EJLINE")h(and)g(\\MAX)o(COL")74
2672 y(on)c(the)g(other.)23 b(In)16 b(fact)f(since)i(forms)d(of)h(di\013eren)
o(t)74 2722 y(sizes)22 b(are)e(not)h(uncommonly)c(used)k(on)f(a)g(single)74
2772 y(prin)o(ter,)c(the)f(last)g(t)o(w)o(o)f(should)h(not)g(b)q(e)h(constan)
o(ts)74 2822 y(at)e(all,)e(but)i(should)g(b)q(e)g(dynamically)d(settable.)
1010 17 y Fi(8885:)20 b Fn(Lo)o(w)o(er)11 b(case)h(alphab)q(etics)f(are)g
(translated)h(b)o(y)e(the)1114 66 y(addition)k(of)g(a)h(constan)o(t,)g(whic)o
(h)g(is)g(con)o(v)o(enien)o(tly)1114 116 y(de\014ned)g(as)f(\\'A')e({)i
('a"';)1010 198 y Fi(8887:)20 b Fn(Certain)13 b(of)e(the)i(remaining)d(c)o
(haracters)k(are)e(sp)q(e-)1114 248 y(cial)h(c)o(haracters)j(whic)o(h)f(are)f
(prin)o(ted)h(as)f(a)h(similar)1114 298 y(c)o(haracter)d(with)f(an)g(o)o(v)o
(erprin)o(ted)g(min)o(us)f(sign,)h(e.g.)1114 348 y(\\)p Fl(f)p
Fn(")i(\(8889\))g(is)h(prin)o(ted)g(as)g(\\)p Fl(f)p Fn(-";)1010
430 y Fi(8909:)20 b Fn(The)c(\\simili)o(ar")c(c)o(haracter)k(is)f(output)g
(via)f(a)h(re-)1114 480 y(cursiv)o(e)20 b(call)f(on)h(\\lp)q(canon",)g(whic)o
(h)g(will)f(incre-)1114 529 y(men)o(t)13 b(\\lp11.ccc")g(b)o(y)h(one)g(as)g
(a)f(side)h(e\013ect;)1010 612 y Fi(8910:)20 b Fn(Decremen)o(t)c(the)g
(curren)o(t)g(c)o(haracter)h(coun)o(t)e(\(for)1114 661 y(the)h(same)f
(e\013ect)j(as)e(a)f(\\bac)o(k)h(space")h(c)o(haracter\))1114
711 y(and)c(...)1010 793 y Fi(8911:)20 b Fn(Prepare)c(to)d(output)h(a)g(min)o
(us)e(sign;)1010 875 y Fi(8915:)20 b Fn(The)d(\\switc)o(h")e(statemen)o(t)h
(b)q(eginning)f(here)i(ex-)1114 925 y(tends)23 b(to)f(line)g(8963.)43
b(Certain)22 b(c)o(haracters)j(in-)1114 975 y(v)o(olv)o(ed)15
b(in)h(v)o(ertical)g(and)f(horizon)o(tal)h(spacing)g(are)1114
1025 y(giv)o(en)c(sp)q(ecial)i(in)o(terpretations)g(with)f(dela)o(y)o(ed)g
(ac-)1114 1075 y(tions;)1010 1157 y Fi(8917:)20 b Fn(F)m(or)h(a)f(horizon)o
(tal)g(tab)h(c)o(haracter,)i(round)e(the)1114 1206 y(curren)o(t)14
b(c)o(haracter)g(coun)o(t)f(up)g(to)g(the)g(next)h(m)o(ulti-)1114
1256 y(ple)i(of)g(eigh)o(t.)25 b(Do)16 b(not)g(output)g(an)o(y)g(blank)g(c)o
(har-)1114 1306 y(acters)f(immedia)o(tely;)1010 1388 y Fi(8921:)20
b Fn(F)m(or)d(a)g(\\form)e(feed")i(or)g(\\new)g(line")f(c)o(haracter,)1114
1438 y(if:)1114 1504 y(\(a\))11 b(the)i(prin)o(ter)f(do)q(es)h(not)e(ha)o(v)o
(e)h(a)f(\\page)h(restore")1114 1554 y(capabilit)o(y;)g(or)1114
1620 y(\(b\))i(the)g(curren)o(t)i(line)d(is)h(not)g(empt)o(y;)e(or)1114
1686 y(\(c\))j(some)e(lines)h(ha)o(v)o(e)g(b)q(een)i(completed)d(since)i(the)
1114 1735 y(last)e(\\form)f(feed")i(c)o(haracter,)h(then)g(...)1010
1817 y Fi(8925:)20 b Fn(reset)c(\\lp11.mcc")11 b(to)j(zero;)1010
1899 y Fi(8926:)20 b Fn(Incremen)o(t)14 b(the)h(completed)e(line)h(coun)o(t;)
1010 1982 y Fi(8927:)20 b Fn(Con)o(v)o(ert)e(a)e(\\new)i(line")e(c)o
(haracter)i(to)f(a)g(\\form)1114 2031 y(feed")h(if)f(su\016cien)o(t)i(lines)f
(ha)o(v)o(e)f(b)q(een)j(completed)1114 2081 y(on)f(the)i(curren)o(t)h(page,)f
(and)f(the)g(prin)o(ter)h(has)f(a)1114 2131 y(\\form)12 b(feed")i(capabilit)o
(y;)1010 2213 y Fi(8929:)20 b Fn(Output)h(the)f(c)o(haracter,)i(and)d(if)g(w)
o(as)h(a)f(\\form)1114 2263 y(feed",)13 b(reset)j(n)o(um)o(b)q(er)d(of)g
(completed)h(lines)f(zero;)1010 2352 y(Examination)e(of)i(this)h(co)q(de)h
(will)d(sho)o(w)i(that:)1010 2441 y Fi(\(a\))20 b Fn(An)o(y)10
b(string)f(of)g(\\form)f(feed"s)i(or)g(\\new)g(line"s)f(whic)o(h)1114
2490 y(b)q(egins)22 b(with)g(a)g(\\form)e(feed",)k(will,)f(if)e(sen)o(t)i(to)
1114 2540 y(a)16 b(prin)o(ter)h(with)g(\\form)d(feed")j(capabilit)o(y)m(,)e
(b)q(e)j(re-)1114 2590 y(duced)d(to)e(a)h(single)f(\\form)f(feed";)1010
2672 y Fi(\(b\))19 b Fn(A)12 b(\\form)d(feed")j(c)o(haracter)h(sen)o(t)f(to)f
(a)h(prin)o(ter)g(with-)1114 2722 y(out)18 b(the)i(\\form)d(feed")i
(capabilit)o(y)m(,)f(will)f(cause)j(a)1114 2772 y(new)c(line)g(to)f(b)q(e)i
(started)g(but)f(will)f(b)q(e)h(passed)h(on)1114 2822 y(otherwise)d(without)g
(commen)o(t.)-30 2946 y(90)p eop
%%Page: 91 99
98 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)456
b(22)43 b(CHARA)o(CTER)14 b(ORIENTED)h(SPECIAL)g(FILES)-30
17 y Fi(8934:)21 b Fn(F)m(or)i(\\carriage)g(return"s,)j Fi(and)p
Fn(,)e(note,)i(\\form)74 66 y(feed"s)11 b(and)f(\\new)g(line"s,)g(reset)h
(the)g(curren)o(t)h(c)o(har-)74 116 y(acter)22 b(coun)o(t)g(to)f(zero)h(or)f
(eigh)o(t,)h(dep)q(ending)g(on)74 166 y(\\IND",)13 b(and)h(return;)-30
256 y Fi(8949:)21 b Fn(F)m(or)13 b(all)g(other)i(c)o(haracters)g(...)-30
347 y Fi(8950:)21 b Fn(If)j(a)g(string)h(of)f(\\bac)o(kspace"s)h(\(real)g(or)
g(con-)74 396 y(triv)o(ed\))11 b(and/or)f(\\carriage)h(returns")h(has)e(b)q
(een)i(re-)74 446 y(ceiv)o(ed,)j(output)f(a)g(single)g(\\carriage)h(return")g
(and)74 496 y(reset)h(the)e(maxim)n(um)c(c)o(haracter)15 b(coun)o(t)f(to)g
(zero;)-30 586 y Fi(8954:)21 b Fn(Pro)o(vided)26 b(the)h(coun)o(t)f(do)q(es)h
(not)e(exceed)j(the)74 636 y(maxim)n(um)15 b(line)j(length,)i(output)f(blank)
f(c)o(harac-)74 686 y(ters)12 b(to)f(bring)g(the)g(maxim)o(um)6
b(c)o(haracter)13 b(coun)o(t)e(to)74 736 y(the)18 b(curren)o(t)h(c)o
(haracter)f(coun)o(t.)28 b(\(P)o(erhaps)18 b(these)74 785 y(t)o(w)o(o)11
b(v)n(ariables)f(w)o(ould)g(b)q(e)h(more)f(accurately)i(called)74
835 y(the)i(\\actual)f(c)o(haracter)h(coun)o(t")g(and)f(the)h(\\logical)74
885 y(c)o(haracter)i(coun)o(t".\);)-30 975 y Fi(8959:)21 b
Fn(Output)15 b(the)f(actual)g(c)o(haracter.)-30 1101 y Fg(22.10)56
b(F)-5 b(or)19 b(idle)e(readers:)24 b(A)18 b(suggestion)-30
1181 y Fn(It)h(will)d(b)q(e)j(observ)o(ed)g(that)f(bac)o(kspaces)h(for)f(o)o
(v)o(erprin)o(t-)-30 1231 y(ing)g(or)h(underscoring)h(c)o(haracters)g(in)o
(tro)q(duce)f(separate)-30 1281 y(prin)o(t)14 b(cycles,)h(and)f(where)i
(these)f(features)h(are)e(in)g(hea)o(vy)-30 1331 y(use,)g(the)g(e\013ectiv)o
(e)h(output)f(rate)g(of)f(the)h(prin)o(ter)g(ma)o(y)d(b)q(e)-30
1380 y(drastically)16 b(reduced.)28 b(If)16 b(this)g(is)h(considered)h(a)e
(serious)-30 1430 y(problem,)k(\\lp)q(canon")f(could)h(b)q(e)g(rewritten)h
(to)f(ensure)-30 1480 y(that)g(no)f(more)g(than)g(t)o(w)o(o)g(prin)o(t)g
(cycles)i(are)e(used)i(p)q(er)-30 1530 y(line)14 b(in)f(suc)o(h)i(cases.)-30
1656 y Fg(22.11)56 b(PC-11)13 b(P)n(ap)r(er)g(T)-5 b(ap)r(e)12
b(Reader/Punc)n(h)154 1714 y(Driv)n(er)-30 1794 y Fn(This)e(driv)o(er)g(is)f
(to)h(b)q(e)g(found)f(in)g(the)i(\014le)e(\\p)q(c.c")h(on)f(Sheets)-30
1843 y(86,)20 b(87.)34 b(It)19 b(is)g(simpler)f(than)h(the)h(line)f(prin)o
(ter)g(driv)o(er)-30 1893 y(in)14 b(that)h(there)g(is)g(ro)f(routine)h
(analogous)e(to)h(\\lp)q(canon".)-30 1943 y(Ho)o(w)o(ev)o(er)d(it)f(is)g
(more)f(complicated)f(in)i(that)g(there)i(is)e(b)q(oth)-30
1993 y(an)j(input)g(and)g(an)f(output)i(device)f(whic)o(h)g(can)g(b)q(e)h
(sim)o(ul-)-30 2043 y(taneously)g(and)g(indep)q(enden)o(tly)h(activ)o(e.)33
2094 y(A)h(description)g(of)f(the)i(op)q(eration)e(of)g(this)h(device)h(is)
-30 2144 y(inciuded)12 b(in)f(the)h(do)q(cumen)o(t)f(\\The)g(UNIX)h(I/O)f
(System")-30 2194 y(b)o(y)22 b(D.)g(Ritc)o(hie.)42 b(Certain)22
b(sp)q(ecial)h(features)g(ma)o(y)d(b)q(e)-30 2244 y(noted:)-30
2342 y Fi(\(1\))g Fn(Only)13 b(one)f(pro)q(cess)j(ma)o(y)c(op)q(en)i(the)g
(\014le)g(for)f(reading)74 2392 y(at)i(a)g(time,)e(but)i(there)h(is)f(no)g
(limit)d(on)j(the)g(nm)o(b)q(er)74 2442 y(of)g(writers;)-30
2532 y Fi(\(2\))20 b Fn(This)13 b(routine)g(pa)o(ys)g(a)f(little)g(more)g
(atten)o(tion)h(to)f(er-)74 2582 y(ror)e(conditions)g(than)g(the)h(line)e
(prin)o(ter)i(driv)o(er,)f(but)74 2632 y(the)15 b(treatmen)o(t)e(is)h(still)f
(not)h(exhaustiv)o(e;)-30 2722 y Fi(\(3\))20 b Fn(\\passc")12
b(\(8695\))e(kno)o(ws)h(ho)o(w)f(man)o(y)g(c)o(haracters)i(are)74
2772 y(required)22 b(and)f(returns)h(a)f(negativ)o(e)f(v)n(alie)g(when)74
2822 y(\\enough")14 b(is)f(reac)o(hed;)1010 17 y Fi(\(4\))20
b Fn(\\p)q(cclose")14 b(is)f(careful)h(to)f(\015ush)h(out)f(an)o(y)g
(remaining)1114 66 y(c)o(haracters)i(in)e(the)g(input)h(queue)g(if)e(and)h
(only)g(if)f(it)1114 116 y(b)q(eliev)o(es)i(the)h(device)f(w)o(as)g(op)q
(ened)h(for)f(input.)1890 2946 y(91)p eop
%%Page: 92 100
99 bop -30 -144 a Fk(23)43 b(CHARA)o(CTER)15 b(HANDLING)786
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(23)70 b(Character)23
b(Handling)-30 108 y Fn(Bu\013ering)18 b(for)f(c)o(haracter)i(sp)q(ecial)e
(devices)i(is)e(pro)o(vided)-30 157 y(via)10 b(a)h(set)h(of)e(four)h(w)o(ord)
f(blo)q(c)o(ks,)h(eac)o(h)h(of)e(whic)o(h)g(pro)o(vides)-30
207 y(storage)19 b(for)e(six)h(c)o(haracters.)32 b(The)18 b(protot)o(yp)q(e)g
(storage)-30 257 y(blo)q(c)o(k)13 b(is)g(\\cblo)q(c)o(k")f(\(8140\))g(whic)o
(h)h(incorp)q(orates)g(a)g(w)o(ord)-30 307 y(p)q(oin)o(ter)k(\(to)f(a)g
(similar)e(structure\))19 b(along)c(with)h(the)h(six)-30 357
y(c)o(haracters.)33 406 y(Structures)g(of)e(t)o(yp)q(e)g(\\clist")g(\(7908\))
f(whic)o(h)h(con)o(tain)-30 456 y(a)20 b(c)o(haracter)i(coun)o(ter)f(plus)g
(a)f(head)g(and)g(tail)f(p)q(oin)o(ter)-30 506 y(are)j(used)g(as)f
(\\headers")h(for)f(lists)g(of)g(blo)q(c)o(ks)g(of)f(t)o(yp)q(e)-30
556 y(\\cblo)q(c)o(k".)33 606 y(\\cblo)q(c)o(k"s)10 b(whic)o(h)g(are)g(not)g
(in)g(curren)o(t)h(use)g(are)f(link)o(ed)-30 656 y(via)i(their)h(head)g(p)q
(oin)o(ters)g(in)o(to)f(a)g(list)g(whose)h(head)g(is)f(the)-30
705 y(p)q(oin)o(ter)h(\\cfreelist")f(\(3149\).)17 b(The)c(head)f(p)q(oin)o
(ter)g(for)g(the)-30 755 y(last)i(elemen)o(t)f(of)h(the)g(list)g(has)g(the)g
(v)n(alue)f(\\NULL".)33 805 y(A)h(list)g(of)f(\\cblo)q(c)o(k"s)i(pro)o(vides)
f(storage)h(for)f(a)g(list)f(of)-30 855 y(c)o(haracters.)25
b(The)16 b(pro)q(cedure)i(\\putc")e(ma)o(y)d(b)q(e)j(used)h(to)-30
905 y(add)11 b(a)f(c)o(haracter)i(to)f(the)g(tail)e(of)h(suc)o(h)i(a)e(list,)
g(and)h(\\getc",)-30 954 y(to)j(remo)o(v)o(e)f(a)h(c)o(haracter)h(from)d(the)
j(head)f(of)f(suc)o(h)i(a)e(list.)33 1004 y(Figures)e(23.1)f(through)h(23.4)f
(illustrate)g(the)i(dev)o(elop-)-30 1054 y(men)o(t)h(of)h(a)f(list)h(as)g(c)o
(haracters)h(are)g(deleted)g(and)e(added.)p 503 1127 89 4 v
503 1585 4 458 v 588 1585 V 503 1588 89 4 v 539 1227 a Fb(g)539
1296 y(h)539 1364 y(i)539 1433 y(j)539 1502 y(k)539 1570 y(l)p
683 1127 V 683 1585 4 458 v 768 1585 V 683 1588 89 4 v 719
1296 a(n)719 1364 y(o)719 1433 y(p)719 1502 y(q)719 1570 y(r)709
1227 y(m)p 29 1389 203 4 v 29 1585 4 197 v 229 1585 V 29 1588
203 4 v 196 1490 131 4 v 285 1488 a Fa(-)p 324 1127 89 4 v
324 1585 4 458 v 409 1585 V 324 1588 89 4 v 360 1163 148 4
v 465 1161 a(-)p 539 1163 V 138 w(-)p 194 1636 4 82 v 196 1638
638 4 v 832 1636 4 82 v 768 1556 66 4 v 768 1554 a(\033)59
1443 y Fb(14)62 1508 y(head)62 1570 y(tail)360 1502 y(e)360
1570 y(f)293 1759 y Fg(Figure)18 b(23.1)p 503 1891 89 4 v 503
2349 4 458 v 588 2349 V 503 2352 89 4 v 539 1991 a Fb(g)539
2060 y(h)539 2128 y(i)539 2197 y(j)539 2266 y(k)539 2334 y(l)p
683 1891 V 683 2349 4 458 v 768 2349 V 683 2352 89 4 v 719
2060 a(n)719 2128 y(o)719 2197 y(p)719 2266 y(q)719 2334 y(r)709
1991 y(m)p 29 2153 203 4 v 29 2349 4 197 v 229 2349 V 29 2352
203 4 v 196 2266 a Fa(P)238 2280 y(P)279 2294 y(P)287 2297
y(P)-42 b(q)p 324 1891 89 4 v 324 2349 4 458 v 409 2349 V 324
2352 89 4 v 360 1927 148 4 v 465 1925 a(-)p 539 1927 V 138
w(-)p 194 2400 4 82 v 196 2402 638 4 v 832 2400 4 82 v 768
2320 66 4 v 768 2318 a(\033)62 2272 y Fb(head)62 2334 y(tail)226
b(f)59 2207 y(13)293 2523 y Fg(Figure)18 b(23.2)33 2622 y Fn(Initially)11
b(the)j(list)g(is)f(assumed)g(to)h(con)o(tain)f(the)h(four-)-30
2672 y(teen)21 b(c)o(haracters)h(\\efghijklmnop)q(qr".)32 b(Note)20
b(that)g(the)-30 2722 y(head)15 b(and)g(tail)e(p)q(oin)o(ters)j(p)q(oin)o(t)e
(to)g Fi(c)o(haracters)p Fn(.)19 b(If)14 b(the)-30 2772 y(\014rst)k(c)o
(haracter,)g(\\e",)e(is)h(remo)o(v)o(ed)e(b)o(y)i(\\getc",)g(the)g(sit-)-30
2822 y(uation)e(p)q(ortra)o(y)o(ed)g(in)f(Figure)h(23.1)f(c)o(hanges)i(to)e
(that)h(of)1010 17 y(Figure)i(23.2.)25 b(The)17 b(c)o(haracter)h(coun)o(t)f
(has)g(b)q(een)h(decre-)1010 66 y(men)o(ted)11 b(and)h(the)g(head)g(p)q(oin)o
(ter)g(has)g(b)q(een)h(adv)n(anced)f(b)o(y)1010 116 y(one)i(c)o(haracter)h(p)
q(osition.)1072 167 y(If)f(a)g(further)i(c)o(haracter,)f(\\f)s(",)f(is)g
(remo)o(v)o(ed)g(from)e(the)1010 217 y(head)i(of)e(the)i(list,)f(the)h
(situation)f(b)q(ecomes)g(as)h(in)f(Figure)1010 267 y(23.3.)26
b(The)18 b(c)o(haracter)g(coun)o(t)g(has)f(b)q(een)h(decremen)o(ted;)1010
317 y(the)d(\014rst)g(\\cblo)q(c)o(k")f(no)g(longer)g(con)o(tains)g(an)o(y)g
(useful)h(in-)1010 367 y(formation)9 b(and)i(has)h(b)q(een)h(returned)g(to)f
(\\cfreelist";)g(and)1010 416 y(the)17 b(head)g(p)q(oin)o(ter)f(no)o(w)h(p)q
(oin)o(ts)f(to)g(the)h(\014rst)h(c)o(haracter)1010 466 y(in)13
b(the)i(second)g(\\cblo)q(c)o(k".)p 1543 541 89 4 v 1543 998
4 458 v 1628 998 V 1543 1001 89 4 v 1579 640 a Fb(g)1579 709
y(h)1579 778 y(i)1579 846 y(j)1579 915 y(k)1579 984 y(l)p 1722
541 V 1722 998 4 458 v 1807 998 V 1722 1001 89 4 v 1758 709
a(n)1758 778 y(o)1758 846 y(p)1758 915 y(q)1758 984 y(r)1749
640 y(m)p 1069 802 203 4 v 1069 998 4 197 v 1268 998 V 1069
1001 203 4 v 1579 577 148 4 v 1685 575 a Fa(-)p 1234 1049 4
82 v 1236 1051 638 4 v 1871 1049 4 82 v 1807 969 66 4 v 1807
967 a(\033)p 1236 904 164 4 v 1397 902 4 278 v 1399 626 148
4 v 1505 624 a(-)1102 921 y Fb(head)1102 984 y(tail)1098 856
y(12)1332 1184 y Fg(Figure)j(23.3)1072 1294 y Fn(The)e(question)g(no)o(w)f(p)
q(oses)h(itself:)21 b(\\ho)o(w)15 b(is)g(the)h(dif-)1010 1344
y(ference)g(b)q(et)o(w)o(een)g(the)f(\014rst)h(and)e(second)i(situations)e
(de-)1010 1394 y(tected)i(so)e(that)h(the)g(action)f(tak)o(en)g(is)g(alw)o(a)
o(ys)g(appropri-)1010 1443 y(ate?":)1072 1494 y(The)19 b(answ)o(er)h(\(if)e
(y)o(ou)g(ha)o(v)o(e)h(not)g(already)f(guessed\))1010 1544
y(in)o(v)o(olv)o(es)12 b(lo)q(oklng)g(at)h(the)g(v)n(alue)g(of)g(the)g(p)q
(oin)o(ter)h(address)1010 1594 y(mo)q(dulo)19 b(8.)39 b(Since)21
b(division)f(b)o(y)g(eigh)o(t)h(is)g(easily)f(p)q(er-)1010
1644 y(formed)d(on)i(a)g(binary)f(computer,)h(the)h(reason)f(for)f(the)1010
1694 y(c)o(hoice)i(of)g(six)f(c)o(haracters)j(p)q(er)f(\\cblo)q(c)o(k")f
(should)f(no)o(w)1010 1743 y(also)13 b(b)q(e)i(apparen)o(t.)1072
1794 y(The)i(addition)f(of)g(a)g(c)o(haracter)j(to)d(the)h(list)g(is)f
(illus-)1010 1844 y(trated)f(in)g(the)g(c)o(hange)g(b)q(et)o(w)o(een)h
(Figure)f(23.3)e(and)i(Fig-)1010 1894 y(ure)f(23.4.)p 1477
1969 89 4 v 1477 2426 4 458 v 1562 2426 V 1477 2429 89 4 v
1513 2068 a Fb(g)1513 2137 y(h)1513 2206 y(i)1513 2274 y(j)1513
2343 y(k)1513 2412 y(l)p 1657 1969 V 1657 2426 4 458 v 1742
2426 V 1657 2429 89 4 v 1693 2137 a(n)1693 2206 y(o)1693 2274
y(p)1693 2343 y(q)1693 2412 y(r)1683 2068 y(m)p 1003 2230 203
4 v 1003 2426 4 197 v 1203 2426 V 1003 2429 203 4 v 1513 2005
148 4 v 1619 2003 a Fa(-)p 1170 2331 164 4 v 1332 2330 4 278
v 1334 2054 148 4 v 1439 2052 a(-)p 1837 1969 89 4 v 1837 2426
4 458 v 1922 2426 V 1837 2429 89 4 v 1693 2005 148 4 v 1799
2003 a(-)p 1169 2477 4 82 v 1170 2479 834 4 v 2002 2477 4 425
v 1922 2054 82 4 v 1922 2052 a(\033)1036 2349 y Fb(head)1036
2412 y(tail)1873 2068 y(s)1033 2284 y(13)1332 2662 y Fg(Figure)k(23.4)1072
2772 y Fn(Since)e(the)g(last)g(\\cblo)q(c)o(k")f(ln)g(Figure)h(23.3)e(w)o(as)
i(full,)1010 2822 y(a)g(new)h(one)g(has)g(b)q(een)h(obtained)e(from)f
(\\cfreelist")i(and)-30 2946 y(92)p eop
%%Page: 93 101
100 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)786
b(23)43 b(CHARA)o(CTER)14 b(HANDLING)-30 17 y Fn(link)o(ed)22
b(in)o(to)f(the)h(list)g(of)f(\\cblo)q(c)o(k"s.)42 b(The)22
b(c)o(haracter)-30 66 y(coun)o(t)d(and)f(tail)f(p)q(oin)o(ter)i(ha)o(v)o(e)f
(b)q(een)h(adjusted)g(appro-)-30 116 y(priately)m(.)-30 231
y Fg(23.1)56 b(cinit)18 b(\(8234\))-30 307 y Fn(This)23 b(pro)q(cedure,)i
(whic)o(h)d(is)g(called)g(once)h(b)o(y)f(\\main")-30 357 y(\(1613\),)d(links)
f(the)i(set)g(of)e(c)o(haracter)i(bu\013ers)g(in)o(to)e(the)-30
407 y(free)13 b(list,)e(\\cfreelist",)h(and)f(coun)o(ts)h(the)g(n)o(um)o(b)q
(er)f(of)g(c)o(har-)-30 457 y(acter)k(device)g(t)o(yp)q(es.)-30
538 y Fi(8239:)21 b Fn(\\ccp")14 b(is)g(the)h(address)g(of)f(the)h(\014rst)g
(w)o(ord)e(in)h(the)74 588 y(arra)o(y)g(\\cfree")h(\(8146\);)-30
667 y Fi(8240:)21 b Fn(Round)e(\\ccp")h(up)g(to)g(the)g(next)h(highest)f(m)o
(ul-)74 717 y(tiple)g(of)f(eigh)o(t,)h(and)g(mark)e(out)i(\\cblo)q(c)o(k")f
(sized)74 767 y(pieces,)e(taking)e(care)i(not)e(to)h(exceed)h(the)g(b)q
(ound-)74 816 y(ary)d(of)f(\\cfree".)74 881 y(Note.)19 b(In)13
b(general)h(there)i(will)c(b)q(e)i(\\NCLIST)g({)f(1")74 931
y(\(rather)i(than)f(\\NCLIST"\))g(blo)q(c)o(ks)g(so)f(de\014ned;)-30
1010 y Fi(8241:)21 b Fn(Set)d(the)g(\014rst)g(w)o(ord)f(of)f(the)i(\\cblo)q
(c)o(k")f(to)g(p)q(oin)o(t)74 1060 y(to)d(the)g(curren)o(t)i(head)e(of)f(the)
i(free)f(list.)74 1124 y(Note)21 b(that)f(\\c)p 318 1124 13
2 v 15 w(next")g(is)g(de\014ned)i(on)e(line)f(8141,)74 1174
y(and)25 b(that)g(the)h(initial)d(v)n(alue)h(of)g(\\cfreelist")i(is)74
1224 y(\\NULL".)-30 1303 y Fi(8242:)21 b Fn(Up)q(date)14 b(\\cfreelist")g(to)
f(p)q(oin)o(t)g(to)g(the)i(new)e(head)74 1352 y(of)h(the)g(list;)-30
1431 y Fi(8244:)21 b Fn(Coun)o(t)11 b(the)g(n)o(um)o(b)q(er)f(of)g(c)o
(haracter)j(device)e(t)o(yp)q(es.)74 1481 y(Up)q(on)18 b(reference)j(to)d
(\\cdevsw")h(on)f(Sheet)h(46,)f(it)74 1531 y(will)13 b(b)q(e)h(seen)i(that)e
(\\nc)o(hrdev")g(will)e(b)q(e)j(set)g(to)f(16,)74 1581 y(whereas)20
b(a)e(more)f(appropriate)i(v)n(alue)f(w)o(ould)f(b)q(e)74 1631
y(10.)-30 1745 y Fg(23.2)56 b(getc)18 b(\(0930\))-30 1822 y
Fn(This)c(pro)q(cedure)i(is)e(called)f(b)o(y)36 1903 y Ff(flushtty)20
b(\(8258,)h(8259,)f(8264\))36 1953 y(canon)86 b(\(8292\))g(pcread)42
b(\(8688\))36 2003 y(ttstart)g(\(8520\))86 b(pcstart)20 b(\(8714\))36
2053 y(ttread)64 b(\(8544\))86 b(lpstart)20 b(\(8971\))36 2102
y(pcclose)42 b(\(8673\))-30 2184 y Fn(with)19 b(a)f(single)g(argumen)o(t)g
(whic)o(h)g(is)h(the)g(address)h(of)e(a)-30 2234 y(\\clist")c(structure.)-30
2315 y Fi(0931:)21 b Fn(Cop)o(y)9 b(the)h(parameter)f(to)g(r1)h(and)f(sa)o(v)
o(e)h(the)g(initial)74 2365 y(pro)q(cessor)17 b(status)f(w)o(ord)f(and)g(v)n
(alue)f(of)g(r2)h(on)g(the)74 2414 y(stac)o(k;)-30 2494 y Fi(0934:)21
b Fn(Set)k(the)f(pro)q(cessor)i(priorit)o(y)d(to)h(\014v)o(e)g(\(higher)74
2543 y(than)15 b(the)g(in)o(terrupt)g(priorit)o(y)f(of)f(a)i(c)o(haracter)g
(de-)74 2593 y(vice\);)-30 2672 y Fi(0936:)21 b Fn(r1)13 b(p)q(oin)o(ts)f(to)
h(the)g(\014rst)h(w)o(ord)f(of)f(a)g(\\clist")h(struc-)74 2722
y(ture)18 b(\(i.e.)26 b(a)16 b(c)o(haracter)i(coun)o(t\).)27
b(Mo)o(v)o(e)16 b(the)i(sec-)74 2772 y(ond)f(w)o(ord)f(of)g(this)g(structure)
j(\(i.e.)25 b(a)16 b(p)q(oin)o(ter)h(to)74 2822 y(the)e(head)f(c)o
(haracter\))h(to)f(r2;)1010 17 y Fi(0937:)20 b Fn(If)10 b(the)h(list)e(is)h
(empt)o(y)f(\(head)h(p)q(oin)o(ter)g(is)g(\\NULL"\))1114 66
y(go)j(to)h(line)f(0961;)1010 159 y Fi(0938:)20 b Fn(Mo)o(v)o(e)9
b(the)h(head)g(c)o(haracter)h(to)e(r0)g(and)g(incremen)o(t)1114
209 y(r2)k(as)h(a)g(side)g(e\013ect;)1010 302 y Fi(0939:)20
b Fn(Mask)13 b(r0)g(to)g(get)h(rid)f(of)f(an)o(y)h(extended)h(negativ)o(e)
1114 352 y(sign;)1010 445 y Fi(0940:)20 b Fn(Store)15 b(the)g(up)q(dated)h
(head)e(p)q(oin)o(ter)h(bac)o(k)f(in)g(the)1114 494 y(\\clist")k(structure.)
35 b(\(This)19 b(ma)o(y)d(ha)o(v)o(e)j(to)g(b)q(e)g(al-)1114
544 y(tered)c(later.\);)1010 637 y Fi(0941:)20 b Fn(Decremen)o(t)13
b(the)g(c)o(haracter)h(coun)o(t)e(and)g(if)g(this)g(is)1114
687 y(still)h(p)q(ositiv)o(e,)g(go)g(to)h(line)f(0947;)1010
780 y Fi(0942:)20 b Fn(The)13 b(list)f(is)g(no)o(w)g(empt)o(y)m(,)f(so)h
(reset)i(the)f(head)f(and)1114 829 y(tail)f(c)o(haracter)i(p)q(oin)o(ters)g
(to)f(\\NULL".)g(Go)f(to)i(line)1114 879 y(0952;)1010 972 y
Fi(0947:)20 b Fn(Lo)q(ok)12 b(at)g(the)h(three)h(least)f(signi\014can)o(t)e
(bits)i(of)f(r2.)1114 1022 y(If)e(these)i(are)f(non-zero,)g(branc)o(h)g(to)f
(line)h(0957)e(\(and)1114 1072 y(return)15 b(to)e(the)i(calling)d(routine)i
(forth)o(with\);)1010 1164 y Fi(0949:)20 b Fn(A)o(t)11 b(this)f(p)q(oin)o(t,)
g(r2)g(is)g(p)q(oin)o(ting)f(at)h(the)h(next)g(c)o(har-)1114
1214 y(acter)h(p)q(osition)e(b)q(ey)o(ond)i(the)g(\\cblo)q(c)o(k".)k(Mo)o(v)o
(e)11 b(the)1114 1264 y(v)n(alue)i(stored)i(in)f(the)h(\014rst)g(w)o(ord)f
(of)g(the)g(\\cblo)q(c)o(k")1114 1314 y(\(i.e.)29 b(at)17 b(r2)h({)f(8\),)h
(whic)o(h)g(is)f(the)h(address)h(of)e(the)1114 1364 y(next)f(\\cblo)q(c)o(k")
f(in)g(the)i(list)e(to)h(the)g(head)g(p)q(oin)o(ter)1114 1414
y(in)c(the)i(\\clist".)j(\(Note)d(that)f(r1)g(w)o(as)g(incremen)o(ted)1114
1463 y(as)h(a)f(side)h(e\013ect)i(at)e(line)f(0941\):)1010
1556 y Fi(0950:)20 b Fn(The)d(last)e(v)n(alue)g(stored)i(needs)g(to)f
(incremen)o(ted)1114 1606 y(b)o(y)d(t)o(w)o(o)h(\(Consult)g(Figures)g(23.2)f
(and)g(23.3\);)1010 1699 y Fi(0952:)20 b Fn(A)o(t)11 b(this)f(p)q(oin)o(t,)h
(a)f(\\cblo)q(c)o(k")g(determined)g(b)o(y)h(r2)f(is)1114 1749
y(to)i(b)q(e)h(returned)h(to)e(\\cfreelist".)18 b(Either)13
b(r2)f(p)q(oin)o(ts)1114 1798 y(in)o(to)17 b(the)i(\\cblo)q(c)o(k")f(or)h
(just)f(b)q(ey)o(ond)h(it.)31 b(Decre-)1114 1848 y(men)o(t)8
b(r2)i(so)f(that)h(r2)f(will)f(p)q(oin)o(t)h(in)o(to)g(the)h(\\cblo)q(c)o
(k";)1010 1941 y Fi(0953:)20 b Fn(Reset)f(the)g(three)g(least)f(signi\014can)
o(t)g(bits)g(of)g(r2,)1114 1991 y(lea)o(ving)12 b(a)i(p)q(oin)o(ter)g(to)g
(the)g(\\cblo)q(c)o(k";)1010 2084 y Fi(0954:)20 b Fn(Link)14
b(the)g(\\cblo)q(c)o(k")g(in)o(to)f(\\cfreelist";)1010 2177
y Fi(0957:)20 b Fn(Restore)h(the)f(v)n(alues)g(of)f(r2)g(and)h(PS)g(from)d
(the)1114 2226 y(stac)o(k)d(and)g(return;)1010 2319 y Fi(0961:)20
b Fn(A)o(t)15 b(this)g(p)q(oin)o(t)f(the)i(list)e(is)h(kno)o(wn)f(to)h(b)q(e)
g(empt)o(y)1114 2369 y(b)q(ecause)g(a)e(\\NULL")g(head)h(p)q(oin)o(ter)f(w)o
(as)g(encoun-)1114 2419 y(tered.)49 b(Mak)o(e)23 b(sure)i(that)f(the)h(tail)d
(p)q(oin)o(ter)i(is)1114 2469 y(\\NULL")13 b(also;)1010 2561
y Fi(0962:)20 b Fn(Mo)o(v)o(e)d({1)f(to)g(r0)h(as)f(the)h(result)h(to)e(b)q
(e)h(returned)1114 2611 y(when)d(the)h(list)e(is)h(empt)o(y)m(.)1010
2740 y Fg(23.3)56 b(putc)18 b(\(0967\))1010 2822 y Fn(This)c(pro)q(cedure)h
(is)f(called)g(b)o(y)1890 2946 y(93)p eop
%%Page: 94 102
101 bop -30 -144 a Fk(23)43 b(CHARA)o(CTER)15 b(HANDLING)786
b(UNIX)14 b(6th)h(Edition)g(Commentary)36 17 y Ff(canon)108
b(\(8323\))36 66 y(ttyinput)42 b(\(8355,)20 b(8358\))36 116
y(ttyoutput)g(\(8414,)g(8478\))36 166 y(pcrint)86 b(\(8730\))36
216 y(pcoutput)42 b(\(8756\))36 266 y(lpoutput)g(\(8990\))-30
388 y Fn(with)17 b(t)o(w)o(o)g(argumen)o(ts:)25 b(a)17 b(c)o(haracter)h(and)f
(the)h(address)-30 438 y(of)c(a)f(\\clist")h(structure.)33
495 y(\\getc")19 b(and)h(\\putc")f(ha)o(v)o(e)g(related)h(functions)g(and)-30
545 y(the)11 b(co)q(des)g(for)e(the)h(t)o(w)o(o)f(pro)q(cedures)j(are)e
(similar)d(in)j(man)o(y)-30 595 y(resp)q(ects.)30 b(F)m(or)17
b(this)g(reason)g(the)h(co)q(de)g(for)e(\\putc")h(will)-30
645 y(not)12 b(b)q(e)h(examined)d(in)i(detail,)f(but)h(is)f(left)h(for)g(the)
g(reader.)33 703 y(It)h(should)g(b)q(e)h(noted)g(that)f(\\putc")h(can)f(fail)
f(if)g(a)h(new)-30 752 y(\\cblo)q(c)o(k")g(is)g(needed)i(and)e(\\cfreelist")h
(is)f(empt)o(y)m(.)j(In)e(this)-30 802 y(case)h(a)e(non-zero)g(v)n(alue)g
(\(line)g(1002\))f(is)h(returned)i(rather)-30 852 y(than)f(a)g(zero)h(v)n
(alue)e(\(line)g(0996\).)33 910 y Fi(Note.)26 b Fn(The)17 b(pro)q(cedures)h
(\\getc")f(and)f(\\putc")h(dis-)-30 959 y(cussed)e(here)e(are)g
Fi(NOT)g Fn(directly)f(related)h(to)g(the)g(pro)q(ce-)-30 1009
y(dures)18 b(d1scussed)h(in)d(the)h(Sections)g(\\GETC\(I)q(I)q(I\)")g(and)-30
1059 y(\\PUTC\(I)q(I)q(I\)")e(of)e(the)h(UPM.)-30 1216 y Fg(23.4)56
b(Character)19 b(Sets)-30 1307 y Fn(UNIX)g(mak)o(es)f(use)i(of)e(the)h(full)e
(ASCI)q(I)i(c)o(haracter)h(set,)-30 1357 y(whic)o(h)h(is)f(displa)o(y)o(ed)g
(in)g(Section)h(\\ASCI)q(I\(V\)")g(of)f(the)-30 1407 y(UPM.)12
b(Since)g(kno)o(wledge)g(of)f(this)g(c)o(haracter)j(set)e(is)g(often)-30
1457 y(assumed)17 b(without)f(commen)o(t,)f(not)i(alw)o(a)o(ys)f
(justi\014ably)m(,)-30 1507 y(some)d(commen)o(t)f(here)j(w)o(ould)e(seem)h
(to)g(b)q(e)g(in)g(order.)33 1564 y(\\ASCI)q(I")c(is)h(an)g(acron)o(ym)e(for)
i(\\American)f(Standard)-30 1614 y(Co)q(de)15 b(for)e(Information)f(In)o
(terc)o(hange".)-30 1771 y Fg(23.5)56 b(Con)n(trol)19 b(Characters)-30
1863 y Fn(The)e(\014rst)h(32)e(of)f(the)j(128)d(ASCI)q(I)i(c)o(haracters)h
(are)f(non-)-30 1912 y(graphic)i(and)g(are)h(in)o(tended)g(for)e(the)i(con)o
(trol)f(of)g(some)-30 1962 y(asp)q(ect)13 b(of)e(transmission)f(or)i(displa)o
(y)m(.)j(The)d(con)o(trol)g(c)o(har-)-30 2012 y(acters)k(explicitly)d(used)h
(or)g(recognised)h(b)o(y)f(UNIX)g(are)-5 2117 y Fi(Numeric)241
b(Description)133 b(UNIX)-5 2166 y(V)l(alue)681 b(Name)p -30
2183 988 2 v -5 2218 a Fn(004)167 b(eot)50 b(end)14 b(of)g(transmission)110
b(004)330 2268 y(or)14 b(\(con)o(trol-D\))-5 2318 y(010)167
b(bs)66 b(bac)o(k)14 b(space)271 b(010)-5 2367 y(011)167 b(h)o(t)67
b(\(horizon)o(tal\))13 b(tab)177 b(')p Ff(\\)p Fn(t')-5 2417
y(012)167 b(nl)70 b(new)14 b(line)g(or)g(line)f(feed)99 b(F)o(ORM)-5
2467 y(014)167 b(np)59 b(new)14 b(page)g(or)g(form)e(feed)61
b(')p Ff(\\)p Fn(r')-5 2517 y(015)167 b(cr)71 b(carriage)14
b(return)195 b(')p Ff(\\)p Fn(n')-5 2567 y(034)167 b(fs)76
b(\014le)14 b(separator)h(or)e(quit)91 b(CQUIT)-5 2616 y(040)167
b(sp)66 b(forw)o(ard)13 b(space)i(or)f(blank)49 b(')14 b(')-5
2666 y(0177)146 b(del)52 b(delete)359 b(CINTR)33 2722 y(It)11
b(will)f(b)q(e)i(noted)f(that)g(the)h(last)f(t)o(w)o(o)g(of)f(these)j(b)q
(elong)-30 2772 y(to)i(the)g(last)f(96)g(c)o(haracters)i(or)f(the)g(graphic)f
(p)q(ortion,)g(of)-30 2822 y(the)h(co)q(de.)1010 17 y Fg(23.6)56
b(Graphic)18 b(Characters)1010 99 y Fn(There)d(are)f(96)f(graphic)h(c)o
(haracters.)19 b(Tw)o(o)14 b(of)f(these,)h(the)1010 149 y(space)f(and)g(the)g
(delete,)h(are)f(not)f(\\visible",)f(and)i(ma)o(y)d(b)q(e)1010
199 y(ciassi\014ed)k(with)g(the)g(con)o(trol)g(c)o(haracters.)1072
252 y(The)25 b(graphic)g(c)o(haracters)h(ma)o(y)d(b)q(e)i(divided)g(in)o(to)
1010 302 y(three)11 b(groups)f(of)f(32)g(c)o(haracters,)i(whic)o(h)f(ma)o(y)e
(b)q(e)i(roughly)1010 351 y(c)o(haracterised)16 b(as)1072 455
y Fl(\017)21 b Fn(n)o(umeric)13 b(and)g(sp)q(ecial)i(c)o(haracters)1072
551 y Fl(\017)21 b Fn(upp)q(er)15 b(case)f(alphab)q(etic)g(c)o(haracters)1072
647 y Fl(\017)21 b Fn(lo)o(w)o(er)13 b(case)i(alphab)q(etic)f(c)o(haracters.)
1072 751 y(Of)21 b(course,)i(since)f(there)g(are)f(only)f(26)g(alphab)q(etic)
1010 801 y(c)o(haracters,)14 b(the)g(latter)g(t)o(w)o(o)e(groups)i(include)f
(some)f(sp)q(e-)1010 851 y(cial)f(c)o(haracters)j(as)e(w)o(ell.)17
b(In)12 b(particular,)g(the)g(last)g(group)1010 900 y(includes)g(the)g(follo)
o(wing)c(six)k(nonalphab)q(etic)f(c)o(haracters:)1097 1001
y(140)49 b(`)60 b(rev)o(erse)16 b(ap)q(ostrophe)1097 1050 y(173)49
b Fl(f)i Fn(left)13 b(brace)1097 1100 y(174)49 b Ff(|)h Fn(v)o(ertical)13
b(bar)1097 1150 y(175)49 b Fl(g)i Fn(righ)o(t)13 b(brace)1097
1200 y(176)49 b Ff(~)h Fn(tilde)1097 1250 y(177)121 b(delete)1010
1378 y Fg(23.7)56 b(Graphic)18 b(Character)h(Sets)1010 1461
y Fn(Devices)10 b(suc)o(h)g(as)g(line)f(prin)o(ters)i(or)e(terminals)f(whic)o
(h)i(sup-)1010 1511 y(p)q(ort)g Fi(all)e Fn(the)j(ASCI)q(I)f(graphic)f(sym)o
(b)q(ols)g(are)h(often)g(said)f(to)1010 1560 y(supp)q(ort)17
b(the)g(96)e(ASCI)q(I)i(c)o(haracter)g(set)h(\(though)e(there)1010
1610 y(are)e(only)f(94)h(graphics)g(actually)f(in)o(v)o(olv)o(ed\).)1072
1663 y(Devices)22 b(whic)o(h)f(supp)q(ort)h(all)e(the)i(ASCI)q(I)f(graphic)
1010 1713 y(sym)o(b)q(ols)16 b(except)k(those)f(in)e(the)i(last)e(group)h(of)
g(32,)g(are)1010 1763 y(said)e(to)g(supp)q(ort)i(the)f(64)f(ASCI)q(I)h(c)o
(haracter)h(set.)27 b(Suc)o(h)1010 1813 y(devices)11 b(lac)o(k)e(the)i(lo)o
(w)o(er)f(case)h(alphab)q(etics)f(and)g(the)g(sym-)1010 1862
y(b)q(ols)16 b(listed)g(ab)q(o)o(v)o(e,)g(namely)e(\\)p Ff(~)p
Fn(",)i(\\)p Fl(f)p Fn(",)f(\\)p Ff(|)p Fn(")h(and)f(\\)p Ff(\\})p
Fn(".)1010 1912 y(Note)g(that)f(\\delete",)h(since)h(it)e(is)g(not)h(a)f
(visible)g(c)o(harac-)1010 1962 y(ter,)g(can)g(still)f(b)q(e)i(supp)q(orted.)
1072 2015 y(Devices)h(in)f(this)g(latter)h(group)f(ma)o(y)e(b)q(e)j(referred)
h(to)1010 2065 y(as)d(\\upp)q(er)g(case)h(only".)1072 2118
y(Sometimes)10 b(some)i(of)g(the)h(graphic)f(sym)o(b)q(ols)f(ma)o(y)f(b)q(e)
1010 2168 y(non-standard,)16 b(e.g.)23 b Fl( )15 b Fn(instead)h(of)p
1617 2168 13 2 v 45 w(and)g(this)g(can)f(b)q(e)1010 2217 y(incon)o(v)o(enien)
o(t,)e(though)h(not)g(usually)f(fatal.)1072 2270 y(UNIX)20
b(prefers,)j(as)d(the)h(reader)g(is)f(no)g(doubt)g(w)o(ell)1010
2320 y(a)o(w)o(are,)10 b(to)h(view)f(the)h(w)o(orld)f(through)h(\\lo)o(w)o
(er)f(case")h(sp)q(ec-)1010 2370 y(tacles.)18 b(Alphab)q(etic)11
b(c)o(haracters)h(receiv)o(ed)h(from)c(an)h(\\up-)1010 2420
y(p)q(er)k(case)g(only")e(terminal)f(are)i(translated)h(imm)o(ediately)1010
2470 y(up)q(on)22 b(receipt)h(from)d(upp)q(er)j(case)g(to)f(lo)o(w)o(er)g
(case.)43 b(A)1010 2520 y(lo)o(w)o(er)17 b(case)i(alphab)q(etic)f(ma)o(y)e
(subsequen)o(tly)j(b)q(e)g(trans-)1010 2569 y(lated)k(bac)o(k)g(to)f(upp)q
(er)i(case)g(if)e(it)h(is)g(preceded)i(b)o(y)d(a)1010 2619
y(single)d(bac)o(kslash.)35 b(F)m(or)19 b(output)h(to)g(suc)o(h)g(a)f
(terminal,)1010 2669 y(b)q(oth)10 b(upp)q(er)h(and)f(lo)o(w)o(er)f(case)i
(alphab)q(etic)f(c)o(haracters)i(are)1010 2719 y(mapp)q(ed)h(to)h(upp)q
(ercase.)1072 2772 y(The)h(con)o(v)o(en)o(tions)g(for)f(line)g(prin)o(ters)i
(and)e(terminals)1010 2822 y(are)g(di\013eren)o(t)h(b)q(ecause:)-30
2946 y(94)p eop
%%Page: 95 103
102 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)786
b(23)43 b(CHARA)o(CTER)14 b(HANDLING)-30 17 y Fi(\(a\))21 b
Fn(for)c(line)h(prin)o(ters,)i(horizon)o(tal)d(alignmen)o(t)f(is)i(usu-)74
66 y(ally)j(imp)q(ortan)o(t,)i(and)f(it)g(is)g(p)q(ossible)h(\(without)74
116 y(to)q(o)13 b(m)o(uc)o(h)f(di\016cult)o(y\))h(to)g(prin)o(t)g(comp)q
(osite,)f(o)o(v)o(er-)74 166 y(struc)o(k)g(c)o(haracters)g(\(using)e(the)h
(min)o(us)e(sign)i(in)f(this)74 216 y(case\);)15 b(and)-30
301 y Fi(\(b\))20 b Fn(for)13 b(terminals,)f(horizon)o(tal)h(alignmen)o(t)f
(is)i(not)g(con-)74 351 y(sidered)22 b(to)e(b)q(e)h(so)g(imp)q(ortan)o(t;)g
(bac)o(kspacing)g(to)74 401 y(pro)o(vide)c(o)o(v)o(erstruc)o(k)i(c)o
(haracters)g(do)q(es)f(not)f(w)o(ork)74 451 y(on)f(most)g(VDUs;)h(and,)f
(since)h(the)g(same)f(graphic)74 501 y(con)o(v)o(en)o(tions)f(are)f(used)h
(for)f(b)q(oth)h(input)f(and)g(out-)74 550 y(put,)j(the)g(sym)o(b)q(ols)e
(should)h(b)q(e)h(as)g(con)o(v)o(enien)o(t)g(to)74 600 y(t)o(yp)q(e)e(as)f(p)
q(ossible.)-30 719 y Fg(23.8)56 b(maptab)18 b(\(8117\))-30
797 y Fn(This)11 b(arra)o(y)g(is)g(used)h(in)f(the)g(translation)f(of)h(c)o
(haracter)h(in-)-30 847 y(put)g(from)e(a)i(terminal)e(preceded)k(b)o(y)d(a)h
(single)f(bac)o(kslash,)-30 897 y(\\)p Ff(\\)p Fn(".)33 947
y(There)18 b(are)g(three)h(c)o(haracters,)h(004)c(\(eot\),)j(`#')d(and)-30
997 y(`@',)f(whic)o(h)h(alw)o(a)o(ys)e(ha)o(v)o(e)h(sp)q(ecial)h(meanings)e
(and)i(need)-30 1047 y(to)e(b)q(e)g(asserted)h(b)o(y)e(a)g(bac)o(kslash)g
(whenev)o(er)i(they)f(are)g(to)-30 1097 y(b)q(e)i(in)o(terpreted)g(literally)
m(.)j(These)d(three)g(c)o(haracters)h(o)q(c-)-30 1146 y(cur)i(in)f(\\maptab")
e(in)h(their)i(\\natural")e(lo)q(cations)h(\(i.e.)-30 1196
y(their)13 b(lo)q(cations)e(in)g(the)h(ASCI)q(I)g(table\).)18
b(Th)o(us)12 b(for)f(exam-)-30 1246 y(ple)j(`#')f(has)h(co)q(de)h(043)e(and)
36 1340 y Ff(maptab[043])19 b(==)j(043.)33 1434 y Fn(The)15
b(other)h(non-n)o(ull)e(c)o(haracters)j(in)d(\\maptab")f(are)-30
1484 y(in)o(v)o(olv)o(ed)e(in)h(the)h(translation)f(of)f(input)h(c)o
(haracters)i(from)-30 1534 y(\\upp)q(er)25 b(case)g(only")e(devices)i(and)f
(do)g(not)g(o)q(ccur)h(in)-30 1583 y(their)12 b(\\natural")d(lo)q(cations)h
(but)h(in)f(the)i(lo)q(cation)d(of)h(their)-30 1633 y(equiv)n(alen)o(t)k(c)o
(haracter,)i(e.g.)k(\\)p Ff(\\)p Fl(f)p Fn(")14 b(o)q(ccurs)i(in)f(the)g
(natu-)-30 1683 y(ral)h(lo)q(cation)f(for)g(\\)p Fl(f)p Fn(",)g(since)i(\\)p
Ff(\\)p Fl(f)p Fn(")d(will)h(b)q(e)h(in)o(terpreted)-30 1733
y(as)e(\\)p Fl(f)p Fn(",)f(etc.)33 1783 y(Note)g(the)h(situation)f(regarding)
g(alphab)q(etic)g(c)o(harac-)-30 1833 y(ters.)19 b(This)13
b(is)f(only)g(explicable)g(when)h(it)g(is)f(remem)o(b)q(ered)-30
1883 y(that)i(the)h(alphab)q(etic)f(c)o(haracters)h(are)g(all)d(translated)j
(to)-30 1933 y(lo)o(w)o(er)f(case)h(b)q(efore)f(an)o(y)g(bac)o(kslash)g(is)g
(recognised.)-30 2052 y Fg(23.9)56 b(partab)19 b(\(7947\))-30
2130 y Fn(This)10 b(arra)o(y)f(consists)h(of)f(256)f(c)o(haracters,)k(lik)o
(e)c(\\maptab".)-30 2179 y(Unfortunately)25 b(the)g(initialisation)c(of)j
(\\partab")g(w)o(as)-30 2229 y(omitted)15 b(from)g(the)h(UNIX)h(Op)q(erating)
f(System)g(Source)-30 2279 y(Co)q(de)11 b(b)q(o)q(oklet.)17
b(It)11 b(is)f(certainly)h(needed,)h(and)e(so)h(is)f(giv)o(en)-30
2329 y(no)o(w:)14 2423 y Ff(char)21 b(partab)g([])g({)-30 2523
y(0001,0201,0201,0001,)o(0201,)o(0001)o(,0001)o(,0201)o(,)-30
2573 y(0202,0004,0003,0205,)o(0005,)o(0206)o(,0201)o(,0001)o(,)-30
2622 y(0201,0001,0001,0201,)o(0001,)o(0201)o(,0201)o(,0001)o(,)-30
2672 y(0001,0201,0201,0001,)o(0201,)o(0001)o(,0001)o(,0201)o(,)-30
2722 y(0200)g(0000,0000,0200,0000,)o(0200)o(,0200)o(,0000)o(,)-30
2772 y(0000)g(0200,0200)f(0000,0200,0000,0000)o(,0200)o(,)-30
2822 y(0000,0200,0200)f(0000,0200,0000,0000)o(,0200)o(,)1010
17 y(0200,0000,0000,02)o(00,0)o(000,0)o(200,0)o(200,0)o(000,)1010
66 y(0200,0000,0000,02)o(00,0)o(000,0)o(200,0)o(200,0)o(000,)1010
116 y(0000,0200,0200,00)o(00,0)o(200,0)o(000,0)o(000,0)o(200,)1010
166 y(0000,0200,0200,00)o(00,0)o(200,0)o(000,0)o(000,0)o(200,)1010
216 y(0200)i(0000,0000)f(0200,0000,0200,0)o(200,0)o(000,)1010
266 y(0000)h(0200,0200)f(0000,0200,0000,0)o(000,0)o(200,)1010
316 y(0200,0000,0000,02)o(00,0)o(000,0)o(200,0)o(200,0)o(000,)1010
365 y(0200,0000,0000,02)o(00,0)o(000,0)o(200,0)o(200,0)o(000,)1010
415 y(0000,0200,0200,00)o(00,0)o(200,0)o(000,0)o(000,0)o(201)1075
465 y(};)1072 556 y Fn(Eac)o(h)d(elemen)o(t)f(of)g(\\partab")g(is)h(an)f
(eigh)o(t)h(bit)f(c)o(har-)1010 606 y(acter,)f(whic)o(h,)g(with)f(the)h(use)h
(of)e(appropriate)g(bitmasks)1010 656 y(\(0200)h(and)g(0177\),)g(can)h(b)q(e)
g(in)o(terpreted)i(as)d(a)h(t)o(w)o(o)f(part)1010 706 y(structure:)1097
795 y(bit)f(7)100 b(parit)o(y)13 b(bit;)1097 844 y(bits)h(3-5)49
b(not)14 b(used.)19 b(Alw)o(a)o(ys)13 b(zero;)1097 894 y(bits)h(0-2)49
b(co)q(de)15 b(n)o(um)o(b)q(er.)1072 992 y(The)24 b(parit)o(y)e(bit)h(is)g
(app)q(ended)h(to)f(the)g(sev)o(en)h(bit)1010 1042 y(ASCI)q(I)13
b(co)q(de)g(when)g(a)f(c)o(haracter)i(is)e(transmitted)g(b)o(y)g(the)1010
1092 y(computer,)g(to)h(form)f(an)g(eigh)o(t)h(bit)g(co)q(de)h(with)e(ev)o
(en)i(par-)1010 1141 y(it)o(y)m(.)1072 1191 y(The)f(co)q(de)g(n)o(um)o(b)q
(er)e(is)h(used)h(b)o(y)f(\\tt)o(y)o(output")g(\(8426\))1010
1241 y(to)f(classify)g(the)g(c)o(haracter)i(in)o(to)d(one)h(of)g(sev)o(en)h
(categories)1010 1291 y(for)d(determining)g(the)i(dela)o(y)e(whic)o(h)h
(should)g(ensue)h(b)q(efore)1010 1341 y(the)g(transmission)e(of)g(the)i(next)
g(c)o(haracter.)18 b(\(This)10 b(is)g(par-)1010 1390 y(ticularly)18
b(imp)q(ortan)o(t)f(for)h(mec)o(hanical)f(prin)o(ters)j(whic)o(h)1010
1440 y(require)13 b(time)d(for)i(the)h(carriage)f(to)g(return)h(from)d(the)j
(end)1010 1490 y(of)g(a)h(line,)f(etc.\))1890 2946 y(95)p eop
%%Page: 96 104
103 bop -30 -144 a Fk(24)43 b(INTERA)o(CTIVE)14 b(TERMINALS)734
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(24)70 b(In)n(teractiv)n(e)
21 b(T)-6 b(erminal)o(s)-30 108 y Fn(Our)20 b(remaining)c(task,)k(to)e(b)q(e)
i(completed)e(in)g(this)h(and)-30 157 y(the)13 b(follo)o(wing)d(c)o(hapter,)j
(is)f(to)h(consider)g(the)g(co)q(de)g(whic)o(h)-30 207 y(con)o(trols)19
b(in)o(teractiv)o(e)h(terminals)d(\(or)i(\\terminals",)f(for)-30
257 y(short\).)33 307 y(A)12 b(wide)g(v)n(ariet)o(y)g(of)f(terminals)g(is)h
(a)o(v)n(ailable)e(and)i(sev-)-30 357 y(eral)f(di\013eren)o(t)h(t)o(yp)q(es)g
(ma)o(y)d(b)q(e)j(sim)o(ultaneously)d(attac)o(hed)-30 406 y(to)19
b(a)g(single)g(computer.)33 b(Distinguishing)18 b(c)o(haracteris-)-30
456 y(tics)23 b(for)e(di\013eren)o(t)i(classes)h(of)d(terminal)f(include)i
(\(b)q(e-)-30 506 y(sides)15 b(suc)o(h)g(non-essen)o(tial)f(features)h(as)g
(shap)q(e,)f(size)h(and)-30 556 y(colour\):)-30 642 y Fi(\(a\))21
b Fn(transmission)k(sp)q(eed,)31 b(e.g.)56 b(110)26 b(baud)h(for)f(an)74
692 y(ASR33)17 b(telet)o(yp)q(e,)h(300)e(baud)h(for)g(a)g(DECwriter,)74
742 y(2400)d(baud)g(or)g(9600)f(baud)h(for)g(a)g(Visual)g(Displa)o(y)74
791 y(unit)g(\(\\VD"\);)-30 872 y Fi(\(b\))20 b Fn(graphic)d(c)o(haracter)i
(set,)f(notably)f(the)g(full)f(ASCI)q(I)74 922 y(graphic)e(set)h(and)e(the)i
(64)e(graphic)h(subset;)-30 1003 y Fi(\(c\))21 b Fn(transmission)15
b(parit)o(y:)23 b(o)q(dd,)17 b(ev)o(en,)h(none)f(or)f(inop-)74
1053 y(eratlv)o(e;)-30 1134 y Fi(\(d\))k Fn(output)c(tec)o(hnique:)24
b(serial)16 b(prin)o(ter)h(or)g(visual)e(dis-)74 1184 y(pla)o(y;)-30
1264 y Fi(\(e\))20 b Fn(miscellaneous:)30 b(com)o(bined)19
b(carriage)h(return/line)74 1314 y(feed)j(c)o(haracter,)i(half)c(duplex)h
(terminal)e(\(input)74 1364 y(c)o(haracters)e(do)f(not)f(need)i(ec)o
(hoing\);)f(recognition)74 1414 y(of)d(tab)f(c)o(haracters;)-30
1495 y Fi(\(f)5 b(\))19 b Fn(c)o(haracteristic)j(dela)o(ys)e(for)g(certain)h
(con)o(trol)f(func-)74 1545 y(tions,)c(e.g.)22 b(carriage)16
b(returns)h(ma)o(y)d(not)h(b)q(e)h(com-)74 1594 y(pleted)g(within)e(a)h
(single)g(c)o(haracter)h(transmission)74 1644 y(time,)c(etc.)33
1730 y(As)17 b(w)o(ell)f(as)h(the)g(wide)f(v)n(ariet)o(y)g(of)h(terminals)e
(whic)o(h)-30 1780 y(are)j(a)o(v)n(ailable)d(and)i(in)f(use,)i(there)h(is)e
(also)f(a)h(v)n(ariet)o(y)f(of)-30 1830 y(hardw)o(are)e(devices)h(whic)o(h)f
(ma)o(y)d(b)q(e)k(used)f(to)g(in)o(terface)g(a)-30 1880 y(terminal)f(to)g(a)h
(PDP)g(11)f(computer.)18 b(F)m(or)c(example:)-5 1977 y(DL11/KL11)49
b(single)13 b(line,)g(async)o(hronous)265 2026 y(in)o(terface;)h(13)f
(standard)265 2076 y(transmission)g(rates)h(b)q(et)o(w)o(een)265
2126 y(40)f(and)h(9600)f(baud;)-5 2226 y(DJ11)175 b(16)13 b(line,)g(async)o
(hronous,)h(bu\013ered)265 2276 y(serial)g(line)f(m)o(ultiplexer;)f(11)265
2325 y(sp)q(eeds)k(b)q(et)o(w)o(een)f(75)e(and)h(9600)f(baud,)265
2375 y(selectable)i(in)e(four)h(line)f(groups;)-5 2475 y(DH11)165
b(16)13 b(line,)g(async)o(hronous,)h(bu\013ered,)265 2525 y(serial)g(line)f
(m)o(ultiplexer;)f(14)h(sp)q(eeds,)265 2574 y(individually)e(selectable;)k
(DMA)265 2624 y(transmission)33 2672 y(Eac)o(h)f(of)e(the)j(ab)q(o)o(v)o(e)e
(in)o(terfaces)h(will)e(w)o(ork)h(in)g(full)g(or)-30 2722 y(half)j(duplex)h
(mo)q(de;)f(handle)h(5,)g(6,)f(7)h(or)f(8)h(lev)o(el)f(co)q(des;)-30
2772 y(generate)c(o)q(dd,)e(ev)o(en)h(or)f(no)f(parit)o(y;)i(and)e(generate)j
(a)d(stop)-30 2822 y(co)q(de)15 b(of)e(1,)h(1.5)e(or)i(2)g(bits.)1072
17 y(In)22 b(addition)f(to)h(the)h(ab)q(o)o(v)o(e)e(async)o(hronous)i(in)o
(ter-)1010 66 y(faces,)12 b(there)g(are)g(a)f(n)o(um)o(b)q(er)g(of)f(sync)o
(hronous)j(in)o(terfaces,)1010 116 y(e.g.)18 b(DQ11.)1072 166
y(Eac)o(h)g(in)o(terface)f(has)h(its)f(o)o(wn)g(con)o(trol)g(c)o(haracteris-)
1010 216 y(tics)c(and)f(it)g(requires)i(a)e(separate)i(op)q(erating)e(system)
h(de-)1010 266 y(vice)f(driv)o(er.)17 b(The)c(common)c(co)q(de)j(whic)o(h)g
(can)g(b)q(e)g(shared)1010 316 y(b)q(et)o(w)o(een)k(these)h(is)d(gathered)i
(in)o(to)e(a)h(single)g(\014le)f(\\tt)o(y)m(.c",)1010 365 y(to)h(b)q(e)i
(found)e(on)g(Sheets)j(81)d(to)g(85.)23 b(A)16 b(set)h(of)e(common)1010
415 y(de\014nitions)i(is)g(gathered)h(in)e(the)i(\014le)f(\\tt)o(y)m(.h")e
(on)i(Sheet)1010 465 y(79.)1072 515 y(By)h(w)o(a)o(y)f(of)h(example,)f(Sheet)
i(80)e(con)o(tains)h(the)g(\014le)1010 565 y(\\kl.c",)12 b(whic)o(h)h
(constitutes)i(the)f(device)g(driv)o(er)f(for)g(a)g(set)1010
615 y(of)c(DL11/KL11)g(in)o(terfaces.)18 b(This)10 b(device)h(driv)o(er)f
(alw)o(a)o(ys)1010 664 y(needs)k(to)g(b)q(e)g(presen)o(t,)g(since)g(one)g
(KL11)f(in)o(terface)h(is)f(in-)1010 714 y(v)n(ariably)d(included)j(in)f(a)g
(system)g(for)g(the)h(the)g(op)q(erator's)1010 764 y(console)h(terminal.)1010
881 y Fg(24.1)56 b(The)18 b('tt)n(y')f(Structure)h(\(7926\))1010
957 y Fn(An)f(instance)h(of)f(\\tt)o(y")g(is)g(asso)q(ciated)h(with)f(ev)o
(ery)h(ter-)1010 1007 y(minal)13 b(p)q(ort)j(to)f(the)h(system)f(\(no)h
(matter)e(what)i(t)o(yp)q(e)g(of)1010 1057 y(hardw)o(are)g(in)o(terface)g(is)
g(used\).)25 b(A)16 b(\\p)q(ort")g(in)f(this)h(con-)1010 1107
y(text)h(is)g(a)f(place)h(to)g(attac)o(h)g(a)f(terminal)f(line.)26
b(Hence)18 b(a)1010 1157 y(DL11)13 b(supplies)i(only)f(one)h(p)q(ort,)f
(whereas)i(a)e(DJ11)g(sup-)1010 1206 y(plies)g(up)g(to)f(sixteen)i(p)q(orts.)
1072 1256 y(The)21 b(\\tt)o(y")g(structure)i(consists)f(of)e(sixteen)i(w)o
(ords)1010 1306 y(and)14 b(includes:)1035 1395 y(A.)50 b(t)p
1146 1395 13 2 v 15 w(dev)104 b(\014xed)14 b(for)f(a)h(particular)1128
1445 y(t)p 1146 1445 V 15 w(addr)84 b(terminal)12 b(p)q(ort;)1035
1544 y(B.)52 b(t)p 1146 1544 V 15 w(sp)q(eeds)g(\014xed)14
b(for)f(a)h(particular)1128 1594 y(t)p 1146 1594 V 15 w(erase)78
b(terminal.)16 b(These)f(v)n(alues)f(ma)o(y)1128 1644 y(t)p
1146 1644 V 15 w(kill)109 b(b)q(e)14 b(set)h(b)o(y)f(\\stt)o(y")f(and)1128
1694 y(t)p 1146 1694 V 15 w(\015ags)86 b(in)o(terrogated)14
b(b)o(y)g(\\gtt)o(y";)1035 1793 y(C.)51 b(t)p 1146 1793 V 15
w(ra)o(wq)79 b(list)13 b(heads)i(for)e Fi(three)1128 1843 y
Fn(t)p 1146 1843 V 15 w(canq)83 b(c)o(haracter)15 b(queues:)k(the)1128
1893 y(t)p 1146 1893 V 15 w(outq)85 b(so-called)13 b(\\ra)o(w")g(input,)1326
1943 y(\\co)q(ok)o(ed")g(input)h(and)g(the)1326 1993 y(output)g(queues;)1035
2092 y(D.)49 b(t)p 1146 2092 V 15 w(state)80 b(status)14 b(information)d
(whic)o(h)1128 2142 y(t)p 1146 2142 V 15 w(delct)80 b(c)o(hanges)14
b(frequen)o(tly)g(during)1128 2192 y(t)p 1146 2192 V 15 w(col)116
b(normal)11 b(pro)q(cessing;)1128 2242 y(t)p 1146 2242 V 15
w(c)o(har)1344 2337 y Fg(T)-5 b(able)19 b(24.1)1010 2454 y(24.2)74
b(In)n(teractiv)n(e)18 b(T)-5 b(erminals)1010 2531 y Fn(The)16
b(reader)g(should)f(study)h(the)g(information)c(on)j(Sheet)1010
2580 y(79)d(carefully)m(.)17 b(Certain)12 b(items)g(listed)h(b)q(elo)o(w)f
(are)h(not)g(ref-)1010 2630 y(erenced)g(in)e(an)o(y)g(essen)o(tial)h(w)o(a)o
(y)f(in)f(the)i(selection)g(of)f(co)q(de)1010 2680 y(examined)h(here.)1075
2772 y Ff(t_char)86 b(\(7940\))g(NLDELAY)64 b(\(7974\))1075
2822 y(t_speeds)42 b(\(7941\))86 b(TBDELAY)64 b(\(7975\))-30
2946 y Fn(96)p eop
%%Page: 97 105
104 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)733
b(24)43 b(INTERA)o(CTIVE)14 b(TERMINALS)36 17 y Ff(HUPCL)108
b(\(7966\))86 b(CRDELAY)64 b(\(7976\))36 66 y(ODDP)130 b(\(7972\))86
b(WOPEN)108 b(\(7985\))36 116 y(EVENP)g(\(7973\))86 b(ASLEEP)g(\(7993\))-30
237 y Fg(24.3)56 b(Initialisation)-30 315 y Fn(Initialisation)13
b(of)i(the)h(\\tt)o(y")f(structures)j(is)d(the)h(resp)q(on-)-30
365 y(sibilit)o(y)c(of)g(the)h(v)n(arious)f(\\op)q(en")h(routines)g(in)g(the)
g(device)-30 415 y(driv)o(ers,)i(for)e(example,)f(\\klop)q(en")h(\(8023\).)33
465 y(The)21 b(items)e(in)h(Group)h(B)f(of)g(T)m(able)g(24.1)f(ma)o(y)g(b)q
(e)-30 515 y(c)o(hanged)11 b(b)o(y)f(a)h(\\stt)o(y")f(system)g(call.)16
b(The)11 b(curren)o(t)h(v)n(alues)-30 565 y(ma)o(y)g(b)q(e)j(in)o(terrogated)
f(b)o(y)g(a)f(\\gtt)o(y")h(system)f(call.)33 616 y(A)18 b(description)g(of)f
(these)i(is)f(con)o(tained)g(in)f(the)i(sec-)-30 666 y(tions,)g(\\STTY\(I)q
(I\)")e(and)h(\\GTTY\(I)q(I\)")f(of)g(the)i(UPM.)-30 715 y(These)j(calls)e
(are)h(in)o(v)o(ok)o(ed)e(b)o(y)i(the)g(\\stt)o(y")f(shell)g(com-)-30
765 y(mand)11 b(whic)o(h)h(is)g(describ)q(ed)j(in)c(the)i(section)g
(\\STTY\(I\)".)33 816 y(Since)f(the)h(\\stt)o(y")f(and)g(\\gtt)o(y")g(system)
g(calls)g(require)-30 866 y(a)17 b(\014le)g(descriptor)h(as)f(a)f(parameter,)
h(they)g(can)g(only)f(b)q(e)-30 916 y(applied)e(to)f(an)h(\\op)q(en")g(c)o
(haracter)h(sp)q(ecial)f(\014le.)33 966 y(The)g(t)o(w)o(o)f(system)g(calls)h
(share)g(a)f(go)q(o)q(d)h(deal)f(of)g(com-)-30 1016 y(mon)k(co)q(de.)34
b(W)m(e)18 b(will)f(trace)j(the)f(progress)h(of)e(an)g(exe-)-30
1066 y(cution)h(of)f(\\stt)o(y")g(b)q(elo)o(w)g(and)h(lea)o(v)o(e)f(the)h
(tracing)f(of)g(a)-30 1116 y(similar)12 b(execution)j(of)e(\\gtt)o(y")g(to)h
(the)g(reader.)-30 1236 y Fg(24.4)56 b(stt)n(y)19 b(\(8183\))-30
1315 y Fn(This)c(pro)q(cedure)i(implemen)o(ts)12 b(the)k(\\stt)o(y")e(system)
h(call.)-30 1364 y(It)d(copies)g(three)h(w)o(ords)f(of)f(user)h(parameter)g
(information)-30 1414 y(in)o(to)k(\\u.u)p 138 1414 13 2 v 15
w(arg[..]")24 b(using)16 b(the)h(parameter)f(supplied)h(as)-30
1464 y(a)d(p)q(oin)o(ter,)g(and)f(then)i(calls)e(\\sgtt)o(y".)-30
1585 y Fg(24.5)56 b(sgtt)n(y)19 b(\(8201\))-30 1663 y Fi(8206:)i
Fn(Get)14 b(a)f(v)n(alidated)f(p)q(oin)o(ter)i(to)f(a)g(\\\014le")g(arra)o(y)
g(en-)74 1713 y(try;)-30 1799 y Fi(8209:)21 b Fn(Chec)o(k)14
b(that)g(the)h(\014le)f(is)g(a)f(\\c)o(haracter)i(sp)q(ecial";)-30
1886 y Fi(8213:)21 b Fn(Call)e(the)i(appropriate)f(\\d)p 548
1886 V 15 w(sgtt)o(y")g(routine)h(for)74 1935 y(the)15 b(device)f(t)o(yp)q
(e.)19 b(\(See)c(Sheet)g(46.\))33 2030 y(Note)h(that)g(the)h(\\d)p
347 2030 V 15 w(sgtt)o(y")f(routine)g(is)g(\\no)q(dev")g(for)-30
2080 y(the)f(line)e(prin)o(ter)i(and)f(pap)q(er)g(tap)q(e)h(reader/punc)o(h.)
-30 2201 y Fg(24.6)56 b(klsgtt)n(y)18 b(\(8090\))-30 2279 y
Fn(This)e(is)f(an)g(example)f(of)h(a)g(\\d)p 464 2279 V 15
w(sgtt)o(y")g(routine.)23 b(It)15 b(calls)-30 2329 y(\\tt)o(ystt)o(y")c
(passing)g(a)g(p)q(oin)o(ter)g(to)g(the)g(appropriate)g(\\tt)o(y")-30
2379 y(structure)17 b(as)c(a)h(parameter.)-30 2499 y Fg(24.7)56
b(t)n(yst)n(y)19 b(\(8577\))-30 2577 y Fn(A)g(call)f(originating)f(from)g
(\\stt)o(y")h(will)g(ha)o(v)o(e)g(a)h(second)-30 2627 y(parameter)14
b(of)f(zero.)-30 2722 y Fi(8589:)21 b Fn(Empt)o(y)e(all)h(the)h(queues)h
(asso)q(ciated)g(with)e(the)74 2772 y(terminal)12 b(forth)o(with.)17
b(They)d(quite)g(lik)o(ely)e(con)o(tain)74 2822 y(nonsense;)1010
17 y Fi(8591:)20 b Fn(Reset)f(the)g(sp)q(eed)h(information)15
b(\(useful)k(in)e(the)1114 66 y(case)c(of)g(a)f(DH11)g(in)o(terface,)h(but)h
(of)e(little)g(in)o(terest)1114 116 y(for)h(the)i(presen)o(t)g(selection)g
(of)e(co)q(de\);)1114 180 y(Reset)24 b(the)f(\\erase")h(c)o(haracter)h(and)d
(the)i(\\kill")1114 229 y(c)o(haracter.)29 b(\(\\kill")15 b(here)j(denotes)g
(\\thro)o(w)f(a)o(w)o(a)o(y)1114 279 y(the)h(curren)o(t)i(input)e(line".\))30
b(Note)19 b(that)f(if)g(these)1114 329 y(c)o(haracters)g(are)f(c)o(hanged)f
(a)o(w)o(a)o(y)g(from)e(their)j(nor-)1114 379 y(mal)e(v)n(alues)j(of)f(\\#")g
(and)h(\\@")g(resp)q(ectiv)o(ely)m(,)h(no)1114 429 y(corresp)q(onding)10
b(c)o(hanges)g(are)f(made)g(to)g(\\maptab".)1114 478 y(Nor)14
b(should)f(they!\),)1010 555 y Fi(8593:)20 b Fn(Reset)13 b(the)g(\\\015ags")e
(de\014ning)h(some)f(relev)n(an)o(t)g(ter-)1114 605 y(minal)g(c)o
(haracteristics)16 b(\(see)f(Sheet)g(79\):)1139 718 y Fi(\015ag)138
b(bit)48 b(if)15 b(set)g(...)1139 817 y Fn(XT)m(ABS)71 b(1)87
b(the)15 b(terminal)d(will)g(not)i(in)o(terpret)1459 867 y(horizon)o(tal)f
(tab)h(c)o(haracters)1459 917 y(correctly;)1139 1017 y(LCASE)74
b(2)87 b(the)15 b(terminal)d(supp)q(orts)j(only)e(the)1459
1066 y(64)g(c)o(haracter)j(ASCI)q(I)e(subset;)1139 1166 y(ECHO)91
b(3)c(the)15 b(terminal)d(is)h(op)q(erating)h(in)1459 1216
y(full)f(duplex)h(mo)q(de,)e(and)i(input)1459 1266 y(c)o(haracters)i(m)o(ust)
d(b)q(e)h(ec)o(ho)q(ed)1459 1315 y(bac)o(k;)1139 1415 y(CRMOD)49
b(4)87 b(up)q(on)14 b(input,)f(a)h(\\carriage)1459 1465 y(return")h(is)f
(replaced)h(b)o(y)e(a)1459 1515 y(\\line)g(feed";)h(up)q(on)g(output,)g(a)
1459 1565 y(\\line)f(feed")h(is)g(replaced)h(b)o(y)f(a)1459
1614 y(\\carriage)g(return")h(and)e(a)h(\\line)1459 1664 y(feed";)1139
1764 y(RA)-5 b(W)112 b(5)87 b(input)14 b(c)o(haracters)h(are)g(to)e(b)q(e)
1459 1814 y(sen)o(t)i(to)f(the)g(program)e(exactly)1459 1863
y(as)i(receiv)o(ed,)h(without)e(\\erase")1459 1913 y(or\\kill")f(pro)q
(cessing,)j(or)1459 1963 y(adjustmen)o(t)e(for)h(bac)o(kslash)1459
2013 y(c)o(haracters.)1114 2074 y(In)23 b(addition,)h(the)g(follo)o(wing)c
(bits)j(are)h(in)o(terro-)1114 2124 y(gated)16 b(b)o(y)g(\\tt)o(y)o(output")g
(\(8373\))f(in)h(c)o(ho)q(osing)f(the)1114 2174 y(dela)o(y)21
b(whic)o(h)g(should)g(ensue)i(after)f(the)g(c)o(harac-)1114
2224 y(ter)15 b(indicated)g(is)g(sen)o(t,)g(b)q(efore)h(sending)f(the)h(next)
1114 2273 y(c)o(haracter:)1139 2376 y(8,9)90 b(line)13 b(feed;)1139
2426 y(10,11)48 b(horizon)o(tal)13 b(tab;)1139 2475 y(12,13)48
b(carriage)14 b(return;)1139 2525 y(14)102 b(v)o(ertical)14
b(tab)f(or)h(form)e(feed.)1010 2637 y Fg(24.8)56 b(The)22 b(DL11/KL11)h(T)-5
b(erminal)21 b(De-)1166 2695 y(vice)c(Handler)1010 2772 y Fn(The)j(\014le)g
(\\kl.c")f(constitutes)j(the)e(device)h(handler)f(for)1010
2822 y(terminals)12 b(connected)j(to)f(the)g(system)f(via)f(DL11/KL11)1890
2946 y(97)p eop
%%Page: 98 106
105 bop -30 -144 a Fk(24)43 b(INTERA)o(CTIVE)14 b(TERMINALS)734
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fn(in)o(terfaces.)j(This)11
b(group)f(alw)o(a)o(ys)g(has)g(at)h(least)f(one)h(mem-)-30
66 y(b)q(er)19 b({)e(the)h(op)q(erator's)f(console)h(terminal.)27
b(Hence)19 b(this)-30 116 y(device)c(handler)f(will)f(alw)o(a)o(ys)f(b)q(e)j
(presen)o(t.)33 167 y(Eac)o(h)g(DL11/KL11)f(hardw)o(are)h(con)o(troller)g
(pro)o(vldes)-30 217 y(an)c(async)o(hronous,)h(serial)e(in)o(terface)i(to)e
(connect)j(a)d(single)-30 267 y(terminal)15 b(to)g(a)h(PDP)g(11)f(system.)23
b(F)m(or)16 b(more)e(complete)-30 317 y(details)21 b(regarding)f(this)g(in)o
(terface)h(the)g(reader)h(should)-30 367 y(consult)15 b(the)f(\\PDP11)f(P)o
(eripherals)i(Handb)q(o)q(ok".)-30 489 y Fg(24.9)56 b(Device)17
b(Registers)-30 568 y Fn(Eac)o(h)c(DL11/RL11)d(unit)j(has)f(a)g(group)g(of)g
(four)g(registers)-30 618 y(o)q(ccup)o(ying)20 b(four)e(consecutiv)o(e)j(w)o
(ords)e(on)g(the)g(UNIBS.)-30 667 y(UNIX)11 b(maps)d(a)i(structure)i(of)d(t)o
(yp)q(e)h(\\klregs")g(\(8016\))f(on)o(to)-30 717 y(eac)o(h)15
b(register)g(group.)-5 815 y Fi(Receiv)o(er)g(Status)f(Register)g(\(klrcsr\))
-5 865 y Fn(bit)g(7)50 b Fi(Receiv)o(er)14 b(Done.)j Fn(\(A)e(c)o(haracter)g
(has)131 915 y(b)q(een)g(transferred)g(in)o(to)e(the)131 965
y(Receiv)o(er)h(Data)f(Bu\013er)j(Register.\);)-5 1064 y(bit)e(6)50
b Fi(Receiv)o(er)14 b(In)o(terrupt)e(Enable.)131 1114 y Fn(\(When)i(set,)g
(an)g(in)o(terrupt)g(is)131 1164 y(caused)h(ev)o(ery)f(time)f(bit)g(7)h(is)g
(set.\);)-5 1264 y(bit)g(1)50 b Fi(Data)15 b(terminal)e(ready;)-5
1363 y Fn(bit)h(0)50 b Fi(Reader)14 b(Enable.)21 b(W)l(rite)14
b(only)l(.)131 1413 y Fn(\(When)g(set,)g(bit)g(7)f(is)h(cleared.\).)-5
1518 y Fi(Receiv)o(er)h(Data)g(Bu\013er)g(Register)f(\(klrbuf)5
b(\))-5 1568 y Fn(bit)14 b(15)79 b(Error)15 b(indication,)d(when)j(set.)-5
1668 y(bits)f(7-0)49 b(Receiv)o(ed)15 b(c)o(haracter,)g(Read)181
1717 y(only)m(.)-5 1822 y Fi(T)l(ransmitter)e(Status)i(Register)e(\(kltcsr\))
-5 1872 y Fn(bit)h(7)50 b Fi(T)l(ransmitter)13 b(ready)l(.)18
b Fn(This)c(is)131 1922 y(cleared)g(when)h(data)e(is)h(loaded)131
1972 y(in)o(to)f(the)h(T)m(ransmitter)f(Data)131 2022 y(Bu\013er,)h(and)g(is)
g(set)h(when)f(the)131 2071 y(latter)g(is)f(ready)i(to)e(receiv)o(e)131
2121 y(another)h(c)o(hatacter;)-5 2221 y(bit)g(6)50 b Fi(T)l(ransmitter)13
b(In)o(terrupt)f(Enable.)131 2271 y Fn(\(when)i(set,)g(causes)i(an)131
2320 y(in)o(terrupt)e(to)g(b)q(e)g(generated)131 2370 y(whenev)o(er)h(bit)e
(7)h(is)g(set.\))-5 2475 y Fi(T)l(ransmitter)f(Data)j(Bu\013er)f(Register)e
(\(kltbuf)5 b(\))-5 2525 y Fn(bits)14 b(7-0)49 b(T)m(ransmitted)13
b(data.)18 b(W)m(rite)13 b(only)m(.)-30 2643 y Fg(24.10)56
b(UNIBUS)19 b(Addresses)-30 2722 y Fn(The)c(Receiv)o(er)g(Status)g(Register)f
(alw)o(a)o(ys)f(has)i(its)f(lo)o(w)o(est)-30 2772 y(address)f(starting)d(on)h
(a)g(four)f(w)o(ord)h(b)q(oundary)m(.)17 b(\(The)11 b(ad-)-30
2822 y(dresses)16 b(whic)o(h)e(follo)o(w)d(are)j(all)e(18)h(bit)h(o)q(ctal)f
(addresses.\))1421 60 y Fi(Receiv)o(er)48 b(T)l(ransmitter)1421
110 y(Status)95 b(Status)1035 159 y Fn(Op)q(erator's)15 b(console)50
b(777560)12 b Fl(!)49 b Fn(777566)1035 259 y(Group)13 b(Tw)o(o)177
b(776500)12 b Fl(!)49 b Fn(776506)1421 309 y(776510)12 b Fl(!)49
b Fn(77656)p 1396 325 529 2 v 1421 359 a(776670)12 b Fl(!)49
b Fn(776676)1035 458 y(Group)13 b(Three)152 b(775610)12 b Fl(!)49
b Fn(775616)1421 508 y(775620)12 b Fl(!)49 b Fn(775626)p 1396
525 V 1421 558 a(776170)12 b Fl(!)49 b Fn(776176)1072 608 y(Apart)10
b(from)d(the)j(op)q(erator's)g(console)f(in)o(terface)h(whic)o(h)1010
657 y(has)23 b(its)g(o)o(wn)f(standard)i(UNIBUS)f(lo)q(cation,)h(the)g(in-)
1010 707 y(terfaces)18 b(are)g(gathered)f(in)o(to)g(t)o(w)o(o)f(groups)h
(\(for)g(reasons)1010 757 y(whic)o(h)f(are)g(irrelev)n(an)o(t)f(here\).)26
b(Within)14 b(eac)o(h)j(group,)e(b)o(y)1010 807 y(con)o(v)o(en)o(tion,)10
b(registers)i(are)e(allo)q(cated)g(in)f(consecutiv)o(e)j(lo-)1010
857 y(cations)i(starting)g(at)f(the)i(lo)o(w)o(est)f(address.)1010
982 y Fg(24.11)56 b(Soft)n(w)n(are)19 b(Considerations)1010
1062 y Fn(\\NKL11")d(\(8011\))g(m)o(ust)g(b)q(e)h(set)h(to)f(de\014ne,)h(for)
f(a)f(par-)1010 1112 y(ticular)d(installation,)f(the)j(n)o(um)o(b)q(er)e(of)g
(in)o(terfaces)i(in)e(the)1010 1162 y(\014rst)k(t)o(w)o(o)f(groups,)g(and)g
(\\NDL11")f(\(8012\),)h(the)h(nm)o(b)q(er)1010 1212 y(in)11
b(the)g(third)h(group.)17 b(An)o(y)11 b(hardw)o(are)g(alterations)g(whic)o(h)
1010 1261 y(c)o(hanged)g(the)h(actual)e(n)o(um)o(b)q(er)g(of)g(in)o(terfaces)
i(w)o(ould)e(ha)o(v)o(e)1010 1311 y(to)k(b)q(e)h(re\015ected)i(in)c(the)i
(soft)o(w)o(are)g(b)o(y)f(c)o(hanging)f(and)i(re-)1010 1361
y(comiling)10 b(\\kl.c",)i(and)h(relinking)f(the)i(op)q(eraing)f(system.)1072
1413 y(It)g(will)f(b)q(e)i(seen)g(that)f(\\klop)q(en")g(calculates)g(the)h
(cor-)1010 1462 y(rect)h(k)o(ernel)f(mo)q(de)f(address)i(\(16)e(bits\))h(for)
g(the)g(Receiv)o(er)1010 1512 y(Status)d(Register)h(for)f(eac)o(h)g(in)o
(terface,)h(and)f(this)g(is)g(stored)1010 1562 y(\(8044\))j(in)o(to)g(the)h
(the)g(\\t)p 1408 1562 13 2 v 15 w(addr")f(elemen)o(t)g(of)g(the)h(appro-)
1010 1612 y(priate)f(\\tt)o(y")f(structure.)1010 1737 y Fg(24.12)56
b(In)n(terrupt)18 b(V)-5 b(ector)18 b(Addresses)1010 1817 y
Fn(The)d(v)o(ector)h(addresses)h(for)d(the)i(\014rst)f(in)o(terface)h(are)f
(060)1010 1867 y(and)10 b(064)g(\(for)h(receiv)o(er)h(and)f(transmitter)f(in)
o(terrupts,)j(re-)1010 1917 y(sp)q(ectiv)o(ely\).)18 b(Additional)9
b(DL11/KL11)h(in)o(terfaces)i(ha)o(v)o(e)1010 1967 y(v)o(ector)f(addresses)h
(whic)o(h)e(are)g(alw)o(a)o(ys)f(at)h(least)g(0300,)f(and)1010
2017 y(whic)o(h)19 b(are)g(assigned)h(according)f(to)g(rules)h(whic)o(h)f
(tak)o(e)1010 2066 y(in)o(to)g(consideration)i(other)g(in)o(terfaces)g(whic)o
(h)f(ma)o(y)e(b)q(e)1010 2116 y(presen)o(t.)1072 2168 y(The)d(second)h(w)o
(ord)e(of)g(an)h(in)o(terrupt)g(doubiet)g(is)f(the)1010 2218
y(\\new)k(pro)q(cessor)j(status")d(w)o(ord.)32 b(The)18 b(\014v)o(e)h(lo)o(w)
e(order)1010 2267 y(bits)j(of)g(this)h(w)o(ord)g(ma)o(y)d(b)q(e)j(c)o(hosen)h
(arbitrarily)m(,)e(and)1010 2317 y(are)14 b(in)g(fact)g(used)h(to)f(de\014ne)
h(the)g(minor)d(device)j(n)o(um)o(b)q(er)1010 2367 y(\(cf.)27
b(a)17 b(similar)d(use)k(to)f(distinguish)f(the)i(v)n(arious)e(kinds)1010
2417 y(of)i(\\traps")h({)g(see)h(Sheet)g(05\).)33 b(A)20 b(mask)o(ed)e(v)o
(ersion)h(of)1010 2467 y(the)g(new)g(pro)q(cessor)h(status)f(w)o(ord)g(is)f
(pro)o(vided)g(to)g(the)1010 2517 y(in)o(terrupt)13 b(handling)d(routines)j
(as)f(the)h(parameter)e(\\dev")1010 2566 y(\(see)k(e.g.)j(line)13
b(8070\).)1010 2692 y Fg(24.13)56 b(Source)18 b(Co)r(de)1010
2772 y Fn(W)m(e)12 b(can)h(no)o(w)g(turn)g(to)g(a)g(detailed)g(study)g(of)f
(the)i(co)q(de)g(in)1010 2822 y(the)g(\014les)f(\\kl.c")f(\(Sheet)j(80\))e
(and)g(\\tt)o(y)m(.c")f(\(Sheets)j(81)d(to)-30 2946 y(98)p
eop
%%Page: 99 107
106 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)733
b(24)43 b(INTERA)o(CTIVE)14 b(TERMINALS)-30 17 y Fn(85\).)k(W)m(e)13
b(shall)g(lo)q(ok)f(\014rst)i(at)g(\\op)q(ening")e(and)i(\\closing")-30
66 y(terminals)c(as)h(c)o(haracter)h(sp)q(ecial)f(\014les)h(and)e(the)i
(handling)-30 116 y(of)19 b(in)o(terrupts.)34 b(Then)19 b(in)g(the)g(next)h
(c)o(hapter)f(w)o(e)g(shall)-30 166 y(lo)q(ok)c(at)h(the)g(receipt)h(of)e
(data)h(from)e(the)i(terminal,)e(and)-30 216 y(\014nally)f(transmission)g(of)
g(data)h(to)f(the)i(terminal.)33 266 y(\\klread")d(\(8062\),)g(\\klwrite")g
(\(8066\))g(and)h(\\klsgtt)o(y")-30 316 y(\(8090\))h(ha)o(v)o(e)f(already)h
(b)q(een)h(discussed)g(ab)q(o)o(v)o(e.)-30 430 y Fg(24.14)56
b(klop)r(en)17 b(\(8023\))-30 507 y Fn(This)e(pro)q(cedure)i(is)e(called)g
(to)f(\\op)q(en")h(a)g(terminal)e(as)i(a)-30 557 y(c)o(haracter)i(sp)q(ecial)
e(\014le.)22 b(This)15 b(call)g(is)g(usually)f(made)g(b)o(y)-30
607 y(the)h(program)e(\\/etc/init")g(for)h(eac)o(h)g(terminal)f(whic)o(h)h
(is)-30 656 y(to)e(b)q(e)h(activ)o(e)f(in)f(the)i(system.)k(Since)12
b(c)o(hild)g(pro)q(cesses)i(in-)-30 706 y(herit)e(the)h(op)q(en)e(\014les)h
(of)f(their)h(paren)o(ts,)h(it)e(is)g(not)h(usually)-30 756
y(necessary)18 b(for)d(other)h(pro)q(cesses)i(to)d(\\op)q(en")g(the)h(device)
-30 806 y(again.)h(It)12 b(will)f(b)q(e)j(noted)e(that)h(the)g(there)h(is)e
(no)g(attempt)-30 856 y(to)f(stop)h(t)o(w)o(o)e(unrelated)i(pro)q(cesses)i
(ha)o(ving)c(the)h(terminal)-30 905 y(as)j(an)g(op)q(en)g(\014le)g(sim)o
(ultaneously)m(.)-30 988 y Fi(8026:)21 b Fn(Chec)o(k)14 b(the)h(minor)d
(device)j(n)o(um)o(b)q(er;)-30 1068 y Fi(8030:)21 b Fn(Lo)q(cate)14
b(the)h(appropriate)f(\\tt)o(y")f(structure;)-30 1148 y Fi(8031:)21
b Fn(If)16 b(the)h(pro)q(cess)h(op)q(ening)e(the)h(\014le)g(has)f(no)h(asso-)
74 1198 y(ciated)d(con)o(trolling)e(terminal)f(designate)j(the)g(cur-)74
1247 y(ren)o(t)f(terminal)d(for)h(this)h(role.)17 b(\(Note)12
b(that)g(the)h(ref-)74 1297 y(erence)k(stored)g(is)e(the)g(address)i(of)d(a)h
(\\tt)o(y")g(struc-)74 1347 y(ture.\):)-30 1427 y Fi(8033:)21
b Fn(Store)k(the)g(terminal)d(device)k(n)o(um)o(b)q(er)d(in)h(the)74
1477 y(\\tt)o(y")14 b(structure)-30 1556 y Fi(8039:)21 b Fn(Calculate)12
b(the)i(address)g(of)e(the)i(appropriate)f(set)74 1606 y(of)h(device)g
(registers)i(for)d(the)i(terminal)d(and)i(store)-30 1686 y
Fi(8045:)21 b Fn(If)g(the)h(terminal)d(is)i(not)g(already)g(\\op)q(en",)i(do)
74 1736 y(some)13 b(initialisation)e(of)j(the)g(\\tt)o(y")f(structure)k(..)
-30 1815 y Fi(8046:)k Fn(\\t)p 139 1815 13 2 v 15 w(state")13
b(is)f(set)h(to)g(sho)o(w)f(the)h(\014le)f(is)g(\\op)q(en",)h(so)74
1865 y(that)h(the)f(next)h(three)h(lines)e(will)f(not)h(b)q(e)h(executed)74
1915 y(if)k(the)h(\014le)f(is)g(op)q(ened)i(a)e(second)h(time,)f(p)q(ossibly)
74 1965 y(undoing)13 b(the)i(e\013ect)g(of)f(a)f(\\stt)o(y")h(system)g(call:)
74 2030 y(\\t)p 113 2030 V 15 w(state")24 b(is)g(also)e(set)j(to)e(sho)o(w)h
(\\CARR)p 796 2030 V 14 w(ON")74 2079 y(\(\\carrier)17 b(on"\).)25
b(This)16 b(is)g(a)g(soft)o(w)o(are)g(\015ag)g(whic)o(h)74
2129 y(sho)o(ws)h(that)g(the)g(terminal)e(is)i(logically)d(enabled,)74
2179 y(regardless)j(of)d(the)i(true)h(hardw)o(are)e(status)h(of)f(the)74
2229 y(terminal.)h(If)11 b(\\CARR)p 441 2229 V 14 w(ON")h(is)g(reset)i(for)d
(a)h(termi-)74 2279 y(nal,)h(the)i(system)f Fi(should)d Fn(ignore)j(all)f
(input)g(from)74 2328 y(the)i(terminal.)74 2393 y(\(This)h(do)q(es)g(not)g
(seem)f(to)h(b)q(e)g(en)o(tirely)f(true,)i(and)74 2443 y(this)d(p)q(oin)o(t)g
(will)e(b)q(e)i(tak)o(en)h(up)e(again)g(later.\);)-30 2523
y Fi(8047:)21 b Fn(The)13 b(standard)g(terminal)e(is)i(assumed)f(to)g(b)q(e)i
(un-)74 2573 y(able)j(to)g(in)o(terpret)h(horizon)o(tal)e(tabs,)i(to)f(supp)q
(ort)74 2622 y(only)12 b(the)h(64)f(c)o(haracter)i(ASCI)q(I)e(subset,)i(to)e
(run)h(in)74 2672 y(full)18 b(duplex)i(mo)q(de)e(and)i(to)f(require)h(b)q
(oth)g(\\car-)74 2722 y(riage)i(return")g(and)g(\\line)e(feed")i(c)o
(haracters)i(to)74 2772 y(pro)o(vide)10 b(normal)e(\\new)i(line")f(pro)q
(cessing.)18 b(\(Could)74 2822 y(this)c(b)q(e)h(a)e(Mo)q(del)h(33)f(telet)o
(yp)q(e?\);)1010 17 y Fi(8048:)20 b Fn(The)12 b(\\erase")h(and)e(\\kill")e(c)
o(haracters)14 b(are)e(set)g(ac-)1114 66 y(cording)h(to)h(the)h(UNIX)f(con)o
(v)o(en)o(tion;)1010 156 y Fi(8051:)20 b Fn(The)c(Receiv)o(er)h(Con)o(trol)d
(Status)i(register)h(is)e(ini-)1114 206 y(tialised)h(with)h(the)h(pattern)g
(\\0103")e(so)h(that)g(the)1114 256 y(terminal)j(is)h(made)g(ready)m(,)i
(reading)e(is)h(enabled)1114 306 y(and)13 b(receiv)o(er)j(in)o(terrupts)f
(are)f(enabled;)1010 395 y Fi(8052:)20 b Fn(The)f(T)m(ransmitter)e(Con)o
(trol)g(Status)h(register)h(is)1114 445 y(initialised)13 b(so)i(that)g(an)g
(in)o(terrupt)g(will)f(b)q(e)h(gener-)1114 495 y(ated)10 b(whenev)o(er)i(the)
e(in)o(terface)h(is)f(ready)h(to)f(receiv)o(e)1114 545 y(another)k(c)o
(haracter.)1072 643 y(Note)19 b(that)f(the)g(\\op)q(en")g(routine)h(do)q(es)g
(not)f(distin-)1010 693 y(guish)12 b(b)q(et)o(w)o(een)h(the)g(cases)h(where)f
(the)g(\014le)f(is)g(op)q(ened)h(for)1010 742 y(reading)18
b(only)m(,)f(or)h(writing)f(only)m(,)g(or)h(for)g(b)q(oth)g(reading)1010
792 y(and)c(writing.)1010 917 y Fg(24.15)56 b(klclose)17 b(\(8055\))1010
997 y Fi(8057:)j Fn(Find)g(the)h(address)g(of)e(the)i(appropriate)f(\\tt)o
(y")1114 1047 y(structure)29 b(in)d(the)i(arra)o(y)e(of)g(suc)o(h)i
(structures,)1114 1097 y(\\kl11")17 b(\(8015\).)33 b(\(This)19
b(op)q(eration)g(ma)o(y)e(b)q(e)i(ob-)1114 1146 y(serv)o(ed)13
b(in)f(all)e(the)j(pro)q(cedures)h(in)e(the)g(second)i(col-)1114
1196 y(umn)f(of)g(Sheet)j(80,)d(and)i(its)f(relev)n(ance)h(should)f(b)q(e)
1114 1246 y(noted.\))1010 1336 y Fi(8058:)20 b Fn(\\w\015ush)o(tt)o(y")15
b(\(8217\))f(allo)o(ws)f(the)i(output)g(queue)1114 1386 y(for)h(the)h
(terminal)e(to)i(\\drain")f(and)g(then)i(\015ushes)1114 1435
y(the)c(input)g(queue)1010 1525 y Fi(8059:)20 b Fn(\\t)p 1178
1525 V 15 w(state")15 b(is)e(reset)j(so)e(that)g(\\ISOPEN")g(and)1114
1575 y(\\CARR)p 1260 1575 V 14 w(ON")g(are)g(no)g(longer)f(true.)1010
1700 y Fg(24.16)56 b(klxin)n(t)17 b(\(8070\))1010 1780 y Fn(This)e(pro)q
(cedure)i(is)f(executed)h(in)e(resp)q(onse)i(to)f(a)f(trans-)1010
1830 y(mitter)25 b(in)o(terrupt.)56 b(It)26 b(should)g(b)q(e)h(compared)e
(with)1010 1879 y(\\p)q(cpin)o(t")14 b(\(8739\))g(and)h(\\lpin)o(t")e
(\(8976\).)20 b(Note)c(that)e(the)1010 1929 y(parameter)d(\\dev")f(is)h(a)g
(mask)o(ed)f(v)o(ersion)h(\(lo)o(w)f(order)i(\014v)o(e)1010
1979 y(bits)i(preserv)o(ed\))i(of)d(the)i(\\new)f(pro)q(cessor)i(status")e(w)
o(ord)1010 2029 y(in)k(the)i(in)o(terrupt)g(v)o(ector.)34 b(Pro)o(vided)19
b(the)g(v)o(ector)h(w)o(as)1010 2079 y(prop)q(erly)e(initialised,)e(the)h
(minor)f(device)i(n)o(um)o(b)q(er)f(will)1010 2128 y(b)q(e)d(prop)q(erly)h
(iden)o(ti\014ed.)1072 2180 y(The)f(second)h(part)e(of)g(the)h(test)h(on)e
(line)g(8074)f(will)g(b)q(e)1010 2230 y(discussed)j(at)f(the)h(end)f(of)f
(the)i(next)f(c)o(hapter.)1010 2355 y Fg(24.17)56 b(klrin)n(t)17
b(\(8078\))1010 2435 y Fn(This)22 b(pro)q(cedure)j(is)d(executed)j(in)d(resp)
q(onse)j(to)d(a)h(re-)1010 2484 y(ceiv)o(er)13 b(in)o(terrupt.)19
b(It)13 b(is)f(not)h(so)g(readily)f(compared)g(with)1010 2534
y(\\p)q(crin)o(t")17 b(\(8719\))g(although)g(similarities)e(certainly)j(ex-)
1010 2584 y(ist.)1010 2682 y Fi(8083:)i Fn(Read)14 b(the)g(input)g(c)o
(haracter)h(from)d(the)i(Receiv)o(er)1114 2732 y(Data)f(Bu\013er)i(register;)
1010 2822 y Fi(8084:)20 b Fn(Enable)14 b(the)h(receiv)o(er)g(for)f(the)g
(next)h(c)o(haracter;)1890 2946 y(99)p eop
%%Page: 100 108
107 bop -30 -144 a Fk(24)43 b(INTERA)o(CTIVE)14 b(TERMINALS)734
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(8085:)21
b Fn(The)15 b(commen)o(t)e(sa)o(ys)i(\\hardw)o(are)g(b)q(otc)o(h".)22
b(Bet-)74 66 y(ter)15 b(b)q(eliev)o(e)f(it;)-30 149 y Fi(8086:)21
b Fn(P)o(ass)14 b(the)f(c)o(haracter)i(to)e(\\tt)o(yinput")f(to)h(insert)h
(it)74 199 y(in)o(to)f(the)i(appropriate)f(\\ra)o(w")f(input)h(queue.)-30
2946 y(100)p eop
%%Page: 101 109
108 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)908
b(25)43 b(THE)15 b(FILE)g(\\TTY.C")-30 17 y Fj(25)70 b(The)22
b(File)f(\\tt)n(y)-6 b(.c")-30 108 y Fn(In)16 b(this,)g(the)g(last)f(c)o
(hapter,)i(the)f(in)o(tricacies)g(of)f(in)o(terac-)-30 157
y(tiv)o(e)h(terminal)f(handlers)i(are)f(\014nally)f(un)o(v)o(eiled,)h
(includ-)-30 207 y(ing:)-30 296 y Fi(\(a\))21 b Fn(the)12 b(handling)f(of)h
(the)g(\\erase")h(and)f(kill)e(c)o(haracters;)-30 378 y Fi(\(b\))20
b Fn(the)c(con)o(v)o(ersion)g(of)e(c)o(haracters)k(during)d(input)g(and)74
428 y(output)f(for)g(upp)q(er)h(case)g(only)e(terminals;)-30
510 y Fi(\(c\))21 b Fn(the)k(insertion)g(of)f(dela)o(ys)h(after)g(v)n(arious)
f(sp)q(ecial)74 560 y(c)o(haracters)16 b(suc)o(h)f(as)e(\\carriage)h
(return".)33 649 y(The)9 b(routines)h(\\gtt)o(y")f(\(8165\),)g(\\stt)o(y")g
(\(8183\),)g(\\sgtt)o(y")-30 699 y(82a1\))18 b(and)h(\\tt)o(ystt)o(y")g
(\(8577\))f(w)o(ere)h(dealt)g(within)f(the)-30 749 y(previous)d(c)o(hapter.)
-30 864 y Fg(25.1)56 b(\015ush)n(tt)n(y)19 b(\(8252\))-30 941
y Fn(The)12 b(purp)q(ose)h(of)e(this)g(pro)q(cedure)i(is)f(to)f(\\normalise")
e(the)-30 991 y(queries)19 b(asso)q(ciated)g(with)f(a)g(particular)f
(terminal.)29 b(Its)-30 1041 y(e\013ect)18 b(is)e(to)g(terminate)f
(transmission)g(to)h(the)g(terminal)-30 1090 y(forth)o(with)9
b(and)h(to)f(thro)o(w)g(a)o(w)o(a)o(y)f(an)o(y)h(accum)o(ulated)g(input)-30
1140 y(c)o(haracters.)-30 1229 y Fi(8258:)21 b Fn(Thro)o(w)14
b(a)o(w)o(a)o(y)g(ev)o(erything)h(in)f(the)h(\\co)q(ok)o(ed")f(in-)74
1279 y(put)g(queue;)-30 1361 y Fi(8259:)21 b Fn(ditto)13 b(for)h(the)g
(output)h(queue;)-30 1443 y Fi(8260:)21 b Fn(W)m(ak)o(eup)g(an)o(y)h(pro)q
(cess)i(w)o(aiting)d(to)h(extract)h(a)74 1493 y(c)o(haracter)16
b(from)c(the)i(\\ra)o(w")f(input)h(queue;)-30 1575 y Fi(8261:)21
b Fn(ditto)13 b(for)h(the)g(output)h(queue;)-30 1657 y Fi(8263:)21
b Fn(Raise)e(the)h(pro)q(cessor)h(priorit)o(y)e(to)g(prev)o(en)o(t)i(an)74
1707 y(in)o(terrupt)15 b(from)d(the)j(terminal)d(while)h(...)-30
1789 y Fi(8264:)21 b Fn(the)14 b(\\ra)o(w")g(input)f(queue)i(is)f(\015ushed,)
-30 1871 y Fi(8265:)21 b Fn(the)12 b(\\delimiter)d(coun)o(t")i(is)g(prop)q
(erly)g(set)h(to)f(zero.)-30 1960 y(\\\015ush)o(tt)o(y")k(is)f(called)h(b)o
(y)f(\\w\015ush)o(tt)o(y")g(\(see)i(b)q(elo)o(w\))f(and)-30
2010 y(\\tt)o(yinput")f(\(8346,)e(8350\))h(when)i(either:)-30
2099 y Fi(\(a\))21 b Fn(the)e(terminal)e(is)h(not)h(op)q(erating)g(in)f(\\ra)
o(w")g(mo)q(de)74 2149 y(and)13 b(a)g(\\quit")f(or)h(\\delete")g(c)o
(haracter)i(is)d(receiv)o(ed)74 2198 y(from)g(the)j(terminal;)d(or)-30
2280 y Fi(\(b\))20 b Fn(the)11 b(\\ra)o(w")e(input)h(queue)h(has)g(gro)o(wn)f
(unreasonably)74 2330 y(large)i(\(presumably)e(b)q(ecause)k(no)d(pro)q(cess)j
(is)d(read-)74 2380 y(ing)i(input)h(from)e(the)j(terminal\);)-30
2496 y Fg(25.2)56 b(w\015ush)n(tt)n(y)20 b(\(8217\))-30 2573
y Fn(This)15 b(pro)q(cedure)i(w)o(aits)d(un)o(til)g(the)i(queue)g(of)e(c)o
(haracters)-30 2622 y(for)k(a)g(terminal)e(is)i(empt)o(y)f(\(b)q(ecause)j
(they'v)o(e)e(all)f(b)q(een)-30 2672 y(sen)o(t!\))40 b(and)20
b(then)h(calls)g(\\\015ush)o(tt)o(y")f(to)h(clean)f(up)h(the)-30
2722 y(input)14 b(queues.)33 2772 y(\\w\015ush)o(tt)o(y")i(is)g(called)g
(\(3053\))f(b)o(y)h(\\klclose".)25 b(This)-30 2822 y(do)q(es)15
b(not)g(happ)q(en)f(v)o(ery)h(often)f({)g(in)g(fact)g(only)f(when)i(all)1010
17 y(\014les)f(referencing)h(the)f(terminal)e(are)h(closed)i(i.e.)i(usually)
1010 66 y(only)c(when)h(the)h(user)g(logs)e(o\013.)1072 117
y(It)j(is)f(also)g(called)h(b)o(y)f(\\tt)o(ystt)o(y")h(\(8589\))e(just)i(b)q
(efore)1010 167 y(the)d(terminal)f(en)o(vironmen)o(t)g(parameters)h(are)g
(adjusted.)1010 285 y Fg(25.3)56 b(Character)18 b(Input)1010
362 y Fn(F)m(or)h(a)g(program)f(requesting)i(input)f(from)f(a)h(terminal,)
1010 412 y(there)14 b(is)e(a)h(c)o(hain)f(of)g(pro)q(cedure)j(calls)d(whic)o
(h)h(extends)h(to)1010 462 y(\\ttread")g(...)1010 580 y Fg(25.4)56
b(ttread)18 b(\(8535\))1010 658 y Fi(8541:)i Fn(Chec)o(k)14
b(that)f(the)h(terminal)e(is)h Fi(logically)d Fn(activ)o(e;)1010
743 y Fi(8543:)20 b Fn(If)11 b(there)i(are)e(c)o(haracters)i(in)e(the)h(\\co)
q(ok)o(ed")f(input)1114 792 y(queue)f Fi(or)f Fn(a)h(call)e(on)i(\\canon")f
(\(8274\))g(is)g(successful)1114 842 y(...)1010 927 y Fi(8544:)20
b Fn(transfer)14 b(c)o(haracters)h(from)c(the)i(\\co)q(ok)o(ed")g(input)1114
977 y(queue)g(un)o(til)e(either)j(it)e(is)g(empt)o(y)f(or)h(enough)h(c)o
(har-)1114 1027 y(acters)g(ha)o(v)o(e)f(b)q(een)h(transferred)h(to)d(suit)h
(the)h(user's)1114 1076 y(requiremen)o(ts.)1010 1195 y Fg(25.5)56
b(canon)19 b(\(8274\))1010 1272 y Fn(This)26 b(pro)q(cedure)i(is)d(called)h
(b)o(y)g(\\ttread")g(\(8543\))f(to)1010 1322 y(transfer)16
b(c)o(haracters)i(from)c(the)i(\\ra)o(w")f(input)h(queue)g(to)1010
1372 y(the)e(\\co)q(ok)o(ed")f(input)f(queue)i(\(after)g(pro)q(cessing)g
(\\erase")1010 1422 y(and)23 b(\\kill")e(c)o(haracters)26 b(and,)f(in)e(the)h
(case)g(of)f(upp)q(er)1010 1471 y(case)c(only)e(terminals,)h(pro)q(cessing)h
(\\escap)q(ed")h(c)o(harac-)1010 1521 y(ters,)15 b(i.e.)k(c)o(haracters)d
(preceded)g(b)o(y)e(the)h(c)o(haracter)h(`)p Ff(\\)p Fn('\).)1010
1571 y(\\canon")i(returns)i(a)e(non-zero)h(v)n(alue)f(if)f(the)i(\\co)q(ok)o
(ed")1010 1621 y(input)14 b(queue)g(is)g(no)g(longer)f(empt)o(y)m(.)1010
1714 y Fi(8284:)20 b Fn(If)14 b(the)g(n)o(um)o(b)q(er)f(of)g(delimiters)g(in)
g(the)i(\\ra)o(w")e(in-)1114 1764 y(put)h(queue)g(is)g(zero)h(then)g(...)1010
1848 y Fi(8285:)20 b Fn(if)11 b(the)h(terminal)d(is)j(logically)d(inactiv)o
(e,)i(then)h(just)1114 1898 y(return;)1010 1983 y Fi(8286:)20
b Fn(otherwise)15 b(go)f(to)f(\\sleep".)1010 2076 y(Note)i(that)h(delimiters)
e(in)h(this)g(con)o(text)h(are)f(c)o(haracters)1010 2126 y(of)f(all)g(ones)i
(\(o)q(ctal)f(v)n(alue)g(is)g(377\))f(and)h(are)h(inserted)g(b)o(y)1010
2176 y(\\tt)o(yinput")d(\(8358\).)1010 2269 y Fi(8291:)20 b
Fn(Set)d(\\bp")f(to)g(p)q(oin)o(t)g(to)g(the)h(third)f(c)o(haracter)i(of)1114
2318 y(the)c(w)o(ork)g(arra)o(y)m(,)e(\\canon)o(b";)1010 2403
y Fi(8292:)20 b Fn(Begin)14 b(a)f(lo)q(op)f(\(extending)i(to)f(line)g(8318\))
f(whic)o(h)1114 2453 y(remo)o(v)o(es)i(one)h(c)o(haracter)h(from)d(the)j
(\\ra)o(w")e(queue)1114 2503 y(p)q(er)g(cycle;)1010 2587 y
Fi(8293:)20 b Fn(If)g(the)h(c)o(haracter)g(is)f(a)g(delimiter,)g(reduce)h
(the)1114 2637 y(delimiter)14 b(coun)o(t)i(b)o(y)g(one)g(and)g(exit)f(the)i
(lo)q(op)e(i.e.)1114 2687 y(go)e(to)h(line)f(8319;)1010 2772
y Fi(8297:)20 b Fn(If)i(the)g(terminal)e(is)i(not)g(op)q(erating)f(in)h(\\ra)
o(w")1114 2822 y(mo)q(de)12 b(...)1869 2946 y(101)p eop
%%Page: 102 110
109 bop -30 -144 a Fk(25)43 b(THE)15 b(FILE)g(\\TTY.C")908
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(8298:)21
b Fn(If)14 b(the)g(previous)g(c)o(haracter)i(\(note)e(the)h(\\bp[{1]")74
66 y(notation!\))28 b(w)o(as)17 b(not)g(a)g(bac)o(kslash,)h(`)p
Ff(\\)p Fn(',)f(execute)74 116 y(the)k(co)q(de)g(from)e(line)h(8299)f(to)h
(8307,)h(otherwise)74 166 y(execute)16 b(the)e(co)q(de)h(b)q(eginning)e(at)h
(line)g(8309.)-30 279 y Fi(Previous)g(c)o(haracter)h(w)o(as)h(not)f(a)h(bac)o
(kslash)-30 392 y(8299:)21 b Fn(If)13 b(the)i(c)o(haracters)h(is)d(an)h
(\\erase")h(and)e(...)-30 497 y Fi(8300:)21 b Fn(if)g(there)j(is)e(at)g
(least)g(one)h(c)o(harater)g(to)f(erase,)74 547 y(bac)o(kup)14
b(the)h(p)q(oin)o(ter)f(\\bp";)-30 651 y Fi(8302:)21 b Fn(Start)11
b(on)f(the)i(next)f(cycle)g(of)f(the)h(lo)q(op)f(b)q(eginning)74
701 y(at)k(line)f(8292;)-30 806 y Fi(8304:)21 b Fn(If)9 b(the)h(c)o(haracter)
h(is)e(a)g(\\kill",)e(thro)o(w)j(a)o(w)o(a)o(y)e(all)g(the)74
856 y(c)o(haracters)21 b(accum)o(ulated)c(for)h(the)i(curren)o(t)g(line,)74
905 y(b)o(y)14 b(going)f(bac)o(k)g(to)h(line)g(8290;)-30 1010
y Fi(8306:)21 b Fn(If)d(the)i(c)o(haracter)g(is)f(an)f(\\eot")h(\(004\))f
(\(usually)74 1060 y(generated)c(at)d(the)i(terminal)d(as)i(\\con)o
(trol-D"\),)f(ig-)74 1110 y(nore)i(it)f(\(and)g(do)g(not)h(put)f(it)g(inot)g
(\\canon)o(b"\))g(and)74 1160 y(start)j(on)e(the)i(next)f(cycle;)74
1237 y(\(If)26 b(this)f(c)o(haracter)i(o)q(ccurs)h(at)d(the)h(b)q(eginning)74
1287 y(of)17 b(a)h(line,)f(then)i(subsequen)o(tly)f(\\ttread")g(\(8544\))74
1336 y(will)13 b(\014nd)i(no)g(c)o(haracters)h(in)e(the)h(\\co)q(ok)o(ed")g
(input)74 1386 y(queue)k(i.e.)30 b(it)18 b(will)e(read)i(a)g(zero)h(length)f
(record,)74 1436 y(whic)o(h)11 b(then)h(leads)f(to)g(the)g(program)f
(receiving)h(the)74 1486 y(normal)h(\\end)i(of)f(\014le")h(indication.\))-30
1599 y Fi(Previous)g(c)o(haracter)h(w)o(as)h(a)g(bac)o(kslash)-30
1712 y(8309:)21 b Fn(If)13 b(\\maptab[c]")f(is)h(non-zero,)h(and)g(either)74
1762 y(\\maptab[c])j(==)i(c")h(or)f(the)g(terminal)f(is)h(upp)q(er)74
1812 y(case)c(only)m(,)d(then)j(...)-30 1916 y Fi(8310:)21
b Fn(if)10 b(the)i(last)f(c)o(haracter)i(but)e(one)h(w)o(as)f
Fi(not)f Fn(a)h(bac)o(k-)74 1966 y(slash)18 b(\(`)p Ff(\\)p
Fn('\),)g(then)g(replace)h(\\c")f(b)o(y)f(\\maptab[c]")74 2016
y(and)d(bac)o(k)g(up)g(\\bp")f(\(so)i(that)f(the)g(bac)o(kslash)g(will)74
2066 y(b)q(e)h(erased\).)-30 2179 y Fi(Character)h(ready)-30
2292 y(8315:)21 b Fn(Mo)o(v)o(e)9 b(\\c")g(in)o(to)g(the)h(next)f(c)o
(haracter)i(in)e(\\canon)o(b",)74 2341 y(and)14 b(if)f(this)h(arra)o(y)g(is)f
(no)o(w)h(full,)e(lea)o(v)o(e)i(the)g(lo)q(op.)-30 2454 y Fi(Line)h
(completed)-30 2567 y(8319:)21 b Fn(A)o(t)13 b(this)g(p)q(oin)o(t,)f(an)g
(input)h(line)f(has)h(b)q(een)h(assem-)74 2617 y(bled)g(in)g(the)g(arra)o(y)g
(\\canon)o(b";)-30 2722 y Fi(8322:)21 b Fn(Shift)27 b(the)i(con)o(ten)o(ts)g
(of)e(\\canon)o(b")g(in)o(to)g(the)74 2772 y(\\co)q(ok)o(ed")13
b(input)f(queue,)i(and)e(return)i(a)f(\\success-)74 2822 y(ful")g(result.)
1010 17 y Fg(25.6)56 b(Notes)1010 96 y Fi(\(A\))20 b Fn(The)10
b(reason)g(wh)o(y)g(\\bp")f(starts)h(\(8291\))f(at)h(the)g(third)1114
146 y(c)o(haracter)20 b(of)e(\\canon)o(b")g(can)h(b)q(e)h(found)e(on)h(line)
1114 196 y(8310.)1010 284 y Fi(\(B\))h Fn(A)9 b(n)o(um)o(b)q(er)g(of)g
(subtleties)i(in)e(the)i(handling)d(of)h(bac)o(k-)1114 334
y(slashes)16 b(\(whic)o(h)f(the)h(reader)g(will)e(no)h(doubt)g(ha)o(v)o(e)
1114 384 y(encoun)o(tered)25 b(in)e(his)h(practical)f(use)i(of)e(UNIX\))1114
434 y(are)h(still)f(not)i(imm)o(ediately)c(apparen)o(t.)50
b(Since)1114 483 y(\\maptab[c]")18 b(is)j(zero)i(for)e(\\c)g(==)h(`)p
Ff(\\)p Fn(')e(")h(\(o)q(ctal)1114 533 y(v)n(alue)15 b(of)g(134\),)g(all)f
(bac)o(kslashes)j(get)f(copied)g(in)o(to)1114 583 y(\\canon)o(b".)27
b(A)17 b(single)g(bac)o(kslash)g(will)f(b)q(e)i(subse-)1114
633 y(quen)o(tly)13 b(o)o(v)o(erwritten)g(if)g(the)g(follo)o(wing)e(c)o
(haracter)1114 683 y(is)j(to)h(b)q(e)g(asserted)i(\(as)d(in)h(the)g(case)h
(of)e(`#')f(or)i(`@')1114 732 y(or)i(eot)i(\(004\),)e(or)h(if)f(the)i(case)f
(of)g(an)f(alphab)q(etic)1114 782 y(c)o(haracter)f(is)g(to)f(b)q(e)h(c)o
(hanged)g(for)f(an)h(upp)q(er)g(case)1114 832 y(only)d(terminal.)1010
956 y Fg(25.7)56 b(tt)n(yinput)18 b(\(8333\))1010 1035 y Fn(\\canon")e(remo)o
(v)o(es)g(c)o(haracters)i(from)d(the)i(\\ra)o(w")f(input)1010
1085 y(queue.)i(They)11 b(are)g(put)g(there)h(in)e(the)i(\014rst)f(place)g(b)
o(y)f(\\tt)o(y-)1010 1135 y(input")k(whic)o(h)g(is)g(called)f(b)o(y)h
(\\klrin)o(t")f(\(8087\))h(whenev)o(er)1010 1184 y(an)k(input)h(c)o(haracter)
h(is)e(receiv)o(ed)i(from)d(the)j(hardw)o(are)1010 1234 y(con)o(troller.)1072
1285 y(The)11 b(parameters)f(passed)i(to)e(\\tt)o(yinput")g(are)h(a)f(c)o
(har-)1010 1335 y(acter)15 b(and)e(a)h(reference)i(to)e(a)g(\\tt)o(y")f
(structure.)1010 1432 y Fi(8342:)20 b Fn(If)e(the)h(c)o(haracter)g(is)f(a)f
(\\carriage)h(return")h(and)1114 1482 y(the)24 b(terminal)e(op)q(erates)j
(with)e(a)h(\\carriage)g(re-)1114 1532 y(turn")g(only)f(\(instead)h(of)g(a)f
(\\carriage)h(return")1114 1582 y(\\line)c(feed")h(pair\))f(c)o(hange)h(the)h
(c)o(haracter)g(to)e(a)1114 1631 y(\\new)14 b(line";)1010 1720
y Fi(8344:)20 b Fn(If)i(the)g(terminal)e(is)i(not)g(op)q(erating)f(in)h(\\ra)
o(w")1114 1770 y(mo)q(de)9 b(and)h(the)g(c)o(haracter)i(is)e(a)f(\\quit")g
(or)i(\\delete")1114 1820 y(\(7958\))e(then)i(call)e(\\signal")f(\(3949\))i
(to)g(send)h(a)e(soft-)1114 1869 y(w)o(are)j(in)o(terrupt)h(to)f(ev)o(ery)g
(pro)q(cess)i(whic)o(h)e(has)g(the)1114 1919 y(terminal)i(as)j(its)f(con)o
(trolling)f(terminal,)f(\015ush)j(all)1114 1969 y(the)e(queues)g(asso)q
(ciated)g(with)f(the)h(terminal,)d(and)1114 2019 y(return;)1010
2107 y Fi(8349:)20 b Fn(If)d(the)h(\\ra)o(w")e(input)h(queue)i(has)e(gro)o
(wn)g(exces-)1114 2157 y(siv)o(ely)f(large,)g(\015ush)h Fi(all)e
Fn(the)i(queues)g(for)f(the)h(ter-)1114 2207 y(minal)g(and)j(return.)38
b(\(This)20 b(ma)o(y)e(seem)i(a)g(tri\015e)1114 2257 y(harsh)12
b(at)g(\014rst)h(sigh)o(t)e(but)h(it)g(will)e(usually)i(b)q(e)g(what)1114
2307 y(is)h(required.\);)1010 2395 y Fi(8353:)20 b Fn(If)d(the)g(terminal)e
(has)i(a)f(limited)f(c)o(haracter)j(set,)1114 2445 y(and)10
b(the)i(c)o(haracter)g(is)e(an)h(upp)q(er)h(case)g(alphab)q(etic,)1114
2495 y(translate)i(it)f(in)o(to)h(lo)o(w)o(er)f(case;)1010
2584 y Fi(8355:)20 b Fn(Insert)j(the)f(c)o(haracter)h(in)o(to)e(the)h(\\ra)o
(w")f(input)1114 2633 y(queue;)1010 2722 y Fi(8356:)f Fn(If)15
b(the)g(terminal)e(is)i(op)q(erating)f(in)h(\\ra)o(w")f(mo)q(de,)1114
2772 y(or)19 b(the)i(c)o(haracter)g(w)o(as)e(a)h(\\new)g(line")f(or)g(\\eot")
1114 2822 y(then)14 b(...)-30 2946 y(102)p eop
%%Page: 103 111
110 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)908
b(25)43 b(THE)15 b(FILE)g(\\TTY.C")-30 17 y Fi(8357:)21 b Fn(\\w)o(ak)o(eup")
9 b(an)o(y)g(pro)q(cess)i(w)o(aiting)d(for)h(input)g(from)74
66 y(the)17 b(terminal,)c(place)j(a)g(delimiter)e(c)o(haracter)j(\(all)74
116 y(ones\))f(also)e(in)g(the)i(\\ra)o(w")e(queue)h(and)g(incremen)o(t)74
166 y(the)24 b(delimiter)d(coun)o(t)i(Note)g(this)g(is)g(one)g(p)q(oin)o(t)74
216 y(where)17 b(p)q(ossible)g(failure)e(of)g(\\putc")i(\(when)f(there)74
266 y(is)e(no)g(bu\013er)h(space\))h(is)e(explicitly)f(recognised.)20
b(A)74 316 y(failure)14 b(o)q(ccurring)i(here)g(w)o(ould)e(explain)g(wh)o(y)g
(the)74 365 y(test)h(on)f(line)f(8316)g(ma)o(y)f(sometimes)g(succeed.)-30
451 y Fi(8361:)21 b Fn(Finally)m(,)8 b(if)h(the)i(input)f(c)o(haracter)h(is)f
(to)g(b)q(e)h(ec)o(ho)q(ed)74 501 y(i.e.)41 b(the)22 b(terminal)e(is)i
(running)f(in)g(full)g(duplex)74 551 y(mo)q(de,)13 b(insert)j(a)e(cop)o(y)g
(of)g(the)h(c)o(haracter)h(in)o(to)e(the)74 601 y(output)23
b(queue,)j(and)d(and)f(arrange)i(to)e(ha)o(v)o(e)h(it)74 651
y(transmitted)14 b(\(\\ttstart"\))g(bac)o(k)g(to)g(the)g(terminal.)-30
771 y Fg(25.8)56 b(Character)13 b(Output)f({)h(tt)n(write)f(\(8550\))-30
849 y Fn(This)i(pro)q(cedure)i(is)e(called)g(via)f(\\klwrite")h(\(8067\))f
(when)-30 899 y(output)i(is)e(to)h(b)q(e)h(sen)o(t)f(to)g(the)g(terminal.)-30
993 y Fi(8556:)21 b Fn(If)13 b(the)i(terminal)d(is)i(inactiv)o(e,)f(do)h
(nothing;)-30 1079 y Fi(8558:)21 b Fn(Lo)q(op)11 b(for)f(eac)o(h)i(c)o
(haracter)g(to)f(b)q(e)h(transmitted)e(...)-30 1165 y Fi(8560:)21
b Fn(While)12 b(there)j(are)f(still)e(an)h(adequate)h(n)o(um)o(b)q(er)e(of)74
1215 y(c)o(haracters)i(queued)e(for)g(transmission)e(to)i(the)g(ter-)74
1265 y(minal)g(...)-30 1351 y Fi(8561:)21 b Fn(call)15 b(\\ttstart")h(just)f
(in)g(case)i(it)e(is)g(time)f(to)i(send)74 1401 y(another)f(c)o(haracter)g
(to)f(the)g(terminal;)-30 1487 y Fi(8562:)21 b Fn(Setting)14
b(the)g(\\ASLEEP")h(\015ag)e(here)i(\(also)f(in)74 1537 y(\\w\015ush)o(tt)o
(y")d(\(8224\)\))f(is)h(rather)h(p)q(oin)o(tless)f(since)h(is)74
1587 y(is)g(nev)o(er)g(in)o(terrogated)g(and)g(nev)o(er)g(reset)h(un)o(til)e
(the)74 1637 y(\014le)j(is)g(closed;)-30 1723 y Fi(8563:)21
b Fn(Go)12 b(to)h(sleep.)19 b(In)13 b(the)g(mean)o(while)e(the)j(in)o
(terrupt)74 1772 y(handler)j(will)e(b)q(e)i(draining)e(c)o(haracters)j(from)d
(the)74 1822 y(output)c(queue)h(and)f(sending)h(them)e(do)o(wn)h(the)g(line)
74 1872 y(to)j(the)g(terminal;)-30 1958 y Fi(8566:)21 b Fn(Call)16
b(\\tt)o(y)o(output")h(to)g(insert)h(the)g(c)o(haracter)h(in)74
2008 y(the)10 b(output)g(queue)h(and)e(arrange)h(to)g(ha)o(v)o(e)f(it)g
(trans-)74 2058 y(mitted;)-30 2144 y Fi(8568:)21 b Fn(Call)13
b(\\ttstart")h(again,)e(for)i(luc)o(k.)-30 2264 y Fg(25.9)56
b(ttstart)-30 2342 y Fn(This)15 b(pro)q(cedure)h(is)e(called)g(whenev)o(er)i
(it)e(seems)g(reason-)-30 2392 y(able)h(to)f(try)h(and)f(send)i(the)f(next)g
(c)o(haracter)h(to)e(the)h(ter-)-30 2442 y(minal.)h(It)e(often)g(ac)o(hiev)o
(es)g(nothing)g(useful.)-30 2536 y Fi(8514:)21 b Fn(See)15
b(the)f(commen)o(t)e(on)i(line)f(8499.)k(This)d(co)q(de)h(is)74
2586 y(not)f(relev)n(an)o(t)g(here;)-30 2672 y Fi(8518:)21
b Fn(If)10 b(the)i(con)o(troller)f(is)f(not)h(ready)g(\(i.e.)17
b(bit)10 b(7)h(of)f(the)74 2722 y(transmitter)18 b(stalus)g(register)g(is)g
(not)g(set\))g(or)g(the)74 2772 y(necessary)f(dela)o(y)d(follo)o(wing)f(the)i
(preious)g(c)o(harac-)74 2822 y(ter)g(has)f(not)g(y)o(et)g(elapsed,)g(do)g
(nothing;)1010 17 y Fi(8520:)20 b Fn(Remo)o(v)o(e)12 b(a)h(c)o(haracter)i
(from)d(the)i(output)g(queue.)1114 66 y(If)k(\\c")g(is)h(p)q(ositiv)o(e,)g
(the)g(queue)g(w)o(as)g(not)f(empt)o(y)1114 116 y(\(as)c(exp)q(ected\))i(...)
1010 209 y Fi(8521:)k Fn(If)13 b(\\c")f(is)g(less)i(than)e(\\0177")f(it)i(is)
f(a)g(c)o(haracter)i(to)1114 259 y(b)q(e)g(transmitted)f(...)1010
352 y Fi(8522:)20 b Fn(After)d(setting)f(the)h(parit)o(y)f(bit)f(from)f(the)j
(corre-)1114 401 y(sp)q(onding)10 b(elemen)o(t)g(of)g(the)h(arra)o(y)f
(\\partab",)h(write)1114 451 y(\\c")j(to)g(the)h(transmitter)f(data)g
(bu\013er)i(register)f(to)1114 501 y(initiate)e(the)h(hardw)o(are)g(op)q
(eration;)1010 594 y Fi(8524:)20 b Fn(Otherwise)g(\(\\c")f
Fh(>)g Fn(0177\))e(the)i(c)o(haracter)h(w)o(as)1114 644 y(inserted)e(in)f
(the)h(output)f(queue)h(to)g(signal)e(a)h(de-)1114 693 y(la)o(y)m(.)k(Call)14
b(\\timeout")f(\(3845\))i(to)g(mak)o(e)f(an)h(en)o(try)1114
743 y(in)c(the)i(\\callout")d(list.)17 b(The)c(result)g(of)e(this)h(will)e(b)
q(e)1114 793 y(to)i(initiate)f(an)h(execution)h(of)e(\\ttrstrt")i(\(8486\))f
(af-)1114 843 y(ter)e(\\c)g(&)g(0177")f(clo)q(c)o(k)h(tic)o(ks)g(.)16
b(It)10 b(will)e(b)q(e)j(seen)g(that)1114 893 y(\\ttrstrt")20
b(calls)e(\\ttstart")i(again,)e(and)h(that)g(the)1114 943 y(manipulatio)o(n)
10 b(of)j(the)h(\\TIMEOUT")f(\015ag)f(\(8524,)1114 992 y(8491\))g(will)g
(ensure)j(that)f(if)f(another)g(execution)i(of)1114 1042 y(\\ttstart")20
b(is)h(initiated)e(in)h(the)h(in)o(terim,)f(on)g(b)q(e-)1114
1092 y(half)9 b(of)h(the)h(same)e(terminal,)g(it)h(will)f(\(8518\))h(return)
1114 1142 y(without)j(doing)g(an)o(ything.)1010 1271 y Fg(25.10)56
b(ttrstrt)17 b(\(8486\))1010 1352 y Fn(See)e(the)f(commen)o(t)e(ab)q(o)o(v)o
(e)h(for)h(line)f(8524.)1010 1481 y Fg(25.11)56 b(tt)n(y)n(output)18
b(\(8373\))1010 1562 y Fn(This)g(pro)q(cedure)h(has)f(more)f(commen)o(ts)f
(in)h(the)i(source)1010 1612 y(co)q(de)12 b(and)g(hence)h(requires)g(less)g
(explanation)d(than)i(some)1010 1662 y(others.)18 b(Note)11
b(the)h(use)g(of)e(recursion)j(\(8392\))d(to)h(generate)1010
1712 y(a)g(string)g(of)g(blanks)g(in)g(place)h(of)f(a)g(tab)g(c)o(haracter.)
19 b(Other)1010 1762 y(recursiv)o(e)c(calls)f(are)g(on)g(lines)f(8403)g(and)h
(8413.)1010 1891 y Fg(25.12)56 b(T)-5 b(erminals)10 b(with)i(a)h(restricted)e
(c)n(har-)1194 1949 y(acter)18 b(set)1010 2030 y Fi(8400:)i
Fn(\\colp")f(p)q(oin)o(ts)h(to)g(a)f(string)h(of)f(pairs)h(of)f(c)o(har-)1114
2080 y(acters.)g(If)13 b(the)h(c)o(haracter)h(to)e(b)q(e)h(output)f(matc)o
(hes)1114 2130 y(the)f(second)g(c)o(haracter)h(of)e(an)o(y)g(of)f(these)j
(pairs,)e(the)1114 2179 y(c)o(haractcr)16 b(is)f(replaced)h(b)o(y)f(a)g(bac)o
(kslash)g(follo)o(w)o(ed)1114 2229 y(b)o(y)e(the)i(\014rst)f(c)o(haracter)i
(of)d(the)h(pair;)1010 2322 y Fi(8407:)20 b Fn(Lo)o(w)o(er)13
b(case)h(alphab)q(etics)g(are)f(con)o(v)o(erted)h(to)f(up-)1114
2372 y(p)q(er)g(case)g(alphab)q(etics)g(b)o(y)f(the)h(addition)e(of)h(a)g
(con-)1114 2422 y(stan)o(t.)1010 2523 y(Note.)17 b(The)12 b(con)o(v)o(ersion)
f(here)h(should)e(b)q(e)i(compared)e(wth)1010 2573 y(the)j(handling)f(of)g
(the)h(rev)o(erse)i(problem)c(on)h(input.)18 b(Here)1010 2622
y(w)o(e)i(ha)o(v)o(e)g(an)g(algorithm)e(whic)o(h)i(clearly)g(trades)h(space)
1010 2672 y(\(no)14 b(table)h(analogue)f(to)g(\\maptab"\))f(for)h(time)g(\(a)
g(serial)1010 2722 y(searc)o(h)19 b(through)f(the)h(string)f(on)g(line)f
(8400\).)30 b(A)18 b(space)1010 2772 y(conserving)f(approac)o(h)f(could)h(b)q
(e)g(adopted)f(in)h(\\canon")1010 2822 y(but)d(the)g(problem)f(is)h(rather)g
(more)f(complicated)g(there.)1869 2946 y(103)p eop
%%Page: 104 112
111 bop -30 -144 a Fk(25)43 b(THE)15 b(FILE)g(\\TTY.C")908
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fi(8414:)21
b Fn(Insert)c(the)f(c)o(haracter)i(in)o(to)d(the)h(output)g(queue.)74
66 y(If)k(p)q(erc)o(hance,)k(\\putc")c(fails)f(for)h(lac)o(k)g(of)g(bu\013er)
74 116 y(space,)13 b(don't)f(w)o(orry)g(ab)q(out)g(inserting)g(an)o(y)g
(subse-)74 166 y(quen)o(t)j(dela)o(y)m(,)d(or)i(up)q(dating)f(the)i(system's)
f(idea)f(of)74 216 y(the)i(curren)o(t)g(prin)o(ting)e(column;)-30
309 y Fi(8423:)21 b Fn(Set)15 b(\\colp")f(to)h(p)q(oin)o(t)f(to)g(the)h(\\t)p
625 309 13 2 v 15 w(col")f(c)o(haracter)74 358 y(of)c(the)i(\\tt)o(y")e
(structure,)j(i.e.)j(\\*colp")10 b(has)h(a)f(v)n(alue)74 408
y(whic)o(h)20 b(is)g(the)h(ordinal)e(n)o(um)o(b)q(er)g(of)h(the)g(column)74
458 y(whic)o(h)14 b(has)g(just)g(b)q(een)h(prin)o(ted;)-30
551 y Fi(8424:)21 b Fn(Set)14 b(\\ct)o(yp)q(e")h(to)e(the)i(elemen)o(t)e(of)g
(\\partab")g(cor-)74 600 y(resp)q(onding)i(to)e(the)i(output)f(c)o(haracter)h
(\\c";)-30 693 y Fi(8426:)21 b Fn(Mask)12 b(out)h(the)g(signi\014can)o(t)f
(bits)g(of)g(\\ct)o(yp)q(e")h(and)74 743 y(use)i(the)f(result)h(as)f(the)h
(\\switc)o(h")e(index;)-30 835 y Fi(8428:)21 b Fn(\(Case)15
b(0\))f(The)h(common)c(situation!)18 b(Incremen)o(t)74 885
y(\\t)p 113 885 V 15 w(col";)-30 978 y Fi(8431:)j Fn(\(Case)28
b(1\))g(Non-prin)o(ting)f(c)o(haracters.)62 b(This)74 1028
y(group)19 b(consists)g(of)f(the)i(\014rst,)g(third)e(and)h(fourth)74
1077 y(o)q(ctet)i(of)e(the)h(ASCI)q(I)f(c)o(haracter)i(set,)h(plus)d(\\so")74
1127 y(\(016\),)14 b(\\si")g(\(017\))g(and)g(\\del")g(\(0177\).)20
b(Don't)13 b(in-)74 1177 y(cremen)o(t)h(\\t)p 271 1177 V 15
w(col";)-30 1270 y Fi(8434:)21 b Fn(\(Case)15 b(2\))f(Bac)o(kspace.)21
b(Decremen)o(t)15 b(\\t)p 733 1270 V 15 w(col")f(un-)74 1319
y(less)h(it)e(is)h(already)g(zero;)-30 1412 y Fi(8439:)21 b
Fn(\(Case)15 b(3\))f(Newline.)k(Ob)o(viously)c(\\t)p 676 1412
V 14 w(col")g(should)74 1462 y(b)q(e)k(set)g(to)f(zero.)28
b(The)17 b(main)e(problem)h(is)g(to)h(cal-)74 1512 y(culate)k(the)h(dela)o(y)
e(whic)o(h)g(should)h(ensue)h(b)q(efore)74 1562 y(another)15
b(c)o(haracter)g(is)f(sen)o(t.)74 1633 y(F)m(or)e(a)f(Mo)q(del)h(37)g(telet)o
(yp)q(e,)h(this)f(dep)q(ends)h(on)f(ho)o(w)74 1683 y(far)e(the)h(prin)o(t)g
(mec)o(hanism)d(has)j(progressed)h(across)74 1732 y(the)h(page.)18
b(The)13 b(v)n(alue)e(c)o(hosen)j(is)e(at)g(least)h(a)f(ten)o(th)74
1782 y(of)18 b(a)g(second)h(\(six)f(clo)q(c)o(k)h(tic)o(ks\))f(and)g(ma)o(y)f
(b)q(e)i(as)74 1832 y(m)o(uc)o(h)13 b(as)h(\(\(132/16\))f(+)h(3\)/60)f(=)h
(0.19)f(seconds.)74 1903 y(F)m(or)18 b(a)g(VT05,)g(the)g(dela)o(y)g(is)g(0.1)
f(second.)31 b(F)m(or)18 b(a)74 1953 y(DECwriter)c(it)f(is)g(zero)g(b)q
(ecause)i(the)f(terminal)d(in-)74 2003 y(corp)q(orates)23 b(bu\013er)f
(storage)g(and)f(has)g(a)g(double)74 2053 y(sp)q(eed)16 b(\\catc)o(h)e(up")g
(prin)o(t)f(mo)q(de;)-30 2145 y Fi(8451:)21 b Fn(\(Case)12
b(4\))g(Horizon)o(tal)f(tab.)18 b(Assign)12 b(the)g(v)n(alue)f(of)74
2195 y(bits)j(10,)f(11)g(of)h(\\t)p 364 2195 V 15 w(\015ags")f(to)h(\\ct)o
(yp)q(e";)-30 2288 y Fi(8453:)21 b Fn(F)m(or)13 b(the)i(only)e(non-trivial)f
(case)j(recognised)74 2338 y(\(\\c")10 b(==)g(1)f(or)g(Mo)q(del)h(37)e(telet)
o(yp)q(e\),)k(calculate)d(the)74 2387 y(the)16 b(n)o(um)o(b)q(er)e(of)g(p)q
(ositions)g(to)h(the)g(next)h(tab)e(stop)74 2437 y(\(via)i(the)g(obscure)i
(calculation)d(of)g(line)h(8454\).)23 b(If)74 2487 y(this)12
b(turns)h(out)f(to)g(b)q(e)h(four)e(columns)g(or)h(less,)h(tak)o(e)74
2537 y(it)h(as)g(zero;)-30 2629 y Fi(8458:)21 b Fn(Round)13
b(\\*colp")f(\(i.e.)18 b(the)c(v)n(alue)e(p)q(oin)o(ted)i(to)f(b)o(y)74
2679 y(\\colp"!\))18 b(to)13 b(the)i(next)f(m)o(ultiple)e(of)h(8)h(less)g
(one;)-30 2772 y Fi(8459:)21 b Fn(Incremen)o(t)d(\\*colp")f(to)g(b)q(e)h(an)g
(exact)g(m)o(ultiple)74 2822 y(of)c(eigh)o(t;)1010 17 y Fi(8462:)20
b Fn(\(Case)c(5\))e(V)m(ertical)g(Motion.)20 b(If)14 b(bit)g(14)h(is)f(set)i
(in)1114 66 y(\\t)p 1153 66 V 14 w(\015ags",)e(mak)o(e)f(the)i(dela)o(y)g(as)
f(long)g(as)g(p)q(ossible,)1114 116 y(i.e.)j(0177)c(or)h(127)g(clo)q(c)o(k)g
(tic)o(ks,)f(i.e.)18 b(just)d(o)o(v)o(er)f(t)o(w)o(o)1114 166
y(seconds;)1010 254 y Fi(8467:)20 b Fn(\(Case)15 b(6\))f(Carriage)g(Return.)
19 b(Assign)14 b(the)h(v)n(alue)1114 304 y(of)e(bits)h(12,)f(13)g(of)g(\\t)p
1450 304 V 15 w(\015ags")h(to)f(\\ct)o(yp)q(e";)1010 392 y
Fi(8469:)20 b Fn(F)m(or)12 b(the)h(\014rst)g(class,)g(allo)o(w)e(a)h(dela)o
(y)g(of)f(\014v)o(e)i(clo)q(c)o(k)1114 441 y(tic)o(ks;)1010
529 y Fi(8472:)20 b Fn(F)m(or)g(the)g(second)h(class,)g(allo)o(w)d(a)h(dela)o
(y)g(of)g(ten)1114 579 y(clo)q(c)o(k)14 b(tic)o(ks;)1010 667
y Fi(8475:)20 b Fn(Set)13 b(the)g(\\*colp")f(\(the)h(last)f(column)f(prin)o
(ted\))i(to)1114 717 y(zero.)1072 813 y(Before)d(lea)o(ving)f(the)g(\014le)h
(\\tt)o(y)m(.c",)f(there)h(are)g(t)o(w)o(o)f(mat-)1010 863
y(ters)15 b(whic)o(h)f(deserv)o(e)h(further)g(examination.)1010
985 y Fg(25.13)56 b(A.)28 b(The)g(test)f(for)i('TTLO)n(W)-6
b(A)h(T')1194 1043 y(\(Line)17 b(8074\))1010 1122 y Fn(On)c(line)g(8074)f(in)
h(\\klxin)o(t",)e(a)i(test)h(is)f(made)f(whether)i(to)1010
1172 y(restart)g(an)o(y)f(pro)q(cesses)i(w)o(aiting)d(to)h(send)g(output)h
(to)e(the)1010 1222 y(terminal.)31 b(The)19 b(test)g(is)g(successful)i(if)c
(the)j(n)o(um)o(b)q(er)e(of)1010 1272 y(c)o(haracters)d(is)e(zero)i(or)e(if)g
(it)g(is)g(equal)g(to)g(\\TTLO)o(W)-5 b(A)m(T".)1072 1323 y(If)11
b(the)g(n)o(um)o(b)q(er)f(of)g(c)o(haracters)j(is)e(b)q(et)o(w)o(een)h(these)
g(v)n(al-)1010 1372 y(ues,)19 b(no)f(\\w)o(ak)o(eup")f(is)h(p)q(erformed)g
(un)o(til)f(the)h(queue)h(is)1010 1422 y(completely)d(empt)o(y)m(,)f(with)i
(the)h(strong)f(lik)o(eliho)q(o)q(d)e(that)1010 1472 y(there)20
b(will)e(then)h(b)q(e)h(a)e(hiatus)h(in)g(the)g(\015o)o(w)g(of)f(output)1010
1522 y(to)e(the)h(terminal.)24 b(Since)17 b(temp)q(orary)e(in)o(terruptions)i
(to)1010 1572 y(the)e(\015o)o(w)f(of)g(output)g(are)h(quite)f(frequen)o(tly)h
(observ)o(ed)h(in)1010 1621 y(practice)e(and)e(represen)o(t)j(a)e(source)g
(of)g(o)q(ccasional)f(irrita-)1010 1671 y(tion)17 b(if)f(nothing)h(more,)f
(one)i(ma)o(y)d(reasonably)i(enquire)1010 1721 y(\\is)c(there)h(an)o(y)f(w)o
(a)o(y)f(the)i(c)o(haracter)h(coun)o(t)e(can)g(get)h(from)1010
1771 y(b)q(eing)e(greater)h(than)f(\\TTLO)o(W)-5 b(A)m(T")11
b(to)h(b)q(elo)o(w)g(it,)g(with-)1010 1821 y(out)i(this)g(b)q(eing)f
(detected)j(at)e(line)g(8074?")1072 1872 y(Quite)c(clearly)f(there)i(is,)e
(since)h(eac)o(h)g(call)e(on)h(\\ttstart")1010 1922 y(can)h(decremen)o(t)g
(the)g(queue)g(size,)h(and)e(only)g(one)h(suc)o(h)g(call)1010
1971 y(is)i(follo)o(w)o(ed)f(b)o(y)h(the)h(test.)18 b(Th)o(us)13
b(if)e(the)i(call)f(on)g(\\ttstart")1010 2021 y(from)20 b(one)i(of)g
(\\ttrstrt")h(\(8492\))e(or)h(\\tt)o(write")g(\(8568\))1010
2071 y(happ)q(ens)15 b(to)f(cross)i(the)f(b)q(oundary)m(,)f(a)g(dela)o(y)g
(will)f(result.)1010 2121 y(The)i(probabilit)o(y)d(that)j(this)f(will)f(happ)
q(en)i(is)f(small,)e(but)1010 2171 y(\014nite)k(and)h(hence)g(the)g(ev)o(en)o
(t)g(is)g(lik)o(ely)e(to)h(b)q(e)h(observ)o(ed)1010 2220 y(in)c(an)o(y)h
(reasonably)f(long)g(output)h(sequence.)1072 2271 y(There)d(are)e(t)o(w)o(o)g
(other)h(situations)f(in)g(whic)o(h)g(\\ttstart")1010 2321
y(is)h(called)g(whic)o(h)h(seem)f(to)g(b)q(e)h(satisfactory)m(.)17
b(A)o(t)10 b(\\tt)o(write")1010 2371 y(\(8561\))j(the)i(queue)g(is)f(at)g
(its)g(maxim)n(um)c(exten)o(t;)k(and)g(at)1010 2421 y(\\tt)o(yinput")f
(\(8363\))f(there)j(is)e(a)g(preceding)i(call)d(on)h(\\tt)o(y-)1010
2471 y(output")20 b(whic)o(h)f(usually)h(\(but)g(not)g(in)o(v)n(ariably!\))34
b(will)1010 2521 y(ha)o(v)o(e)14 b(added)g(a)f(c)o(haracter)j(to)d(the)i
(output)f(queue.)1010 2643 y Fg(25.14)56 b(B.)18 b(Inactiv)n(e)f(T)-5
b(erminals)1010 2722 y Fn(When)16 b(the)h(last)f(sp)q(ecial)h(\014le)f(for)g
(a)g(terminal)f(is)h(closed,)1010 2772 y(\\klclose")24 b(\(8055\))g(is)g
(called)h(and)f(resets)j(\(8059\))c(the)1010 2822 y(\\ISOPEN")c(and)g(\\CARR)
p 1460 2822 V 14 w(ON")g(\015ags.)33 b(Ho)o(w)o(ev)o(er)19
b(the)-30 2946 y(104)p eop
%%Page: 105 113
112 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)908
b(25)43 b(THE)15 b(FILE)g(\\TTY.C")-30 17 y Fn(\\read)e(enable")g(bit)g(of)f
(the)h(receiv)o(er)h(con)o(trol)f(status)g(reg-)-30 66 y(ister)j(is)f(not)g
(reset,)i(so)e(that)g(incoming)e(c)o(haracters)k(ma)o(y)-30
116 y(still)22 b(b)q(e)g(receiv)o(ed)i(and)d(will)g(b)q(e)i(stored)g(a)o(w)o
(a)o(y)d(\(8087\))-30 166 y(in)i(the)h(terminal's)d(\\ra)o(w")i(input)g
(queue)h(b)o(y)f(\\klrin)o(t")-30 216 y(\(8078\),)d(and)g(\\tt)o(yinput")f
(\(8333\),)h(whic)o(h)f(do)h(not)g(test)-30 266 y(the)c(\\CARR)p
188 266 13 2 v 14 w(ON")f(\015ag,)f(to)h(see)i(if)d(the)i(terminal)d(is)i
(log-)-30 316 y(ically)f(connected.)33 365 y(These)25 b(c)o(haracters)g(ma)o
(y)d(accum)o(ulate)h(for)g(a)h(long)-30 415 y(time)10 b(and)i(clog)e(up)i
(the)f(c)o(haracter)i(bu\013er)f(storage.)18 b(Only)-30 465
y(when)j(the)f(\\ra)o(w")f(input)g(queue)h(reac)o(hes)i(256)c(c)o(harac-)-30
515 y(ters)i(\(\\TTYHOG",)d(8349\))g(will)g(the)h(con)o(ten)o(ts)h(of)f(this)
-30 565 y(queue)13 b(b)q(e)g(thro)o(wn)f(a)o(w)o(a)o(y)m(.)j(It)d(do)q(es)h
(seem)e(therefore,)j(that)-30 614 y(a)i(statemen)o(t)f(to)g(disable)g(reader)
h(in)o(terrupts)h(should)e(b)q(e)-30 664 y(included)g(in)e(\\klclose")g(b)q
(efore)i(line)e(8058.)1010 17 y Fg(25.15)56 b(W)-5 b(ell,)17
b(that's)h(all,)g(folks)g(...)1010 93 y Fn(No)o(w)d(that)h(y)o(ou,)f(oh)h
(long-su\013ering,)f(exhausted)i(reader)1010 143 y(ha)o(v)o(e)12
b(reac)o(hed)h(this)g(p)q(oin)o(t,)e(y)o(ou)h(will)f(ha)o(v)o(e)h(no)g
(trouble)h(in)1010 193 y(disp)q(osing)e(of)f(the)i(last)f(remaining)e
(\014le,)j(\\mem.)o(c")d(\(Sheet)1010 243 y(90\).)17 b(And)12
b(on)f(this)h(note,)g(w)o(e)g(end)g(this)g(discussion)g(of)f(the)1010
293 y(UNIX)j(Op)q(erating)g(System)g(Source)h(Co)q(de.)1072
342 y(Of)f(course)i(there)f(are)g(lots)f(more)f(device)i(driv)o(ers)g(for)
1010 392 y(y)o(our)i(patien)o(t)g(examination,)e(and)i(in)g(truth)h(the)f
(whole)1010 442 y(UNIX)11 b(Timesharing)f(System)g(Source)i(Co)q(de)f(has)h
(hardly)1010 492 y(b)q(een)j(scratc)o(hed.)20 b(So)13 b(this)h(is)g(not)g
(really)1354 583 y Fb(THE)j(END)1869 2946 y Fn(105)p eop
%%Page: 106 114
113 bop -30 -144 a Fk(26)43 b(SUGGESTED)16 b(EXER)o(CISES)790
b(UNIX)14 b(6th)h(Edition)g(Commentary)-30 17 y Fj(26)70 b(Suggested)23
b(Exercises)-30 108 y Fn(An)o(y)12 b(op)q(erating)f(system)g(design)h(in)o(v)
o(olv)o(es)e(man)o(y)g(sub)r(jec-)-30 158 y(tiv)o(e)j(and)f(ad)g(ho)q(c)h
(judgemen)o(ts)f(on)g(the)h(part)g(of)f(system's)-30 207 y(designers.)19
b(A)o(t)11 b(man)o(y)e(places)j(in)f(the)h(UNIX)f(source)i(co)q(de)-30
257 y(y)o(ou)h(will)e(\014nd)i(y)o(ourself)f(w)o(ondering)h(\\Wh)o(y)e(did)i
(they)g(do)-30 307 y(it)k(that)h(w)o(a)o(y?",)e(\\What)h(w)o(ould)f(happ)q
(en)i(if)e(I)h(c)o(hanged)-30 357 y(this?")33 407 y(The)j(follo)o(wing)d
(exercises)k(express)h(some)c(of)h(these)-30 457 y(questions.)e(Some)10
b(can)h(b)q(e)g(answ)o(ered)h(from)d(an)i(examina-)-30 506
y(tion)j(of)f(the)i(source)g(co)q(de)g(alone)e(after)h(a)g(study)g(in)g(more)
-30 556 y(depth;)25 b(others)c(require)h(some)d(exp)q(erimen)o(tal)h(probing)
-30 606 y(and)11 b(measuremen)o(t,)f(for)h(whic)o(h)f(read-only)h(access)h
(to)f(the)-30 656 y(\014le)21 b(\\/dev/kmem")c(via)i(terminal)g(will)f(pro)o
(v)o(e)j(in)o(v)n(alu-)-30 706 y(able;)12 b(and)g(still)f(others)h(really)g
(require)g(the)h(construction)-30 756 y(and)i(testing)f(of)g(exp)q(erimen)o
(tal)f(v)o(ersions)i(of)e(the)i(op)q(erat-)-30 805 y(ing)f(system.)-30
922 y Fg(26.1)56 b(Section)18 b(One)-30 999 y Fi(1.1)j Fn(Devise)f(c)o
(hanges)h(to)f(\\mallo)q(c")d(\(2528\))i(to)h(imple-)74 1049
y(men)o(t)13 b(the)i(Best)g(Fit)e(algorithm.)-30 1133 y Fi(1.2)21
b Fn(Rewrite)c(the)f(pro)q(cedure)i(\\mfree")d(\(2556\))g(to)h(ren-)74
1182 y(der)d(its)f(function)f(more)g(easily)h(discernible)g(b)o(y)g(the)74
1232 y(reader.)-30 1316 y Fi(1.3)21 b Fn(In)o(v)o(estigate)13
b(the)h(adequacy)f(of)f(the)i(sizes)g(of)e(the)i(ar-)74 1366
y(ra)o(ys)d(\\coremap")e(and)h(\\sw)o(apmap")e(\(0203,)i(0204\).)74
1415 y(Ho)o(w)24 b(should)f(\\CMAPSIZ")h(and)f(\\SW)-5 b(APSIZ")74
1465 y(c)o(hange)14 b(when)h(\\NPR)o(OC")e(is)h(increased?)-30
1549 y Fi(1.4)21 b Fn(Pro)o(v)o(e)15 b(that)g(\\malloc")d(and)j(\\mfree")e
(join)o(tly)g(solv)o(e)74 1599 y(the)i(memory)c(alio)q(cation)h(problem)h
(correctly)m(.)-30 1682 y Fi(1.5)21 b Fn(By)12 b(monitoring)c(the)k(con)o
(ten)o(ts)g(of)e(\\coremap",)g(esti-)74 1732 y(mate)j(the)h(e\016ciency)h
(with)f(whic)o(h)f(main)f(memory)74 1782 y(is)g(utilised.)k(Estimate)11
b(also)g(the)h(cost)g(of)f(compact-)74 1832 y(ing)h(\\in)g(use)i(areas")e(of)
g(main)f(memory)f(from)h(time)74 1881 y(to)j(time)f(to)g(reduce)j(memory)11
b(fragmen)o(tation.)74 1948 y(Hence)27 b(decide)g(whether)g(it)e(w)o(ould)g
(b)q(e)h(w)o(orth-)74 1998 y(while)18 b(to)h(extend)g(the)h(presen)o(t)g
(memory)c(allo)q(ca-)74 2048 y(tion)e(sc)o(heme)g(to)f(include)h(memory)e
(compaction.)-30 2131 y Fi(1.6)21 b Fn(In)16 b(setting)g(the)g(\014rst)h(six)
e(k)o(ernel)h(page)g(description)74 2181 y(registers,)h(UNIX)e(do)q(es)h(not)
f(mak)o(e)e(use)j(of)e(all)g(the)74 2231 y(hardw)o(are)20 b(protection)f
(features)h(that)f(are)h(a)o(v)n(ail-)74 2281 y(able)13 b(e.g.)k(some)c
(pages)g(whic)o(h)g(con)o(tain)g(only)f(pure)74 2331 y(text)g(could)f(b)q(e)g
(made)f(read-only)m(.)17 b(Devise)11 b(c)o(hanges)74 2380 y(to)k(the)g(co)q
(de)g(to)g(maxim)o(ise)d(the)j(use)h(of)e(the)h(a)o(v)n(ail-)74
2430 y(able)f(hardw)o(are)g(protection.)-30 2514 y Fi(1.7)21
b Fn(Compile)12 b(the)i(program)161 2622 y Ff(char)21 b(*init)g
(``/etc/init'';)161 2672 y(main)g(\()h(\))g({)161 2722 y(execl)f(\(init,)g
(init,)f(0\);)161 2772 y(while)h(\(1\);)161 2822 y(})1114 17
y Fn(and)16 b(compare)g(the)i(result)f(with)f(the)i(con)o(ten)o(ts)g(of)1114
66 y(the)c(arra)o(y)g(\\ico)q(de")f(\(1516\).)1010 152 y Fi(1.8)21
b Fn(In)o(v)o(estigate)e(the)h(size)g(required)g(for)f(k)o(ernel)h(mo)q(de)
1114 202 y(stac)o(k)e(areas.)30 b(Hence)20 b(sho)o(w)e(that)g(the)g(367)f(w)o
(ord)1114 251 y(area)d(whic)o(h)f(is)h(pro)o(vided)g(is)g(adequate.)1010
337 y Fi(1.9)21 b Fn(If)9 b(main)f(memory)f(consists)k(of)e(sev)o(eral)i
(indep)q(enden)o(t)1114 387 y(memory)17 b(mo)q(dules)h(and)h(one)h(of)f
(these,)j(not)d(the)1114 436 y(last,)e(is)f(do)o(wn,)h(\\main")d(will)i(not)h
(include)g(mem-)1114 486 y(ory)10 b(mo)q(dules)g(b)q(ey)o(ond)g(the)h(one)g
(whic)o(h)g(is)f(do)o(wn,)h(in)1114 536 y(the)k(list)g(of)g(a)o(v)n(ailable)e
(space)j(in)e(\\coremap".)21 b(De-)1114 586 y(vise)11 b(some)g(simple)e(c)o
(hanges)j(to)f(\\main")e(to)i(handle)1114 636 y(this)g(situation.)17
b(what)11 b(other)i(parts)f(of)f(the)h(system)1114 686 y(w)o(ould)h(also)g
(need)i(revision?)1010 771 y Fi(1.10)20 b Fn(Rewrite)j(the)h(routines)f
(\\estabur")g(\(1650\))f(and)1114 821 y(\\sureg")17 b(\(1739\))g(so)g(that)h
(they)g(will)e(w)o(ork)h(as)g(ef-)1114 871 y(\014cien)o(tly)f(as)h(p)q
(ossible)g(on)f(the)h(PDP11/40.)25 b(Ho)o(w)1114 920 y(often)g(are)i(these)g
(routines)f(used)h(in)e(practice?)1114 970 y(W)m(ould)16 b(it)h(really)h(b)q
(e)g(w)o(orth)o(while)f(trying)h(to)f(im-)1114 1020 y(plemen)o(t)c(y)o(our)g
(impro)o(v)o(ed)f(v)o(ersions?)1010 1105 y Fi(1.11)20 b Fn(In)o(v)o(estigate)
c(the)g(o)o(v)o(erheads)g(in)o(v)o(olv)o(ed)f(in)g(initiat-)1114
1155 y(ing)g(a)i(new)g(pro)q(cess.)28 b(P)o(erform)15 b(a)i(series)h(of)d
(mea-)1114 1205 y(suremen)o(ts)c(for)f(a)h(set)g(of)f(di\013eren)o(t)i(sized)
f(programs)1114 1255 y(under)j(di\013eren)o(t)h(conditions.)1010
1340 y Fi(1.12)20 b Fn(Ev)n(aluate)h(the)i(follo)o(wing)18
b(sc)o(heme)k(whic)o(h)f(is)h(in-)1114 1390 y(tended)17 b(b)o(y)g(Ken)g
(Thompson)e(as)i(the)g(basis)g(for)f(a)1114 1440 y(revised)e(sc)o(heduling)h
(algorithm:)1114 1507 y(A)d(n)o(um)o(b)q(er)f(\\p")g(is)h(k)o(ept)g(for)g
(eac)o(h)g(pro)q(cess,)i(stored)1114 1557 y(as)h(\\p)p 1212
1557 13 2 v 14 w(cpu".)21 b(\\p")15 b(is)f(incremen)o(ted)i(b)o(y)e(one)h(ev)
o(ery)1114 1607 y(clo)q(c)o(k)f(tic)o(k)h(that)f(the)h(pro)q(cess)i(is)d
(found)g(to)h(b)q(e)g(ex-)1114 1657 y(ecuting.)22 b(\\p")14
b(therefore)j(accum)o(ulates)d(the)i(CPU)1114 1707 y(usage.)k(Ev)o(ery)15
b(second,)g(eac)o(h)g(v)n(alue)f(of)g(\\p")g(is)h(re-)1114
1756 y(placed)i(b)o(y)g(four)h(\014fths)f(of)g(its)g(v)n(alue)g(rounded)h(to)
1114 1806 y(the)c(nearest)i(in)o(teger.)j(This)13 b(means)h(that)g(\\o")f
(has)1114 1856 y(v)n(alues)f(whic)o(h)g(are)h(b)q(ounded)g(b)o(y)f(zero)h
(and)f(the)h(so-)1114 1906 y(lution)f(of)h(the)i(equation)e
Fh(k)f Fn(=)g(0)p Fh(:)p Fn(8)c Fl(\003)g Fn(\()p Fh(k)i Fn(+)f
Fh(H)s(Z)s Fn(\))14 b(i.e.)1114 1956 y(4*HZ.)19 b(Hence)i(if)e(HZ)h(is)g(50)f
(or)h(60,)g(and)g(\\p")f(is)1114 2006 y(in)o(tegerised,)14
b(\\p")f(can)h(b)q(e)h(stored)g(in)e(one)h(b)o(yte.)1010 2091
y Fi(1.13)20 b Fn(The)15 b(\\pro)q(c")e(table)h(is)g(alw)o(a)o(ys)e(searc)o
(hed)j(via)e(a)h(di-)1114 2141 y(rect)22 b(linear)e(searc)o(h.)41
b(As)21 b(the)h(table)f(size)h(is)f(in-)1114 2190 y(creased,)i(the)e(searc)o
(h)g(o)o(v)o(erheads)h(also)d(increase.)1114 2240 y(Surv)o(ey)27
b(the)h(alternativ)o(es)g(for)f(impro)o(ving)d(the)1114 2290
y(searc)o(h)h(mec)o(hanism,)e(when)h(\\NPR)o(OC")g(is)f(sa)o(y)1114
2340 y(300.)1010 2459 y Fg(26.2)56 b(Section)17 b(Tw)n(o)1010
2537 y Fi(2.1)k Fn(Explain)c(in)h(detail)f(ho)o(w)h(the)h(system)f(reacts)h
(to)f(a)1114 2587 y(\015oating)8 b(p)q(oin)o(t)h(trap)g(whic)o(h)h(o)q(ccurs)
g(when)g(the)g(pro-)1114 2637 y(cessor)15 b(is)f(in)f(k)o(ernel)i(mo)q(de.)
1010 2722 y Fi(2.2)21 b Fn(When)10 b(a)g(pro)q(cess)i(dies,)f(a)f(\\zom)o
(bie")f(record)i(is)f(writ-)1114 2772 y(ten)k(to)f(disk,)f(and)i(is)f
(subsequen)o(tly)h(read)g(bac)o(k)f(b)o(y)1114 2822 y(the)h(paren)o(t.)k
(Devise)c(a)g(sc)o(heme)f(for)h(passing)f(bac)o(k)-30 2946
y(106)p eop
%%Page: 107 115
114 bop -30 -144 a Fk(UNIX)15 b(6th)g(Edition)g(Commentary)788
b(26)43 b(SUGGESTED)16 b(EXER)o(CISES)74 17 y Fn(the)11 b(necessary)i
(information)7 b(to)k(the)g(paren)o(t)g(whic)o(h)74 66 y(will)i(a)o(v)o(oid)h
(the)h(o)o(v)o(erhead)g(of)f(the)h(t)o(w)o(o)f(i/o)f(op)q(era-)74
116 y(tions.)-30 199 y Fi(2.3)21 b Fn(Do)q(cumen)o(t)13 b(\\bac)o(kup")h
(\(1012\).)-30 281 y Fi(2.4)21 b Fn(It)11 b(is)f(relativ)o(ely)g(easy)h
(using)g(the)g(\\shell")f(to)h(set)g(up)g(a)74 331 y(set)h(of)e(async)o
(hronous)i(pro)q(cesses)i(whic)o(h)c(will)g(\015o)q(o)q(d)74
381 y(y)o(our)22 b(terminal)e(with)h(useless)j(output.)42 b(T)m(rying)74
431 y(to)15 b(stop)h(these)g(pro)q(cesses)i(individually)13
b(can)i(b)q(e)h(a)74 481 y(problem,)11 b(since)j(their)e(iden)o(tifying)f(n)o
(um)o(b)q(ers)i(ma)o(y)74 530 y(not)j(b)q(e)g(kno)o(wn.)24
b(Use)17 b(of)e(the)h(command)d(\\kill)h(0")74 580 y(is)f(usually)g(an)g(act)
g(of)g(sheer)i(desp)q(eration.)j(Devise)74 630 y(an)e(alternativ)o(e)f(sc)o
(heme,)h(e.g.)22 b(based)16 b(on)g(the)g(use)74 680 y(of)f(messages)g(suc)o
(h)h(as)f(\\kill)e({99",)h(whic)o(h)h(will)f(b)q(e)74 730 y(e\013ectiv)o(e,)h
(but)f(more)f(selectiv)o(e.)-30 812 y Fi(2.5)21 b Fn(Design)g(a)g(form)e(of)i
(coroutine)h(jump)d(whlc)o(h)i(will)74 862 y(cause)13 b(con)o(trol)f(to)g
(pass)g(more)f(e\016cien)o(tly)h(b)q(et)o(w)o(een)74 912 y(a)h(program)e
(whic)o(h)i(is)g(b)q(eing)g(traced,)h(and)f(its)g(par-)74 962
y(en)o(t.)-30 1077 y Fg(26.3)56 b(Section)18 b(Three)-30 1154
y Fi(3.1)j Fn(Rewrite)11 b(the)g(pro)q(cedure)i(\\sc)o(hed")e(to)f(a)o(v)o
(oid)g(the)h(use)74 1204 y(of)j(\\goto")e(statemen)o(ts.)-30
1286 y Fi(3.2)21 b Fn(Mo)q(dify)16 b(\\sc)o(hed")h(so)f(that)g(the)h(text)g
(segmen)o(t)f(and)74 1336 y(data)g(segmen)o(t)g(for)g(a)g(program)f(will)g(p)
q(ossibly)h(b)q(e)74 1386 y(allo)q(cated)e(in)f(separate)i(main)c(memory)h
(areas)i(if)f(a)74 1436 y(single)f(large)g(area)g(is)h(not)f(imm)o(ediately)d
(a)o(v)n(ailable.)-30 1518 y Fi(3.3)21 b Fn(If)14 b(the)h(system)g(crashes)h
(and)e(m)o(ust)g(b)q(e)h(\\reb)q(o)q(oted")74 1568 y(the)22
b(con)o(ten)o(ts)h(of)e(the)h(bu\013ers)h(whic)o(h)e(w)o(ere)i(not)74
1618 y(written)15 b(out)e(at)h(the)h(time)d(of)i(the)g(crash)h(are)f(lost.)74
1684 y(Ho)o(w)o(ev)o(er)22 b(if)e(a)g(core)i(dump)e(is)h(tak)o(en,)h(the)g
(con-)74 1734 y(ten)o(ts)12 b(of)e(the)i(bu\013ers)g(can)f(b)q(e)g(obtained)g
(and)f(hence)74 1784 y(the)15 b(con)o(ten)o(ts)g(of)e(the)i(disk)f(can)g(b)q
(e)g(brough)o(t)g(com-)74 1834 y(pletely)19 b(up)g(to)f(date.)33
b(Outline)19 b(a)g(detalled)f(plan)74 1883 y(for)g(carrying)h(out)f(this)h
(sc)o(heme.)32 b(Ho)o(w)18 b(e\013ectiv)o(e)74 1933 y(do)c(y)o(ou)f(think)h
(it)f(w)o(ould)g(b)q(e?)-30 2016 y Fi(3.4)21 b Fn(Explain)15
b(wh)o(y)h(the)h(bu\013er)g(areas)f(declared)h(on)f(line)74
2066 y(4720)d(are)h(514,)f(and)h(not)g(512,)e(c)o(haracters)k(long.)-30
2148 y Fi(3.5)21 b Fn(Explain)d(ho)o(w)f(deadlo)q(c)o(k)i(situations)f(ma)o
(y)e(arise)j(if)74 2198 y(there)k(are)g(to)q(o)e(few)h(\\large")f(bu\013ers)i
(a)o(v)n(ailable.)74 2248 y(What)17 b(measures)h(can)f(y)o(ou)g(suggest)h(to)
g(alleviate)74 2297 y(the)24 b(problem,)h(assuming)d(that)h(increasing)h(the)
74 2347 y(n)o(um)o(b)q(er)13 b(of)h(bu\013ers)h(is)f(not)f(p)q(ossible.)-30
2463 y Fg(26.4)56 b(Section)18 b(F)-5 b(our)-30 2540 y Fi(4.1)21
b Fn(Devise)e(a)e(sc)o(heme)h(for)g(lab)q(elling)e(\014le)i(system)g(v)o(ol-)
74 2590 y(umes)13 b(and)f(c)o(hec)o(king)i(these)g(lab)q(els)f(when)g(the)h
(v)o(ol-)74 2639 y(umes)g(are)g(moun)o(ted.)-30 2722 y Fi(4.2)21
b Fn(Discuss)12 b(the)f(problems)f(of)g(supp)q(orting)h(ANSI)h(stan-)74
2772 y(dard)g(lab)q(elled)f(tap)q(es)h(under)g(UNIX,)g(and)f(prop)q(ose)74
2822 y(a)j(solution.)1010 17 y Fi(4.3)21 b Fn(Design)11 b(a)h(sc)o(heme)f
(for)h(pro)o(viding)e(index)i(sequen)o(tial)1114 66 y(access)j(to)f(\014les.)
1010 149 y Fi(4.4)21 b Fn(The)9 b(emergence)h(of)f(the)h(\\stic)o(ky)f(bit")g
(\(see)h(\\CHMOD\(I\)")1114 199 y(in)f(the)h(PM\))g(con\014rms)f(that)h
(there)h(are)f(some)f(resid-)1114 249 y(ual)14 b(adv)n(an)o(tages)g(in)h
(allo)q(cating)e(all)h(the)h(space)h(for)1114 299 y(a)10 b(\014le)g(con)o
(tiguously)m(.)16 b(Discuss)11 b(the)g(merits)f(of)g(mak-)1114
349 y(ing)21 b(\\con)o(tiguous)g(\014les")h(more)f(generally)g(a)o(v)n(ail-)
1114 399 y(able.)1010 482 y Fi(4.5)g Fn(Devise)12 b(a)g(tec)o(hnique)i(to)e
(measure)g(the)h(e\016ciency)h(of)1114 531 y(pip)q(es.)27 b(Apply)17
b(the)g(tec)o(hnique)h(and)e(rep)q(ort)i(y)o(our)1114 581 y(results.)1010
664 y Fi(4.6)j Fn(Devise)k(mo)q(di\014cations)e(to)i(\\pip)q(e.c")g(whic)o(h)
g(will)1114 714 y(mak)o(e)9 b(pip)q(es)i(more)e(e\016cien)o(t)i(according)g
(to)f(the)h(fol-)1114 764 y(lo)o(wing)j(sc)o(heme:)22 b(whenev)o(er)17
b(the)g(\\read")f(p)q(oin)o(ter)1114 814 y(is)d(greater)i(than)e(512,)g
(rotate)h(the)g(non-n)o(ull)e(blo)q(c)o(k)1114 863 y(n)o(um)o(b)q(ers)e(in)g
(the)i(\\ino)q(de")e(ana)g(decrease)k(b)q(oth)c(the)1114 913
y(\\read")j(and)h(\\write")g(p)q(oin)o(ters)g(b)o(y)g(512.)1010
996 y Fi(5.1)21 b Fn(By)e(monitoring)f(the)i(n)o(um)o(b)q(er)f(of)g(free)h
(bu\013ers)h(or)1114 1046 y(otherwise,)c(determine)f(whether)h(the)g(n)o(um)o
(b)q(er)f(of)1114 1096 y(c)o(haracter)11 b(bu\013ers)h(pro)o(vided)e(at)g(y)o
(our)g(installation)1114 1146 y(is)j(adequate.)1010 1229 y
Fi(5.2)21 b Fn(P)o(erform)13 b(measuremen)o(ts)h(and/or)g(exp)q(erimen)o(ts)h
(to)1114 1279 y(determine)10 b(whether)h(the)g(c)o(haracter)g(bu\013er)g(blo)
q(c)o(ks)1114 1328 y(w)o(ould)h(b)q(e)i(more)e(e\016cien)o(tly)i(utilised)f
(if)f(they)i(con-)1114 1378 y(sisted)g(of)f(four)g(or)h(eigh)o(t)f(c)o
(haracters,)i(rather)f(than)1114 1428 y(six,)f(p)q(er)i(blo)q(c)o(k.)1010
1511 y Fi(5.3)21 b Fn(Redesign)11 b(the)h(line)f(prin)o(ter)h(driv)o(er)g(to)
f(handle)g(o)o(v)o(er-)1114 1561 y(prin)o(ting)17 b(and)h(bac)o(kspacing)h
(more)e(e\016cien)o(tly)i(in)1114 1611 y(the)e(sense)i(of)d(minim)o(ising)d
(the)18 b(n)o(um)o(b)q(er)e(of)g(prin)o(t)1114 1660 y(cycles.)1010
1744 y Fi(5.4)21 b Fn(Do)q(cumen)o(t)e(\\mmread")e(\(0916\))i(and)h(\\mm)o
(write")1114 1793 y(\(9042\).)1010 1910 y Fg(26.5)56 b(General)1010
1986 y Fi(6.1)21 b Fn(The)j(easiest)i(w)o(a)o(y)d(to)i(v)n(ary)e(the)i(main)e
(memory)1114 2036 y(space)13 b(used)g(b)o(y)g(the)g(op)q(erating)f(system)g
(is)g(to)h(v)n(ary)1114 2086 y(\\NBUF".)c(If)g(this)g(is)h(forbidden,)g(prop)
q(ose)g(the)g(b)q(est)1114 2136 y(w)o(a)o(y)j(to:)1114 2227
y Fi(\(a\))20 b Fn(reduce)15 b(the)g(space)g(required)g(b)o(y)e(500)g(w)o
(ords;)1114 2293 y Fi(\(b\))19 b Fn(utilise)13 b(an)h(additional)e(500)h(w)o
(ords.)1010 2385 y Fi(6.2)21 b Fn(Discuss)f(the)h(merits)e(of)g(\\C")g(as)h
(a)f(systems)h(pro-)1114 2434 y(grammi)o(ng)10 b(language.)17
b(What)c(features)i(are)e(miss-)1114 2484 y(ing?)k(or)d(sup)q(er\015uous?)
1869 2946 y(107)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
